Universidad Central de Venezuela Facultad de Ciencias Escuela de Computación Trabajo Especial de Grado Reconocimiento de Patrones de Registros De Electrocardiograf́ıa Dinámica de Holter 24 horas Br. Valentina Colmenarez Castillo Caracas; Junio de 2016 Reconocimiento de Patrones de Registros De Electrocardiograf́ıa Dinámica de Holter 24 horas Br. Valentina Colmenarez Castillo Trabajo Especial de Grado presentado ante la ilustre Facultad de Ciencias de la Universidad Central de Venezuela como requisito parcial para optar al t́ıtulo de: Licenciado en Computación. Dr. Esteban Álvarez, Tutor Fecha: Caracas, 03 de Junio de 2016 Prof. Robinson Rivas , Tutor Fecha: Caracas, 03 de Junio de 2016 À la mémoire de mon cher Al... iv v Agradecimientos A Dios y a la Virgen por su amor. A la 3ra. Comunidad Neocatecumenal de la parroquia La Preciośısima Sangre por sus oraciones. A mis padres Clementina, Samuel, a mi hermano José Samuel, mis abuelos: Maria, Luisa(†), Alfonso(†), Pedro(†) y a mis tios, primos y hermanos, a mi cuñada Emily y sobrino Victor Samuel. A mi tutor el Dr. Esteban Álvarez por su inagotable ayuda, gracias. A mi compañero y amigo Ruben Rondon, donde quiera que esté. A los Doctores Federico Moleiro, Ana Elisa Rodriguez y al Prof. Robinson Rivas por apoyo y tutoria en este proyecto. A mis hermanos la Dra. Ines Mart́ınez, Dr. Juan José Anzola y el Lic. Enrique Rodŕıguez por sus oraciones y colaboración en este proyecto. Al Lic. Luis y Mayela Lessey por su ayuda y oraciones. Al Prof. Jonathan Piña (frère) y Vanessa Contreras por su ayuda y cariño. A mis amigos los Mscs. Jennifer y Humberto de Nobrega por su cariño. A mis hermanos Karen Torrealba y la Familia Machado Sojo por su cariño y oraciones. A mis queridos amigos de siempre Ana Maria Aguilar, Jonathan Jaimes y Álvaro Marquina. A Mary Muñoz del Postgrado de F́ısica gracias por tu amistad y apoyo. A la Dra. Haydemar Nuñez, el Prof. Miguel Astor, el Prof. Gilberto Perpiñan y Carlos Ledezma por su colaboración en este trabajo. A Álvaro Roccaro(†), el Prof. Rafael Martin, Prof. Hely Cordero el Lic. Javier Lugo y Ritguey Flores que me motivaron a volver a mis raices, gracias por su amistad. vi A los profesores de la escuela de F́ısica y de la escuela de Computación de la UCV por mi formación profesional. Y a todas y cada una de las personas que de una u otra forma han contribuido a que esté hoy presentando este trabajo. vii Índice general Índice de figuras X Índice de cuadros XIII Resumen 1 Introducción 2 1. Planteamiento del problema 4 1.1. Planteamiento del Problema . . . . . . . . . . . . . . . . . . . . . . . 4 1.2. Objetivo General . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 5 1.3. Objetivos Espećıficos . . . . . . . . . . . . . . . . . . . . . . . . . . . 5 1.4. Alcance . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 6 1.5. Justificación . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 6 2. El Corazón 7 2.1. Anatomı́a y Funcionalidad del Corazón . . . . . . . . . . . . . . . . . 7 2.2. Ciclo Card́ıaco . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 9 2.3. Sistema de Conducción Card́ıaca . . . . . . . . . . . . . . . . . . . . 10 2.4. Alteraciones del Ritmo Cardiaco . . . . . . . . . . . . . . . . . . . . . 11 2.4.1. Arritmias . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 12 2.5. Tipos de Arritmias . . . . . . . . . . . . . . . . . . . . . . . . . . . . 12 2.5.1. Arritmias Supraventriculares . . . . . . . . . . . . . . . . . . . 13 2.5.2. Arritmias Ventriculares . . . . . . . . . . . . . . . . . . . . . . 13 2.5.3. Fibrilación Auricular . . . . . . . . . . . . . . . . . . . . . . . 14 2.5.4. Taquicardia Ventricular . . . . . . . . . . . . . . . . . . . . . 14 2.6. Pruebas Diagnóstico para la Detección de Arritmias . . . . . . . . . . 15 2.6.1. Prueba de Esfuerzo . . . . . . . . . . . . . . . . . . . . . . . . 16 viii 2.6.2. Registro Electrocardiográfico de Largo Plazo . . . . . . . . . . 16 2.7. Derivaciones del Electrocardiógrafo . . . . . . . . . . . . . . . . . . . 17 2.7.1. Derivaciones unipolares . . . . . . . . . . . . . . . . . . . . . . 17 2.7.2. Derivaciones bipolares . . . . . . . . . . . . . . . . . . . . . . 18 2.8. Holter . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 19 2.9. Ruido . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 21 3. Algoritmo especializado 23 3.1. Algoritmos de Detección del QRS . . . . . . . . . . . . . . . . . . . . 23 3.1.1. Filtro Pasa Banda . . . . . . . . . . . . . . . . . . . . . . . . 25 3.1.2. Filtro Pasa Bajos . . . . . . . . . . . . . . . . . . . . . . . . . 25 3.1.3. Filtro Pasa Altos . . . . . . . . . . . . . . . . . . . . . . . . . 26 3.1.4. Derivación . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 26 3.1.5. Función Cuadrática . . . . . . . . . . . . . . . . . . . . . . . . 27 3.1.6. Ventana Móvil Integradora . . . . . . . . . . . . . . . . . . . . 27 3.1.7. Fase de Detección . . . . . . . . . . . . . . . . . . . . . . . . . 28 3.1.8. Umbrales Adaptativos . . . . . . . . . . . . . . . . . . . . . . 28 4. Metodoloǵıa 30 4.1. Base de Datos del Instituto de Medicina Tropical, Departamento de Cardioloǵıa de la UCV . . . . . . . . . . . . . . . . . . . . . . . . . . 30 4.2. Base de Datos del MIT-BIH Normal Sinus Rhythm Databases . . . . 31 4.3. Desarrollo de la Solución . . . . . . . . . . . . . . . . . . . . . . . . . 31 4.4. Algoritmo de Extracción de Caracteŕısticas . . . . . . . . . . . . . . . 32 4.4.1. Detección de los Parámetros Caracteŕısticos . . . . . . . . . . 35 4.4.2. Identificación de Patrones . . . . . . . . . . . . . . . . . . . . 36 Índice general ix 5. Resultados y Discusión 43 5.1. Evaluación de las Pruebas Diagnósticas . . . . . . . . . . . . . . . . . 43 5.1.1. Efectividad . . . . . . . . . . . . . . . . . . . . . . . . . . . . 43 5.1.2. Eficiencia . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 44 5.1.3. Verdaderos Positivos(VP): . . . . . . . . . . . . . . . . . . . . 44 5.1.4. Falsos Negativos(FN): . . . . . . . . . . . . . . . . . . . . . . 44 5.1.5. Verdaderos Negativos(VN): . . . . . . . . . . . . . . . . . . . 44 5.1.6. Falsos Positivos(FP): . . . . . . . . . . . . . . . . . . . . . . . 44 5.1.7. Sensibilidad o Tasa de Verdaderos Positivos: . . . . . . . . . . 45 5.1.8. Especificidad o Tasa de Verdaderos Negativos: . . . . . . . . . 45 5.1.9. Exactitud: . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 45 5.2. Análisis de Resultados . . . . . . . . . . . . . . . . . . . . . . . . . . 45 5.2.1. Registros con Presencia de Patrones de TVNS . . . . . . . . . 46 5.2.2. Registros con Presencia de Patrones de FAP . . . . . . . . . . 48 5.2.3. Registros Control . . . . . . . . . . . . . . . . . . . . . . . . . 54 6. Conclusiones y Trabajos Futuros 58 6.1. Trabajos Futuros . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 59 Acrónimos 60 A. Código Fuente 61 Referencias Bibliográficas 81 x Índice de figuras 2.1. El corazón (Fuente: www.emaze.com) . . . . . . . . . . . . . . . . . . 8 2.2. El ciclo card́ıaco (Fuente: resumen2cardiomeregarcia.blogspot.com) . 9 2.3. Sistema de conducción card́ıaca (Fuente: es.slideshare.net) . . . . . . 10 2.4. Composición de una Señal Electrocardiográfica (Fuente: www.scielo.org.co) . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 12 2.5. Caracteristicas de la Fibrilación Auricular Parox́ıstica (Fuente: Elabo- ración propia) . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 14 2.6. Caracteŕısticas de la Taquicardia Ventricular no Sostenida (Fuente: Elaboración propia) . . . . . . . . . . . . . . . . . . . . . . . . . . . . 15 2.7. Derivaciones unipolares (Fuente: slideplayer.es) . . . . . . . . . . . . 18 2.8. Derivaciones bipolares (Fuente: slideplayer.es) . . . . . . . . . . . . . 19 2.9. Ruido presente en un registro ECG (Fuente: www.monografias.com) 22 3.1. Diagrama de Bloques del Algoritmo de Pan-Tompkins (Fuente: Elabo- ración propia) . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 24 4.1. Detector. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 32 4.2. Estructura general del detector. . . . . . . . . . . . . . . . . . . . . . 33 4.3. Estructura del proyecto . . . . . . . . . . . . . . . . . . . . . . . . . . 34 4.4. Fase de Detección de los parámetros caracteŕısticos. . . . . . . . . . . 37 4.5. Fase de Identificación de patrones . . . . . . . . . . . . . . . . . . . 39 4.6. Diagrama de flujo del algoritmo detector de FAP. . . . . . . . . . . . 40 4.7. Diagrama de flujo del algoritmo detector de TVNS. . . . . . . . . . . 41 Índice de figuras xi 5.1. Gráfica del registro ctvp 03 1ev 215859 bajo el esquema de 3 inter- valos RR consecutivos bajo observación (Fuente: Elaboración propia). (a) Se muestra serie de intervalos RR. (b) Presencia de intervalos RR irregulares (1) e intervalos RR regulares (0). (c) Se muestra la presen- cia de complejos QRS con un ancho mayor a 120 ms (1) y ausencia de complejos QRS anchos (0). (d) Presencia de frecuencias instantáneas mayor a 100 lpm (1) y ausencia de frecuencias instantáneas mayor a 100 lpm (0) que acompaña cada complejo. (e) Se muestra presencia (1) y ausencia (0) de un patrón de TVNS en el registro . . . . . . . . . . 47 5.2. Gráfica del registro cfap 11 1ev 021600 bajo el esquema de 3 intervalos RR consecutivos bajo observación (Fuente: Elaboración propia). (a) Se muestra serie de intervalos RR. (b) Presencia de intervalos RR irregu- lares (1) e intervalos RR regulares (0). (c) Se muestra la presencia de onda P (1) y ausencia de onda P (0) que acompaña cada complejo. (d) Presencia de frecuencias instantáneas menores a 50 lpm (0), frecuen- cias instantaneas entre 50 y 100 lpm (1) y frecuencias superiores a 100 lpm (2).en cada intervalo RR. (e) Se muestra presencia (1) y ausencia (0) de un patrón de FAP en el registro . . . . . . . . . . . . . . . . . 49 5.3. Gráfica del registro cfap 08 1ev 235342 bajo el esquema de 3 intervalos RR consecutivos bajo observación (Fuente: Elaboración propia). (a) Se muestra serie de intervalos RR. (b) Presencia de intervalos RR irregu- lares (1) e intervalos RR regulares (0). (c) Se muestra la presencia de onda P (1) y ausencia de onda P (0) que acompaña cada complejo. (d) Presencia de frecuencias instantáneas menores a 50 lpm (0), frecuen- cias instantáneas entre 50 y 100 lpm (1) y frecuencias superiores a 100 lpm (2).en cada intervalo RR. (e) Se muestra presencia (1) y ausencia (0) de un patrón de FAP en el registro . . . . . . . . . . . . . . . . . 50 5.4. Gráfica del registro cfap 08 1ev 235342 bajo el esquema de 4 intervalos RR consecutivos bajo observación (Fuente: Elaboración propia). (a) Se muestra serie de intervalos RR. (b) Presencia de intervalos RR irregu- lares (1) e intervalos RR regulares (0). (c) Se muestra la presencia de onda P (1) y ausencia de onda P (0) que acompaña cada complejo. (d) Presencia de frecuencias instantáneas menores a 50 lpm (0), frecuen- cias instantáneas entre 50 y 100 lpm (1) y frecuencias superiores a 100 lpm (2).en cada intervalo RR. (e) Se muestra presencia (1) y ausencia (0) de un patrón de FAP en el registro . . . . . . . . . . . . . . . . . 52 5.5. Gráfica del registro del sujeto de control nsrdb 19088 22:58:00 bajo el esquema de 3 intervalos RR consecutivos bajo observación (Fuente: Elaboración propia).(a) Se muestra serie de intervalos RR. (b) Pre- sencia de intervalos RR irregulares (1) e intervalos RR regulares (0). (c) Se muestra la presencia de complejos QRS con un ancho mayor a 120 ms (1) y ausencia de complejos QRS anchos (0). (d) Se muestra la presencia de onda P (1) y ausencia de onda P (0) que acompaña cada complejo. (e) Presencia de frecuencias instantáneas entren 60 y 100 lpm (1) y ausencia de frecuencias dentro de este rango(0) en ca- da intervalo RR. (f) Se muestra presencia(1) y ausencia(0) de algún patrón de las arritmias estudiadas (FAP o TVNS). . . . . . . . . . . . 55 Índice de figuras xii 5.6. Gráficas del sujeto de control nsrdb 16273 09:00:00 bajo el esquema de 3 intervalos RR consecutivos bajo observación (Fuente: Elaboración propia).(a) Se muestra serie de intervalos RR. (b) Presencia de inter- valos RR irregulares (1) e intervalos RR regulares (0). (c) Se muestra la presencia de complejos QRS con un ancho mayor a 120 ms (1) y ausencia de complejos QRS anchos (0). (d) Se muestra la presencia de onda P (1) y ausencia de onda P (0) que acompaña cada complejo. (e) Presencia de frecuencias instantáneas entren 60 y 100 lpm (1) y au- sencia de frecuencias dentro de este rango(0) en cada intervalo RR. (f) Se muestra presencia(1) y ausencia(0) de algún patrón de las arritmias estudiadas (FAP o TVNS). . . . . . . . . . . . . . . . . . . . . . . . . 56 5.7. En esta imagen correspondiente a las anotaciones del registro nsrdb- 16273 de la base de datos MIT-BIH Normal Sinus Rhythm, se muestra señalado en un ćırculo rojo el instante de tiempo 09:08:46 donde se presenta el patrón de FAP hallado por el prototipo, pero en dichas anotaciones no se reporta tal anomaĺıa. . . . . . . . . . . . . . . . . 57 xiii Índice de cuadros 5.1. Tabla de resultados de la TVNS bajo el esquema de observación de 3 intervalos RR consecutivos bajo observación . . . . . . . . . . . . . . 48 5.2. Tabla de resultados de la FAP bajo el esquema de 3 intervalos RR consecutivos bajo observación . . . . . . . . . . . . . . . . . . . . . . 51 5.3. Tabla de resultados de la FAP bajo el esquema de 4 intervalos RR consecutivos bajo observación . . . . . . . . . . . . . . . . . . . . . . 53 5.4. Resultado de pacientes control bajo el esquema de 3 intervalos RR bajo observación . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 57 1 Resumen Reconocimiento de Patrones de Registros De Electrocardiograf́ıa Dinámica de Holter 24 horas Br. Valentina Colmenarez Castillo Universidad Central de Venezuela Dr. Esteban Álvarez y Prof. Robinson Rivas , Tutores El objetivo del presente Trabajo Especial de Grado es el diseño e implementación de un software a partir de herramientas open source, capaz de reconocer patrones de eventos de Fibrilación Auricular Parox́ıstica (FAP) y Taquicardia Ventricular no sostenida (TVNS), a partir de registros de series temporales (ECG), partiendo de dos parámetros únicos de entrada: La irregularidad de los intervalos RR y la ausencia de la onda P, para el caso de la FAP. Para el patrón de TVNS, el ancho del complejo QRS y la irregularidad del intervalo RR. Los registros utilizados fueron proporciona- dos por la Sección de Cardioloǵıa Experimental – Instituto de Medicina Tropical – UCV. Se realizó un procesamiento a las series temporales a partir del algoritmo de Pan-Tompkins, con el fin de detectar parámetros tales como: duración de los interva- los RR, ancho QRS y onda P, que caracterizan las arritmias card́ıacas antes citadas. Para el reconocimiento final de los patrones, a partir de los parámetros citados se implementa un método para la tomas de decisiones, basado en sentencias condicio- nales, evitando aśı, el uso de un método de decisión más complejo como el de redes neuronales artificiales. Como resultados relevantes se obtiene una sensibilidad del de- tector de 100 %, especificidad de 99,99 % y exactitud de 99,99 % para la detección del patrón de TVNS y para los eventos de FAP una sensibilidad de 75 %, especificidad de 99,89 % y exactitud de 99,89 %. Palabras clave: Señal ECG, complejo QRS, onda P, detector de arritmias, arritmia, fibrilación auricular parox́ıstica, taquicardia ventricular no sostenida, algoritmo de Pan-Tompkins. 2 Introducción Las arritmias cardiacas son alteraciones del funcionamiento eléctrico normal del corazón. Algunas son potencialmente malignas y constituyen, con otras enfermedades cardiovasculares, una de las principales causas de mortalidad en el mundo, según la Organización Mundial de la Salud (OMS) 1, para el año 2012 representaron un 31 %, y ese mismo año, solo en nuestro páıs un 20,58 %, representando las enfermedades cardiovasculares la primera causa de muerte en Venezuela. [27] Hoy en d́ıa, el estudio de los mecanismos de las arritmias patológicas se asien- ta sobre dos ámbitos de investigación: de un lado, el análisis de señales card́ıacas registradas mediante sistemas de captación con electrodos en estudios cĺınicos y/o experimentales, tales como los electrogramas intracavitarios y del electrocardiograma de superficie, de otro lado, el análisis de la dinámica del sustrato cardiaco a partir imágenes proporcionadas por sistemas de mapeo óptico en estudios experimentales in- vivo e in-vitro. La detección de cardiopat́ıas como la Fibrilación Auricular Parox́ıstica (FAP) y Taquicardia Ventricular No Sostenida (TVNS) es de vital importancia, ya que su detección temprana puede ayudar a disminuir el nivel de morbilidad o morta- lidad de la población, motivo por el cual, se propone el desarrollo e implementación de una herramienta de software para el reconocimiento de estas patoloǵıas a bajo costo, a través del framework de Qt Project, basado en un algoritmo para la detec- ción del complejo QRS, de la onda P, la irregularidad y frecuencia, contando con el asesoramiento de la sección de Cardioloǵıa Experimental del Instituto de Medicina Tropical, además de la escuela de F́ısica y de Computación de la Universidad Central de Venezuela. Para el desarrollo de la herramienta antes mencionada, se abordaron dos etapas: la primera consistió en el estudio y elección de un marco de trabajo para la imple- mentación del software, resultando en el uso de Qt; por ser esta, una herramienta de código abierto. En una segunda etapa, se abordó el estudio de algoritmos espe- cializados, permitiendo el acondicionamiento de los registros de ECG, facilitando de 1http://www.who.int/en/ Índice de figuras 3 esta manera la adquisición de los parámetros necesarios para la identificación de los patrones asociados a las arritmias espećıficas bajo estudio. Como resultado se logró la detección de los eventos arŕıtmicos estudiados por medio de la detección de los com- plejos PQRS, lo cual facilita la detección de de los parámetros mı́nimos tales como el ancho del complejo QRS, la irregularidad entre cada intervalo RR y la frecuencia instantánea. Estos parámetros son utilizados en la detección de los patrones de FAP y TVNS. Finalmente para la revisión de todos estos aspectos se presenta la siguiente estruc- tura del trabajo: En un primer caṕıtulo se inicia la discusión con el planteamiento del problema, sus alcances y objetivos. Posteriormente en el caṕıtulo dos, se presenta una breve descripción de los aspectos teóricos necesarios para la comprensión de este trabajo. Conocida esta información, en un tercer caṕıtulo se realiza una detallada descripción del algoritmo especializado, implementado en este trabajo. En un cuarto caṕıtulo, se desarrolla la metodoloǵıa para el desarrollo del software, y por último, en el quinto caṕıtulo, se presenta la discusión y resultados obtenidos. 4 Caṕıtulo 1 Planteamiento del problema Este caṕıtulo inicia la discusión, a partir del planteamiento del problema, describe los objetivos, e indica el alcance esperado en el presente trabajo. 1.1. Planteamiento del Problema El número de pacientes con arritmias card́ıacas tiende a incrementarse cada año. Por ello, es posible encontrar en muchos centros hospitalarios, que el personal designa- do para dar atención a tales pacientes es insuficiente. Es aśı que se vuelve totalmente necesario contar con equipos automatizados, que además de registrar las ondas ECG, sean capaces de identificar los tipos de arritmias cardiacas facilitando un diagnóstico inmediato por parte del especialista. Es bien conocida la importancia de la señal ECG para el diagnóstico de un sin fin de enfermedades card́ıacas, a partir de la inspección visual o mediante técnicas actuales de inspección automática. Desde el punto de vista médico, la posibilidad de disponer de herramientas que, a partir de las señales, puedan enfatizar la actividad Auricular y Ventricular, son realmente interesantes y además hoy en d́ıa necesarias, pues pueden permitir el desarrollo de técnicas no invasivas de ayuda al diagnóstico cĺınico, como por ejemplo, clasificación entre distintas manifes- taciones de Fibrilación Auricular y Taquicardia Ventricular, aśı como la detección de otras patoloǵıas, evitando los métodos tradicionales de reconocimiento de arritmias, que pueden ser largos y tediosos, ocasionando un diagnóstico tard́ıo, que en muchos casos puede ser fatal para el paciente. Por tal motivo, una identificación automatizada del tipo de arritmia card́ıaca en el momento preciso se vuelve sumamente importante. En el mercado, existen aplicaciones capaces de identificar tipos de arritmias cardia- cas de forma rápida, pero a costos elevados, debido a que se debe adquirir la licencia Caṕıtulo – 1. Planteamiento del problema 5 del producto, o el servicio técnico en caso de presentarse alguna eventualidad, y en algunos casos equipo de hardware especializado. Por tal motivo, se desarrolló una herramienta de software que permite el reconocimiento automatizado de dos tipos de arritmias FAP y TVNS, de forma rápida, y a bajo costo porque las herramientas de desarrollo son de código abierto, para prescindir del costo de licencia. 1.2. Objetivo General Diseñar e implementar un software capaz de reconocer patrones de eventos de Fi- brilación Auricular Parox́ıstica (FAP) y Taquicardia Ventricular No Sostenida (TVNS), a partir de registros de series temporales (ECG Holter 24 horas), por medio de he- rramientas computacionales. 1.3. Objetivos Espećıficos 1. Investigar en la bibliograf́ıa los siguientes aspectos: Anatomı́a y funcionalidad del corazón, electrocardiograf́ıa dinámica de Holter 24 horas, arritmias cardia- cas, técnicas o modelos computacionales de reconocimiento de patrones en re- gistros temporales. 2. Identificar los cambios caracteŕısticos que suceden en registros temporales, aso- ciados con los eventos de FAP, por medio de técnicas o metodoloǵıas compu- tacionales. 3. Identificar los cambios caracteŕısticos que suceden en registros temporales, aso- ciados con los eventos de TVNS, por medio de técnicas o metodoloǵıas compu- tacionales. 4. Evaluación y entonación del sistema de reconocimiento de patrones implemen- tado. Caṕıtulo – 1. Planteamiento del problema 6 1.4. Alcance Este proyecto es el primer paso para un trabajo de mayor envergadura. Está desa- rrollado bajo tecnoloǵıas opensource lo que permite su continuidad. Además los es- pecialistas del área de cardioloǵıa podrán adquirir un software para la detección de arritmias mantenible en el tiempo dada las bondades del software libre. La evaluación de desempeño del producto se llevará a cabo con el análisis de 36 registros ECG provenientes de la base de datos internacional de PhysioNet y del Departamento de Cardioloǵıa de la UCV, ya digitalizados y con presencia de ruido. El prototipo en caso de detectar presencia de patrones de TVNS y FAP, presentará la ubicación de los patrones de arritmia encontrados en un archivo de texto que puede ser visualizado posteriormente. Aśı pues, diversas herramienta para graficar pueden ser utilizadas, debido a que la salida se presentará en un fichero de texto plano. La implementación no cuenta con una interfaz gráfica que permita visualizar los resultados obtenidos después del proceso de análisis. Sólo se detectan dos patrones de arritmia FAP y TVNS, dejando abierta la posibilidad para la creación de módulos de detección de cardiopatias de tipo ventricular y supraventricular. 1.5. Justificación El alto costo de adquisición y mantenimiento de equipos para apoyar el diagnósti- co de cardiopat́ıas en las Instituciones médicas públicas y la tasa de morbilidad y mortalidad por dichas enfermedades han incrementado los esfuerzos para avanzar en materia tecnológica. El impacto que tiene desarrollar soluciones opensource es de gran interés en la comunidad cient́ıfica, por su bajo costo y múltiples ventajas. La presente investigación representa el primer paso en el desarrollo de una solución para suplir las deficiencias de los centros médico-hospitalarios. Aśı pues, se presenta una herramienta multiplataforma compatible en Windows y Linux que lleva a cabo el análisis de la señal ECG adquirida previamente y digitalizada por un dispositivo de captura Holter. 7 Caṕıtulo 2 El Corazón En este caṕıtulo se presentan los fundamentos electrofisiológicos que describen el comportamiento eléctrico, anatomı́a y funcionalidad del corazón. Mediante este desarrollo, se explican en detalle los sistemas de excitación y conducción responsables de su funcionamiento normal y también se examinan los trastornos en la actividad eléctrica cardiaca, más conocidos como arritmias según [6]. Por ello cada una de las secciones de este caṕıtulo conforma la base conceptual que, proporciona el conjunto de modelos y señales cardiacas que serán utilizados como herramientas de análisis en el trabajo. 2.1. Anatomı́a y Funcionalidad del Corazón Para todo organismo vivo que posee corazón, este representa el eje fundamental de su funcionamiento gracias a la acción de bombeo que el mismo realiza, con la cual asegura que la sangre como fluido fundamental llegue a todos los tejidos, con los nu- trientes y el ox́ıgeno necesario para los procesos metabólicos de śıntesis y degradación, permitiendo también el regreso de la misma cuando carece de dichas propiedades. Por esta razón, se presentarán un conjunto de definiciones asociadas al órgano principal del sistema circulatorio, llamado, por algunos: “El órgano más fuerte y poderoso o la sala de máquinas del cuerpo”. El corazón tiene aproximadamente el mismo tamaño que el puño, pero no la misma forma. Mide aproximadamente de 12cms de largo, 9 de ancho y 6 de espesor [12]. El corazón se localiza en la parte inferior del mediastino medio, entre el segundo y quinto espacio intercostal, izquierdo. Está situado de forma oblicua: aproximadamente Caṕıtulo – 2. El Corazón 8 dos tercios a la izquierda del plano medio y un tercio a la derecha. Tiene forma de una pirámide inclinada con el vértice en el “suelo” en sentido anterior izquierdo; la base, opuesta a la punta, en sentido posterior y 3 lados: la cara diafragmática, sobre la que descansa la pirámide, la cara esternocostal, anterior y la cara pulmonar hacia la izquierda. Desde el punto de vista histológico, es un órgano conformado por tres capas: El endocardio, una membrana serosa de endotelio y tejido conectivo de revesti- miento interno, con la cual entra en contacto la sangre. Incluye fibras elásticas y de colágeno, vasos sangúıneos y fibras musculares especializadas, las cuales se denominan Fibras de Purkinje. El miocardio, es una masa muscular contráctil. El músculo card́ıaco propiamente dicho; encargado de impulsar la sangre por el cuerpo mediante su contracción. El pericardio es una membrana fibroserosa de dos capas, el pericardio visceral seroso o epicardio y el pericardio fibroso o parietal, que envuelve al corazón y a los grandes vasos separándolos de las estructuras vecinas, como se observa en la imagen 2.1. Figura 2.1: El corazón (Fuente: www.emaze.com) Caṕıtulo – 2. El Corazón 9 2.2. Ciclo Card́ıaco El corazón consta de 4 cavidades, dos auŕıculas: derecha e izquierda y 2 ventŕıculos: derecho e izquierdo. Según [12] la auŕıcula derecha (AD) recibe el retorno venoso (sangre desoxigenada) de la circulación sistémica a través de las venas cava superior e inferior, al final del periodo de llenado pasivo de la auŕıcula, es excitada, y la contracción auricular, impulsa una cantidad adicional de sangre dentro del ventŕıculo derecho a través de la válvula auriculoventricular derecha (tricúspide) y este alcanza un mayor tamaño. Luego del llenado del ventŕıculo derecho (VD), es excitado y en su pared empieza a desarrollarse tensión que se aplica sobre el volumen de sangre que contiene y crea presión intraventricular, cuando esta presión supera la presión intraarterial, el VD se contrae y expulsa la sangre a través de las válvulas pulmonares hacia el interior de la arteria pulmonar que conduce la sangre a los pulmones. En el lecho capilar de los pulmones se añade oxigeno O2 y se elimina el CO2. Figura 2.2: El ciclo card́ıaco (Fuente: resumen2cardiomeregarcia.blogspot.com) La sangre recién oxigenada en los pulmones retorna al corazón a través de las venas pulmonares hasta la auŕıcula izquierda (AI), luego de su llenado, esta fluye al ventŕıculo izquierdo (VI) a través de la válvula auriculoventricular izquierda (mitral). Posterior al llenado Ventricular, se inicia la excitación que conlleva a la contracción Caṕıtulo – 2. El Corazón 10 del mismo y la subsecuente expulsión de la sangre hacia el interior de la aorta, a partir de esta se distribuye a las circulación sistémica. De acuerdo a López Grillo (1999) en [9]: En el periodo de relajación las presiones dentro de los ventŕıculos son bajas y cuando se llenan de sangre aumenta su volumen. El llenado Ventricular se completa con la sangre que aporta la contracción auricular, de igual forma, en el periodo de contracción las presiones dentro de los ventŕıculos aumentan y cuando los ventŕıculos expulsan sangre disminuye su volumen. Estos procesos de relajación y contracción se denominan: śıstole y diástole (ver figura 2.2). 2.3. Sistema de Conducción Card́ıaca El sistema de conducción según [9] es un sistema especializado que tiene como función, la generación y propagación del impulso ŕıtmico y la contracción coordinada del corazón. El sistema de conducción se divide en dos subsistemas, el primero es un sistema de producción de est́ımulos, uno con capacidad de automatismo (marcapasos) y el otro permite la conducción de dicho est́ımulo (ver figura 2.3). Figura 2.3: Sistema de conducción card́ıaca (Fuente: es.slideshare.net) Caṕıtulo – 2. El Corazón 11 La actividad eléctrica durante cada ciclo card́ıaco normal empieza en el nodo si- nusal y sigue hasta que todo el corazón se activa. El nodo sinusal o nodo de Keith y Flack, forma parte del subsistema de producción de est́ımulo, conformado por te- jido especializado de conducción con la capacidad de generar potenciales de acción espontáneos, es decir generar el impulso eléctrico. Está situado en la unión entre la vena cava superior y la auŕıcula derecha, y está compuesto de tejido fibroso llamado fibras nodales o células P, que son el punto de partida para la formación del impulso normal del nodo, a una frecuencia de 60 a 100 latidos/min, automatismo que supera cualquier otro punto capaz de producir est́ımulos en el corazón, por esta razón, tam- bién es llamado el marcapasos fisiológico [11]. Luego de originarse el impulso eléctrico, este viaja a través de las auŕıculas, por los fasćıculos auriculares internodales, permi- tiendo aśı la despolarización de la misma, que se representa por la onda P en la señal electrocardiográfica (ver figura 2.4), y tiene como punto de llegada el nodo AV, este proceso de despolarización, seguida de repolarización auricular permite el periodo de llenado y expulsión por parte de las auŕıculas a los ventŕıculos. Posteriormente, el nodo AV va a permitir la conducción eléctrica de este impulso a los ventŕıculos, en forma transversal, a través del haz de His, las ramas derecha e izquierda y las fibras de Purkinje, permitiendo la despolarización de los ventŕıculos, esta despolarización se representa a partir del complejo QRS en el electrocardiograma, ulterior a esta despo- larización, ocurre un periodo de repolarización Ventricular que es representada en el electrocardiograma por la onda T (ver figura 2.4). Este proceso de despolarización y repolarización, permiten la śıstole y diástole Ventricular. El comportamiento Auricular y Ventricular ocurre de forma sincronizada, la pérdi- da de sincronización en ambos procesos, traen como consecuencia, la aparición de diversas cardiopat́ıas, entre estas, las arritmias que se desarrollarán en apartados posteriores. 2.4. Alteraciones del Ritmo Cardiaco La alteración del ritmo cardiaco es según [6] consecuencia de la generación normal o anómala del impulso eléctrico, de la conducción anómala de este impulso o de una combinación de ambas. Estas alteraciones del ritmo son conocidas como arritmias y Caṕıtulo – 2. El Corazón 12 Figura 2.4: Composición de una Señal Electrocardiográfica (Fuente: www.scielo.org.co) esta sección proporcionará una breve descripción y clasificación de este trastorno, que es causa de la mayor tasa de morbilidad en la población mundial. 2.4.1. Arritmias La alteración del ritmo card́ıaco, consecuencia de la actividad eléctrica anormal en el corazón se conoce como arritmia card́ıaca. El est́ımulo eléctrico originado en el nódulo Sinusal o marcapasos fisiológico, se conduce a las auŕıculas y los ventŕıculos con una frecuencia que oscila entre 60 y 100 latidos por minuto 2.5. Tipos de Arritmias Las arritmias card́ıacas pueden clasificarse según su frecuencia, origen o mecanis- mo de producción [6]. Si la frecuencia es mayor a la generada por el nodo Sinusal se denominan taquiarritmias, y bradiarritmias cuando la frecuencia es menor. Si el origen de la arritmia se encuentra por encima de la bifurcación del haz de His son conocidas como supraventriculares, y ventriculares cuando se generan por debajo. Según el mecanismo de producción, si se dan alteraciones en el inicio del impulso eléctrico como consecuencia de despolarizaciones espontáneas, se denomina automa- tismo, si se dan en la conducción debido a variaciones de los peŕıodos refractarios Caṕıtulo – 2. El Corazón 13 de las diferentes fibras, que causan que el impulso se bloquee en algunos sectores y en otros continúe, generando circuitos en los que el est́ımulo recircule, son llamadas reentrada y por último, si se generan por la aparición de pospotenciales durante o después de la despolarizaron, produciendo una despolarización parcial de las fibras, seŕıa una actividad gatillada, como definen algunos autores. Clasificación de algunas arritmias, según su origen: 2.5.1. Arritmias Supraventriculares Arritmia Sinusal Extrasistolia auricular Taquiarritmias Supraventriculares Taquicardia Sinusal Aleteo auricular Fibrilación auricular, etc. 2.5.2. Arritmias Ventriculares Extrasistolia Ventricular Parasistolia Ventricular Taquicardia Ventricular Fibrilación Ventricular, etc. En el siguiente apartado, solo se menciona la Taquicardia Ventricular y la Fibri- lación Auricular, por ser estas de mayor interés en este estudio [16]. Caṕıtulo – 2. El Corazón 14 Figura 2.5: Caracteristicas de la Fibrilación Auricular Parox́ıstica (Fuente: Elaboración propia) 2.5.3. Fibrilación Auricular La fibrilación auricular es según [7] una arritmia supraventricular caracterizada por una activación incoordinada de las auŕıculas, (consecuencia de la pérdida de la función hemodinámica de las auŕıculas) teniendo o no, una respuesta Ventricular va- riable, esto significa, que puede presentarse, durante la fibrilación, un comportamiento normal de los ventŕıculos (QRS normal) o puede generarse una Taquicardia Ventricu- lar (deformación y aumento de la frecuencia de los complejos QRS) al mismo tiempo. Esta arritmia se caracteriza por presentar ondulaciones irregulares y pequeñas de am- plitud y morfoloǵıa variable denominadas ondas f con frecuencia de 350 a 600 lpm, y una onda P ausente, este tipo de arritmia, disminuye el gasto cardiaco en un 25 %. En la práctica, se encuentra la Fibrilación Auricular del tipo parox́ıstica, episodios que se revierten con tratamiento o por si solos en menos de 72 horas, persistente con una duración de semanas, y permanente. Las condiciones que debe cumplir una cardiopatia para considerarse fibrilación auricular parox́ıstica, son las siguientes: Ausencia de la Onda P. Diferentes tres intervalos R-R consecutivos, en 20 Latidos contiguos. Frecuencia cardiaca entre 50 y 200 lpm. 2.5.4. Taquicardia Ventricular La taquicardia ventricular se define según [6] como la ocurrencia de tres o más extraśıstoles ventriculares (latidos prematuros que se originan fuera del nodo Sinusal) Caṕıtulo – 2. El Corazón 15 Figura 2.6: Caracteŕısticas de la Taquicardia Ventricular no Sostenida (Fuente: Ela- boración propia) consecutivas con una duración mayor a 120ms y una frecuencia que vaŕıa de 70 a 250 lpm. Se origina en el sistema especializado de conducción, situado en la localización distal a la bifurcación del haz de His, en el músculo Ventricular o en combinaciones de ambos tipos de tejido. Los mecanismos suelen ser trastornos en la formación y en la conducción del impulso. Se encuentran Taquicardias Ventriculares del tipo No Soste- nida que tienen un origen repentino, cuya duración en menor a 30s y Sostenida cuya duración en mayor a 30s, cuando los contornos del QRS son fijos es una Taquicar- dia Ventricular Monomorfa, si vaŕıan al azar Taquicardia Ventricular Polimorfa, si la variación es más o menos repetitiva se denomina Taquicardia Ventricular Helicoidal. Las condiciones que se deben cumplir para considerarse como taquicardia ventri- cular no sostenida, un evento, son las siguientes: Ancho del complejo QRS mayor a 120 ms . Poca irregularidad de los intervalos R-R. Frecuencia cardiaca mayor a 100 lpm. 2.6. Pruebas Diagnóstico para la Detección de Arrit- mias Debido al peligro que representa para la vida de un paciente un trastorno en el ritmo cardiaco, se han diseñado una serie de pruebas que van desde métodos más sencillos, como un interrogatorio o examen f́ısico, hasta el más complejo, es decir, Caṕıtulo – 2. El Corazón 16 desde el que requiera menor penetración o inocuidad hasta el más peligroso e invasivo. Para la evaluación de pacientes con arritmias cardiacas, se emplean los siguientes métodos: 2.6.1. Prueba de Esfuerzo El ejercicio induce diversos tipos de taquiarritmias supraventriculares y ventricu- lares y, rara vez, bradiarritmias. Los pacientes con śıntomas que indican una arritmia producida por el ejercicio (p. ej., śıncope, palpitación sostenida, etc.) son aptos para someterse a la prueba de esfuerzo. La prueba de esfuerzo mide el consumo máximo de ox́ıgeno y otras variables fisiológicas a través de analizadores de gases respiratorios para la prueba de esfuerzo directa, y la indirecta, se realiza sin disponer del analiza- dor. Estas pruebas se pueden realizar en el laboratorio o sobre el terreno, donde la persona realiza su actividad deportiva [16][12]. 2.6.2. Registro Electrocardiográfico de Largo Plazo De los métodos existentes, el registro ECG es el más útil para detectar y cuanti- ficar la frecuencia y complejidad de las arritmias, correlacionar su aparición con los śıntomas del paciente y evaluar el efecto del tratamiento antiarŕıtmico en arritmias espontáneas. Un registro electrocardiográfico o electrocardiograma según [4]: “Es un método de utilidad diagnóstica basado en el registro de la actividad eléctri- ca card́ıaca.” Existen diferentes modalidades de registro, el cual puede ser: 1) Continuo, en cuyo caso se registran todos los latidos para su ulterior análisis; también se utiliza un dispositivo de análisis en tiempo real. 2) Activado por el propio paciente, que es un método útil cuando éste percibe los śıntomas de la arritmia a fin de activar el sistema 3) Activado por la propia arritmia: una modalidad eficaz. Pero que depende de la precisión y confiabilidad del algoritmo del dispositivo capaz de detectar la arritmia. Mucho de los Marcapasos y desfibriladores internos permiten registrar el ECG durante un tiempo prolongado, y otros poseen un dispositivo de registro que se implanta en la región subcutánea, para el seguimiento a largo plazo. Caṕıtulo – 2. El Corazón 17 2.7. Derivaciones del Electrocardiógrafo La contracción y dilatación del corazón, son consecuencia de su estimulación eléctrica, estos est́ımulos eléctricos producen diferencias de potencial, que pueden registrarse a través de una serie de cables y electrodos, conectados a la superficie corporal del individuo. El registro de la señal producida en el músculo card́ıaco, me- diante una serie de electrodos que se ubican en una posición diferente, según normas preestablecidas, en relación con el corazón, se denomina Derivación. La finalidad de una derivación electrocardiográfica según [8] es medir la corriente que va en la dirección marcada por una ĺınea recta que une los electrodos que llevan a cabo el registro. Estas derivaciones son de dos tipos: Derivaciones unipolares y bipolares. 2.7.1. Derivaciones unipolares Las derivaciones unipolares registran la diferencia de potencial entre un punto del cuerpo y otro punto llamado centro eléctrico. Estas derivaciones miden la fuerza eléctrica absoluta de un electrodo positivo único en el cuerpo, Para esto se necesita que el otro electrodo sea de potencial cero (0), y esto se logra uniendo los cables de las extremidades correspondientes a los electrodos negativos de tal manera que se anulen sus fuerzas respectivas, el electrodo positivo es el explorador y el negativo está conformado por la unión de los otros dos electrodos exploradores (ver figura 2.7). Fueron ideadas por Frank Wilson en 1934 [8]. Existen dos tipos de derivaciones unipolares que van a depender de la localización de los electrodos, estas son: Derivaciones unipolares precordiales V1: Los electrodos deben colocarse en la intersección del cuarto espacio inter- costal derecho (EID) con ĺınea paraesternal (LPE) derecha (borde derecho del esternón). V2: Los electrodos deben colocarse en la intersección del cuarto espacio inter- costal izquierdo (EII) con LPE izquierda. V3: Intermedio entre V2 y V4. Caṕıtulo – 2. El Corazón 18 Figura 2.7: Derivaciones unipolares (Fuente: slideplayer.es) V4: Los electrodos deben colocarse en el quinto EII con ĺınea medio clavicular. V5: Los electrodos deben colocarse en quinto EII con ĺınea axilar anterior. V6: Los electrodos deben colocarse en quinto EII con ĺınea axilar media. Derivaciones unipolares de las extremidades: aVR: Electrodo (-) en la unión del brazo izquierdo y la pierna izquierda y (+) en el brazo derecho. aVL: Electrodo (-) en la unión del brazo derecho y la pierna izquierda y (+) en el brazo izquierdo. aVF: Electrodo (-) en la unión del brazo izquierdo y el brazo derecho y (+) en la pierna izquierda. 2.7.2. Derivaciones bipolares Las derivaciones bipolares, creadas por William Einthoven [8], registran la dife- rencia de potencial eléctrico que se produce entre dos puntos del cuerpo, se obtiene al tomar el registro de 4 electrodos ubicados, uno en el brazo derecho, otro en el iz- quierdo, otro en la pierna izquierda y, finalmente, otro en la pierna derecha, que es la toma de la tierra. El dipolo tiene como electrodo negativo el derecho y como positivo el izquierdo, y su eje de circunferencia está entre 0◦ a 180◦. Las derivaciones bipolares Caṕıtulo – 2. El Corazón 19 Figura 2.8: Derivaciones bipolares (Fuente: slideplayer.es) son tres, y Einthoven las denominó D1, D2 y D3, como se presenta en la figura 2.8, y cada una se describe a continuación: DI: Registra la diferencia de potencial entre el electrodo (polo +) en el brazo izquierdo y (polo -) en el brazo derecho. DII: Registra la diferencia de potencial entre el electrodo (polo -) en el brazo derecho y (polo +) en la pierna izquierda. DIII: Registra la diferencia de potencial entre el electrodo (polo -) en el brazo izquierdo y (polo +) en la pierna izquierda. 2.8. Holter El estudio de Holter, es una técnica de examen cardiovascular llamado “radio- electrocardiograf́ıa” o registró electrocardiográfico, de tipo ambulatorio, que se to- ma durante un tiempo prolongado (24 ó 48 horas) en las condiciones cotidianas del paciente. Es un método diagnóstico no invasivo muy utilizado en la práctica cĺıni- ca, que ofrece un examen electrocardiográfico dinámico y detallado de los cambios Caṕıtulo – 2. El Corazón 20 eléctricos transitorios, que permite establecer una correlación entre los hallazgos elec- trocardiográficos y los śıntomas referidos por el paciente durante su actividad diaria. Esta técnica facilita el diagnóstico, y la cuantificación de las arritmias card́ıacas, los cambios transitorios isquémicos de la repolarización Ventricular y las mediciones del complejo QRS y del intervalo QTc. Además, por medio de éste se evalúan los cambios en el sistema nervioso autónomo (análisis de la variabilidad de la frecuencia card́ıaca, tanto del dominio en el tiempo como en la frecuencia), la detección de potenciales tard́ıos ventriculares (electrocardiograma de alta resolución ambulatorio) y la valora- ción de la dispersión del intervalo QTc y de la alternancia de la onda T. Esta técnica fue descrita por Norman J. Holter en 1957, y se lleva a cabo con un dispositivo del mismo nombre [13]. El registro de la actividad eléctrica card́ıaca, se realiza con una grabadora de ECG continua, denominada monitor de Holter, que en su forma t́ıpica graba durante 24 ó 48 horas el ECG. En la década de 1960, los registros eran de un solo canal y el foco de atención fue el análisis de las arritmias card́ıacas. Luego, en la década de 1970 y 1980, se desarrolló la de dos y tres canales, y se iniciaron las observaciones sobre segmento ST e isquemia silenciosa, el registro se realizaba sobre una cinta magnética, sin interrupciones en el trabajo o vida personal del paciente, y es especialmente útil para el diagnóstico de ritmos cardiacos menos frecuentes y que puede sentir el pa- ciente. La precisión con que pueden interpretarse registros prolongados en cinta, vaŕıa según el sistema, si bien muchas computadoras analizan cintas que tienen precisión suficiente para las necesidades cĺınicas. En teoŕıa, todos los sistemas registran más información que la que el médico necesita para o puede asimilar. Se calcula en 25 a 50 % la proporción de pacientes que experimentan un episodio durante un registro de 24h, causado por arritmias en 2 a 15 % de los casos. En la actualidad el registro se realiza sobre un medio magnético o en un medio de almacenamiento conocido como memoria SD, con posterior restitución en un sistema traductor de la señal almacenada, lo que permite analizar las alteraciones en el ECG durante un peŕıodo de tiempo determinado; su mayor rendimiento diagnóstico se obtiene cuando se efectúa en al menos 24 horas según [8]. Caṕıtulo – 2. El Corazón 21 2.9. Ruido El ruido puede definirse como una perturbación eléctrica que interfiere en la trans- misión o el procesamiento de una señal2. Un electrocardiograma es la representación gráfica que recoge la actividad electrica generada por los diferentes potenciales de polarización y despolarización a nivel del músculo card́ıaco, empleado como método diagnóstico de anomaĺıas en el ritmo card́ıaco, asi como de cardiopat́ıas, etc. Esta señal generalmente se ve afectada por niveles de ruido apreciables que tienden a oscu- recer aspectos caracteŕısticos del ECG, que evidencian el buen funcionamiento o no del músculo card́ıaco, motivo por el cual es de gran importancia realizar una correcta apreciación de la información contenida en éstos, a pesar del ruido presente [31]. Una de las principales dificultades encontradas durante el proceso de detección de los diferentes patrones en los registros analizados por el detector prototipo desarro- llado es el ruido. En los registros proporcionados por la base de datos de la unidad de Cardioloǵıa se encuentran ruidos tales como la interferencia de ĺınea de potencia que consiste en una señal de 60 Hz y sus armónicos, el generado por los aparatos electrónicos utilizados en la fase de adquisición (ruido térmico), las distorsiones de origen muscular o ruido electromiográfico provocado por la contracción muscular y caracterizado por (quiebres) transitorios, el generado por los artefactos provenientes de la interfaz electrodo-piel causado por variaciones en la impedancia debido al movi- miento del electrodo y el desplazamiento de la ĺınea base provocado por la respiración que puede ser representado como una componente sinusoidal en la frecuencia de res- piración adherida a la señal ECG. Eliminar el ruido sin afectar la morfoloǵıa de la señal ECG es crucial debido a que la presencia de este, puede llegar a enmascarar rasgos significativos de la señal original que no permitiran un diagnóstico acertado del paciente. Para reducir el ruido presente sobre la señal electrocardiográfica original, con la finalidad de obtener la parte útil, se hacen necesarias técnicas de procesado de la señal. Una de las primeras opciones es el filtrado mediante filtros lineales y no linea- les que maximicen la relación señal a ruido. En el siguiente trabajo se implementaron los métodos basados en técnicas de filtrado lineal y no lineal propuestos por el algo- ritmo de Pan y Tompkins [18] para reducir el ruido en los registros de prueba (y un 2http://definicion.de/ruido/ Caṕıtulo – 2. El Corazón 22 Figura 2.9: Ruido presente en un registro ECG (Fuente: www.monografias.com) promediado de señal). Como se observa en la figura 2.9, la mayoŕıa de las componentes de alta frecuencia presentes en la señal original del registro son eliminadas a partir del filtrado lineal proporcionado por el algoritmo de Pan y Tompkins [18] con el fin de resaltar la onda P y el complejo QRS, parámetros necesarios para la detección de la TVNS y la FAP. Sin embargo, en la practica muchas veces no resulta completamente eficiente lograr una adecuada relación señal-ruido principalmente cuando la onda de interés presenta una baja amplitud comparable a los niveles de amplitud de ruido, lo cual trae como consecuencia dificultades en el momento de detectar patrones que dependen del reco- nocimiento de la onda P tal como la FAP. Este hecho amerita tomar decisiones como el promediado local de la señal, entre otras técnicas, o estrategias que permitan resal- tar los rasgos caracteŕısticos de la onda de interés y poder disponer de la información completa (P-QRS-T) que identifica un complejo en el ECG. 23 Caṕıtulo 3 Algoritmo especializado Los algoritmos de detección del complejo QRS establecen una marca donde em- pieza, termina, o se encuentra el punto de mayor amplitud en el este. La detección del QRS es complicada, no solo por su variabilidad fisiológica, sino también porque el ruido que puede estar presente en la señal ECG, tiende a distorsionar el registro, impidiendo una detección o diagnóstico acertado. Los criterios principales en la selec- ción de un algoritmo para la detección del complejo QRS toman en cuenta el mejor desempeño ante el nivel de ruido presente en los registros. El algoritmo empleado debe ser robusto a niveles bajos de ruido si se desea incorporar a sistemas cĺınicos, para evitar un diagnostico inexacto. El algoritmo propuesto en el presente trabajo, para la detección del QRS, es el algoritmo desarrollado por Jiapu Pan y Willis J. Tompkins [18], ya que se considera un algoritmo robusto a niveles bajos de ruido por estar basado en filtros digitales. El propósito de este caṕıtulo es presentar una breve descripción, del esquema de detección de complejos QRS desarrollado por Pan y Tompkins, y la extracción de la información necesaria, para el reconocimiento de las cardiopat́ıas de interés. 3.1. Algoritmos de Detección del QRS El algoritmo que se implementará en la detección y extracción de los parámetros de entrada, para llevar a cabo la detección de las cardiopat́ıas de interés, es el Algoritmo de detección QRS en tiempo real, desarrollado por Jiapu Pan y Willis J. Tompkins en el año 1985, este algoritmo en tiempo real, Reconoce de forma fiable, complejos Caṕıtulo – 3. Algoritmo especializado 24 Figura 3.1: Diagrama de Bloques del Algoritmo de Pan-Tompkins (Fuente: Elaboración propia) QRS en base a los análisis digital de pendiente, amplitud y anchura, en señales de ECG. Cada onda presente en el ECG describe una acción espećıfica del sistema card́ıaco que genera diferentes potenciales. Las señales ECG, como se definió en el caṕıtulo anterior, se dividen en ondas, intervalos y segmentos: onda P, el complejo QRS, onda T, onda U, segmento PR, segmento ST, intervalo PP, intervalo RR, e intervalo QT. Las secciones ubicadas entre las deflexiones se denominan segmentos, y las distancias entre cada onda, se conocen como intervalos. El algoritmo de detección de complejos QRS fue implementado en el lenguaje C/C++ y todo el proceso se realiza con aritmética punto flotante en un PC, a pesar de ello el computo se puede realizar con aritmética de enteros de modo que puede operar en tiempo real sin necesidad de excesiva potencia de cálculo, la figura 3.1 muestra las señales en varias etapas de procesamiento de señal digital. Los registros ECG a procesar provienen de bases de datos (Cardioloǵıa y Physio- net), adquiridos en su mayoŕıa a una tasa de 200 o 500 muestras/s. La señal digital resultante pasa sucesivamente a través de una secuencia de pasos que incluyen tres filtros digitales lineales implementados en el algoritmo. El primero es un filtro pasa banda de coeficiente integrado compuesto filtros paso bajos y filtros de pasa-alto dis- puestos en casadas, cuya función es la eliminación de ruido, 3.1 muestra las etapas de este proceso, luego del filtrado de la señal original, se aplica un filtro que se aproxima a una derivada. Después le sigue un proceso de cuadratura de la amplitud, que ayuda a restringir falsos positivos causados por las ondas T con un nivel más alto al del es- pectro habitual, y finalmente la señal pasa a través de un integrador de ventana móvil o ventana móvil integrador. Ahora es cuando unos umbrales adaptativos discriminan las ubicaciones de los complejos QRS. En el siguiente apartado, se detallarán las etapas del algoritmo descrito. Caṕıtulo – 3. Algoritmo especializado 25 3.1.1. Filtro Pasa Banda El filtro pasa banda reduce la influencia del ruido muscular, la interferencia de 60 Hz, desviaciones basales y la interferencia de la onda T. La banda de paso deseable para maximizar la enerǵıa del QRS es aproximadamente 5-15 Hz. El filtro presenta una respuesta rápida, recursivo en tiempo real en el que los polos se ubican para cancelar ceros en el ćırculo unitario del plano z. Este enfoque se traduce en un filtro diseñado con coeficientes enteros. Puesto que sólo la aritmética de enteros es necesaria, un filtrado en tiempo real se puede implementar con un simple microprocesador y todav́ıa queda la potencia de cálculo disponible para hacer la tarea de reconocimiento de QRS. Esta clase de filtros que tienen polos y ceros sólo en ćırculo unitario permite una limitada flexibilidad en el diseño de pasa bandas. El filtro pasabanda presentado se diseña a partir de la secuencia de los filtros pasa bajos y los pasa altos descritos a continuación, para conseguir una banda de paso de 3 dB desde alrededor de 5 a 12 Hz, razonablemente cerca del objetivo de diseño [18]. 3.1.2. Filtro Pasa Bajos La función de transferencia del filtro pasa bajos de segundo orden es H (z) = (1−z−6 )2 (1−z−1)2 , (3.1) donde La amplitud de respuesta es H (z) = (−1 + 32z−16+ z−32) (1+z−1) , (3.2) donde La ecuación de diferencia del filtro es y (nT ) =2y (nT−T )−y (nT−2T ) +x (nT )−2x (nT−6T ) +x(nT−12T ), (3.3) donde la enerǵıa de corte es cerca de 11 Hz, T es el peŕıodo de muestreo y la ganancia es 36. El retraso de procesamiento del filtro es de seis muestras [18]. Caṕıtulo – 3. Algoritmo especializado 26 3.1.3. Filtro Pasa Altos El diseño del filtro pasa alto es basado en restar la salida de un filtro pasa bajo de primer orden desde un filtro pasa altos y bajos (es decir, las muestras en la señal original). La función de transferencia para este filtro pasa alto es: H (z) = (−1 + 32z−16+ z−32) (1+z−1) , (3.4) donde la amplitud de respuesta es |H (wT ) | = [ 256+sin2(16wT ) ]1/2 cos(wT/2) , (3.5) donde la ecuación de la diferencia es y (nT ) =32x (nT−16T )− [y (nT−T ) +x (nT )−x(nT−12T )] (3.6) . El punto de corte bajo de frecuencia de este filtro es cerca de 5 Hz, la ganancia es 32 y el retardo son 16 muestras [18]. 3.1.4. Derivación Después del filtrado, la señal es diferenciada para proveer la información de la forma del complejo QRS. Nosotros usamos una derivación de cinco puntos con una función de transferencia H (z) = (1/8T ) (−z−2−2z−1+2z1+z2), (3.7) donde la amplitud de la respuesta es |H (wT ) | = (1/4T )[sin(2wT ) +2sin(wt) ], (3.8) Caṕıtulo – 3. Algoritmo especializado 27 donde La ecuación de la diferencia es y (nT ) = (1/8T ) [−x (nT−2T )−2x (nT−T ) +2x (nT+T ) +x (nT−2T )] . (3.9) La frecuencia de respuesta de esta derivación es cercanamente lineal entre dc y 30 Hz (es decir, se aproxima a una derivada ideal en este rango). Su retardo es de dos muestras [18]. 3.1.5. Función Cuadrática Después de la diferenciación, la señal es elevada al cuadrado punto por punto. La ecuación de este operador es y (nT ) =[x(nT )] 2 . (3.10) Esto hace todos los puntos de los datos positivos, y genera una amplificación no lineal de la salida de la derivación, enfatizando las altas frecuencias (es decir, frecuencias presentes en el ECG) [18]. 3.1.6. Ventana Móvil Integradora El propósito de la ventana móvil integradora, es obtener información caracteŕıstica de la forma de onda del complejo QRS adicional a la pendiente de la onda R. Se calcula a partir de y (nT ) = (1/N) [x (nT−(N−1)T ) +x (nT− (N−2)T ) + · · ·+,x (nT )] , (3.11) donde N es el número de muestras en el ancho de la ventana integradora. El número de N muestras en la ventana móvil es importante. Generalmente el ancho de la ventana debe ser aproximadamente igual al complejo QRS más ancho. Si la ventana es demasiado ancha, la forma de la onda integrada fusionará los complejos QRS y T. Si la ventana es demasiado estrecha, algunos complejos QRS producirán Caṕıtulo – 3. Algoritmo especializado 28 varios picos en la forma de la onda integrada. Estos pueden causar dificultad en los procesos posteriores de detección del QRS. El ancho de la ventana se determina emṕıricamente, generalmente se asocia a un ancho QRS de aproximadamente 150ms. Para nuestra frecuencia de muestreo de 200 muestras/s, la ventana es de 30 muestras de ancho (150ms). 3.1.7. Fase de Detección La detección ocurre, cuando el algoritmo, al recibir las muestras de la señal inte- grada, detecta un cambio de pendiente positivo a negativo, y este se mantiene aśı por un número prefijado de muestras, este levantamiento, se denomina pico de enerǵıa. Luego, a partir del procedimiento denominado umbrales adaptativos, el algoritmo determinará si el pico de enerǵıa corresponde a un complejo QRS o si debe ser con- siderado ruido. Adicionalmente, la técnica de búsqueda hacia atrás, permitirá que el ajuste de los umbrales, sea más efectivo. 3.1.8. Umbrales Adaptativos Durante la detección, el algoritmo lleva estimaciones de los picos de la señal aso- ciados a los complejos QRS, y del nivel de ruido de la misma, entendiéndose como ruido, cualquier pico de la señal que no es un complejo QRS, dichos estimadores se actualizan cada vez que se encuentra un nuevo complejo QRS, a través de un prome- dio ponderado entre el último valor medio y el valor de la última detección, a partir de la siguiente relación SPKI = wpk ∗ PEAKI + 0, 875 ∗ SPKI (3.12) NPKI = wpk ∗ PEAKI + 0, 875 ∗NPKI . (3.13) Donde, 3.12 y 3.13 son los estimadores del nivel de los picos QRS y de ruido respectivamente, y PEAKI el último pico detectado, sea de la señal (complejo QRS) o de ruido, y el valor wpk, es para ajustar cuánto afecta la amplitud del último pico Caṕıtulo – 3. Algoritmo especializado 29 encontrado. Luego de obtener los estimadores, se lleva a cabo el cálculo de los umbrales de la siguiente manera: TH1 = NPKI + wth ∗ (SPKI −NPKI) (3.14) TH2 = 0, 5 ∗ TH1. (3.15) Siendo wth, el valor que determina, a que altura entre los dos niveles se fija el umbral. El primer umbral (TH1) es el que se utiliza para decidir si un pico dado es un complejo QRS o no, y el segundo TH2, es utilizado cuando el algoritmo entra en modo searchback o búsqueda hacia atrás [25]. 30 Caṕıtulo 4 Metodoloǵıa Una vez conocido los aspectos básicos inherentes a la tecnoloǵıa a usar y lo relacio- nado a las arritmias card́ıacas, se establecerán las pautas para alcanzar los objetivos planteados, para ello se adoptó el enfoque de desarrollo de software Extreme Pro- gramming (XP). Se partió de una solución del problema más simple que solo permit́ıa obtener los parámetros caracteŕısticos (complejo PQRS) necesarios para la detección de los patrones arŕıtmicos sobre registros de corta duración y libres de ruido que, a partir de ciclos de prueba, retroalimentación y cambios llevados a cabo en corto tiem- po proporcionó una solución más compleja y robusta. En la detección del patrón de FAP y TVNS, la metodoloǵıa XP proporcionó una herramienta que permitió obtener buenos resultados en segmentos de registro de mayor duración con presencia de ruido. A continuación se describirán las etapas en las que se realizó el siguiente trabajo. Luego de organizar y seleccionar los registros de prueba y su procedencia se aplicó un algoritmo de extracción de caracteŕısticas. Posteriormente se llevó a cabo la detección de los parámetros caracteŕısticos de cada una de las cardiopat́ıas aqúı estudiadas. Por último la fase de identificación de sus patrones. 4.1. Base de Datos del Instituto de Medicina Tro- pical, Departamento de Cardioloǵıa de la UCV La base de datos que se tiene a disposición del Instituto de Medicina Tropical, de la cual se han tomado 70 registros ECG que presentan al menos un evento de TVNS, provenientes de sujetos asintomáticos (33 hombres y 22 mujeres, con edad promedio Caṕıtulo – 4. Metodoloǵıa 31 de 59 ± 15 años [entre 25 y 86 años]) y al menos un evento de FAP provenientes de sujetos asintomáticos (8 hombres y 12 mujeres, con edad promedio de 61 ± 11 años [entre 41 y 85 años]). Los registros tienen una duración en promedio de 24 h cada uno y han sido digitalizados a 500 y 1000 muestrass. Como requisito , solo se consideran para su análisis, registros de 1 h que se encuentran alejados en promedio a más de 4 horas de eventos previos. 4.2. Base de Datos del MIT-BIH Normal Sinus Rhythm Databases La base de datos incluye 18 registros de larga duración de ECG referidos al La- boratorio de Arritmias del Hospital Beth Israel en Boston (ahora el Centro Médico Beth Israel Deaconess). Se encontró que los sujetos incluidos en esta base de datos no han tenido arritmias significativas. La base de datos se compone de 5 registros de sujeto masculino entre 26 y 45 años de edad, y de 13 registros de sujeto femenino entre 20 a 50 años.[30] 4.3. Desarrollo de la Solución La implementación se desarrolló bajo el lenguaje de programación C++, utilizan- do programación orientada a objetos a través del Framework Qt. Un requerimiento primordial del proyecto es que la aplicación sea multiplataforma por ello se llevo a cabo en Qt project que contiene un conjunto de librerias gratuitas que permiten desarrollar herramientas open source con esta caracteŕıstica. Además, Qt proporciona ventajas para la creación de interfaces gráficas en sus aplicaciones, gracias al uso de la aceleración gráfica basada en OpenGL/OpenGLES 3 que permite procesar y des- plegar con rapidez grandes volúmenes de datos (ver figura 4.1). Requerimiento inicial de la herramienta en desarrollo (detector) que posteriormente fue asignado a otra de las fases del proyecto. 3 http://softpei.blogspot.com/2013/05/introduccion-al-framework-qt-5-para-el.html Caṕıtulo – 4. Metodoloǵıa 32 Figura 4.1: Detector. Para visualizar los resultados obtenidos en cada etapa se utilizó la herramienta Grace de algunas distribuciones de Linux. La detección de los patrones arŕıtmicos requirió de un algoritmo de extracción de caracteŕısticas, una fase de detección de los parámetros caracteŕısticos y por último la identificación de patrones, cada etapa será descrita en los siguientes apartados. El algoritmo en ĺınea general tiene la estructura que se observa en el diagrama 4.2. 4.4. Algoritmo de Extracción de Caracteŕısticas Para la identificación del patrón correspondiente a cada arritmia bajo estudio, fue necesario hallar primero la posición de la onda R asociada a cada complejo PQRST del ciclo card́ıaco, tomando como referencia el algoritmo de Jiapu Pan y Willis J. Tompkins [18], el cual se basa en el análisis de la pendiente, la amplitud, y el ancho de dichos complejos, por ser esta onda R, el punto de más amplio voltaje de todo el complejo PQRST, y por ende la mejor referencia visual para calcular la frecuencia card́ıaca, los intervalos RR, y detectar otras ondas del complejo. Una vez encontrada la posición de la onda R, se procede a localizar la posición de las ondas Q, S y P de cada complejo, usando como referencia, las caracteŕısticas de los registros de la Caṕıtulo – 4. Metodoloǵıa 33 Figura 4.2: Estructura general del detector. señal filtrada, derivada, cuadrada e integrada. Finalmente a partir de estos parámetros primarios se realizó el cálculo del ancho del complejo QRS, además de la irregularidad temporal entre los intervalos RR, haciendo uso de los criterios dados por los médicos especialistas en electrofisioloǵıa este esquema se presenta en la figura 4.3. Caṕıtulo – 4. Metodoloǵıa 34 Figura 4.3: Estructura del proyecto Caṕıtulo – 4. Metodoloǵıa 35 4.4.1. Detección de los Parámetros Caracteŕısticos Para llegar a detectar los parámetros caracteŕısticos, se requiere acondicionar la señal en una primera instancia, con el fin de mejorar la relación señal-ruido, facilitan- do la observación de los mismos. Este acondicionamiento consiste en aplicar al ECG un proceso de filtrado pasa-banda para eliminar el ruido de altas frecuencias, como el ruido muscular y la interferencia de la onda T, y obtener solo la banda en frecuencia donde se esperan encontrar los complejos QRS. Una ventaja del filtro recursivo (pasa- banda) propuesto por Pan y Willis J. Tompkins[18], es que al manejar coeficientes enteros en su función de transferencia, se reduce la complejidad y el consumo compu- tacional. El siguiente paso en el procesamiento, es un filtro diferencial o derivador que elimina las componentes de baja frecuencia de las ondas P y T para resaltar las pendientes pronunciadas que caracterizan a la onda R; posteriormente se aplica una transformación no lineal que consiste en elevar al cuadrado la señal resultante del filtro diferencial para que todas las muestras sean positivas, acentuando la diferencia entre las distintas pendientes detectadas. Por último se aplica una ventana móvil integradora, que promedia las amplitudes elevadas al cuadrado, para eliminar las oscilaciones de poca duración que no corresponden con un complejo QRS, y permite obtener un pulso uniforme en el conjunto de muestras de la señal, asociada a cada uno de los complejos PQRST. Es importante mencionar que posterior a la etapa de filtrado, debe aplicarse sobre la señal una regresión lineal, para eliminar el offset (nivel de corrimiento o desplaza- miento) generado en el proceso de filtrado. Finalmente, luego del acondicionamiento de la señal, se procede a la detección de la onda R. Primero, se realiza la búsqueda de un pico de amplitud máxima sobre la señal integrada, esto ocurre cuando se detecta un cambio de pendiente de positivo a negativo y se mantiene por un número prefija- do de muestras, luego, a partir de el valor de umbrales de amplitud establecidos, se determina si el pico corresponde efectivamente a la onda R, o si debe ser considerado ruido. Los umbrales 3.12 y 3.13 son estimadores del nivel de los picos de la señales asociadas a los complejos QRS y del nivel de ruido de la misma, entendiéndose como ruido a cualquier pico de la señal que no sea un complejo QRS. Estos estimadores se actualizan cada vez que se encuentra un nuevo complejo (onda R) a través de un pro- medio ponderado entre el último valor medio y el valor tomado en la última detección. La amplitud del último pico detectado, sea de señal o de ruido, es usado para adaptar Caṕıtulo – 4. Metodoloǵıa 36 el valor medio a los cambios, además el valor del umbral (TH1), para decidir si se ha encontrado o no un pico a partir de los valores de la señal cuadrada, se obtiene del valor de las pendientes, asegurando con este valor, que el latido corresponde a la onda R y no a una onda T de pendiente pronunciada. Para realizar un mejor ajuste de los umbrales de amplitud, se agrego al algoritmo después de las primeras detecciones, el promedio de los últimos 8 picos R encontrados. La detección de las ondas Q y S se realiza a partir de la señal derivada. Para el caso de la onda Q, se busca, antes de la posición de la onda R, la ubicación donde se da un cambio de signo, es decir, el valor de amplitud en la señal derivada menor a cero, luego se ubica con mayor precisión la amplitud mı́nima entorno (ventana de x ms) a la posición donde ocurre el cambio de signo, siendo este último valor, la posición y amplitud de la onda Q. Para detectar la onda S, se lleva a cabo el mismo procedimiento, pero la búsqueda del cambio de signo se realiza a partir de la onda R hasta x ms después de esta, usando el mismo criterio. La búsqueda de la onda P, se realiza en el segmento P-Q. Primero, se localiza la posición de la amplitud máxima sobre la señal filtrada en dicho segmento, para validar que corresponde al de la onda P, se realiza una búsqueda de cambio de signo unos milisegundos antes y después de la posición de este máximo sobre la señal derivada (como la búsqueda de las ondas Q y S), pero el cambio de signo, sera evaluado con la diferencia de las muestras (i) e (i-1), para encontrar el origen de la onda, y la diferencia entre las muestras (i) e (i+1), para hallar el fin de esta, después de validar que el ancho de la onda P es menor o igual a 100 ms, se calcula el máximo de la pendiente a partir de la señal cuadrada, y en caso de que esta pendiente sea menor a un porcentaje de la pendiente de la onda R, se ha encontrado una onda P. En nuestra implementación el cálculo de los parámetros caracteŕısticos, esta con- tenido en cuatro de los métodos de la clase calculos, estos son: calculoSenhal(), De- teccionQRS(), anchoQRS() y ausenciaP(), como se presenta en la imagen 4.4. 4.4.2. Identificación de Patrones El siguiente paso de nuestro algoritmo, es la identificación de patrones, iniciando con la detección del ancho del complejo QRS. Luego de obtener las posiciones de Caṕıtulo – 4. Metodoloǵıa 37 Figura 4.4: Fase de Detección de los parámetros caracteŕısticos. Q y S, en la fase anterior, se calcula la diferencia entre la posición de la onda S menos la posición de la onda Q, para cada complejo, y esta diferencia se multiplica por el tiempo entre cada muestra, si el resultado es menor a 120 ms este se considera un complejo QRS normal, en caso de tener un ancho mayor a 120ms, nos encontramos con un complejo anómalo, ya que la deformación del complejo QRS, indica una falla de la actividad ventricular. Para llevar a cabo la detección de la irregularidad de los intervalos RR, se deben introducir algunas definiciones. Un intervalo RR, es el tiempo que transcurre desde la aparición de un latido u onda R al siguiente, y un intervalo se considera irregular, cuando el tiempo entre dos intervalos RR adyacentes, es mayor a 50 ms. En nuestra implementación, luego de detectadas las ondas R, se calculan los intervalos RR restando la posición entre un latido y el anterior, el resultado se multiplica por el Caṕıtulo – 4. Metodoloǵıa 38 tiempo entre muestras, para conocer su duración. Luego de calculado cada intervalo, se realiza la diferencia entre dos RR consecutivos, si esta diferencia es menor a 50 ms se registra dicho intervalo como regular, en caso contrario, se indica que es regular. Finalmente, si el registro contiene más de tres latidos consecutivos con un ancho en cada complejo QRS mayor a 120 ms, poca regularidad y una aumento de frecuencia, estamos ante el patrón de la TVNS (Criterio para detectar un patron de TVNS). Si el registro contiene más de 3 latidos consecutivos con ausencia de la onda P e irregularidad en sus intervalos, estamos ante un patrón de FAP (Criterio para la deteccción de un patron de FAP). Por último, el criterio para la identificación de un registro de paciente sano, toma en cuenta la presencia de intervalos RR, regulares, el ancho de cada uno de sus complejos QRS es menor a 120 ms y presencia regular de la onda P. En nuestra implementación, la identificación de patrones, esta contenido en los siguientes métodos de la clase calculos, estos son: Detector(), anchoQRS(), au- senciaP() y DeteccionIrregularidad(). Las instrucciones encargadas de la identi- ficación, se presenta en el esquema de la figura 4.5. Caṕıtulo – 4. Metodoloǵıa 39 Figura 4.5: Fase de Identificación de patrones Caṕıtulo – 4. Metodoloǵıa 40 Los esquemas de funcionamiento del sistema detector, en la búsqueda permanente de patrones de FAP y TVNS, se muestran en las figuras 4.6 y 4.7, respectivamente. Figura 4.6: Diagrama de flujo del algoritmo detector de FAP. Como se observa en el diagrama de flujo 4.6 se describe la secuencia de consultas que lleva a cabo el algoritmo para detectar un patrón de FAP. Como entrada se requiere el registro ECG que será analizado. Seguidamente se crea una ventana con dimensión de 3 ó 4 latidos para iniciar la busqueda de patrones de FAP. La búsqueda Caṕıtulo – 4. Metodoloǵıa 41 Figura 4.7: Diagrama de flujo del algoritmo detector de TVNS. es la siguiente: Si en 3 ó 4 complejos consecutivos esta ausente la onda P se procede a validar el siguiente parámetro, en caso de que la onda P este presente se puede concluir que no hay un evento de FAP, retorno al inicio del algoritmo de decisión y desplazo la ventana en un latido para iniciar otra consulta. Si la onda P se encuentra ausente en todos los latidos existentes en la ventana, se procede a verificar que los mismos 3 ó 4 complejos consecutivos sean irregulares, es decir que sus intervalos RR sean mayor a 50 ms. Si la onda P esta ausente y existe irregularidad se activa la Caṕıtulo – 4. Metodoloǵıa 42 alarma que indica la existencia de un patrón de FAP, en caso contrario, se desplaza la ventana al siguiente complejo para iniciar la búsqueda. Una vez realizada la búsqueda de patrones de FAP se procede a examinar la exis- tencia de eventos de TVNS (ver 4.7). El procedimiento para la detección de eventos de TVNS es similar al algoritmo antes expuesto, con la diferencia de que los parámetros a validar son la existencia de 3 ó 4 complejos QRS consecutivos de ancho mayor a 120 ms y una frecuencia instantánea asociada a los complejos involucrados mayor a 100 lpm. 43 Caṕıtulo 5 Resultados y Discusión Se presentan resultados de evaluar el funcionamiento del software detector de even- tos arŕıtmicos tipo FAP y TVNS en registros electrocardiográficos de 1h de duración, alguno de ellos finalizan con eventos de FAP o TVNS, aśı como también se pone a prueba su respuesta en registros control. La confiabilidad de la herramienta se medirá a partir del cálculo de algunos indi- cadores estad́ısticos como sensibilidad, especificidad y exactitud. Para ésta prueba se han analizado 36 registros: 12 registros pertenecen a pacientes que presentan al menos un episodio de FAP, 12 que presentan al menos un episodio de TVNS y 12 registros control (sanos), los mismos han sido obtenidos de la base de datos de la Sección de Cardioloǵıa Experimental del Instituto de Medicina Tropical de la UCV y la Base de datos internacional PhysioNET, en particular la proveniente del Instituto Tecnológico de Massachusetts (en inglés, MIT-BIH Normal Sinus Rhythm Databases). 5.1. Evaluación de las Pruebas Diagnósticas La evaluación de las pruebas diagnósticas se refiere a definir su efectividad y eficiencia. [24] 5.1.1. Efectividad La efectividad de una prueba diagnóstica es su capacidad de modificar o mejo- rar la evolución del paciente a través de cambios en las decisiones diagnósticas y/o terapéuticas. Caṕıtulo – 5. Resultados y Discusión 44 5.1.2. Eficiencia La eficiencia en una prueba diagnóstica es la capacidad para lograr una medición adecuada de la enfermedad. La eficiencia está constituida por la reproducibilidad, la exactitud o validez, la adaptabilidad, la aceptabilidad y la eficiencia estad́ıstica. La eficiencia de una prueba diagnóstica tiene como finalidad estad́ıstica diferenciar un grupo de pacientes con determinada caracteŕıstica o enfermedad de otro grupo sin esa enfermedad, la prueba ideal seŕıa aquella que fuese positiva en todos los enfermos o aquellos que tienen la caracteŕıstica, y negativa en todos los no enfermos o aquellos que no la tienen. A continuación se presentan los indicadores estad́ısticos utilizados para evaluar la eficiencia del método patrón que define la presencia de la FAP, la TVNS y la ausencia de ambas cardiopat́ıas en registros control, por medio de nuestro algoritmo el cual toma en cuenta los criterios ya definidos. 5.1.3. Verdaderos Positivos(VP): Cuantifica enfermos con la prueba positiva. 5.1.4. Falsos Negativos(FN): Cuantifica enfermos con la prueba negativa. 5.1.5. Verdaderos Negativos(VN): Cuantifica no enfermos con la prueba negativa. 5.1.6. Falsos Positivos(FP): Cuantifica no enfermos con la prueba positiva. Caṕıtulo – 5. Resultados y Discusión 45 5.1.7. Sensibilidad o Tasa de Verdaderos Positivos: Es la proporción de pacientes enfermos que tienen la prueba positiva, o la proba- bilidad de que la prueba sea positiva cuando la enfermedad está presente. Sensibilidad = V P (V P + FN) = V P Total de enfermos (5.1) 5.1.8. Especificidad o Tasa de Verdaderos Negativos: Es la proporción de pruebas negativas entre los pacientes que no tienen la enfer- medad, o la probabilidad de que la prueba sea negativa cuando la enfermedad no está presente. Especificidad = V N (V N + FP ) = V N Total de No enfermos (5.2) 5.1.9. Exactitud: La exactitud de una prueba diagnóstica se define como la capacidad que tiene de medir aquello que desea medirse. El cálculo de la exactitud del detector indicará el porcentaje de qué tan exacto es el algoritmo en la detección del patrón de FAP y TVNS. Exactitud = (V P + V N) (V P + V N + FP + FN) ∗ 100 (5.3) 5.2. Análisis de Resultados En esta sección se presentarán los resultados sobre el desempeño del algoritmo de detección de FAP y TVNS, a partir del uso de los indicadores definidos en la sección anterior: exactitud, especificidad y sensibilidad. Las pruebas sobre los registros que Caṕıtulo – 5. Resultados y Discusión 46 presentan eventos de FAP y TVNS, además de los registros control se realizaron des- plazando una ventana que contiene 3 ó 4 intervalos RR (equivalente a 4 ó 5 complejos QRS consecutivos) a lo largo del registro. Cuando se dispone a observar la presencia o no de eventos de FAP el algoritmo de detección se basa en el criterio de observar si 3 ó 4 intervalos RR consecutivos pueden ser catalogados cada uno como irregulares (si el intervalo RR considerado difiere del RR que lo antecede en 50ms), además de estar acompañados de la ausencia de la onda P. Para la observación de eventos de TVNS el algoritmo de detección toma como criterio la coincidencia de la irregularidad en la morfoloǵıa de 3 o más complejos QRS (medido a través del ancho del QRS) y la frecuencia instantánea entre estos complejos la cual debe superar los 100 lpm. 5.2.1. Registros con Presencia de Patrones de TVNS Un comportamiento que tiende a ser común en la mayoŕıa de los registros que presentan TVNS es la presencia de lo que hemos catalogado como la irregularidad, lo cual pone de manifiesto la presencia de complejos adyacentes cuyos intervalos RR difieren en más de 50 ms, ver figura 5.1.b . Aśı como también es notable frecuencias instantáneas que superan los 100 lpm (ver 5.1.d), además de algunos complejos cuyo ancho QRS tienden a superar los 120 ms (ver 5.1.c). Estos tres comportamientos señalados nos dan una breve descripción de la dinámica presente en los registros de ECG de aproximadamente una hora de duración que contienen al menos un evento de arritmia tipo TVNS. En espećıfico, cuando nos centramos en el comportamiento mostrado por el ancho del complejo QRS y la frecuencia instantánea, ambos tienden a presentar los valo- res esperados que caracterizan la presencia de un evento de TVNS justo donde se encuentra el patrón de esta arritmia, es decir, un ancho QRS superior a 120 ms y una frecuencia instantánea que acompaña a estos complejos QRS superior a 100 lpm. De esta manera, cuando cruzamos los observables de ancho y frecuencia, vemos que ambos parámetros en conjunto poseen valores superiores al umbral necesario para identificar la huella o patrón de TVNS, en promedio con una sensibilidad de 100 %, Caṕıtulo – 5. Resultados y Discusión 47 una especificidad de 99,99 % y exactitud de 99,99 % como se muestra en el cuadro 5.1. Estos resultados nos permiten asociar una alta efectividad al prototipo detector de TVNS desarrollado haciendo uso de solo dos parámetros para su detección, un ejemplo de esta efectividad en la detección es mostrado en la figura 5.1.e. A pesar de la irregularidad que muestran la mayoŕıa de los registros analizados, que de alguna manera dificulta la detección de los intervalos RR y en consecuencia la detección de los anchos y la frecuencia instantánea, la herramienta computacional detecta los patrones de TVNS con una alta eficiencia. Figura 5.1: Gráfica del registro ctvp 03 1ev 215859 bajo el esquema de 3 intervalos RR consecutivos bajo observación (Fuente: Elaboración propia). (a) Se muestra serie de intervalos RR. (b) Presencia de intervalos RR irregulares (1) e intervalos RR regulares (0). (c) Se muestra la presencia de complejos QRS con un ancho mayor a 120 ms (1) y ausencia de complejos QRS anchos (0). (d) Presencia de frecuencias instantáneas mayor a 100 lpm (1) y ausencia de frecuencias instantáneas mayor a 100 lpm (0) que acompaña cada complejo. (e) Se muestra presencia (1) y ausencia (0) de un patrón de TVNS en el registro Caṕıtulo – 5. Resultados y Discusión 48 Registro VP VN FN FP ctvp 01 1ev 103433 1 5661 0 1 ctvp 02 6ev 230144 1 4328 0 0 ctvp 03 1ev 215859 1 3050 0 0 ctvp 04 1ev 135554 1 4681 0 0 ctvp 05 2ev 054355 1 4753 0 0 ctvp 06 1ev 053000 1 5395 0 0 ctvp 07 1ev 141211 1 4432 0 0 ctvp 09 3ev 141248 1 5047 0 1 ctvp 09 1ev 203803 1 6216 0 2 ctvp 12 1ev 014152 1 3730 0 0 ctvp 19 1ev 180823 1 5779 0 0 ctvp 25 3ev 234713 1 4998 0 2 Total 12 58070 0 6 Resultado de la TVNS Exactitud ( %) 99,99 Sensibilidad ( %) 100,00 Especificidad ( %) 99,99 Cuadro 5.1: Tabla de resultados de la TVNS bajo el esquema de observación de 3 intervalos RR consecutivos bajo observación 5.2.2. Registros con Presencia de Patrones de FAP Como en el caso anterior procederemos a observar el comportamiento que pre- sentan registros en los cuales se presenta al menos un evento de FAP, haciéndole seguimiento principalmente a los siguientes estimadores: la irregularidad y ausencia de onda P. La mayoŕıa de los registros a lo largo de la hora previa a los eventos de FAP tienden a presentar una alta irregularidad (intervalos RR entre complejos adyacentes que difieren en más de 50 ms) como se observa en la figura 5.2.b , además de interrupciones y activaciones sucesivas de la onda P en complejos no adyacentes (ver figura 5.2.c), acompañados además de frecuencias instantáneas entre 50 y 200 lpm (ver figura 5.2.d). Un evento de FAP se identifica cuando coinciden simultáneamente la ausencia de la onda P en 3 complejos (PQRST) consecutivos, con la irregularidad asociada a los intervalos RR en estos, es decir, si encontramos asociado a cada complejo PQRST una diferencia entre los intervalos temporales RR que lo antecede y lo precede mayor a 50 ms, con la ausencia de la onda P (complejo QRST), como mı́nimo en 3 complejos Caṕıtulo – 5. Resultados y Discusión 49 consecutivos, se alcanza la condición de la activación de un evento de FA, como se aprecia en la figura 5.2.e. Figura 5.2: Gráfica del registro cfap 11 1ev 021600 bajo el esquema de 3 intervalos RR consecutivos bajo observación (Fuente: Elaboración propia). (a) Se muestra serie de intervalos RR. (b) Presencia de intervalos RR irregulares (1) e intervalos RR regulares (0). (c) Se muestra la presencia de onda P (1) y ausencia de onda P (0) que acompaña cada complejo. (d) Presencia de frecuencias instantáneas menores a 50 lpm (0), frecuencias instantaneas entre 50 y 100 lpm (1) y frecuencias superiores a 100 lpm (2).en cada intervalo RR. (e) Se muestra presencia (1) y ausencia (0) de un patrón de FAP en el registro Cuando empleamos el criterio de detección de un patrón de FAP a partir de la presencia de 3 intervalos RR consecutivos irregulares, acompañados de ausencia de onda P, la sensibilidad que se obtiene del detector es de 75 %, debido a la detección de falsos patrones de la enfermedad denominados falsos positivos en zonas del ECG donde no existe un evento (ver figura 5.3.e), arrojando una especificidad de 99,89 % y una exactitud de 99,89 %, como se muestra en el cuadro 5.2. Como se puede observar la sensibilidad obtenida para los casos de la detección del patrón de FAP tiende a ser inferior al resultado encontrado por el sistema detector para los casos de TVNS. De esta manera, nuestro sistema detector de FAP presenta un nivel más elevado de equivocarse al diagnosticar estos patrones arŕıtmicos comparado Caṕıtulo – 5. Resultados y Discusión 50 Figura 5.3: Gráfica del registro cfap 08 1ev 235342 bajo el esquema de 3 intervalos RR consecutivos bajo observación (Fuente: Elaboración propia). (a) Se muestra serie de intervalos RR. (b) Presencia de intervalos RR irregulares (1) e intervalos RR regulares (0). (c) Se muestra la presencia de onda P (1) y ausencia de onda P (0) que acompaña cada complejo. (d) Presencia de frecuencias instantáneas menores a 50 lpm (0), frecuencias instantáneas entre 50 y 100 lpm (1) y frecuencias superiores a 100 lpm (2).en cada intervalo RR. (e) Se muestra presencia (1) y ausencia (0) de un patrón de FAP en el registro con el detector de TVNS. Sin embargo, es notorio que la especificidad mantiene un nivel muy cercano al 100 %, resultado relevante ya que en estudios de salud pública es mucho más grave decirle a un sano que está enfermo, que equivocarse en el diagnóstico en enfermos. Esto evitaŕıa asignar un falso diagnóstico a pacientes que no presentan ninguna enfermedad, hecho no deseable y de consecuencias graves. Ahora si elevamos el nivel de exigencia para la detección de FAP usando como cri- terio involucrar 4 intervalos RR consecutivos irregulares con las respectivas ausencias de la onda P, en lugar de 3, obtenemos como resultado una sensibilidad de 58,33 %, una especificidad de 99,99 %, y una exactitud de 99,98 %, se evidencia una mejora en la especificidad y un deterioro en la sensibilidad (ver cuadro 5.3). Un ejemplo de la mejora de la especificidad al robustecer el criterio se presenta en la figura 5.4.e, en la cual se observa que tienden a desaparecer falsos positivos como los observados Caṕıtulo – 5. Resultados y Discusión 51 Registro VP VN FN FP cfap 03 1ev 195404 1 3462 0 1 cfap 04 1ev 141026 1 4360 0 1 cfap 04 2ev 161829 1 4700 0 0 cfap 08 1ev 235342 1 4552 0 3 cfap 11 1ev 021600 1 3735 0 0 cfap 15 1ev 204006 1 5573 0 3 cfap 22 1ev 113304 1 5604 0 7 cfap 05 1ev 034755 0 5221 1 3 cfap 12 1ev 204610 0 4586 1 16 cfap 13 1ev 232822 0 4168 1 16 cfap 06 1ev 111903 1 4610 0 6 cfap 24 1ev 045002 1 4353 0 2 Total 9 54924 3 58 Resultado de la FAP Exactitud ( %) 99,89 Sensibilidad ( %) 75,00 Especificidad ( %) 99,89 Cuadro 5.2: Tabla de resultados de la FAP bajo el esquema de 3 intervalos RR con- secutivos bajo observación en la figura 5.3.e, incrementando de esta manera la especificidad a expensas de un deterioro en la sensibilidad, ya que se tiende a excluir la presencia de patrones de FAP que involucran 3 intervalos RR irregulares consecutivos. Caṕıtulo – 5. Resultados y Discusión 52 Figura 5.4: Gráfica del registro cfap 08 1ev 235342 bajo el esquema de 4 intervalos RR consecutivos bajo observación (Fuente: Elaboración propia). (a) Se muestra serie de intervalos RR. (b) Presencia de intervalos RR irregulares (1) e intervalos RR regulares (0). (c) Se muestra la presencia de onda P (1) y ausencia de onda P (0) que acompaña cada complejo. (d) Presencia de frecuencias instantáneas menores a 50 lpm (0), frecuencias instantáneas entre 50 y 100 lpm (1) y frecuencias superiores a 100 lpm (2).en cada intervalo RR. (e) Se muestra presencia (1) y ausencia (0) de un patrón de FAP en el registro Caṕıtulo – 5. Resultados y Discusión 53 Registro VP VN FN FP cfap 03 1ev 195404 1 3462 0 1 cfap 04 1ev 141026 1 4360 0 0 cfap 04 2ev 161829 1 4700 0 0 cfap 08 1ev 235342 1 4552 0 0 cfap 11 1ev 021600 0 3735 1 0 cfap 15 1ev 204006 0 5573 1 0 cfap 22 1ev 113304 1 5604 0 0 cfap 05 1ev 034755 0 5221 1 1 cfap 12 1ev 204610 0 4586 1 1 cfap 13 1ev 232822 0 4168 1 3 cfap 06 1ev 111903 1 4610 0 1 cfap 24 1ev 045002 1 4353 0 1 Total 7 54924 5 8 Resultado de la FAP Exactitud ( %) 99,98 Sensibilidad ( %) 58,33 Especificidad ( %) 99,99 Cuadro 5.3: Tabla de resultados de la FAP bajo el esquema de 4 intervalos RR con- secutivos bajo observación Caṕıtulo – 5. Resultados y Discusión 54 5.2.3. Registros Control El estudio de los registros control, se lleva a cabo analizando sobre 3 intervalos RR consecutivos los mismos parámetros que han sido observados sobre los registros que presentan eventos de FAP y TVNS. Los indicadores son: irregularidad, frecuencia instantánea, ancho del QRS y presencia de onda P. En la totalidad de los casos analizados por medio del prototipo se presenta alta irregularidad (intervalos RR entre complejos adyacentes que difieren en más de 50 ms) como se observa en la figura 5.5.b , algunos de estos registros presentan además complejos aislados cuyo ancho QRS tienden a superar los 120 ms (ver 5.5.c), aśı como también presencia de interrupciones y activaciones sucesivas de la onda P en comple- jos no adyacentes aislados (ver figura 5.5.d) y frecuencias instantáneas fuera del rango - que corresponden a un ritmo sinusal normal - de 60 a 100 lpm, como se observa en la figura 5.5.e. A pesar de las alteraciones observadas (ver figura 5.5), consecuencia en la mayoŕıa de los casos de arritmia sinusal respiratoria, común en pacientes que no padecen afecciones card́ıacas, el prototipo detector responde de forma efectiva, sin activación de reconocimiento de patrones tipo FAP y TVNS (ver figura 5.5.f), indicando que la dinámica presente en los registros de ECG de aproximadamente una hora de duración pertenecen a pacientes no enfermos, ya que se obtiene una especifi- cidad de 100 %. Este resultado se encuentra además acompañado de una sensibilidad de 100 %, ya que hemos detectado un patrón de FAP (ver figura 5.6.f) por medio del sistema detector en un registro que proviene de la base de datos de pacientes sanos (control). Este hallazgo nos obligó a su certificación por medio de los médicos especialistas quienes confirmaron la veracidad del patrón arŕıtmico, este patrón no se encuentra identificado dentro de la base de datos de PhysioNET (ver figura 5.7). Tal hecho eleva el nivel de confianza sobre el sistema detector al ubicar un evento o patrón del cual inicialmente no se teńıa información. En resumen, el desempeño del algoritmo como método diagnóstico en los regis- tros control arroja un resultado altamente eficiente, con una sensibilidad de 100 %, especificidad de 100 % y exactitud de 100 %, como se observa en el cuadro 5.4. Una vez analizados los diferentes casos bajo estudio, se observó un resultado eficiente de la herramienta prototipo propuesta como detector de los eventos tipo TVNS y FAP estudiados, tomando en cuenta un mı́nimo de parámetros que lo caracterizan para su detección. Caṕıtulo – 5. Resultados y Discusión 55 Figura 5.5: Gráfica del registro del sujeto de control nsrdb 19088 22:58:00 bajo el esquema de 3 intervalos RR consecutivos bajo observación (Fuente: Elaboración pro- pia).(a) Se muestra serie de intervalos RR. (b) Presencia de intervalos RR irregulares (1) e intervalos RR regulares (0). (c) Se muestra la presencia de complejos QRS con un ancho mayor a 120 ms (1) y ausencia de complejos QRS anchos (0). (d) Se muestra la presencia de onda P (1) y ausencia de onda P (0) que acompaña cada complejo. (e) Presencia de frecuencias instantáneas entren 60 y 100 lpm (1) y ausencia de fre- cuencias dentro de este rango(0) en cada intervalo RR. (f) Se muestra presencia(1) y ausencia(0) de algún patrón de las arritmias estudiadas (FAP o TVNS). Sin embargo, es importante resaltar que se requiere de un esfuerzo que conlleve al diseño de un algoritmo computacional que tome en cuenta los diversos elementos que complican una correcta observación de la dinámica altamente cambiante que presenta el registro del ECG, y en consecuencia tienden a dificultar de manera indirecta la detección de los parámetros necesarios para la identificación de los patrones arŕıtmicos bajo estudio, entre estos elementos podemos citar: cambios de amplitudes, cambios de frecuencia, desplazamiento de la ĺınea base, cambio en la morfoloǵıa t́ıpica del ECG, ruido por interferencias externas, entre otros. Caṕıtulo – 5. Resultados y Discusión 56 Figura 5.6: Gráficas del sujeto de control nsrdb 16273 09:00:00 bajo el esquema de 3 intervalos RR consecutivos bajo observación (Fuente: Elaboración propia).(a) Se muestra serie de intervalos RR. (b) Presencia de intervalos RR irregulares (1) e in- tervalos RR regulares (0). (c) Se muestra la presencia de complejos QRS con un ancho mayor a 120 ms (1) y ausencia de complejos QRS anchos (0). (d) Se muestra la presencia de onda P (1) y ausencia de onda P (0) que acompaña cada complejo. (e) Presencia de frecuencias instantáneas entren 60 y 100 lpm (1) y ausencia de fre- cuencias dentro de este rango(0) en cada intervalo RR. (f) Se muestra presencia(1) y ausencia(0) de algún patrón de las arritmias estudiadas (FAP o TVNS). Caṕıtulo – 5. Resultados y Discusión 57 Figura 5.7: En esta imagen correspondiente a las anotaciones del registro nsrdb-16273 de la base de datos MIT-BIH Normal Sinus Rhythm, se muestra señalado en un ćırculo rojo el instante de tiempo 09:08:46 donde se presenta el patrón de FAP hallado por el prototipo, pero en dichas anotaciones no se reporta tal anomaĺıa. Registro VP VN FN FP nsrdb1626508:04:00 0 460796 0 0 nsrdb-16786-16:48:00 0 460796 0 0 nsrdb-18184-21:34:00 0 460796 0 0 nsrdb-19140-01:39:00 0 460796 0 0 nsrdb-16420-02:55:00 0 460796 0 0 nsrdb-16272-12:45:00 0 460796 0 0 nsrdb-19090-23:50:00 0 460796 0 0 nsrdb-19830-02:56:00 0 460796 0 0 nsrdb-18177-20:30:00 0 460781 0 0 nsrdb-19088-22:58:00 0 460730 0 0 nsrdb-16539-14:40:00 0 460745 0 0 nsrdb-16273-09:00:00 1 460796 0 0 Total 1 5529420 0 0 Resultado R. Control Exactitud( %) 100,00 Sensibilidad( %) 100,00 Especificidad( %) 100,00 Cuadro 5.4: Resultado de pacientes control bajo el esquema de 3 intervalos RR bajo observación 58 Caṕıtulo 6 Conclusiones y Trabajos Futuros En el trabajo presentado se desarrollo un prototipo que permite la detección de dos aritmias (TV, FA) que muchas veces sirven de elementos coadyuvantes o predece- sores de eventos letales como infartos o ACV en el hombre. Siendo las enfermedades cardiovasculares una de las principales causas de muerte en Venezuela [27], este pro- totipo pretende apoyar, a partir de un diagnóstico temprano, la disminución de la tasa de mortalidad. Entre los objetivos logrados se puede mencionar, que por medio del lenguaje de programación C/C++, con las librerias de Qt se pudo llegar al diseño e implementa- ción de un software capaz de reconocer patrones de eventos de FAP y TVNS presentes en registros de series temporales de ECG, a través de la implementación de filtros lineales y no lineales que permitieron reducir interferencias y resaltar los cambios caracteŕısticos de la señal original para luego, a partir de otros métodos computacio- nales, extraer las caracteŕısticas o parámetros que definen cada arritmia, como la onda P y complejo QRS para su posterior análisis. Es importante mencionar que es es posible obtener los parámetros caracteŕısticos necesarios para el reconocimiento de patrones de las arritmias, a partir de las etapas de procesamiento de la señal y el resultado final del algoritmo de Jiapu Pan y Willis J. Tompkins [18] reduciendo el costo computacional que generan otros métodos como el de las transformadas de wavelet ya que requieren una manipulación efectiva de ecuaciones matemáticas. Cabe destacar que a partir de dos parámetros únicos de entrada se llevó a cabo el reconocimiento de la Fibrilación auricular y Taquicardia ventricular, sin ser necesario el uso de más parámetros o una red de neuronas artificiales, e inclusive algoritmos más Caṕıtulo – 6. Conclusiones y Trabajos Futuros 59 complejos de decisión, permitiendo una detección rápida debido al número reducido de cálculos. En la fase de evaluación del sistema de reconocimiento de patrones implementado, se realizaron pruebas sobre un grupo de 36 registros pertenecientes a la base de datos del PhysioNet y del Departamento de Cardioloǵıa de la UCV. Los resultados obtenidos en la fase de evaluación de la herramienta son una sensibilidad de 100 %, una especificidad del 99,99 % y exactitud de 99,99 % en la detección de eventos de TVNS y para el patrón de FAP una sensibilidad del 75 %, especificidad de 99,89 % y exactitud de 99,89 %, usando ventanas de detección que involucran 3 intervalos temporales RR (4 complejos consecutivos). Finalmente, cabe resaltar que con el desarrollo de este trabajo se demuestra que es posible obtener resultados eficientes de la herramienta prototipo propuesta como detector de los eventos tipo TVNS y FAP estudiados, tomando en cuenta un mı́nimo de parámetros que lo caracterizan. 6.1. Trabajos Futuros Como trabajo futuro se propone ampliar las detecciones a un mayor número de arritmias y la inclusión de una interfaz gráfica para visualizar los resultados obtenidos durante el desarrollo. Se sugiere agregar al detector el cálculo de los indicadores estad́ısticos de sensi- bilidad, especificidad, eficiencia y la opción de aumentar el número de muestras a 4 intervalos RR en el análisis de las arritmias FAP y TVNS. El especialista podrá ajus- tar la herramienta a su preferencia dado el resultado de los indicadores estad́ısticos. Se propone incluir una aplicación web que muestre las estad́ısticas de los registros ECG de cada paciente e integre los resultados del prototipo detector, además de una aplicación móvil que permita la consulta de estos datos por el especialista. Se propone la aplicación de técnicas de mineŕıa de datos para generar estad́ısticas más detalladas de la población enferma. Es necesario un número mayor de registros de ECG para tal fin. 60 Acrónimos FAP Fibrilación auricular Parox́ıstica. TVNS Taquicardia ventricular no sostenida. ECG Electrocardiograma. PQRST Complejo PQRST. QRS Complejo QRS. AD Auŕıcula derecha. AI Auŕıcula izquierda. Hz Unidad de frecuencia, hercio. RR Intervalo RR. FN Falsos negativos. VN Verdaderos negativos. FP Falsos positivos. VP Verdaderos positivos. SPK Pico de la señal. NPK Pico de ruido. TH Umbral. XP Programación extrema. VD Ventŕıculo derecho. VD Ventŕıculo izquierdo. ACV Accidente cerebro vascular. 61 Apéndice A Código Fuente #include "calculo.h" #include <stdio.h> #include <string.h> #include <QFile> #include <QDebug> #include <QString> #include <QTextStream> #include <iostream> #include <stdio.h> #include <math.h> #include <QVector> #include<fstream> Calculo::Calculo(QObject * parent): QObject(parent) { } void Calculo::open(double x, QString insertaArchivo) { QFile b; fs = x; samplesRate = floor(x); b.setFileName(insertaArchivo); if (!b.open(QIODevice::ReadOnly | QIODevice::Text)) { qFatal("No puedo abrir el fichero"); } double dat1; //int i=0; QTextStream in2(&b); QString linea2; while (!in2.atEnd()) { Caṕıtulo – A. Código Fuente 62 linea2 = in2.readLine(); dat1 = linea2.toDouble(); canal1v.append(dat1); } b.close(); N = canal1v.size(); bandera = true; } void Calculo::archivoSalida(QString imprimeArchivoFilt, QString imprimeArchivoDect) { QFile write_fich(imprimeArchivoFilt); if (!write_fich.open(QFile::WriteOnly | QFile::Text)) { qDebug() << "No se ha podido abrir el fichero de escritura"; return; } else { QTextStream out(&write_fich); for (long i = 0; i < N; ++i) { out << filtrado[i]; out << "\n"; } } write_fich.close(); QFile write_fich8(imprimeArchivoDect); if (!write_fich8.open(QFile::WriteOnly | QFile::Text)) { qDebug() << "No se ha podido abrir el fichero de escritura"; return; } else { QTextStream out8(&write_fich8); out8 << "\n"; } write_fich8.close(); } void Calculo::calculoSenhal() { Caṕıtulo – A. Código Fuente 63 double *f; double *lineal; f = new double[N]; lineal = new double[N]; filtrado = new double[N]; derivada = new double[N]; integrada = new double[N]; cuadrado = new double[N]; for (int j = 0; j < 12; ++j) { f[j] = canal1v.at(j); } for (int i = 12; i < N; ++i) { f[i] = 2 * f[i - 1] - f[i - 2] + canal1v.at(i) - 2 * canal1v.at(i - 6) + canal1v.at(i - 12); } for (int j = 0; j < 32; ++j) { filtrado[j] = f[j]; } for (int i = 32; i < N; ++i) { filtrado[i] = 32 * f[i - 16] - (filtrado[i - 1] + f[i] - f[i - 32]); } long int s = 1, k = 1, x = samplesRate; double M, B, aux_rl; while (s < N) { if (x > N) x = N; if (s == 1) RegresionLineal(filtrado, &M, &B, s, (x + 0.5 * samplesRate)); else if ((x + 0.5 * samplesRate) >= N) RegresionLineal(filtrado, &M, &B, (s - 0.5 * samplesRate), x); else RegresionLineal(filtrado, &M, &B, (s - 0.5 * samplesRate), (x + 0.5 * samplesRate)); for (int i = s; i < x; ++i) { aux_rl = B + (M * i); lineal[i] = filtrado[i] - aux_rl; Caṕıtulo – A. Código Fuente 64 } s = k * samplesRate; x = s + samplesRate; k++; } for (long int i = 0; i < N; ++i) filtrado[i] = lineal[i]; for (int j = 0; j < N; ++j) { if (j < 4) { derivada[j] = 0; } else { derivada[j] = (2 * filtrado[j] + filtrado[j - 1] - filtrado[j - 3] - filtrado[j - 4]) / 8; } } for (int j = 0; j < N; ++j) { cuadrado[j] = derivada[j] * derivada[j]; } int tamVentana; double aux = 0.0; tamVentana = (150 * samplesRate) / 1000.0; for (int i = 0; i < N; i++) { if (i < tamVentana) { integrada[i] = cuadrado[i]; } else { for (int k = 1; k < tamVentana + 1; k++) { aux += (cuadrado[i - (tamVentana - k)]); } integrada[i] = aux; aux = 0.0; } } canal1v.clear(); delete f; delete lineal; DeteccionQRS(fs); deteccionIrregularidad(); Caṕıtulo – A. Código Fuente 65 anchoQRS(); Detector(); } void Calculo::RegresionLineal(double *sn, double *m, double *b, long inic, long fin) { double sumx, sum_sqx, sumy, sumxy; long n, i; sumx = 0; sum_sqx = 0; sumy = 0; sumxy = 0; n = fin - inic; for (i = inic; i < fin; i++) { sumx = sumx + i; sumy = sumy + sn[i]; sumxy = sumxy + (i * sn[i]); sum_sqx = sum_sqx + (i * i); } *m = (n * sumxy - sumx * sumy) / (n * sum_sqx - sumx * sumx); *b = (sumy - (*m) * sumx) / n; } double Calculo::getMayor(double *arreglo, int dimen) { mayor = arreglo[0]; for (int i = 0; i < dimen; ++i) { if (mayor < arreglo[i]) mayor = arreglo[i]; } return mayor; } double Calculo::getMenor(double *arreglo2, int dimen2) { menor = arreglo2[0]; for (int i = 0; i < dimen2; ++i) { if (menor > arreglo2[i]) menor = arreglo2[i]; } return menor; } Caṕıtulo – A. Código Fuente 66 void Calculo::DeteccionQRS(double j) { long int fs_floor, filtWin, slopeWin, k, first, last, maxPosFilt; double SPKI, NPKI, THRESHI, SPKF, NPKF, THRESHF, waitWin, maxNoDet, aux1, aux2; double maxSlope, lastSlope; long int i, z; QVector < double >SlopeR1; fs_floor = floor(j); double sumPoscDer = 0.0; long ventanaDerivada = 0; while (sumPoscDer < 400) { sumPoscDer += ((1 / fs) * 1000.0); ventanaDerivada++; } double maxI; maxI = getMayor(integrada, fs_floor); SPKI = maxI; NPKI = 0.01 * maxI; THRESHI = NPKI + 0.21 * (SPKI - NPKI); double maxF; maxF = getMayor(filtrado, fs_floor); SPKF = maxF; NPKF = 0.01 * maxF; THRESHF = NPKF + 0.21 * (SPKF - NPKF); waitWin = (200.0 / 1000.0) * fs; maxNoDet = 1.0 * fs; aux1 = (100.0 / 1000.0) * fs; filtWin = floor(aux1); aux2 = (50.0 / 1000.0) * fs; slopeWin = floor(aux2); lastSlope = 0; k = 0; int waitwin_floor = floor(-waitWin); beats.append(waitwin_floor); long x, y, num = 0; double promed1, RR_Average1, RR_LowLimit, RR_HighLimit; double auxpromed1, promed1amplitud, RR_AverageAmplitud1; Caṕıtulo – A. Código Fuente 67 double maxAmplFilt; int opcion = 0; RR_Average1 = maxNoDet; RR_LowLimit = 0.92 * RR_Average1; RR_HighLimit = 1.16 * RR_Average1; for (i = 1; i < N - 1; i++) { if ((i - beats.last()) > waitWin) { if ((integrada[i] > integrada[i - filtWin]) && (integrada[i] > integrada[i + filtWin])) { if (integrada[i] > THRESHI) { first = ((i - filtWin) < 0) ? 0 : (i - filtWin); last = ((i + filtWin) > N) ? (N - 1) : (i + filtWin); maxAmplFilt = filtrado[first]; for (x = first; x < last; x++) { if (maxAmplFilt < filtrado[x]) { maxAmplFilt = filtrado[x]; maxPosFilt = x; } } first = ((i - slopeWin) < 0) ? 0 : (i - slopeWin); last = ((i + slopeWin) > N) ? (N - 1) : (i + slopeWin); for (z = first, maxSlope = derivada[first]; z < last; z++) { if (maxSlope < derivada[z]) maxSlope = derivada[z]; } //ffor double aa, bb; long l; aa = (360.0 / 1000.0) * fs; bb = (360.0 / 1000.0) * fs; if ((filtrado[maxPosFilt] >= THRESHF) && (((maxPosFilt - beats.last()) > (aa)) || ((maxPosFilt - beats.last()) <= (bb) && maxSlope >= (0.85 * lastSlope))) ) { /*El condicional if verifica dos condiciones: 1) si el valor maximo de la se~nal es mayor al umbral y ocurre despues de 360ms 2) si el valor maximo de la se~nal es mayor al umbral y el latido encontrado ocurre antes de los 360ms, se evalua si tiene una pendiente pronunciada, es decir, si la pendiente es mayor a la mitad, si esto ocurre, se descarta que sea una onda T. */ Caṕıtulo – A. Código Fuente 68 l = maxPosFilt; long finDer, posNuevR; double maxDeriv; maxDeriv = derivada[maxPosFilt]; posNuevR = maxPosFilt; finDer = maxPosFilt - ventanaDerivada; if (finDer < (beats.last() + waitWin)) finDer = beats.last() + waitWin; for (long x3 = maxPosFilt; x3 > finDer; --x3) { if (maxDeriv < derivada[x3]) { maxDeriv = derivada[x3]; posNuevR = x3; } } //fforx3 if (maxDeriv > derivada[maxPosFilt]) { maxPosFilt = posNuevR; maxAmplFilt = filtrado [maxPosFilt]; maxSlope = maxDeriv; } beats.append(maxPosFilt); k = k + 1; num = beats.size() - 1; if (num >= 9) { for (y = 0, auxpromed1 = 0.0, promed1amplitud = 0.0; y < 8; y++, num--) { promed1 = (beats.at(num)) - (beats.at((num - 1))); auxpromed1 += promed1; promed1amplitud += filtrado[beats.at(num)]; } auxpromed1 = 0.125 * auxpromed1; RR_Average1 = (auxpromed1 / fs) * 1000; RR_AverageAmplitud1 = 0.125 * promed1amplitud; RR_LowLimit = 0.92 * auxpromed1; RR_HighLimit = 1.16 * auxpromed1; maxNoDet = RR_HighLimit; if (maxNoDet > (2.0 * fs)) maxNoDet = 1.0 * fs; } SPKI = 0.125 * integrada[i] + 0.875 * SPKI; SPKF = 0.125 * RR_AverageAmplitud1 + 0.875 * SPKF; Caṕıtulo – A. Código Fuente 69 NPKI = 0.125 * integrada[i] + 0.875 * NPKI; NPKF = 0.125 * filtrado[maxPosFilt] + 0.875 * NPKF; THRESHI = NPKI + 0.21 * (SPKI - NPKI); THRESHF = NPKF + 0.21 * (SPKF - NPKF); lastSlope = maxSlope; SlopeR1.append(lastSlope); } else { // fin de la condicion > 360ms o <360ms y pendiente del pico candidato a R mayor a la pendiente de onda T } } else { } } /*fin de verificacion de existencia de pico */ else { switch (opcion) { case 0: if ((i - beats.last()) > maxNoDet) { THRESHI = 0.5 * THRESHI; THRESHF = 0.5 * THRESHF; i = beats.last() + waitWin; opcion = 1; } break; case 1: if ((i - beats.last()) > maxNoDet) { THRESHI = THRESHI / 0.5; THRESHF = THRESHF / 0.5; i = beats.last() + waitWin; maxNoDet = 1.3 * RR_HighLimit; opcion = 2; } break; case 2: if ((i - beats.last()) > maxNoDet) { THRESHI = 0.25 * THRESHI; THRESHF = 0.25 * THRESHF; i = beats.last() + waitWin; opcion = 3; } break; case 3: if ((i - beats.last()) > maxNoDet) { THRESHI = THRESHI / 0.25; THRESHF = THRESHF / 0.25; i = beats.last() + 2.0 * waitWin; maxAmplFilt = derivada[i]; maxPosFilt = i; for (long y = i; y < (i + maxNoDet); ++y) { if (maxAmplFilt < derivada[y]) { maxAmplFilt = derivada[y]; maxPosFilt = y; } Caṕıtulo – A. Código Fuente 70 } maxAmplFilt = filtrado[maxPosFilt]; opcion = 4; } break; } //fin de swicth if (opcion == 4) { beats.append(maxPosFilt); k = k + 1; maxNoDet = RR_HighLimit; NPKI = 0.125 * integrada[maxPosFilt] + 0.875 * NPKI; NPKF = 0.125 * filtrado[maxPosFilt] + 0.875 * NPKF; THRESHI = NPKI + 0.21 * (SPKI - NPKI); THRESHF = NPKF + 0.21 * (SPKF - NPKF); SlopeR1.append(lastSlope); opcion = 0; } } } } tamanhoBeats = beats.size(); resultadoBeats = new int[tamanhoBeats]; int *data = beats.data(); for (int m = 0; m < tamanhoBeats; ++m) { resultadoBeats[m] = data[m]; } tamanhoSlope = SlopeR1.size(); SlopeR = new double[tamanhoSlope]; for (int ms = 0; ms < tamanhoSlope; ++ms) { SlopeR[ms] = SlopeR1.at(ms); } } void Calculo::deteccionIrregularidad() { double dt; QVector < double >aux_Int_RR; QVector < int >aux_Posic_latido_irreg; QVector < long >aux_posic_Int_RR; dt = 1 / fs; tiempMuestr = dt * 1000; double promd = 0.0, promd2 = 0.0, aux_muestra2 = 0.0, muestras2 = 0.0, compara2, compara, tiemp2, tiemp, muestras = 0.0, aux_muestra = 0.0; int ind; for (int i = 2; i < tamanhoBeats - 1; i++) { if (i < 9) { aux_muestra = beats.at(i) - beats.at(i - 1)) * tiempMuestr; Caṕıtulo – A. Código Fuente 71 muestras = aux_muestra + muestras; if (i == 8) { promd = (muestras) / 8; tiemp = (beats.at(i + 1) - beats.at(i)) * tiempMuestr; compara = promd - tiemp; if (compara < 0) { //Diferencia positiva compara = (-1) * compara; } } } else { for (int k = 2; k < 8 + 1; k++) { ind = i - (8 - k); aux_muestra2 = (beats.at(ind) - beats.at(ind - 1)) * tiempMuestr; muestras2 = aux_muestra2 + muestras2; } promd2 = (muestras2) / 8; tiemp2 = (beats.at(i + 1) - beats.at(i)) * tiempMuestr; compara2 = promd2 - tiemp2; if (compara2 < 0) { compara2 = (-1) * compara2; } promd2 = 0.0; aux_muestra2 = 0.0; muestras2 = 0.0; compara2 = 0.0; tiemp2 = 0.0; } } double TiempRR = 0.0, aux_Tiem_RR = 0.0, auxFrec; for (int a = 2; a < tamanhoBeats; a++) { aux_Tiem_RR = (beats.at(a) - beats.at(a - 1)) * tiempMuestr; if (aux_Tiem_RR < 0) { aux_Tiem_RR = (-1) * aux_Tiem_RR; } aux_Int_RR.append(aux_Tiem_RR); aux_posic_Int_RR.append(beats.at(a)); } tamanhoRR = aux_Int_RR.size(); Int_RR = new double[tamanhoRR]; posic_Int_RR = new long[tamanhoRR]; posic_Irregularidad = new int[tamanhoRR]; frecuenciaTV.reserve(tamanhoRR); frecuenciaTV.fill(0, tamanhoRR); double *data = aux_Int_RR.data(); for (int m = 0; m < tamanhoRR; ++m) { Int_RR[m] = data[m]; } for (long m2 = 0; m2 < tamanhoRR; ++m2) { posic_Int_RR[m2] = aux_posic_Int_RR.at(m2); posic_Irregularidad[m2] = 0; } Caṕıtulo – A. Código Fuente 72 for (int r = 1; r < tamanhoRR; r++) { TiempRR = (Int_RR[r] - Int_RR[r - 1]); if (TiempRR < 0) { TiempRR = (-1) * TiempRR; } if (TiempRR > 50) { posic_Irregularidad[r] = 1; } auxFrec = (60000 / Int_RR[r]); if ((auxFrec) > 100) { frecuenciaTV.replace(r, 1); } } int k = 1; double numIrreg = 0; while (k < tamanhoRR - 1) { if (posic_Irregularidad[k] == 1 && posic_Irregularidad[k - 1] == 1 && posic_Irregularidad[k + 1] == 1 /* && posic_Irregularidad[k+2] == 1 */ ) { aux_Posic_latido_irreg.append(k); numIrreg = numIrreg++; k++; } else { k++; } } tamnhoPosicIrrg = aux_Posic_latido_irreg.size(); Posic_todo_latido_irreg = new int[tamnhoPosicIrrg * 3]; int *data2 = aux_Posic_latido_irreg.data(); int z = 1, s = 0, m, e; while (z < (tamnhoPosicIrrg * 3)) { m = z; if (s < tamnhoPosicIrrg) { e = aux_Posic_latido_irreg.at(s); Posic_todo_latido_irreg[m - 1] = resultadoBeats[e - 1]; Posic_todo_latido_irreg[m] = resultadoBeats[e]; Posic_todo_latido_irreg[m + 1] = resultadoBeats[e + 1]; z = z + 3; s++; } } double tiempIrreg, a2; for (int a = 0; a < tamnhoPosicIrrg; ++a) { a2 = Posic_todo_latido_irreg[a] / fs; tiempIrreg = a2 / 60; } if (numIrreg > 0) { promedio_Irregularidades = 1; } else { promedio_Irregularidades = 0; } } Caṕıtulo – A. Código Fuente 73 void calculos::anchoQRS() { long posic, x, posic2, xq, temp, tamVentana1 = 0, tamVentana15 = 0, tamVentana40 = 0, min, finS, finQ, numTV; double aux, auxQ, auxS, sumTiemp = 0; long k = 0, t = 0, q = 0; QVector < long >aux_Posic_TV; ondaS = new double[tamanhoBeats - 1]; ondaQ = new double[tamanhoBeats - 1]; posicionS = new long[tamanhoBeats - 1]; posicionQ = new long[tamanhoBeats - 1]; anchQRS = new double[tamanhoBeats - 1]; QRS_ancho = new long[tamanhoBeats - 1]; double dt = 1 / fs; for (int q = 0; q < tamanhoBeats - 1; ++q) { posicionS[q] = 0; posicionQ[q] = 0; ondaQ[q] = 0; ondaS[q] = 0; } sumTiemp = 0; tamVentana1 = 0; while (sumTiemp < 150) { sumTiemp = tiempMuestr + sumTiemp; tamVentana1++; } sumTiemp = 0; tamVentana15 = 0; while (sumTiemp < 15) { sumTiemp = tiempMuestr + sumTiemp; tamVentana15++; } sumTiemp = 0; tamVentana40 = 0; while (sumTiemp < 40) { sumTiemp = tiempMuestr + sumTiemp; tamVentana40++; } for (long t = 0; t < tamanhoBeats - 1; ++t) { posic = resultadoBeats[t]; finS = posic + tamVentana1; for (long s = posic; s < finS; ++s) { if (derivada[s] < 0) { ondaS[t] = derivada[s]; posicionS[t] = s; for (min = s; min < (s + tamVentana40); min++) { if (derivada[min] < ondaS[t]) { ondaS[t] = derivada[min]; posicionS[t] = min; } } break; } } } for (long q = 0; q < tamanhoBeats - 1; q++) { Caṕıtulo – A. Código Fuente 74 posic2 = resultadoBeats[q]; auxQ = posic2 - tamVentana1; if (auxQ < 0) { finQ = 0; } else { finQ = auxQ; } for (long l = posic2; l > (finQ); --l) { if (derivada[l] < 0) { ondaQ[q] = derivada[l]; posicionQ[q] = l; for (min = l; min > (l - tamVentana15); min--) { if (derivada[min] < ondaQ[q]) { ondaQ[q] = derivada[min]; posicionQ[q] = min; } } break; } } } for (long k = 0; k < tamanhoBeats - 1; ++k) { QRS_ancho[k] = 0; anchQRS[k] = 0; } for (long j = 0; j < tamanhoBeats - 1; ++j) { if ((posicionS[j] == 0) || (posicionQ[j] == 0)) { if ((posicionS[j] == 0) && (posicionQ[j] == 0)) { anchQRS[j] = 200; } else if ((posicionS[j] != 0) && (posicionQ[j] == 0)) { anchQRS[j] = 2 * ((posicionS[j] - resultadoBeats[j]) * tiempMuestr); } else if ((posicionS[j] == 0) && (posicionQ[j] != 0)) { anchQRS[j] = 2 * ((resultadoBeats[j] - posicionQ[j]) * tiempMuestr); } } else { temp = posicionS[j] - posicionQ[j]; anchQRS[j] = (tiempMuestr * temp); } } for (long k2 = 0; k2 < tamanhoBeats - 1; ++k2) { if (anchQRS[k2] > 120) { QRS_ancho[k2] = 1; } } long an = 1; while (an < tamanhoBeats - 1) { if (QRS_ancho[an] == 1 && QRS_ancho[an - 1] == 1 && QRS_ancho[an + 1] == 1) { aux_Posic_TV.append(an); numTV = numTV++; an = an + 2; } else { an++; } } tamanhoPTV = aux_Posic_TV.size(); Caṕıtulo – A. Código Fuente 75 posicion_TV = new long[tamanhoPTV * 3]; long aux4, z1 = 1, s = 0, m; long *data3 = aux_Posic_TV.data(); while (z1 < (tamanhoPTV * 3)) { m = z1; if (s < tamanhoPTV) { aux4 = data3[s]; posicion_TV[m - 1] = resultadoBeats[aux4 - 1]; posicion_TV[m] = resultadoBeats[aux4]; posicion_TV[m + 1] = resultadoBeats[aux4 + 1]; z1 = z1 + 3; s++; } } /* Si se encuentran al menos, 1 complejos QRS, con una duración > 120 ms, se asigna 1, porque es indicativo de la existencia de una TV no sostenida */ if (numTV > 0) { promedio_SIhayTV = 1; } else { promedio_SIhayTV = 0; } } double calculos::ausenciaP() { long pos, pos3, fin, pos_aux = 0, ventana = 0, aux_p, *temporal, aux3, pikP, ventanaP = 0, posR, ventana2 = 0, ventanaSalto1 = 0, ventanaSalto2 = 0; double maxP, tPd, tBd, sumTiempM = 0.0, maxpikP = 0.0, sumTiemp2 = 0.0, IntRRp, sumTiemp3 = 0.0; QVector < long >pos_aux_P; QVector < long >posicion_hayP; QVector < double >vector_promedioPendientP; QVector < long >R_quetiene_P; hay_p = new long[tamanhoBeats - 1]; while (sumTiempM < 200) { //Ventana del segmento P-Q de 200ms sumTiempM += tiempMuestr; ventana2++; } sumTiemp3 = 0.0; ventanaSalto1 = 0; while (sumTiemp3 < 10) { sumTiemp3 += tiempMuestr; ventanaSalto1++; } sumTiemp3 = 0.0; ventanaSalto2 = 0; while (sumTiemp3 < 30) { sumTiemp3 += tiempMuestr; ventanaSalto2++; } while (sumTiemp2 < 95) { sumTiemp2 += tiempMuestr; ventanaP++; } double pendienteP = 0.0, promedioPendientP; Caṕıtulo – A. Código Fuente 76 long nroVeces = 0, fin2; for (long p3 = 0; p3 < tamanhoBeats - 1; ++p3) { posR = resultadoBeats[p3 + 1]; if (p3 > 0) { sumTiemp3 = 0.0; ventanaSalto1 = 0; double ind3 = 0.5 * anchQRS[p3]; while (sumTiemp3 < ind3) { sumTiemp3 += tiempMuestr; ventanaSalto1++; } ventanaSalto2 = ventanaSalto1; if (posicionQ[p3] == 0) { pos3 = resultadoBeats[p3] - ventanaSalto2; } else { pos3 = posicionQ[p3] - ventanaSalto1; pos3 = resultadoBeats[p3] - ventanaSalto2; } IntRRp = (resultadoBeats[p3] - resultadoBeats[p3 - 1]) * tiempMuestr; if (((IntRRp - 360) < 200) && ((IntRRp - 360) > 0)) { sumTiempM = 0.0; ventana = 0; while (sumTiempM < (IntRRp - 360)) { sumTiempM += tiempMuestr; ventana++; } } else { ventana = ventana2; } long aux_p = pos3 - ventana; fin = (aux_p < 0) ? 0 : aux_p; double maxpikP3 = filtrado[pos3]; pikP = 0; for (long j2 = pos3; j2 > fin; --j2) { if (maxpikP3 < filtrado[j2]) { maxpikP3 = filtrado[j2]; pikP = j2; } } long finAtras = (pikP - ventanaP); double derivadaPatras, derivadaPadelante, pendMax; long la, ld; if (pikP != 0) { la = 0; for (long atras = pikP; atras > finAtras; --atras) { if ((((derivada[atras] + derivada[atras - 1] + derivada[atras - 2]) - (derivada[atras - 2] + derivada[atras - 3] + derivada[atras - 4])) < 0)) { derivadaPatras = derivada[atras]; la = atras; break; Caṕıtulo – A. Código Fuente 77 } } if (la == 0) derivadaPatras = 0.0; long finAdelante = pikP + ventanaP; ld = 0; for (long adelante = pikP; adelante < finAdelante; ++adelante) { if ((((derivada[adelante] + derivada[adelante + 1] + derivada[adelante + 2]) - (derivada[adelante + 2] + derivada[adelante + 3] + derivada[adelante + 4])) < 0.0)) { derivadaPadelante = derivada[adelante]; ld = adelante; break; } } if (ld == 0) derivadaPadelante = 0.0; double tiempoP, maxpendAtras; long posmaxpendAtras, posmaxpendAdelante, maxpendAdelante; if ((la != 0) && (ld == 0)) { tiempoP = 2.0 * (pikP - la) * tiempMuestr; if ((tiempoP > 30) && (tiempoP < 160)) { maxpendAtras = cuadrado[pikP]; for (long j5 = pikP; j5 > la; --j5) { if (maxpendAtras < cuadrado[j5]) { maxpendAtras = cuadrado[j5]; posmaxpendAtras = j5; } } maxpendAdelante = maxpendAtras; pendMax = maxpendAdelante; } } if ((la == 0) && (ld != 0)) { tiempoP = 2.0 * (ld - pikP) * tiempMuestr; if ((tiempoP > 30) && (tiempoP < 160)) { maxpendAdelante = cuadrado[pikP]; for (long j6 = pikP; j6 < ld; ++j6) { if (maxpendAdelante < cuadrado[j6]) { maxpendAdelante = cuadrado[j6]; posmaxpendAdelante = j6; } } maxpendAtras = maxpendAdelante; pendMax = maxpendAtras; } } if ((la != 0) && (ld != 0) && (la != ld)) { tiempoP = (ld - la) * tiempMuestr; Caṕıtulo – A. Código Fuente 78 if ((tiempoP > 30) && (tiempoP < 160)) { maxpendAtras = cuadrado[pikP]; for (long j5 = pikP; j5 > la; --j5) { if (maxpendAtras < cuadrado[j5]) { maxpendAtras = cuadrado[j5]; posmaxpendAtras = j5; } } maxpendAdelante = cuadrado[pikP]; for (long j6 = pikP; j6 < ld; ++j6) { if (maxpendAdelante < cuadrado[j6]) { maxpendAdelante = cuadrado[j6]; posmaxpendAdelante = j6; } } pendMax = maxpendAdelante; double auxpromedioPendientP; long nroVeces2, posP; posP = vector_promedioPendientP.size() - 1; if (posP >= 9) { nroVeces2 = 0; auxpromedioPendientP = 0.0; for (long y2 = 0; y2 < 8; y2++, posP--) { auxpromedioPendientP += vector_promedioPendientP.at(posP); nroVeces2++; } promedioPendientP = auxpromedioPendientP / nroVeces2; } } } if (((tiempoP > 30) && (tiempoP < 160)) && ((la != 0) || (ld != 0))) { pos_aux_P.append(pikP); posicion_hayP.append(p3); vector_promedioPendientP.append(pendMax); R_quetiene_P.append(posR); } } } } tamanhoP = pos_aux_P.size(); posicionP = new long[tamanhoP]; temporal = new long[tamanhoP]; long *dataP = pos_aux_P.data(); for (long m = 0; m < tamanhoP; ++m) { posicionP[m] = dataP[m]; } for (long x = 0; x < tamanhoBeats - 1; ++x) { hay_p[x] = 0; } long *data_hay = posicion_hayP.data(); for (long st = 0; st < tamanhoP; ++st) { temporal[st] = data_hay[st]; } for (long u = 0; u < tamanhoP; ++u) { Caṕıtulo – A. Código Fuente 79 aux3 = temporal[u]; hay_p[aux3] = 1; } for (long x = 0; x < tamanhoBeats - 1; ++x) { if (hay_p[x] != 0) { tPd++; } } long indPP; binarioP = new long[N]; for (long y1 = 0; y1 < N; ++y1) { binarioP[y1] = 0; } for (long y2 = 0; y2 < tamanhoP; ++y2) { indPP = posicionP[y2]; binarioP[indPP] = 1; } OndaP_IntRR = new int[tamanhoRR]; for (int x2 = 0; x2 < tamanhoRR; ++x2) { OndaP_IntRR[x2] = 0; } long esta; for (int yy = 0; yy < (R_quetiene_P.size()); ++yy) { //(8) esta = R_quetiene_P.at(yy); for (int m2 = 0; m2 < tamanhoRR; ++m2) { if (esta == posic_Int_RR[m2]) { //(7) OndaP_IntRR[m2] = 1; } } } /* Se deberia calcular un promedio, algo asi como el numero de ondas P entre numero de picos R y esa salida, si es 1, significa que no hay ausencia de onda P */ tBd = tamanhoBeats - 1; promedio_SIhayP = tPd / tBd; return promedio_SIhayP; } void calculos::Detector() { long tempTV, tempFA, tempSano; bool hayTV = 0, hayFA = 0; double frecTV, frecTV2; detecciones = new long[tamanhoRR]; QVector < long >TVNS_temp; QVector < long >FAP_temp; for (long z1 = 0; z1 < tamanhoRR; ++z1) { detecciones[z1] = 0; } //*************** TV ************** if (hayTV == 0) { for (long z2 = 1; z2 < tamanhoBeats - 1; ++z2) { if ((QRS_ancho[z2] == 1) && (QRS_ancho[z2 - 1] == 1) && (QRS_ancho[z2 + 1] == 1)) { TVNS_temp.append(z2); hayTV = 1; } } Caṕıtulo – A. Código Fuente 80 for (long z3 = 0; z3 < TVNS_temp.size(); ++z3) { tempTV = TVNS_temp.at(z3); frecTV = 60000 / ((resultadoBeats[tempTV] - resultadoBeats[tempTV - 1]) * tiempMuestr); frecTV2 = 60000 / ((resultadoBeats[tempTV + 1] - resultadoBeats[tempTV]) * tiempMuestr); if ((frecTV > 100) || (frecTV2 > 100)) { detecciones[tempTV] = 1; } } } //***** FA ***************** if ((hayFA == 0)) { //(b) ausenciaP(); for (long z4 = 1; z4 < tamanhoRR; ++z4) { detecciones[z4] = 1; hayFA = 1; } } } } for (long z4 = 1; z4 < tamanhoBeats - 1; ++z4) { if ((hay_p[z4] == 1) && (hay_p[z4 + 1] == 1) && (hay_p[z4 - 1] == 1)) { FAP_temp.append(z4); tempFA; OndaP_IntRR[i] == 1; posic_Irregularidad[r] = 1; if ((OndaP_IntRR[z2 - 1] == 1 && OndaP_IntRR[z2] == 1 && OndaP_IntRR[z2 + 1] == 1) && posic_Int_RR[z2]) { detecciones[z2] = 1; } //***** sanos ***************** if ((hayTV == 0) && (hayFA == 0)) { qDebug() << "ES SANO!!!\n"; } } 81 Bibliograf́ıa [1] Pocock, G. ; Richards, D.C. : Fisioloǵıa Humana: la base de la medicina Editorial Masson, 2da. Edición, año 2005 [2] Koolman, J. ; Röhm , K.H. : Bioqúımica: Textos y Atlas Editorial Médica Panamericana, 3ra. Edición, Pag. 274, año 2004 [3] Prieto, J. ; Gal, B. : Bases de la Fisioloǵıa Editorial Tebar, 2da. Edición, Pag. 95. [4] Castellano, C. ; Perez de Juan, M. ; Attie, F. : Electrocardiograf́ıa Cĺınica Editorial Elsevier, 2da. Edición, Pag. 9-14,16-203,año 2004 [5] Almeida, F. ; Deyanira : Manual de Arritmias Card́ıacas CDHC-UCV, Pag. 145, año 2004 [6] Huszar, R. : Arritmias: Principios, Interpretación y Tratamiento Editorial Elsevier, 3ra. Edición, Pag. 7-21, año 2002 [7] Gutiérrez, O. ; Araya, V. : Manual de Arritmias Cardiacas: Gúıa diagnóstica Terapéutica Editorial de la Universidad de Costa Rica, 1ra. Edición, Pag. 11-12,93, año 2002 [8] Duque, M. ; Vesga, B. : Electrocardiograf́ıa Sociedad Colombiana de Cardio- loǵıa y Ciruǵıa Cardiovascular, 1ra. Edición, Pag. 14–19, año 2008 [9] López, G.L. : Semioloǵıa Cardiovascular 5ta. Edición, Pag. 18-19, año 1999 [10] Palastanga, N. ; Field, D. : Anatomı́a y Movimiento Humano, Estructura y Funcionamiento Editorial Paidotribo, 3ra. Edición, año 2000 Bibliograf́ıa 82 [11] Braunwald, E. : Tratado de Cardioloǵıa Editorial McGraw-Hill Interamerica, Vol. 1, 5ta. Edición, Pag. 599, año 1999 [12] Fuster, V. ; Wayne, R. : HURST: El corazón Editorial McGraw-Hill Inter- america, Vol. 1, 10ma. Edición, Pag. 767 [13] Butler, H. : Como leer un electrocardiograma Editorial Para los médicos, año 1981 [14] Mendis, S. ; Puska P. : Global Atlas on Cardiovascular Diseases Prevention and Control Published by the World Health Organization in collaboration with the World Heart Federation and the World Stroke Organization, Pag. 58, año 2011 [15] Argente, A.H. ; Álvarez, E.M. : Semioloǵıa Médica: fisiopatoloǵıa, se- miotecnia y propedéutica. Enseñanza basada en el paciente Editorial Médica Pan- americana, año 2005 [16] Fernández, V.A. ; López, J. : Fisioloǵıa del ejercicio Editorial Médica Panamericana, 3ra. Edición, Pag. 442-443, año 2006 [17] Armada, F. ; Curcio, P. : Anuario de Mortalidad de Venezuela 2011 Minis- terio del poder popular para la salud, Pag. 10, año 2014 [18] Pan, J. ; Tompkins, W.J. : A Real-Time QRS Detection Algorithm IEEE Transactions on Biomedical Engineering, Vol. BME-32, No. 3, March 1985 [19] Isasi, P. ; Galvan, I. : Redes de Neuronas Artificiales: Un Enfoque Práctico Editorial Pearson Educación, año 2004 [20] Serrano, A.J. ; Soria, E. ; Martin, J.D. : Redes Neuronales Artificiales OCW de la Universitat de Valencia, 3er. Ciclo , año 2009 [21] Sotos, J.M. ; Rieta, J.J. : Aplicación de Redes Neuronales Artificiales en el Procesado Versátil de Señales Electrocardiográficas Universidad Politécnica de Valencia, Julio 2012 [22] Kendall, E.K. ; Kendall, J. : Análisis y diseño de sistemas Editorial Pear- son Educación, 6ta. Edición, año 2005 [23] Ledezma, C. : Pan and Tompkins Detector http://gbbanet.labc.usb.ve/toolbox.php Bibliograf́ıa 83 [24] Bustamante, L. ; Guevara ; Migliore ; Roisinblit : Ecocardiograf́ıa: para la toma de decisiones cĺınicas Editorial Médica Panamericana, Julio 2005 [25] Hinojosa, S. : Detector de QRS basado en el algoritmo de Pan y Tompkins Señales e Imagenes en Biomedicina, 1er. Cuatrimestre, año 2011 [26] Reina, M. : Diseño y Análisis de Confiabilidad de un Algoritmo para la Detec- ción de Fibrilación Auricular Universidad Simon Bolivar, Febrero 2006 [27] Perez, N. ; Curcio, P. : Republica Bolivariana de Venezuela Anuario de Mortalidad 2012 Ministerio del Poder Popular para la Salud, Pag. 6, Septiembre 2014 [28] Meissimilly, G. : Filtros con Coeficientes Potencias de 2: Una Alternativa para Suprimir el Ruido de la Señal ECG en Tiempo Real Usando Microprocesadores de Propósito General Instituto Central de Investigación Digital, año 2002 [29] Gonzales, M. ; Casillas, J. : Reducción de ruido digital en señales ECG utilizando filtraje por convolución Investigación y ciencia de la Universidad de Autónoma de Aguascalientes, No. 40, Enero-Abril 2008 [30] Goldberger, AL.; Amaral, LAN.; Glass, L.; Hausdorff, JM. : Phy- sioBank, PhysioToolkit, and PhysioNet: Components of a New Research Resource for Complex Physiologic Signals Circulation 101(23):e215-e220, June 13 2000 [31] Tomasi, W. : Sistemas de comunicaciones electrónicas Editorial Prentice Hall, 4ta. Edición, año 2003 Índice de figuras Índice de cuadros Resumen Introducción Planteamiento del problema Planteamiento del Problema Objetivo General Objetivos Específicos Alcance Justificación El Corazón Anatomía y Funcionalidad del Corazón Ciclo Cardíaco Sistema de Conducción Cardíaca Alteraciones del Ritmo Cardiaco Arritmias Tipos de Arritmias Arritmias Supraventriculares Arritmias Ventriculares Fibrilación Auricular Taquicardia Ventricular Pruebas Diagnóstico para la Detección de Arritmias Prueba de Esfuerzo Registro Electrocardiográfico de Largo Plazo Derivaciones del Electrocardiógrafo Derivaciones unipolares Derivaciones bipolares Holter Ruido Algoritmo especializado Algoritmos de Detección del QRS Filtro Pasa Banda Filtro Pasa Bajos Filtro Pasa Altos Derivación Función Cuadrática Ventana Móvil Integradora Fase de Detección Umbrales Adaptativos Metodología Base de Datos del Instituto de Medicina Tropical, Departamento de Cardiología de la UCV Base de Datos del MIT-BIH Normal Sinus Rhythm Databases Desarrollo de la Solución Algoritmo de Extracción de Características Detección de los Parámetros Característicos Identificación de Patrones Resultados y Discusión Evaluación de las Pruebas Diagnósticas Efectividad Eficiencia Verdaderos Positivos(VP): Falsos Negativos(FN): Verdaderos Negativos(VN): Falsos Positivos(FP): Sensibilidad o Tasa de Verdaderos Positivos: Especificidad o Tasa de Verdaderos Negativos: Exactitud: Análisis de Resultados Registros con Presencia de Patrones de TVNS Registros con Presencia de Patrones de FAP Registros Control Conclusiones y Trabajos Futuros Trabajos Futuros Acrónimos Código Fuente Referencias BibliográficasUniversidad Central de Venezuela Facultad de Ciencias Escuela de Computación Trabajo Especial de Grado Reconocimiento de Patrones de Registros De Electrocardiograf́ıa Dinámica de Holter 24 horas Br. Valentina Colmenarez Castillo Caracas; Junio de 2016 Reconocimiento de Patrones de Registros De Electrocardiograf́ıa Dinámica de Holter 24 horas Br. Valentina Colmenarez Castillo Trabajo Especial de Grado presentado ante la ilustre Facultad de Ciencias de la Universidad Central de Venezuela como requisito parcial para optar al t́ıtulo de: Licenciado en Computación. Dr. Esteban Álvarez, Tutor Fecha: Caracas, 03 de Junio de 2016 Prof. Robinson Rivas , Tutor Fecha: Caracas, 03 de Junio de 2016 À la mémoire de mon cher Al... iv v Agradecimientos A Dios y a la Virgen por su amor. A la 3ra. Comunidad Neocatecumenal de la parroquia La Preciośısima Sangre por sus oraciones. A mis padres Clementina, Samuel, a mi hermano José Samuel, mis abuelos: Maria, Luisa(†), Alfonso(†), Pedro(†) y a mis tios, primos y hermanos, a mi cuñada Emily y sobrino Victor Samuel. A mi tutor el Dr. Esteban Álvarez por su inagotable ayuda, gracias. A mi compañero y amigo Ruben Rondon, donde quiera que esté. A los Doctores Federico Moleiro, Ana Elisa Rodriguez y al Prof. Robinson Rivas por apoyo y tutoria en este proyecto. A mis hermanos la Dra. Ines Mart́ınez, Dr. Juan José Anzola y el Lic. Enrique Rodŕıguez por sus oraciones y colaboración en este proyecto. Al Lic. Luis y Mayela Lessey por su ayuda y oraciones. Al Prof. Jonathan Piña (frère) y Vanessa Contreras por su ayuda y cariño. A mis amigos los Mscs. Jennifer y Humberto de Nobrega por su cariño. A mis hermanos Karen Torrealba y la Familia Machado Sojo por su cariño y oraciones. A mis queridos amigos de siempre Ana Maria Aguilar, Jonathan Jaimes y Álvaro Marquina. A Mary Muñoz del Postgrado de F́ısica gracias por tu amistad y apoyo. A la Dra. Haydemar Nuñez, el Prof. Miguel Astor, el Prof. Gilberto Perpiñan y Carlos Ledezma por su colaboración en este trabajo. A Álvaro Roccaro(†), el Prof. Rafael Martin, Prof. Hely Cordero el Lic. Javier Lugo y Ritguey Flores que me motivaron a volver a mis raices, gracias por su amistad. vi A los profesores de la escuela de F́ısica y de la escuela de Computación de la UCV por mi formación profesional. Y a todas y cada una de las personas que de una u otra forma han contribuido a que esté hoy presentando este trabajo. vii Índice general Índice de figuras X Índice de cuadros XIII Resumen 1 Introducción 2 1. Planteamiento del problema 4 1.1. Planteamiento del Problema . . . . . . . . . . . . . . . . . . . . . . . 4 1.2. Objetivo General . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 5 1.3. Objetivos Espećıficos . . . . . . . . . . . . . . . . . . . . . . . . . . . 5 1.4. Alcance . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 6 1.5. Justificación . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 6 2. El Corazón 7 2.1. Anatomı́a y Funcionalidad del Corazón . . . . . . . . . . . . . . . . . 7 2.2. Ciclo Card́ıaco . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 9 2.3. Sistema de Conducción Card́ıaca . . . . . . . . . . . . . . . . . . . . 10 2.4. Alteraciones del Ritmo Cardiaco . . . . . . . . . . . . . . . . . . . . . 11 2.4.1. Arritmias . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 12 2.5. Tipos de Arritmias . . . . . . . . . . . . . . . . . . . . . . . . . . . . 12 2.5.1. Arritmias Supraventriculares . . . . . . . . . . . . . . . . . . . 13 2.5.2. Arritmias Ventriculares . . . . . . . . . . . . . . . . . . . . . . 13 2.5.3. Fibrilación Auricular . . . . . . . . . . . . . . . . . . . . . . . 14 2.5.4. Taquicardia Ventricular . . . . . . . . . . . . . . . . . . . . . 14 2.6. Pruebas Diagnóstico para la Detección de Arritmias . . . . . . . . . . 15 2.6.1. Prueba de Esfuerzo . . . . . . . . . . . . . . . . . . . . . . . . 16 viii 2.6.2. Registro Electrocardiográfico de Largo Plazo . . . . . . . . . . 16 2.7. Derivaciones del Electrocardiógrafo . . . . . . . . . . . . . . . . . . . 17 2.7.1. Derivaciones unipolares . . . . . . . . . . . . . . . . . . . . . . 17 2.7.2. Derivaciones bipolares . . . . . . . . . . . . . . . . . . . . . . 18 2.8. Holter . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 19 2.9. Ruido . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 21 3. Algoritmo especializado 23 3.1. Algoritmos de Detección del QRS . . . . . . . . . . . . . . . . . . . . 23 3.1.1. Filtro Pasa Banda . . . . . . . . . . . . . . . . . . . . . . . . 25 3.1.2. Filtro Pasa Bajos . . . . . . . . . . . . . . . . . . . . . . . . . 25 3.1.3. Filtro Pasa Altos . . . . . . . . . . . . . . . . . . . . . . . . . 26 3.1.4. Derivación . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 26 3.1.5. Función Cuadrática . . . . . . . . . . . . . . . . . . . . . . . . 27 3.1.6. Ventana Móvil Integradora . . . . . . . . . . . . . . . . . . . . 27 3.1.7. Fase de Detección . . . . . . . . . . . . . . . . . . . . . . . . . 28 3.1.8. Umbrales Adaptativos . . . . . . . . . . . . . . . . . . . . . . 28 4. Metodoloǵıa 30 4.1. Base de Datos del Instituto de Medicina Tropical, Departamento de Cardioloǵıa de la UCV . . . . . . . . . . . . . . . . . . . . . . . . . . 30 4.2. Base de Datos del MIT-BIH Normal Sinus Rhythm Databases . . . . 31 4.3. Desarrollo de la Solución . . . . . . . . . . . . . . . . . . . . . . . . . 31 4.4. Algoritmo de Extracción de Caracteŕısticas . . . . . . . . . . . . . . . 32 4.4.1. Detección de los Parámetros Caracteŕısticos . . . . . . . . . . 35 4.4.2. Identificación de Patrones . . . . . . . . . . . . . . . . . . . . 36 Índice general ix 5. Resultados y Discusión 43 5.1. Evaluación de las Pruebas Diagnósticas . . . . . . . . . . . . . . . . . 43 5.1.1. Efectividad . . . . . . . . . . . . . . . . . . . . . . . . . . . . 43 5.1.2. Eficiencia . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 44 5.1.3. Verdaderos Positivos(VP): . . . . . . . . . . . . . . . . . . . . 44 5.1.4. Falsos Negativos(FN): . . . . . . . . . . . . . . . . . . . . . . 44 5.1.5. Verdaderos Negativos(VN): . . . . . . . . . . . . . . . . . . . 44 5.1.6. Falsos Positivos(FP): . . . . . . . . . . . . . . . . . . . . . . . 44 5.1.7. Sensibilidad o Tasa de Verdaderos Positivos: . . . . . . . . . . 45 5.1.8. Especificidad o Tasa de Verdaderos Negativos: . . . . . . . . . 45 5.1.9. Exactitud: . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 45 5.2. Análisis de Resultados . . . . . . . . . . . . . . . . . . . . . . . . . . 45 5.2.1. Registros con Presencia de Patrones de TVNS . . . . . . . . . 46 5.2.2. Registros con Presencia de Patrones de FAP . . . . . . . . . . 48 5.2.3. Registros Control . . . . . . . . . . . . . . . . . . . . . . . . . 54 6. Conclusiones y Trabajos Futuros 58 6.1. Trabajos Futuros . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 59 Acrónimos 60 A. Código Fuente 61 Referencias Bibliográficas 81 x Índice de figuras 2.1. El corazón (Fuente: www.emaze.com) . . . . . . . . . . . . . . . . . . 8 2.2. El ciclo card́ıaco (Fuente: resumen2cardiomeregarcia.blogspot.com) . 9 2.3. Sistema de conducción card́ıaca (Fuente: es.slideshare.net) . . . . . . 10 2.4. Composición de una Señal Electrocardiográfica (Fuente: www.scielo.org.co) . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 12 2.5. Caracteristicas de la Fibrilación Auricular Parox́ıstica (Fuente: Elabo- ración propia) . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 14 2.6. Caracteŕısticas de la Taquicardia Ventricular no Sostenida (Fuente: Elaboración propia) . . . . . . . . . . . . . . . . . . . . . . . . . . . . 15 2.7. Derivaciones unipolares (Fuente: slideplayer.es) . . . . . . . . . . . . 18 2.8. Derivaciones bipolares (Fuente: slideplayer.es) . . . . . . . . . . . . . 19 2.9. Ruido presente en un registro ECG (Fuente: www.monografias.com) 22 3.1. Diagrama de Bloques del Algoritmo de Pan-Tompkins (Fuente: Elabo- ración propia) . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 24 4.1. Detector. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 32 4.2. Estructura general del detector. . . . . . . . . . . . . . . . . . . . . . 33 4.3. Estructura del proyecto . . . . . . . . . . . . . . . . . . . . . . . . . . 34 4.4. Fase de Detección de los parámetros caracteŕısticos. . . . . . . . . . . 37 4.5. Fase de Identificación de patrones . . . . . . . . . . . . . . . . . . . 39 4.6. Diagrama de flujo del algoritmo detector de FAP. . . . . . . . . . . . 40 4.7. Diagrama de flujo del algoritmo detector de TVNS. . . . . . . . . . . 41 Índice de figuras xi 5.1. Gráfica del registro ctvp 03 1ev 215859 bajo el esquema de 3 inter- valos RR consecutivos bajo observación (Fuente: Elaboración propia). (a) Se muestra serie de intervalos RR. (b) Presencia de intervalos RR irregulares (1) e intervalos RR regulares (0). (c) Se muestra la presen- cia de complejos QRS con un ancho mayor a 120 ms (1) y ausencia de complejos QRS anchos (0). (d) Presencia de frecuencias instantáneas mayor a 100 lpm (1) y ausencia de frecuencias instantáneas mayor a 100 lpm (0) que acompaña cada complejo. (e) Se muestra presencia (1) y ausencia (0) de un patrón de TVNS en el registro . . . . . . . . . . 47 5.2. Gráfica del registro cfap 11 1ev 021600 bajo el esquema de 3 intervalos RR consecutivos bajo observación (Fuente: Elaboración propia). (a) Se muestra serie de intervalos RR. (b) Presencia de intervalos RR irregu- lares (1) e intervalos RR regulares (0). (c) Se muestra la presencia de onda P (1) y ausencia de onda P (0) que acompaña cada complejo. (d) Presencia de frecuencias instantáneas menores a 50 lpm (0), frecuen- cias instantaneas entre 50 y 100 lpm (1) y frecuencias superiores a 100 lpm (2).en cada intervalo RR. (e) Se muestra presencia (1) y ausencia (0) de un patrón de FAP en el registro . . . . . . . . . . . . . . . . . 49 5.3. Gráfica del registro cfap 08 1ev 235342 bajo el esquema de 3 intervalos RR consecutivos bajo observación (Fuente: Elaboración propia). (a) Se muestra serie de intervalos RR. (b) Presencia de intervalos RR irregu- lares (1) e intervalos RR regulares (0). (c) Se muestra la presencia de onda P (1) y ausencia de onda P (0) que acompaña cada complejo. (d) Presencia de frecuencias instantáneas menores a 50 lpm (0), frecuen- cias instantáneas entre 50 y 100 lpm (1) y frecuencias superiores a 100 lpm (2).en cada intervalo RR. (e) Se muestra presencia (1) y ausencia (0) de un patrón de FAP en el registro . . . . . . . . . . . . . . . . . 50 5.4. Gráfica del registro cfap 08 1ev 235342 bajo el esquema de 4 intervalos RR consecutivos bajo observación (Fuente: Elaboración propia). (a) Se muestra serie de intervalos RR. (b) Presencia de intervalos RR irregu- lares (1) e intervalos RR regulares (0). (c) Se muestra la presencia de onda P (1) y ausencia de onda P (0) que acompaña cada complejo. (d) Presencia de frecuencias instantáneas menores a 50 lpm (0), frecuen- cias instantáneas entre 50 y 100 lpm (1) y frecuencias superiores a 100 lpm (2).en cada intervalo RR. (e) Se muestra presencia (1) y ausencia (0) de un patrón de FAP en el registro . . . . . . . . . . . . . . . . . 52 5.5. Gráfica del registro del sujeto de control nsrdb 19088 22:58:00 bajo el esquema de 3 intervalos RR consecutivos bajo observación (Fuente: Elaboración propia).(a) Se muestra serie de intervalos RR. (b) Pre- sencia de intervalos RR irregulares (1) e intervalos RR regulares (0). (c) Se muestra la presencia de complejos QRS con un ancho mayor a 120 ms (1) y ausencia de complejos QRS anchos (0). (d) Se muestra la presencia de onda P (1) y ausencia de onda P (0) que acompaña cada complejo. (e) Presencia de frecuencias instantáneas entren 60 y 100 lpm (1) y ausencia de frecuencias dentro de este rango(0) en ca- da intervalo RR. (f) Se muestra presencia(1) y ausencia(0) de algún patrón de las arritmias estudiadas (FAP o TVNS). . . . . . . . . . . . 55 Índice de figuras xii 5.6. Gráficas del sujeto de control nsrdb 16273 09:00:00 bajo el esquema de 3 intervalos RR consecutivos bajo observación (Fuente: Elaboración propia).(a) Se muestra serie de intervalos RR. (b) Presencia de inter- valos RR irregulares (1) e intervalos RR regulares (0). (c) Se muestra la presencia de complejos QRS con un ancho mayor a 120 ms (1) y ausencia de complejos QRS anchos (0). (d) Se muestra la presencia de onda P (1) y ausencia de onda P (0) que acompaña cada complejo. (e) Presencia de frecuencias instantáneas entren 60 y 100 lpm (1) y au- sencia de frecuencias dentro de este rango(0) en cada intervalo RR. (f) Se muestra presencia(1) y ausencia(0) de algún patrón de las arritmias estudiadas (FAP o TVNS). . . . . . . . . . . . . . . . . . . . . . . . . 56 5.7. En esta imagen correspondiente a las anotaciones del registro nsrdb- 16273 de la base de datos MIT-BIH Normal Sinus Rhythm, se muestra señalado en un ćırculo rojo el instante de tiempo 09:08:46 donde se presenta el patrón de FAP hallado por el prototipo, pero en dichas anotaciones no se reporta tal anomaĺıa. . . . . . . . . . . . . . . . . 57 xiii Índice de cuadros 5.1. Tabla de resultados de la TVNS bajo el esquema de observación de 3 intervalos RR consecutivos bajo observación . . . . . . . . . . . . . . 48 5.2. Tabla de resultados de la FAP bajo el esquema de 3 intervalos RR consecutivos bajo observación . . . . . . . . . . . . . . . . . . . . . . 51 5.3. Tabla de resultados de la FAP bajo el esquema de 4 intervalos RR consecutivos bajo observación . . . . . . . . . . . . . . . . . . . . . . 53 5.4. Resultado de pacientes control bajo el esquema de 3 intervalos RR bajo observación . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 57 1 Resumen Reconocimiento de Patrones de Registros De Electrocardiograf́ıa Dinámica de Holter 24 horas Br. Valentina Colmenarez Castillo Universidad Central de Venezuela Dr. Esteban Álvarez y Prof. Robinson Rivas , Tutores El objetivo del presente Trabajo Especial de Grado es el diseño e implementación de un software a partir de herramientas open source, capaz de reconocer patrones de eventos de Fibrilación Auricular Parox́ıstica (FAP) y Taquicardia Ventricular no sostenida (TVNS), a partir de registros de series temporales (ECG), partiendo de dos parámetros únicos de entrada: La irregularidad de los intervalos RR y la ausencia de la onda P, para el caso de la FAP. Para el patrón de TVNS, el ancho del complejo QRS y la irregularidad del intervalo RR. Los registros utilizados fueron proporciona- dos por la Sección de Cardioloǵıa Experimental – Instituto de Medicina Tropical – UCV. Se realizó un procesamiento a las series temporales a partir del algoritmo de Pan-Tompkins, con el fin de detectar parámetros tales como: duración de los interva- los RR, ancho QRS y onda P, que caracterizan las arritmias card́ıacas antes citadas. Para el reconocimiento final de los patrones, a partir de los parámetros citados se implementa un método para la tomas de decisiones, basado en sentencias condicio- nales, evitando aśı, el uso de un método de decisión más complejo como el de redes neuronales artificiales. Como resultados relevantes se obtiene una sensibilidad del de- tector de 100 %, especificidad de 99,99 % y exactitud de 99,99 % para la detección del patrón de TVNS y para los eventos de FAP una sensibilidad de 75 %, especificidad de 99,89 % y exactitud de 99,89 %. Palabras clave: Señal ECG, complejo QRS, onda P, detector de arritmias, arritmia, fibrilación auricular parox́ıstica, taquicardia ventricular no sostenida, algoritmo de Pan-Tompkins. 2 Introducción Las arritmias cardiacas son alteraciones del funcionamiento eléctrico normal del corazón. Algunas son potencialmente malignas y constituyen, con otras enfermedades cardiovasculares, una de las principales causas de mortalidad en el mundo, según la Organización Mundial de la Salud (OMS) 1, para el año 2012 representaron un 31 %, y ese mismo año, solo en nuestro páıs un 20,58 %, representando las enfermedades cardiovasculares la primera causa de muerte en Venezuela. [27] Hoy en d́ıa, el estudio de los mecanismos de las arritmias patológicas se asien- ta sobre dos ámbitos de investigación: de un lado, el análisis de señales card́ıacas registradas mediante sistemas de captación con electrodos en estudios cĺınicos y/o experimentales, tales como los electrogramas intracavitarios y del electrocardiograma de superficie, de otro lado, el análisis de la dinámica del sustrato cardiaco a partir imágenes proporcionadas por sistemas de mapeo óptico en estudios experimentales in- vivo e in-vitro. La detección de cardiopat́ıas como la Fibrilación Auricular Parox́ıstica (FAP) y Taquicardia Ventricular No Sostenida (TVNS) es de vital importancia, ya que su detección temprana puede ayudar a disminuir el nivel de morbilidad o morta- lidad de la población, motivo por el cual, se propone el desarrollo e implementación de una herramienta de software para el reconocimiento de estas patoloǵıas a bajo costo, a través del framework de Qt Project, basado en un algoritmo para la detec- ción del complejo QRS, de la onda P, la irregularidad y frecuencia, contando con el asesoramiento de la sección de Cardioloǵıa Experimental del Instituto de Medicina Tropical, además de la escuela de F́ısica y de Computación de la Universidad Central de Venezuela. Para el desarrollo de la herramienta antes mencionada, se abordaron dos etapas: la primera consistió en el estudio y elección de un marco de trabajo para la imple- mentación del software, resultando en el uso de Qt; por ser esta, una herramienta de código abierto. En una segunda etapa, se abordó el estudio de algoritmos espe- cializados, permitiendo el acondicionamiento de los registros de ECG, facilitando de 1http://www.who.int/en/ Índice de figuras 3 esta manera la adquisición de los parámetros necesarios para la identificación de los patrones asociados a las arritmias espećıficas bajo estudio. Como resultado se logró la detección de los eventos arŕıtmicos estudiados por medio de la detección de los com- plejos PQRS, lo cual facilita la detección de de los parámetros mı́nimos tales como el ancho del complejo QRS, la irregularidad entre cada intervalo RR y la frecuencia instantánea. Estos parámetros son utilizados en la detección de los patrones de FAP y TVNS. Finalmente para la revisión de todos estos aspectos se presenta la siguiente estruc- tura del trabajo: En un primer caṕıtulo se inicia la discusión con el planteamiento del problema, sus alcances y objetivos. Posteriormente en el caṕıtulo dos, se presenta una breve descripción de los aspectos teóricos necesarios para la comprensión de este trabajo. Conocida esta información, en un tercer caṕıtulo se realiza una detallada descripción del algoritmo especializado, implementado en este trabajo. En un cuarto caṕıtulo, se desarrolla la metodoloǵıa para el desarrollo del software, y por último, en el quinto caṕıtulo, se presenta la discusión y resultados obtenidos. 4 Caṕıtulo 1 Planteamiento del problema Este caṕıtulo inicia la discusión, a partir del planteamiento del problema, describe los objetivos, e indica el alcance esperado en el presente trabajo. 1.1. Planteamiento del Problema El número de pacientes con arritmias card́ıacas tiende a incrementarse cada año. Por ello, es posible encontrar en muchos centros hospitalarios, que el personal designa- do para dar atención a tales pacientes es insuficiente. Es aśı que se vuelve totalmente necesario contar con equipos automatizados, que además de registrar las ondas ECG, sean capaces de identificar los tipos de arritmias cardiacas facilitando un diagnóstico inmediato por parte del especialista. Es bien conocida la importancia de la señal ECG para el diagnóstico de un sin fin de enfermedades card́ıacas, a partir de la inspección visual o mediante técnicas actuales de inspección automática. Desde el punto de vista médico, la posibilidad de disponer de herramientas que, a partir de las señales, puedan enfatizar la actividad Auricular y Ventricular, son realmente interesantes y además hoy en d́ıa necesarias, pues pueden permitir el desarrollo de técnicas no invasivas de ayuda al diagnóstico cĺınico, como por ejemplo, clasificación entre distintas manifes- taciones de Fibrilación Auricular y Taquicardia Ventricular, aśı como la detección de otras patoloǵıas, evitando los métodos tradicionales de reconocimiento de arritmias, que pueden ser largos y tediosos, ocasionando un diagnóstico tard́ıo, que en muchos casos puede ser fatal para el paciente. Por tal motivo, una identificación automatizada del tipo de arritmia card́ıaca en el momento preciso se vuelve sumamente importante. En el mercado, existen aplicaciones capaces de identificar tipos de arritmias cardia- cas de forma rápida, pero a costos elevados, debido a que se debe adquirir la licencia Caṕıtulo – 1. Planteamiento del problema 5 del producto, o el servicio técnico en caso de presentarse alguna eventualidad, y en algunos casos equipo de hardware especializado. Por tal motivo, se desarrolló una herramienta de software que permite el reconocimiento automatizado de dos tipos de arritmias FAP y TVNS, de forma rápida, y a bajo costo porque las herramientas de desarrollo son de código abierto, para prescindir del costo de licencia. 1.2. Objetivo General Diseñar e implementar un software capaz de reconocer patrones de eventos de Fi- brilación Auricular Parox́ıstica (FAP) y Taquicardia Ventricular No Sostenida (TVNS), a partir de registros de series temporales (ECG Holter 24 horas), por medio de he- rramientas computacionales. 1.3. Objetivos Espećıficos 1. Investigar en la bibliograf́ıa los siguientes aspectos: Anatomı́a y funcionalidad del corazón, electrocardiograf́ıa dinámica de Holter 24 horas, arritmias cardia- cas, técnicas o modelos computacionales de reconocimiento de patrones en re- gistros temporales. 2. Identificar los cambios caracteŕısticos que suceden en registros temporales, aso- ciados con los eventos de FAP, por medio de técnicas o metodoloǵıas compu- tacionales. 3. Identificar los cambios caracteŕısticos que suceden en registros temporales, aso- ciados con los eventos de TVNS, por medio de técnicas o metodoloǵıas compu- tacionales. 4. Evaluación y entonación del sistema de reconocimiento de patrones implemen- tado. Caṕıtulo – 1. Planteamiento del problema 6 1.4. Alcance Este proyecto es el primer paso para un trabajo de mayor envergadura. Está desa- rrollado bajo tecnoloǵıas opensource lo que permite su continuidad. Además los es- pecialistas del área de cardioloǵıa podrán adquirir un software para la detección de arritmias mantenible en el tiempo dada las bondades del software libre. La evaluación de desempeño del producto se llevará a cabo con el análisis de 36 registros ECG provenientes de la base de datos internacional de PhysioNet y del Departamento de Cardioloǵıa de la UCV, ya digitalizados y con presencia de ruido. El prototipo en caso de detectar presencia de patrones de TVNS y FAP, presentará la ubicación de los patrones de arritmia encontrados en un archivo de texto que puede ser visualizado posteriormente. Aśı pues, diversas herramienta para graficar pueden ser utilizadas, debido a que la salida se presentará en un fichero de texto plano. La implementación no cuenta con una interfaz gráfica que permita visualizar los resultados obtenidos después del proceso de análisis. Sólo se detectan dos patrones de arritmia FAP y TVNS, dejando abierta la posibilidad para la creación de módulos de detección de cardiopatias de tipo ventricular y supraventricular. 1.5. Justificación El alto costo de adquisición y mantenimiento de equipos para apoyar el diagnósti- co de cardiopat́ıas en las Instituciones médicas públicas y la tasa de morbilidad y mortalidad por dichas enfermedades han incrementado los esfuerzos para avanzar en materia tecnológica. El impacto que tiene desarrollar soluciones opensource es de gran interés en la comunidad cient́ıfica, por su bajo costo y múltiples ventajas. La presente investigación representa el primer paso en el desarrollo de una solución para suplir las deficiencias de los centros médico-hospitalarios. Aśı pues, se presenta una herramienta multiplataforma compatible en Windows y Linux que lleva a cabo el análisis de la señal ECG adquirida previamente y digitalizada por un dispositivo de captura Holter. 7 Caṕıtulo 2 El Corazón En este caṕıtulo se presentan los fundamentos electrofisiológicos que describen el comportamiento eléctrico, anatomı́a y funcionalidad del corazón. Mediante este desarrollo, se explican en detalle los sistemas de excitación y conducción responsables de su funcionamiento normal y también se examinan los trastornos en la actividad eléctrica cardiaca, más conocidos como arritmias según [6]. Por ello cada una de las secciones de este caṕıtulo conforma la base conceptual que, proporciona el conjunto de modelos y señales cardiacas que serán utilizados como herramientas de análisis en el trabajo. 2.1. Anatomı́a y Funcionalidad del Corazón Para todo organismo vivo que posee corazón, este representa el eje fundamental de su funcionamiento gracias a la acción de bombeo que el mismo realiza, con la cual asegura que la sangre como fluido fundamental llegue a todos los tejidos, con los nu- trientes y el ox́ıgeno necesario para los procesos metabólicos de śıntesis y degradación, permitiendo también el regreso de la misma cuando carece de dichas propiedades. Por esta razón, se presentarán un conjunto de definiciones asociadas al órgano principal del sistema circulatorio, llamado, por algunos: “El órgano más fuerte y poderoso o la sala de máquinas del cuerpo”. El corazón tiene aproximadamente el mismo tamaño que el puño, pero no la misma forma. Mide aproximadamente de 12cms de largo, 9 de ancho y 6 de espesor [12]. El corazón se localiza en la parte inferior del mediastino medio, entre el segundo y quinto espacio intercostal, izquierdo. Está situado de forma oblicua: aproximadamente Caṕıtulo – 2. El Corazón 8 dos tercios a la izquierda del plano medio y un tercio a la derecha. Tiene forma de una pirámide inclinada con el vértice en el “suelo” en sentido anterior izquierdo; la base, opuesta a la punta, en sentido posterior y 3 lados: la cara diafragmática, sobre la que descansa la pirámide, la cara esternocostal, anterior y la cara pulmonar hacia la izquierda. Desde el punto de vista histológico, es un órgano conformado por tres capas: El endocardio, una membrana serosa de endotelio y tejido conectivo de revesti- miento interno, con la cual entra en contacto la sangre. Incluye fibras elásticas y de colágeno, vasos sangúıneos y fibras musculares especializadas, las cuales se denominan Fibras de Purkinje. El miocardio, es una masa muscular contráctil. El músculo card́ıaco propiamente dicho; encargado de impulsar la sangre por el cuerpo mediante su contracción. El pericardio es una membrana fibroserosa de dos capas, el pericardio visceral seroso o epicardio y el pericardio fibroso o parietal, que envuelve al corazón y a los grandes vasos separándolos de las estructuras vecinas, como se observa en la imagen 2.1. Figura 2.1: El corazón (Fuente: www.emaze.com) Caṕıtulo – 2. El Corazón 9 2.2. Ciclo Card́ıaco El corazón consta de 4 cavidades, dos auŕıculas: derecha e izquierda y 2 ventŕıculos: derecho e izquierdo. Según [12] la auŕıcula derecha (AD) recibe el retorno venoso (sangre desoxigenada) de la circulación sistémica a través de las venas cava superior e inferior, al final del periodo de llenado pasivo de la auŕıcula, es excitada, y la contracción auricular, impulsa una cantidad adicional de sangre dentro del ventŕıculo derecho a través de la válvula auriculoventricular derecha (tricúspide) y este alcanza un mayor tamaño. Luego del llenado del ventŕıculo derecho (VD), es excitado y en su pared empieza a desarrollarse tensión que se aplica sobre el volumen de sangre que contiene y crea presión intraventricular, cuando esta presión supera la presión intraarterial, el VD se contrae y expulsa la sangre a través de las válvulas pulmonares hacia el interior de la arteria pulmonar que conduce la sangre a los pulmones. En el lecho capilar de los pulmones se añade oxigeno O2 y se elimina el CO2. Figura 2.2: El ciclo card́ıaco (Fuente: resumen2cardiomeregarcia.blogspot.com) La sangre recién oxigenada en los pulmones retorna al corazón a través de las venas pulmonares hasta la auŕıcula izquierda (AI), luego de su llenado, esta fluye al ventŕıculo izquierdo (VI) a través de la válvula auriculoventricular izquierda (mitral). Posterior al llenado Ventricular, se inicia la excitación que conlleva a la contracción Caṕıtulo – 2. El Corazón 10 del mismo y la subsecuente expulsión de la sangre hacia el interior de la aorta, a partir de esta se distribuye a las circulación sistémica. De acuerdo a López Grillo (1999) en [9]: En el periodo de relajación las presiones dentro de los ventŕıculos son bajas y cuando se llenan de sangre aumenta su volumen. El llenado Ventricular se completa con la sangre que aporta la contracción auricular, de igual forma, en el periodo de contracción las presiones dentro de los ventŕıculos aumentan y cuando los ventŕıculos expulsan sangre disminuye su volumen. Estos procesos de relajación y contracción se denominan: śıstole y diástole (ver figura 2.2). 2.3. Sistema de Conducción Card́ıaca El sistema de conducción según [9] es un sistema especializado que tiene como función, la generación y propagación del impulso ŕıtmico y la contracción coordinada del corazón. El sistema de conducción se divide en dos subsistemas, el primero es un sistema de producción de est́ımulos, uno con capacidad de automatismo (marcapasos) y el otro permite la conducción de dicho est́ımulo (ver figura 2.3). Figura 2.3: Sistema de conducción card́ıaca (Fuente: es.slideshare.net) Caṕıtulo – 2. El Corazón 11 La actividad eléctrica durante cada ciclo card́ıaco normal empieza en el nodo si- nusal y sigue hasta que todo el corazón se activa. El nodo sinusal o nodo de Keith y Flack, forma parte del subsistema de producción de est́ımulo, conformado por te- jido especializado de conducción con la capacidad de generar potenciales de acción espontáneos, es decir generar el impulso eléctrico. Está situado en la unión entre la vena cava superior y la auŕıcula derecha, y está compuesto de tejido fibroso llamado fibras nodales o células P, que son el punto de partida para la formación del impulso normal del nodo, a una frecuencia de 60 a 100 latidos/min, automatismo que supera cualquier otro punto capaz de producir est́ımulos en el corazón, por esta razón, tam- bién es llamado el marcapasos fisiológico [11]. Luego de originarse el impulso eléctrico, este viaja a través de las auŕıculas, por los fasćıculos auriculares internodales, permi- tiendo aśı la despolarización de la misma, que se representa por la onda P en la señal electrocardiográfica (ver figura 2.4), y tiene como punto de llegada el nodo AV, este proceso de despolarización, seguida de repolarización auricular permite el periodo de llenado y expulsión por parte de las auŕıculas a los ventŕıculos. Posteriormente, el nodo AV va a permitir la conducción eléctrica de este impulso a los ventŕıculos, en forma transversal, a través del haz de His, las ramas derecha e izquierda y las fibras de Purkinje, permitiendo la despolarización de los ventŕıculos, esta despolarización se representa a partir del complejo QRS en el electrocardiograma, ulterior a esta despo- larización, ocurre un periodo de repolarización Ventricular que es representada en el electrocardiograma por la onda T (ver figura 2.4). Este proceso de despolarización y repolarización, permiten la śıstole y diástole Ventricular. El comportamiento Auricular y Ventricular ocurre de forma sincronizada, la pérdi- da de sincronización en ambos procesos, traen como consecuencia, la aparición de diversas cardiopat́ıas, entre estas, las arritmias que se desarrollarán en apartados posteriores. 2.4. Alteraciones del Ritmo Cardiaco La alteración del ritmo cardiaco es según [6] consecuencia de la generación normal o anómala del impulso eléctrico, de la conducción anómala de este impulso o de una combinación de ambas. Estas alteraciones del ritmo son conocidas como arritmias y Caṕıtulo – 2. El Corazón 12 Figura 2.4: Composición de una Señal Electrocardiográfica (Fuente: www.scielo.org.co) esta sección proporcionará una breve descripción y clasificación de este trastorno, que es causa de la mayor tasa de morbilidad en la población mundial. 2.4.1. Arritmias La alteración del ritmo card́ıaco, consecuencia de la actividad eléctrica anormal en el corazón se conoce como arritmia card́ıaca. El est́ımulo eléctrico originado en el nódulo Sinusal o marcapasos fisiológico, se conduce a las auŕıculas y los ventŕıculos con una frecuencia que oscila entre 60 y 100 latidos por minuto 2.5. Tipos de Arritmias Las arritmias card́ıacas pueden clasificarse según su frecuencia, origen o mecanis- mo de producción [6]. Si la frecuencia es mayor a la generada por el nodo Sinusal se denominan taquiarritmias, y bradiarritmias cuando la frecuencia es menor. Si el origen de la arritmia se encuentra por encima de la bifurcación del haz de His son conocidas como supraventriculares, y ventriculares cuando se generan por debajo. Según el mecanismo de producción, si se dan alteraciones en el inicio del impulso eléctrico como consecuencia de despolarizaciones espontáneas, se denomina automa- tismo, si se dan en la conducción debido a variaciones de los peŕıodos refractarios Caṕıtulo – 2. El Corazón 13 de las diferentes fibras, que causan que el impulso se bloquee en algunos sectores y en otros continúe, generando circuitos en los que el est́ımulo recircule, son llamadas reentrada y por último, si se generan por la aparición de pospotenciales durante o después de la despolarizaron, produciendo una despolarización parcial de las fibras, seŕıa una actividad gatillada, como definen algunos autores. Clasificación de algunas arritmias, según su origen: 2.5.1. Arritmias Supraventriculares Arritmia Sinusal Extrasistolia auricular Taquiarritmias Supraventriculares Taquicardia Sinusal Aleteo auricular Fibrilación auricular, etc. 2.5.2. Arritmias Ventriculares Extrasistolia Ventricular Parasistolia Ventricular Taquicardia Ventricular Fibrilación Ventricular, etc. En el siguiente apartado, solo se menciona la Taquicardia Ventricular y la Fibri- lación Auricular, por ser estas de mayor interés en este estudio [16]. Caṕıtulo – 2. El Corazón 14 Figura 2.5: Caracteristicas de la Fibrilación Auricular Parox́ıstica (Fuente: Elaboración propia) 2.5.3. Fibrilación Auricular La fibrilación auricular es según [7] una arritmia supraventricular caracterizada por una activación incoordinada de las auŕıculas, (consecuencia de la pérdida de la función hemodinámica de las auŕıculas) teniendo o no, una respuesta Ventricular va- riable, esto significa, que puede presentarse, durante la fibrilación, un comportamiento normal de los ventŕıculos (QRS normal) o puede generarse una Taquicardia Ventricu- lar (deformación y aumento de la frecuencia de los complejos QRS) al mismo tiempo. Esta arritmia se caracteriza por presentar ondulaciones irregulares y pequeñas de am- plitud y morfoloǵıa variable denominadas ondas f con frecuencia de 350 a 600 lpm, y una onda P ausente, este tipo de arritmia, disminuye el gasto cardiaco en un 25 %. En la práctica, se encuentra la Fibrilación Auricular del tipo parox́ıstica, episodios que se revierten con tratamiento o por si solos en menos de 72 horas, persistente con una duración de semanas, y permanente. Las condiciones que debe cumplir una cardiopatia para considerarse fibrilación auricular parox́ıstica, son las siguientes: Ausencia de la Onda P. Diferentes tres intervalos R-R consecutivos, en 20 Latidos contiguos. Frecuencia cardiaca entre 50 y 200 lpm. 2.5.4. Taquicardia Ventricular La taquicardia ventricular se define según [6] como la ocurrencia de tres o más extraśıstoles ventriculares (latidos prematuros que se originan fuera del nodo Sinusal) Caṕıtulo – 2. El Corazón 15 Figura 2.6: Caracteŕısticas de la Taquicardia Ventricular no Sostenida (Fuente: Ela- boración propia) consecutivas con una duración mayor a 120ms y una frecuencia que vaŕıa de 70 a 250 lpm. Se origina en el sistema especializado de conducción, situado en la localización distal a la bifurcación del haz de His, en el músculo Ventricular o en combinaciones de ambos tipos de tejido. Los mecanismos suelen ser trastornos en la formación y en la conducción del impulso. Se encuentran Taquicardias Ventriculares del tipo No Soste- nida que tienen un origen repentino, cuya duración en menor a 30s y Sostenida cuya duración en mayor a 30s, cuando los contornos del QRS son fijos es una Taquicar- dia Ventricular Monomorfa, si vaŕıan al azar Taquicardia Ventricular Polimorfa, si la variación es más o menos repetitiva se denomina Taquicardia Ventricular Helicoidal. Las condiciones que se deben cumplir para considerarse como taquicardia ventri- cular no sostenida, un evento, son las siguientes: Ancho del complejo QRS mayor a 120 ms . Poca irregularidad de los intervalos R-R. Frecuencia cardiaca mayor a 100 lpm. 2.6. Pruebas Diagnóstico para la Detección de Arrit- mias Debido al peligro que representa para la vida de un paciente un trastorno en el ritmo cardiaco, se han diseñado una serie de pruebas que van desde métodos más sencillos, como un interrogatorio o examen f́ısico, hasta el más complejo, es decir, Caṕıtulo – 2. El Corazón 16 desde el que requiera menor penetración o inocuidad hasta el más peligroso e invasivo. Para la evaluación de pacientes con arritmias cardiacas, se emplean los siguientes métodos: 2.6.1. Prueba de Esfuerzo El ejercicio induce diversos tipos de taquiarritmias supraventriculares y ventricu- lares y, rara vez, bradiarritmias. Los pacientes con śıntomas que indican una arritmia producida por el ejercicio (p. ej., śıncope, palpitación sostenida, etc.) son aptos para someterse a la prueba de esfuerzo. La prueba de esfuerzo mide el consumo máximo de ox́ıgeno y otras variables fisiológicas a través de analizadores de gases respiratorios para la prueba de esfuerzo directa, y la indirecta, se realiza sin disponer del analiza- dor. Estas pruebas se pueden realizar en el laboratorio o sobre el terreno, donde la persona realiza su actividad deportiva [16][12]. 2.6.2. Registro Electrocardiográfico de Largo Plazo De los métodos existentes, el registro ECG es el más útil para detectar y cuanti- ficar la frecuencia y complejidad de las arritmias, correlacionar su aparición con los śıntomas del paciente y evaluar el efecto del tratamiento antiarŕıtmico en arritmias espontáneas. Un registro electrocardiográfico o electrocardiograma según [4]: “Es un método de utilidad diagnóstica basado en el registro de la actividad eléctri- ca card́ıaca.” Existen diferentes modalidades de registro, el cual puede ser: 1) Continuo, en cuyo caso se registran todos los latidos para su ulterior análisis; también se utiliza un dispositivo de análisis en tiempo real. 2) Activado por el propio paciente, que es un método útil cuando éste percibe los śıntomas de la arritmia a fin de activar el sistema 3) Activado por la propia arritmia: una modalidad eficaz. Pero que depende de la precisión y confiabilidad del algoritmo del dispositivo capaz de detectar la arritmia. Mucho de los Marcapasos y desfibriladores internos permiten registrar el ECG durante un tiempo prolongado, y otros poseen un dispositivo de registro que se implanta en la región subcutánea, para el seguimiento a largo plazo. Caṕıtulo – 2. El Corazón 17 2.7. Derivaciones del Electrocardiógrafo La contracción y dilatación del corazón, son consecuencia de su estimulación eléctrica, estos est́ımulos eléctricos producen diferencias de potencial, que pueden registrarse a través de una serie de cables y electrodos, conectados a la superficie corporal del individuo. El registro de la señal producida en el músculo card́ıaco, me- diante una serie de electrodos que se ubican en una posición diferente, según normas preestablecidas, en relación con el corazón, se denomina Derivación. La finalidad de una derivación electrocardiográfica según [8] es medir la corriente que va en la dirección marcada por una ĺınea recta que une los electrodos que llevan a cabo el registro. Estas derivaciones son de dos tipos: Derivaciones unipolares y bipolares. 2.7.1. Derivaciones unipolares Las derivaciones unipolares registran la diferencia de potencial entre un punto del cuerpo y otro punto llamado centro eléctrico. Estas derivaciones miden la fuerza eléctrica absoluta de un electrodo positivo único en el cuerpo, Para esto se necesita que el otro electrodo sea de potencial cero (0), y esto se logra uniendo los cables de las extremidades correspondientes a los electrodos negativos de tal manera que se anulen sus fuerzas respectivas, el electrodo positivo es el explorador y el negativo está conformado por la unión de los otros dos electrodos exploradores (ver figura 2.7). Fueron ideadas por Frank Wilson en 1934 [8]. Existen dos tipos de derivaciones unipolares que van a depender de la localización de los electrodos, estas son: Derivaciones unipolares precordiales V1: Los electrodos deben colocarse en la intersección del cuarto espacio inter- costal derecho (EID) con ĺınea paraesternal (LPE) derecha (borde derecho del esternón). V2: Los electrodos deben colocarse en la intersección del cuarto espacio inter- costal izquierdo (EII) con LPE izquierda. V3: Intermedio entre V2 y V4. Caṕıtulo – 2. El Corazón 18 Figura 2.7: Derivaciones unipolares (Fuente: slideplayer.es) V4: Los electrodos deben colocarse en el quinto EII con ĺınea medio clavicular. V5: Los electrodos deben colocarse en quinto EII con ĺınea axilar anterior. V6: Los electrodos deben colocarse en quinto EII con ĺınea axilar media. Derivaciones unipolares de las extremidades: aVR: Electrodo (-) en la unión del brazo izquierdo y la pierna izquierda y (+) en el brazo derecho. aVL: Electrodo (-) en la unión del brazo derecho y la pierna izquierda y (+) en el brazo izquierdo. aVF: Electrodo (-) en la unión del brazo izquierdo y el brazo derecho y (+) en la pierna izquierda. 2.7.2. Derivaciones bipolares Las derivaciones bipolares, creadas por William Einthoven [8], registran la dife- rencia de potencial eléctrico que se produce entre dos puntos del cuerpo, se obtiene al tomar el registro de 4 electrodos ubicados, uno en el brazo derecho, otro en el iz- quierdo, otro en la pierna izquierda y, finalmente, otro en la pierna derecha, que es la toma de la tierra. El dipolo tiene como electrodo negativo el derecho y como positivo el izquierdo, y su eje de circunferencia está entre 0◦ a 180◦. Las derivaciones bipolares Caṕıtulo – 2. El Corazón 19 Figura 2.8: Derivaciones bipolares (Fuente: slideplayer.es) son tres, y Einthoven las denominó D1, D2 y D3, como se presenta en la figura 2.8, y cada una se describe a continuación: DI: Registra la diferencia de potencial entre el electrodo (polo +) en el brazo izquierdo y (polo -) en el brazo derecho. DII: Registra la diferencia de potencial entre el electrodo (polo -) en el brazo derecho y (polo +) en la pierna izquierda. DIII: Registra la diferencia de potencial entre el electrodo (polo -) en el brazo izquierdo y (polo +) en la pierna izquierda. 2.8. Holter El estudio de Holter, es una técnica de examen cardiovascular llamado “radio- electrocardiograf́ıa” o registró electrocardiográfico, de tipo ambulatorio, que se to- ma durante un tiempo prolongado (24 ó 48 horas) en las condiciones cotidianas del paciente. Es un método diagnóstico no invasivo muy utilizado en la práctica cĺıni- ca, que ofrece un examen electrocardiográfico dinámico y detallado de los cambios Caṕıtulo – 2. El Corazón 20 eléctricos transitorios, que permite establecer una correlación entre los hallazgos elec- trocardiográficos y los śıntomas referidos por el paciente durante su actividad diaria. Esta técnica facilita el diagnóstico, y la cuantificación de las arritmias card́ıacas, los cambios transitorios isquémicos de la repolarización Ventricular y las mediciones del complejo QRS y del intervalo QTc. Además, por medio de éste se evalúan los cambios en el sistema nervioso autónomo (análisis de la variabilidad de la frecuencia card́ıaca, tanto del dominio en el tiempo como en la frecuencia), la detección de potenciales tard́ıos ventriculares (electrocardiograma de alta resolución ambulatorio) y la valora- ción de la dispersión del intervalo QTc y de la alternancia de la onda T. Esta técnica fue descrita por Norman J. Holter en 1957, y se lleva a cabo con un dispositivo del mismo nombre [13]. El registro de la actividad eléctrica card́ıaca, se realiza con una grabadora de ECG continua, denominada monitor de Holter, que en su forma t́ıpica graba durante 24 ó 48 horas el ECG. En la década de 1960, los registros eran de un solo canal y el foco de atención fue el análisis de las arritmias card́ıacas. Luego, en la década de 1970 y 1980, se desarrolló la de dos y tres canales, y se iniciaron las observaciones sobre segmento ST e isquemia silenciosa, el registro se realizaba sobre una cinta magnética, sin interrupciones en el trabajo o vida personal del paciente, y es especialmente útil para el diagnóstico de ritmos cardiacos menos frecuentes y que puede sentir el pa- ciente. La precisión con que pueden interpretarse registros prolongados en cinta, vaŕıa según el sistema, si bien muchas computadoras analizan cintas que tienen precisión suficiente para las necesidades cĺınicas. En teoŕıa, todos los sistemas registran más información que la que el médico necesita para o puede asimilar. Se calcula en 25 a 50 % la proporción de pacientes que experimentan un episodio durante un registro de 24h, causado por arritmias en 2 a 15 % de los casos. En la actualidad el registro se realiza sobre un medio magnético o en un medio de almacenamiento conocido como memoria SD, con posterior restitución en un sistema traductor de la señal almacenada, lo que permite analizar las alteraciones en el ECG durante un peŕıodo de tiempo determinado; su mayor rendimiento diagnóstico se obtiene cuando se efectúa en al menos 24 horas según [8]. Caṕıtulo – 2. El Corazón 21 2.9. Ruido El ruido puede definirse como una perturbación eléctrica que interfiere en la trans- misión o el procesamiento de una señal2. Un electrocardiograma es la representación gráfica que recoge la actividad electrica generada por los diferentes potenciales de polarización y despolarización a nivel del músculo card́ıaco, empleado como método diagnóstico de anomaĺıas en el ritmo card́ıaco, asi como de cardiopat́ıas, etc. Esta señal generalmente se ve afectada por niveles de ruido apreciables que tienden a oscu- recer aspectos caracteŕısticos del ECG, que evidencian el buen funcionamiento o no del músculo card́ıaco, motivo por el cual es de gran importancia realizar una correcta apreciación de la información contenida en éstos, a pesar del ruido presente [31]. Una de las principales dificultades encontradas durante el proceso de detección de los diferentes patrones en los registros analizados por el detector prototipo desarro- llado es el ruido. En los registros proporcionados por la base de datos de la unidad de Cardioloǵıa se encuentran ruidos tales como la interferencia de ĺınea de potencia que consiste en una señal de 60 Hz y sus armónicos, el generado por los aparatos electrónicos utilizados en la fase de adquisición (ruido térmico), las distorsiones de origen muscular o ruido electromiográfico provocado por la contracción muscular y caracterizado por (quiebres) transitorios, el generado por los artefactos provenientes de la interfaz electrodo-piel causado por variaciones en la impedancia debido al movi- miento del electrodo y el desplazamiento de la ĺınea base provocado por la respiración que puede ser representado como una componente sinusoidal en la frecuencia de res- piración adherida a la señal ECG. Eliminar el ruido sin afectar la morfoloǵıa de la señal ECG es crucial debido a que la presencia de este, puede llegar a enmascarar rasgos significativos de la señal original que no permitiran un diagnóstico acertado del paciente. Para reducir el ruido presente sobre la señal electrocardiográfica original, con la finalidad de obtener la parte útil, se hacen necesarias técnicas de procesado de la señal. Una de las primeras opciones es el filtrado mediante filtros lineales y no linea- les que maximicen la relación señal a ruido. En el siguiente trabajo se implementaron los métodos basados en técnicas de filtrado lineal y no lineal propuestos por el algo- ritmo de Pan y Tompkins [18] para reducir el ruido en los registros de prueba (y un 2http://definicion.de/ruido/ Caṕıtulo – 2. El Corazón 22 Figura 2.9: Ruido presente en un registro ECG (Fuente: www.monografias.com) promediado de señal). Como se observa en la figura 2.9, la mayoŕıa de las componentes de alta frecuencia presentes en la señal original del registro son eliminadas a partir del filtrado lineal proporcionado por el algoritmo de Pan y Tompkins [18] con el fin de resaltar la onda P y el complejo QRS, parámetros necesarios para la detección de la TVNS y la FAP. Sin embargo, en la practica muchas veces no resulta completamente eficiente lograr una adecuada relación señal-ruido principalmente cuando la onda de interés presenta una baja amplitud comparable a los niveles de amplitud de ruido, lo cual trae como consecuencia dificultades en el momento de detectar patrones que dependen del reco- nocimiento de la onda P tal como la FAP. Este hecho amerita tomar decisiones como el promediado local de la señal, entre otras técnicas, o estrategias que permitan resal- tar los rasgos caracteŕısticos de la onda de interés y poder disponer de la información completa (P-QRS-T) que identifica un complejo en el ECG. 23 Caṕıtulo 3 Algoritmo especializado Los algoritmos de detección del complejo QRS establecen una marca donde em- pieza, termina, o se encuentra el punto de mayor amplitud en el este. La detección del QRS es complicada, no solo por su variabilidad fisiológica, sino también porque el ruido que puede estar presente en la señal ECG, tiende a distorsionar el registro, impidiendo una detección o diagnóstico acertado. Los criterios principales en la selec- ción de un algoritmo para la detección del complejo QRS toman en cuenta el mejor desempeño ante el nivel de ruido presente en los registros. El algoritmo empleado debe ser robusto a niveles bajos de ruido si se desea incorporar a sistemas cĺınicos, para evitar un diagnostico inexacto. El algoritmo propuesto en el presente trabajo, para la detección del QRS, es el algoritmo desarrollado por Jiapu Pan y Willis J. Tompkins [18], ya que se considera un algoritmo robusto a niveles bajos de ruido por estar basado en filtros digitales. El propósito de este caṕıtulo es presentar una breve descripción, del esquema de detección de complejos QRS desarrollado por Pan y Tompkins, y la extracción de la información necesaria, para el reconocimiento de las cardiopat́ıas de interés. 3.1. Algoritmos de Detección del QRS El algoritmo que se implementará en la detección y extracción de los parámetros de entrada, para llevar a cabo la detección de las cardiopat́ıas de interés, es el Algoritmo de detección QRS en tiempo real, desarrollado por Jiapu Pan y Willis J. Tompkins en el año 1985, este algoritmo en tiempo real, Reconoce de forma fiable, complejos Caṕıtulo – 3. Algoritmo especializado 24 Figura 3.1: Diagrama de Bloques del Algoritmo de Pan-Tompkins (Fuente: Elaboración propia) QRS en base a los análisis digital de pendiente, amplitud y anchura, en señales de ECG. Cada onda presente en el ECG describe una acción espećıfica del sistema card́ıaco que genera diferentes potenciales. Las señales ECG, como se definió en el caṕıtulo anterior, se dividen en ondas, intervalos y segmentos: onda P, el complejo QRS, onda T, onda U, segmento PR, segmento ST, intervalo PP, intervalo RR, e intervalo QT. Las secciones ubicadas entre las deflexiones se denominan segmentos, y las distancias entre cada onda, se conocen como intervalos. El algoritmo de detección de complejos QRS fue implementado en el lenguaje C/C++ y todo el proceso se realiza con aritmética punto flotante en un PC, a pesar de ello el computo se puede realizar con aritmética de enteros de modo que puede operar en tiempo real sin necesidad de excesiva potencia de cálculo, la figura 3.1 muestra las señales en varias etapas de procesamiento de señal digital. Los registros ECG a procesar provienen de bases de datos (Cardioloǵıa y Physio- net), adquiridos en su mayoŕıa a una tasa de 200 o 500 muestras/s. La señal digital resultante pasa sucesivamente a través de una secuencia de pasos que incluyen tres filtros digitales lineales implementados en el algoritmo. El primero es un filtro pasa banda de coeficiente integrado compuesto filtros paso bajos y filtros de pasa-alto dis- puestos en casadas, cuya función es la eliminación de ruido, 3.1 muestra las etapas de este proceso, luego del filtrado de la señal original, se aplica un filtro que se aproxima a una derivada. Después le sigue un proceso de cuadratura de la amplitud, que ayuda a restringir falsos positivos causados por las ondas T con un nivel más alto al del es- pectro habitual, y finalmente la señal pasa a través de un integrador de ventana móvil o ventana móvil integrador. Ahora es cuando unos umbrales adaptativos discriminan las ubicaciones de los complejos QRS. En el siguiente apartado, se detallarán las etapas del algoritmo descrito. Caṕıtulo – 3. Algoritmo especializado 25 3.1.1. Filtro Pasa Banda El filtro pasa banda reduce la influencia del ruido muscular, la interferencia de 60 Hz, desviaciones basales y la interferencia de la onda T. La banda de paso deseable para maximizar la enerǵıa del QRS es aproximadamente 5-15 Hz. El filtro presenta una respuesta rápida, recursivo en tiempo real en el que los polos se ubican para cancelar ceros en el ćırculo unitario del plano z. Este enfoque se traduce en un filtro diseñado con coeficientes enteros. Puesto que sólo la aritmética de enteros es necesaria, un filtrado en tiempo real se puede implementar con un simple microprocesador y todav́ıa queda la potencia de cálculo disponible para hacer la tarea de reconocimiento de QRS. Esta clase de filtros que tienen polos y ceros sólo en ćırculo unitario permite una limitada flexibilidad en el diseño de pasa bandas. El filtro pasabanda presentado se diseña a partir de la secuencia de los filtros pasa bajos y los pasa altos descritos a continuación, para conseguir una banda de paso de 3 dB desde alrededor de 5 a 12 Hz, razonablemente cerca del objetivo de diseño [18]. 3.1.2. Filtro Pasa Bajos La función de transferencia del filtro pasa bajos de segundo orden es H (z) = (1−z−6 )2 (1−z−1)2 , (3.1) donde La amplitud de respuesta es H (z) = (−1 + 32z−16+ z−32) (1+z−1) , (3.2) donde La ecuación de diferencia del filtro es y (nT ) =2y (nT−T )−y (nT−2T ) +x (nT )−2x (nT−6T ) +x(nT−12T ), (3.3) donde la enerǵıa de corte es cerca de 11 Hz, T es el peŕıodo de muestreo y la ganancia es 36. El retraso de procesamiento del filtro es de seis muestras [18]. Caṕıtulo – 3. Algoritmo especializado 26 3.1.3. Filtro Pasa Altos El diseño del filtro pasa alto es basado en restar la salida de un filtro pasa bajo de primer orden desde un filtro pasa altos y bajos (es decir, las muestras en la señal original). La función de transferencia para este filtro pasa alto es: H (z) = (−1 + 32z−16+ z−32) (1+z−1) , (3.4) donde la amplitud de respuesta es |H (wT ) | = [ 256+sin2(16wT ) ]1/2 cos(wT/2) , (3.5) donde la ecuación de la diferencia es y (nT ) =32x (nT−16T )− [y (nT−T ) +x (nT )−x(nT−12T )] (3.6) . El punto de corte bajo de frecuencia de este filtro es cerca de 5 Hz, la ganancia es 32 y el retardo son 16 muestras [18]. 3.1.4. Derivación Después del filtrado, la señal es diferenciada para proveer la información de la forma del complejo QRS. Nosotros usamos una derivación de cinco puntos con una función de transferencia H (z) = (1/8T ) (−z−2−2z−1+2z1+z2), (3.7) donde la amplitud de la respuesta es |H (wT ) | = (1/4T )[sin(2wT ) +2sin(wt) ], (3.8) Caṕıtulo – 3. Algoritmo especializado 27 donde La ecuación de la diferencia es y (nT ) = (1/8T ) [−x (nT−2T )−2x (nT−T ) +2x (nT+T ) +x (nT−2T )] . (3.9) La frecuencia de respuesta de esta derivación es cercanamente lineal entre dc y 30 Hz (es decir, se aproxima a una derivada ideal en este rango). Su retardo es de dos muestras [18]. 3.1.5. Función Cuadrática Después de la diferenciación, la señal es elevada al cuadrado punto por punto. La ecuación de este operador es y (nT ) =[x(nT )] 2 . (3.10) Esto hace todos los puntos de los datos positivos, y genera una amplificación no lineal de la salida de la derivación, enfatizando las altas frecuencias (es decir, frecuencias presentes en el ECG) [18]. 3.1.6. Ventana Móvil Integradora El propósito de la ventana móvil integradora, es obtener información caracteŕıstica de la forma de onda del complejo QRS adicional a la pendiente de la onda R. Se calcula a partir de y (nT ) = (1/N) [x (nT−(N−1)T ) +x (nT− (N−2)T ) + · · ·+,x (nT )] , (3.11) donde N es el número de muestras en el ancho de la ventana integradora. El número de N muestras en la ventana móvil es importante. Generalmente el ancho de la ventana debe ser aproximadamente igual al complejo QRS más ancho. Si la ventana es demasiado ancha, la forma de la onda integrada fusionará los complejos QRS y T. Si la ventana es demasiado estrecha, algunos complejos QRS producirán Caṕıtulo – 3. Algoritmo especializado 28 varios picos en la forma de la onda integrada. Estos pueden causar dificultad en los procesos posteriores de detección del QRS. El ancho de la ventana se determina emṕıricamente, generalmente se asocia a un ancho QRS de aproximadamente 150ms. Para nuestra frecuencia de muestreo de 200 muestras/s, la ventana es de 30 muestras de ancho (150ms). 3.1.7. Fase de Detección La detección ocurre, cuando el algoritmo, al recibir las muestras de la señal inte- grada, detecta un cambio de pendiente positivo a negativo, y este se mantiene aśı por un número prefijado de muestras, este levantamiento, se denomina pico de enerǵıa. Luego, a partir del procedimiento denominado umbrales adaptativos, el algoritmo determinará si el pico de enerǵıa corresponde a un complejo QRS o si debe ser con- siderado ruido. Adicionalmente, la técnica de búsqueda hacia atrás, permitirá que el ajuste de los umbrales, sea más efectivo. 3.1.8. Umbrales Adaptativos Durante la detección, el algoritmo lleva estimaciones de los picos de la señal aso- ciados a los complejos QRS, y del nivel de ruido de la misma, entendiéndose como ruido, cualquier pico de la señal que no es un complejo QRS, dichos estimadores se actualizan cada vez que se encuentra un nuevo complejo QRS, a través de un prome- dio ponderado entre el último valor medio y el valor de la última detección, a partir de la siguiente relación SPKI = wpk ∗ PEAKI + 0, 875 ∗ SPKI (3.12) NPKI = wpk ∗ PEAKI + 0, 875 ∗NPKI . (3.13) Donde, 3.12 y 3.13 son los estimadores del nivel de los picos QRS y de ruido respectivamente, y PEAKI el último pico detectado, sea de la señal (complejo QRS) o de ruido, y el valor wpk, es para ajustar cuánto afecta la amplitud del último pico Caṕıtulo – 3. Algoritmo especializado 29 encontrado. Luego de obtener los estimadores, se lleva a cabo el cálculo de los umbrales de la siguiente manera: TH1 = NPKI + wth ∗ (SPKI −NPKI) (3.14) TH2 = 0, 5 ∗ TH1. (3.15) Siendo wth, el valor que determina, a que altura entre los dos niveles se fija el umbral. El primer umbral (TH1) es el que se utiliza para decidir si un pico dado es un complejo QRS o no, y el segundo TH2, es utilizado cuando el algoritmo entra en modo searchback o búsqueda hacia atrás [25]. 30 Caṕıtulo 4 Metodoloǵıa Una vez conocido los aspectos básicos inherentes a la tecnoloǵıa a usar y lo relacio- nado a las arritmias card́ıacas, se establecerán las pautas para alcanzar los objetivos planteados, para ello se adoptó el enfoque de desarrollo de software Extreme Pro- gramming (XP). Se partió de una solución del problema más simple que solo permit́ıa obtener los parámetros caracteŕısticos (complejo PQRS) necesarios para la detección de los patrones arŕıtmicos sobre registros de corta duración y libres de ruido que, a partir de ciclos de prueba, retroalimentación y cambios llevados a cabo en corto tiem- po proporcionó una solución más compleja y robusta. En la detección del patrón de FAP y TVNS, la metodoloǵıa XP proporcionó una herramienta que permitió obtener buenos resultados en segmentos de registro de mayor duración con presencia de ruido. A continuación se describirán las etapas en las que se realizó el siguiente trabajo. Luego de organizar y seleccionar los registros de prueba y su procedencia se aplicó un algoritmo de extracción de caracteŕısticas. Posteriormente se llevó a cabo la detección de los parámetros caracteŕısticos de cada una de las cardiopat́ıas aqúı estudiadas. Por último la fase de identificación de sus patrones. 4.1. Base de Datos del Instituto de Medicina Tro- pical, Departamento de Cardioloǵıa de la UCV La base de datos que se tiene a disposición del Instituto de Medicina Tropical, de la cual se han tomado 70 registros ECG que presentan al menos un evento de TVNS, provenientes de sujetos asintomáticos (33 hombres y 22 mujeres, con edad promedio Caṕıtulo – 4. Metodoloǵıa 31 de 59 ± 15 años [entre 25 y 86 años]) y al menos un evento de FAP provenientes de sujetos asintomáticos (8 hombres y 12 mujeres, con edad promedio de 61 ± 11 años [entre 41 y 85 años]). Los registros tienen una duración en promedio de 24 h cada uno y han sido digitalizados a 500 y 1000 muestrass. Como requisito , solo se consideran para su análisis, registros de 1 h que se encuentran alejados en promedio a más de 4 horas de eventos previos. 4.2. Base de Datos del MIT-BIH Normal Sinus Rhythm Databases La base de datos incluye 18 registros de larga duración de ECG referidos al La- boratorio de Arritmias del Hospital Beth Israel en Boston (ahora el Centro Médico Beth Israel Deaconess). Se encontró que los sujetos incluidos en esta base de datos no han tenido arritmias significativas. La base de datos se compone de 5 registros de sujeto masculino entre 26 y 45 años de edad, y de 13 registros de sujeto femenino entre 20 a 50 años.[30] 4.3. Desarrollo de la Solución La implementación se desarrolló bajo el lenguaje de programación C++, utilizan- do programación orientada a objetos a través del Framework Qt. Un requerimiento primordial del proyecto es que la aplicación sea multiplataforma por ello se llevo a cabo en Qt project que contiene un conjunto de librerias gratuitas que permiten desarrollar herramientas open source con esta caracteŕıstica. Además, Qt proporciona ventajas para la creación de interfaces gráficas en sus aplicaciones, gracias al uso de la aceleración gráfica basada en OpenGL/OpenGLES 3 que permite procesar y des- plegar con rapidez grandes volúmenes de datos (ver figura 4.1). Requerimiento inicial de la herramienta en desarrollo (detector) que posteriormente fue asignado a otra de las fases del proyecto. 3 http://softpei.blogspot.com/2013/05/introduccion-al-framework-qt-5-para-el.html Caṕıtulo – 4. Metodoloǵıa 32 Figura 4.1: Detector. Para visualizar los resultados obtenidos en cada etapa se utilizó la herramienta Grace de algunas distribuciones de Linux. La detección de los patrones arŕıtmicos requirió de un algoritmo de extracción de caracteŕısticas, una fase de detección de los parámetros caracteŕısticos y por último la identificación de patrones, cada etapa será descrita en los siguientes apartados. El algoritmo en ĺınea general tiene la estructura que se observa en el diagrama 4.2. 4.4. Algoritmo de Extracción de Caracteŕısticas Para la identificación del patrón correspondiente a cada arritmia bajo estudio, fue necesario hallar primero la posición de la onda R asociada a cada complejo PQRST del ciclo card́ıaco, tomando como referencia el algoritmo de Jiapu Pan y Willis J. Tompkins [18], el cual se basa en el análisis de la pendiente, la amplitud, y el ancho de dichos complejos, por ser esta onda R, el punto de más amplio voltaje de todo el complejo PQRST, y por ende la mejor referencia visual para calcular la frecuencia card́ıaca, los intervalos RR, y detectar otras ondas del complejo. Una vez encontrada la posición de la onda R, se procede a localizar la posición de las ondas Q, S y P de cada complejo, usando como referencia, las caracteŕısticas de los registros de la Caṕıtulo – 4. Metodoloǵıa 33 Figura 4.2: Estructura general del detector. señal filtrada, derivada, cuadrada e integrada. Finalmente a partir de estos parámetros primarios se realizó el cálculo del ancho del complejo QRS, además de la irregularidad temporal entre los intervalos RR, haciendo uso de los criterios dados por los médicos especialistas en electrofisioloǵıa este esquema se presenta en la figura 4.3. Caṕıtulo – 4. Metodoloǵıa 34 Figura 4.3: Estructura del proyecto Caṕıtulo – 4. Metodoloǵıa 35 4.4.1. Detección de los Parámetros Caracteŕısticos Para llegar a detectar los parámetros caracteŕısticos, se requiere acondicionar la señal en una primera instancia, con el fin de mejorar la relación señal-ruido, facilitan- do la observación de los mismos. Este acondicionamiento consiste en aplicar al ECG un proceso de filtrado pasa-banda para eliminar el ruido de altas frecuencias, como el ruido muscular y la interferencia de la onda T, y obtener solo la banda en frecuencia donde se esperan encontrar los complejos QRS. Una ventaja del filtro recursivo (pasa- banda) propuesto por Pan y Willis J. Tompkins[18], es que al manejar coeficientes enteros en su función de transferencia, se reduce la complejidad y el consumo compu- tacional. El siguiente paso en el procesamiento, es un filtro diferencial o derivador que elimina las componentes de baja frecuencia de las ondas P y T para resaltar las pendientes pronunciadas que caracterizan a la onda R; posteriormente se aplica una transformación no lineal que consiste en elevar al cuadrado la señal resultante del filtro diferencial para que todas las muestras sean positivas, acentuando la diferencia entre las distintas pendientes detectadas. Por último se aplica una ventana móvil integradora, que promedia las amplitudes elevadas al cuadrado, para eliminar las oscilaciones de poca duración que no corresponden con un complejo QRS, y permite obtener un pulso uniforme en el conjunto de muestras de la señal, asociada a cada uno de los complejos PQRST. Es importante mencionar que posterior a la etapa de filtrado, debe aplicarse sobre la señal una regresión lineal, para eliminar el offset (nivel de corrimiento o desplaza- miento) generado en el proceso de filtrado. Finalmente, luego del acondicionamiento de la señal, se procede a la detección de la onda R. Primero, se realiza la búsqueda de un pico de amplitud máxima sobre la señal integrada, esto ocurre cuando se detecta un cambio de pendiente de positivo a negativo y se mantiene por un número prefija- do de muestras, luego, a partir de el valor de umbrales de amplitud establecidos, se determina si el pico corresponde efectivamente a la onda R, o si debe ser considerado ruido. Los umbrales 3.12 y 3.13 son estimadores del nivel de los picos de la señales asociadas a los complejos QRS y del nivel de ruido de la misma, entendiéndose como ruido a cualquier pico de la señal que no sea un complejo QRS. Estos estimadores se actualizan cada vez que se encuentra un nuevo complejo (onda R) a través de un pro- medio ponderado entre el último valor medio y el valor tomado en la última detección. La amplitud del último pico detectado, sea de señal o de ruido, es usado para adaptar Caṕıtulo – 4. Metodoloǵıa 36 el valor medio a los cambios, además el valor del umbral (TH1), para decidir si se ha encontrado o no un pico a partir de los valores de la señal cuadrada, se obtiene del valor de las pendientes, asegurando con este valor, que el latido corresponde a la onda R y no a una onda T de pendiente pronunciada. Para realizar un mejor ajuste de los umbrales de amplitud, se agrego al algoritmo después de las primeras detecciones, el promedio de los últimos 8 picos R encontrados. La detección de las ondas Q y S se realiza a partir de la señal derivada. Para el caso de la onda Q, se busca, antes de la posición de la onda R, la ubicación donde se da un cambio de signo, es decir, el valor de amplitud en la señal derivada menor a cero, luego se ubica con mayor precisión la amplitud mı́nima entorno (ventana de x ms) a la posición donde ocurre el cambio de signo, siendo este último valor, la posición y amplitud de la onda Q. Para detectar la onda S, se lleva a cabo el mismo procedimiento, pero la búsqueda del cambio de signo se realiza a partir de la onda R hasta x ms después de esta, usando el mismo criterio. La búsqueda de la onda P, se realiza en el segmento P-Q. Primero, se localiza la posición de la amplitud máxima sobre la señal filtrada en dicho segmento, para validar que corresponde al de la onda P, se realiza una búsqueda de cambio de signo unos milisegundos antes y después de la posición de este máximo sobre la señal derivada (como la búsqueda de las ondas Q y S), pero el cambio de signo, sera evaluado con la diferencia de las muestras (i) e (i-1), para encontrar el origen de la onda, y la diferencia entre las muestras (i) e (i+1), para hallar el fin de esta, después de validar que el ancho de la onda P es menor o igual a 100 ms, se calcula el máximo de la pendiente a partir de la señal cuadrada, y en caso de que esta pendiente sea menor a un porcentaje de la pendiente de la onda R, se ha encontrado una onda P. En nuestra implementación el cálculo de los parámetros caracteŕısticos, esta con- tenido en cuatro de los métodos de la clase calculos, estos son: calculoSenhal(), De- teccionQRS(), anchoQRS() y ausenciaP(), como se presenta en la imagen 4.4. 4.4.2. Identificación de Patrones El siguiente paso de nuestro algoritmo, es la identificación de patrones, iniciando con la detección del ancho del complejo QRS. Luego de obtener las posiciones de Caṕıtulo – 4. Metodoloǵıa 37 Figura 4.4: Fase de Detección de los parámetros caracteŕısticos. Q y S, en la fase anterior, se calcula la diferencia entre la posición de la onda S menos la posición de la onda Q, para cada complejo, y esta diferencia se multiplica por el tiempo entre cada muestra, si el resultado es menor a 120 ms este se considera un complejo QRS normal, en caso de tener un ancho mayor a 120ms, nos encontramos con un complejo anómalo, ya que la deformación del complejo QRS, indica una falla de la actividad ventricular. Para llevar a cabo la detección de la irregularidad de los intervalos RR, se deben introducir algunas definiciones. Un intervalo RR, es el tiempo que transcurre desde la aparición de un latido u onda R al siguiente, y un intervalo se considera irregular, cuando el tiempo entre dos intervalos RR adyacentes, es mayor a 50 ms. En nuestra implementación, luego de detectadas las ondas R, se calculan los intervalos RR restando la posición entre un latido y el anterior, el resultado se multiplica por el Caṕıtulo – 4. Metodoloǵıa 38 tiempo entre muestras, para conocer su duración. Luego de calculado cada intervalo, se realiza la diferencia entre dos RR consecutivos, si esta diferencia es menor a 50 ms se registra dicho intervalo como regular, en caso contrario, se indica que es regular. Finalmente, si el registro contiene más de tres latidos consecutivos con un ancho en cada complejo QRS mayor a 120 ms, poca regularidad y una aumento de frecuencia, estamos ante el patrón de la TVNS (Criterio para detectar un patron de TVNS). Si el registro contiene más de 3 latidos consecutivos con ausencia de la onda P e irregularidad en sus intervalos, estamos ante un patrón de FAP (Criterio para la deteccción de un patron de FAP). Por último, el criterio para la identificación de un registro de paciente sano, toma en cuenta la presencia de intervalos RR, regulares, el ancho de cada uno de sus complejos QRS es menor a 120 ms y presencia regular de la onda P. En nuestra implementación, la identificación de patrones, esta contenido en los siguientes métodos de la clase calculos, estos son: Detector(), anchoQRS(), au- senciaP() y DeteccionIrregularidad(). Las instrucciones encargadas de la identi- ficación, se presenta en el esquema de la figura 4.5. Caṕıtulo – 4. Metodoloǵıa 39 Figura 4.5: Fase de Identificación de patrones Caṕıtulo – 4. Metodoloǵıa 40 Los esquemas de funcionamiento del sistema detector, en la búsqueda permanente de patrones de FAP y TVNS, se muestran en las figuras 4.6 y 4.7, respectivamente. Figura 4.6: Diagrama de flujo del algoritmo detector de FAP. Como se observa en el diagrama de flujo 4.6 se describe la secuencia de consultas que lleva a cabo el algoritmo para detectar un patrón de FAP. Como entrada se requiere el registro ECG que será analizado. Seguidamente se crea una ventana con dimensión de 3 ó 4 latidos para iniciar la busqueda de patrones de FAP. La búsqueda Caṕıtulo – 4. Metodoloǵıa 41 Figura 4.7: Diagrama de flujo del algoritmo detector de TVNS. es la siguiente: Si en 3 ó 4 complejos consecutivos esta ausente la onda P se procede a validar el siguiente parámetro, en caso de que la onda P este presente se puede concluir que no hay un evento de FAP, retorno al inicio del algoritmo de decisión y desplazo la ventana en un latido para iniciar otra consulta. Si la onda P se encuentra ausente en todos los latidos existentes en la ventana, se procede a verificar que los mismos 3 ó 4 complejos consecutivos sean irregulares, es decir que sus intervalos RR sean mayor a 50 ms. Si la onda P esta ausente y existe irregularidad se activa la Caṕıtulo – 4. Metodoloǵıa 42 alarma que indica la existencia de un patrón de FAP, en caso contrario, se desplaza la ventana al siguiente complejo para iniciar la búsqueda. Una vez realizada la búsqueda de patrones de FAP se procede a examinar la exis- tencia de eventos de TVNS (ver 4.7). El procedimiento para la detección de eventos de TVNS es similar al algoritmo antes expuesto, con la diferencia de que los parámetros a validar son la existencia de 3 ó 4 complejos QRS consecutivos de ancho mayor a 120 ms y una frecuencia instantánea asociada a los complejos involucrados mayor a 100 lpm. 43 Caṕıtulo 5 Resultados y Discusión Se presentan resultados de evaluar el funcionamiento del software detector de even- tos arŕıtmicos tipo FAP y TVNS en registros electrocardiográficos de 1h de duración, alguno de ellos finalizan con eventos de FAP o TVNS, aśı como también se pone a prueba su respuesta en registros control. La confiabilidad de la herramienta se medirá a partir del cálculo de algunos indi- cadores estad́ısticos como sensibilidad, especificidad y exactitud. Para ésta prueba se han analizado 36 registros: 12 registros pertenecen a pacientes que presentan al menos un episodio de FAP, 12 que presentan al menos un episodio de TVNS y 12 registros control (sanos), los mismos han sido obtenidos de la base de datos de la Sección de Cardioloǵıa Experimental del Instituto de Medicina Tropical de la UCV y la Base de datos internacional PhysioNET, en particular la proveniente del Instituto Tecnológico de Massachusetts (en inglés, MIT-BIH Normal Sinus Rhythm Databases). 5.1. Evaluación de las Pruebas Diagnósticas La evaluación de las pruebas diagnósticas se refiere a definir su efectividad y eficiencia. [24] 5.1.1. Efectividad La efectividad de una prueba diagnóstica es su capacidad de modificar o mejo- rar la evolución del paciente a través de cambios en las decisiones diagnósticas y/o terapéuticas. Caṕıtulo – 5. Resultados y Discusión 44 5.1.2. Eficiencia La eficiencia en una prueba diagnóstica es la capacidad para lograr una medición adecuada de la enfermedad. La eficiencia está constituida por la reproducibilidad, la exactitud o validez, la adaptabilidad, la aceptabilidad y la eficiencia estad́ıstica. La eficiencia de una prueba diagnóstica tiene como finalidad estad́ıstica diferenciar un grupo de pacientes con determinada caracteŕıstica o enfermedad de otro grupo sin esa enfermedad, la prueba ideal seŕıa aquella que fuese positiva en todos los enfermos o aquellos que tienen la caracteŕıstica, y negativa en todos los no enfermos o aquellos que no la tienen. A continuación se presentan los indicadores estad́ısticos utilizados para evaluar la eficiencia del método patrón que define la presencia de la FAP, la TVNS y la ausencia de ambas cardiopat́ıas en registros control, por medio de nuestro algoritmo el cual toma en cuenta los criterios ya definidos. 5.1.3. Verdaderos Positivos(VP): Cuantifica enfermos con la prueba positiva. 5.1.4. Falsos Negativos(FN): Cuantifica enfermos con la prueba negativa. 5.1.5. Verdaderos Negativos(VN): Cuantifica no enfermos con la prueba negativa. 5.1.6. Falsos Positivos(FP): Cuantifica no enfermos con la prueba positiva. Caṕıtulo – 5. Resultados y Discusión 45 5.1.7. Sensibilidad o Tasa de Verdaderos Positivos: Es la proporción de pacientes enfermos que tienen la prueba positiva, o la proba- bilidad de que la prueba sea positiva cuando la enfermedad está presente. Sensibilidad = V P (V P + FN) = V P Total de enfermos (5.1) 5.1.8. Especificidad o Tasa de Verdaderos Negativos: Es la proporción de pruebas negativas entre los pacientes que no tienen la enfer- medad, o la probabilidad de que la prueba sea negativa cuando la enfermedad no está presente. Especificidad = V N (V N + FP ) = V N Total de No enfermos (5.2) 5.1.9. Exactitud: La exactitud de una prueba diagnóstica se define como la capacidad que tiene de medir aquello que desea medirse. El cálculo de la exactitud del detector indicará el porcentaje de qué tan exacto es el algoritmo en la detección del patrón de FAP y TVNS. Exactitud = (V P + V N) (V P + V N + FP + FN) ∗ 100 (5.3) 5.2. Análisis de Resultados En esta sección se presentarán los resultados sobre el desempeño del algoritmo de detección de FAP y TVNS, a partir del uso de los indicadores definidos en la sección anterior: exactitud, especificidad y sensibilidad. Las pruebas sobre los registros que Caṕıtulo – 5. Resultados y Discusión 46 presentan eventos de FAP y TVNS, además de los registros control se realizaron des- plazando una ventana que contiene 3 ó 4 intervalos RR (equivalente a 4 ó 5 complejos QRS consecutivos) a lo largo del registro. Cuando se dispone a observar la presencia o no de eventos de FAP el algoritmo de detección se basa en el criterio de observar si 3 ó 4 intervalos RR consecutivos pueden ser catalogados cada uno como irregulares (si el intervalo RR considerado difiere del RR que lo antecede en 50ms), además de estar acompañados de la ausencia de la onda P. Para la observación de eventos de TVNS el algoritmo de detección toma como criterio la coincidencia de la irregularidad en la morfoloǵıa de 3 o más complejos QRS (medido a través del ancho del QRS) y la frecuencia instantánea entre estos complejos la cual debe superar los 100 lpm. 5.2.1. Registros con Presencia de Patrones de TVNS Un comportamiento que tiende a ser común en la mayoŕıa de los registros que presentan TVNS es la presencia de lo que hemos catalogado como la irregularidad, lo cual pone de manifiesto la presencia de complejos adyacentes cuyos intervalos RR difieren en más de 50 ms, ver figura 5.1.b . Aśı como también es notable frecuencias instantáneas que superan los 100 lpm (ver 5.1.d), además de algunos complejos cuyo ancho QRS tienden a superar los 120 ms (ver 5.1.c). Estos tres comportamientos señalados nos dan una breve descripción de la dinámica presente en los registros de ECG de aproximadamente una hora de duración que contienen al menos un evento de arritmia tipo TVNS. En espećıfico, cuando nos centramos en el comportamiento mostrado por el ancho del complejo QRS y la frecuencia instantánea, ambos tienden a presentar los valo- res esperados que caracterizan la presencia de un evento de TVNS justo donde se encuentra el patrón de esta arritmia, es decir, un ancho QRS superior a 120 ms y una frecuencia instantánea que acompaña a estos complejos QRS superior a 100 lpm. De esta manera, cuando cruzamos los observables de ancho y frecuencia, vemos que ambos parámetros en conjunto poseen valores superiores al umbral necesario para identificar la huella o patrón de TVNS, en promedio con una sensibilidad de 100 %, Caṕıtulo – 5. Resultados y Discusión 47 una especificidad de 99,99 % y exactitud de 99,99 % como se muestra en el cuadro 5.1. Estos resultados nos permiten asociar una alta efectividad al prototipo detector de TVNS desarrollado haciendo uso de solo dos parámetros para su detección, un ejemplo de esta efectividad en la detección es mostrado en la figura 5.1.e. A pesar de la irregularidad que muestran la mayoŕıa de los registros analizados, que de alguna manera dificulta la detección de los intervalos RR y en consecuencia la detección de los anchos y la frecuencia instantánea, la herramienta computacional detecta los patrones de TVNS con una alta eficiencia. Figura 5.1: Gráfica del registro ctvp 03 1ev 215859 bajo el esquema de 3 intervalos RR consecutivos bajo observación (Fuente: Elaboración propia). (a) Se muestra serie de intervalos RR. (b) Presencia de intervalos RR irregulares (1) e intervalos RR regulares (0). (c) Se muestra la presencia de complejos QRS con un ancho mayor a 120 ms (1) y ausencia de complejos QRS anchos (0). (d) Presencia de frecuencias instantáneas mayor a 100 lpm (1) y ausencia de frecuencias instantáneas mayor a 100 lpm (0) que acompaña cada complejo. (e) Se muestra presencia (1) y ausencia (0) de un patrón de TVNS en el registro Caṕıtulo – 5. Resultados y Discusión 48 Registro VP VN FN FP ctvp 01 1ev 103433 1 5661 0 1 ctvp 02 6ev 230144 1 4328 0 0 ctvp 03 1ev 215859 1 3050 0 0 ctvp 04 1ev 135554 1 4681 0 0 ctvp 05 2ev 054355 1 4753 0 0 ctvp 06 1ev 053000 1 5395 0 0 ctvp 07 1ev 141211 1 4432 0 0 ctvp 09 3ev 141248 1 5047 0 1 ctvp 09 1ev 203803 1 6216 0 2 ctvp 12 1ev 014152 1 3730 0 0 ctvp 19 1ev 180823 1 5779 0 0 ctvp 25 3ev 234713 1 4998 0 2 Total 12 58070 0 6 Resultado de la TVNS Exactitud ( %) 99,99 Sensibilidad ( %) 100,00 Especificidad ( %) 99,99 Cuadro 5.1: Tabla de resultados de la TVNS bajo el esquema de observación de 3 intervalos RR consecutivos bajo observación 5.2.2. Registros con Presencia de Patrones de FAP Como en el caso anterior procederemos a observar el comportamiento que pre- sentan registros en los cuales se presenta al menos un evento de FAP, haciéndole seguimiento principalmente a los siguientes estimadores: la irregularidad y ausencia de onda P. La mayoŕıa de los registros a lo largo de la hora previa a los eventos de FAP tienden a presentar una alta irregularidad (intervalos RR entre complejos adyacentes que difieren en más de 50 ms) como se observa en la figura 5.2.b , además de interrupciones y activaciones sucesivas de la onda P en complejos no adyacentes (ver figura 5.2.c), acompañados además de frecuencias instantáneas entre 50 y 200 lpm (ver figura 5.2.d). Un evento de FAP se identifica cuando coinciden simultáneamente la ausencia de la onda P en 3 complejos (PQRST) consecutivos, con la irregularidad asociada a los intervalos RR en estos, es decir, si encontramos asociado a cada complejo PQRST una diferencia entre los intervalos temporales RR que lo antecede y lo precede mayor a 50 ms, con la ausencia de la onda P (complejo QRST), como mı́nimo en 3 complejos Caṕıtulo – 5. Resultados y Discusión 49 consecutivos, se alcanza la condición de la activación de un evento de FA, como se aprecia en la figura 5.2.e. Figura 5.2: Gráfica del registro cfap 11 1ev 021600 bajo el esquema de 3 intervalos RR consecutivos bajo observación (Fuente: Elaboración propia). (a) Se muestra serie de intervalos RR. (b) Presencia de intervalos RR irregulares (1) e intervalos RR regulares (0). (c) Se muestra la presencia de onda P (1) y ausencia de onda P (0) que acompaña cada complejo. (d) Presencia de frecuencias instantáneas menores a 50 lpm (0), frecuencias instantaneas entre 50 y 100 lpm (1) y frecuencias superiores a 100 lpm (2).en cada intervalo RR. (e) Se muestra presencia (1) y ausencia (0) de un patrón de FAP en el registro Cuando empleamos el criterio de detección de un patrón de FAP a partir de la presencia de 3 intervalos RR consecutivos irregulares, acompañados de ausencia de onda P, la sensibilidad que se obtiene del detector es de 75 %, debido a la detección de falsos patrones de la enfermedad denominados falsos positivos en zonas del ECG donde no existe un evento (ver figura 5.3.e), arrojando una especificidad de 99,89 % y una exactitud de 99,89 %, como se muestra en el cuadro 5.2. Como se puede observar la sensibilidad obtenida para los casos de la detección del patrón de FAP tiende a ser inferior al resultado encontrado por el sistema detector para los casos de TVNS. De esta manera, nuestro sistema detector de FAP presenta un nivel más elevado de equivocarse al diagnosticar estos patrones arŕıtmicos comparado Caṕıtulo – 5. Resultados y Discusión 50 Figura 5.3: Gráfica del registro cfap 08 1ev 235342 bajo el esquema de 3 intervalos RR consecutivos bajo observación (Fuente: Elaboración propia). (a) Se muestra serie de intervalos RR. (b) Presencia de intervalos RR irregulares (1) e intervalos RR regulares (0). (c) Se muestra la presencia de onda P (1) y ausencia de onda P (0) que acompaña cada complejo. (d) Presencia de frecuencias instantáneas menores a 50 lpm (0), frecuencias instantáneas entre 50 y 100 lpm (1) y frecuencias superiores a 100 lpm (2).en cada intervalo RR. (e) Se muestra presencia (1) y ausencia (0) de un patrón de FAP en el registro con el detector de TVNS. Sin embargo, es notorio que la especificidad mantiene un nivel muy cercano al 100 %, resultado relevante ya que en estudios de salud pública es mucho más grave decirle a un sano que está enfermo, que equivocarse en el diagnóstico en enfermos. Esto evitaŕıa asignar un falso diagnóstico a pacientes que no presentan ninguna enfermedad, hecho no deseable y de consecuencias graves. Ahora si elevamos el nivel de exigencia para la detección de FAP usando como cri- terio involucrar 4 intervalos RR consecutivos irregulares con las respectivas ausencias de la onda P, en lugar de 3, obtenemos como resultado una sensibilidad de 58,33 %, una especificidad de 99,99 %, y una exactitud de 99,98 %, se evidencia una mejora en la especificidad y un deterioro en la sensibilidad (ver cuadro 5.3). Un ejemplo de la mejora de la especificidad al robustecer el criterio se presenta en la figura 5.4.e, en la cual se observa que tienden a desaparecer falsos positivos como los observados Caṕıtulo – 5. Resultados y Discusión 51 Registro VP VN FN FP cfap 03 1ev 195404 1 3462 0 1 cfap 04 1ev 141026 1 4360 0 1 cfap 04 2ev 161829 1 4700 0 0 cfap 08 1ev 235342 1 4552 0 3 cfap 11 1ev 021600 1 3735 0 0 cfap 15 1ev 204006 1 5573 0 3 cfap 22 1ev 113304 1 5604 0 7 cfap 05 1ev 034755 0 5221 1 3 cfap 12 1ev 204610 0 4586 1 16 cfap 13 1ev 232822 0 4168 1 16 cfap 06 1ev 111903 1 4610 0 6 cfap 24 1ev 045002 1 4353 0 2 Total 9 54924 3 58 Resultado de la FAP Exactitud ( %) 99,89 Sensibilidad ( %) 75,00 Especificidad ( %) 99,89 Cuadro 5.2: Tabla de resultados de la FAP bajo el esquema de 3 intervalos RR con- secutivos bajo observación en la figura 5.3.e, incrementando de esta manera la especificidad a expensas de un deterioro en la sensibilidad, ya que se tiende a excluir la presencia de patrones de FAP que involucran 3 intervalos RR irregulares consecutivos. Caṕıtulo – 5. Resultados y Discusión 52 Figura 5.4: Gráfica del registro cfap 08 1ev 235342 bajo el esquema de 4 intervalos RR consecutivos bajo observación (Fuente: Elaboración propia). (a) Se muestra serie de intervalos RR. (b) Presencia de intervalos RR irregulares (1) e intervalos RR regulares (0). (c) Se muestra la presencia de onda P (1) y ausencia de onda P (0) que acompaña cada complejo. (d) Presencia de frecuencias instantáneas menores a 50 lpm (0), frecuencias instantáneas entre 50 y 100 lpm (1) y frecuencias superiores a 100 lpm (2).en cada intervalo RR. (e) Se muestra presencia (1) y ausencia (0) de un patrón de FAP en el registro Caṕıtulo – 5. Resultados y Discusión 53 Registro VP VN FN FP cfap 03 1ev 195404 1 3462 0 1 cfap 04 1ev 141026 1 4360 0 0 cfap 04 2ev 161829 1 4700 0 0 cfap 08 1ev 235342 1 4552 0 0 cfap 11 1ev 021600 0 3735 1 0 cfap 15 1ev 204006 0 5573 1 0 cfap 22 1ev 113304 1 5604 0 0 cfap 05 1ev 034755 0 5221 1 1 cfap 12 1ev 204610 0 4586 1 1 cfap 13 1ev 232822 0 4168 1 3 cfap 06 1ev 111903 1 4610 0 1 cfap 24 1ev 045002 1 4353 0 1 Total 7 54924 5 8 Resultado de la FAP Exactitud ( %) 99,98 Sensibilidad ( %) 58,33 Especificidad ( %) 99,99 Cuadro 5.3: Tabla de resultados de la FAP bajo el esquema de 4 intervalos RR con- secutivos bajo observación Caṕıtulo – 5. Resultados y Discusión 54 5.2.3. Registros Control El estudio de los registros control, se lleva a cabo analizando sobre 3 intervalos RR consecutivos los mismos parámetros que han sido observados sobre los registros que presentan eventos de FAP y TVNS. Los indicadores son: irregularidad, frecuencia instantánea, ancho del QRS y presencia de onda P. En la totalidad de los casos analizados por medio del prototipo se presenta alta irregularidad (intervalos RR entre complejos adyacentes que difieren en más de 50 ms) como se observa en la figura 5.5.b , algunos de estos registros presentan además complejos aislados cuyo ancho QRS tienden a superar los 120 ms (ver 5.5.c), aśı como también presencia de interrupciones y activaciones sucesivas de la onda P en comple- jos no adyacentes aislados (ver figura 5.5.d) y frecuencias instantáneas fuera del rango - que corresponden a un ritmo sinusal normal - de 60 a 100 lpm, como se observa en la figura 5.5.e. A pesar de las alteraciones observadas (ver figura 5.5), consecuencia en la mayoŕıa de los casos de arritmia sinusal respiratoria, común en pacientes que no padecen afecciones card́ıacas, el prototipo detector responde de forma efectiva, sin activación de reconocimiento de patrones tipo FAP y TVNS (ver figura 5.5.f), indicando que la dinámica presente en los registros de ECG de aproximadamente una hora de duración pertenecen a pacientes no enfermos, ya que se obtiene una especifi- cidad de 100 %. Este resultado se encuentra además acompañado de una sensibilidad de 100 %, ya que hemos detectado un patrón de FAP (ver figura 5.6.f) por medio del sistema detector en un registro que proviene de la base de datos de pacientes sanos (control). Este hallazgo nos obligó a su certificación por medio de los médicos especialistas quienes confirmaron la veracidad del patrón arŕıtmico, este patrón no se encuentra identificado dentro de la base de datos de PhysioNET (ver figura 5.7). Tal hecho eleva el nivel de confianza sobre el sistema detector al ubicar un evento o patrón del cual inicialmente no se teńıa información. En resumen, el desempeño del algoritmo como método diagnóstico en los regis- tros control arroja un resultado altamente eficiente, con una sensibilidad de 100 %, especificidad de 100 % y exactitud de 100 %, como se observa en el cuadro 5.4. Una vez analizados los diferentes casos bajo estudio, se observó un resultado eficiente de la herramienta prototipo propuesta como detector de los eventos tipo TVNS y FAP estudiados, tomando en cuenta un mı́nimo de parámetros que lo caracterizan para su detección. Caṕıtulo – 5. Resultados y Discusión 55 Figura 5.5: Gráfica del registro del sujeto de control nsrdb 19088 22:58:00 bajo el esquema de 3 intervalos RR consecutivos bajo observación (Fuente: Elaboración pro- pia).(a) Se muestra serie de intervalos RR. (b) Presencia de intervalos RR irregulares (1) e intervalos RR regulares (0). (c) Se muestra la presencia de complejos QRS con un ancho mayor a 120 ms (1) y ausencia de complejos QRS anchos (0). (d) Se muestra la presencia de onda P (1) y ausencia de onda P (0) que acompaña cada complejo. (e) Presencia de frecuencias instantáneas entren 60 y 100 lpm (1) y ausencia de fre- cuencias dentro de este rango(0) en cada intervalo RR. (f) Se muestra presencia(1) y ausencia(0) de algún patrón de las arritmias estudiadas (FAP o TVNS). Sin embargo, es importante resaltar que se requiere de un esfuerzo que conlleve al diseño de un algoritmo computacional que tome en cuenta los diversos elementos que complican una correcta observación de la dinámica altamente cambiante que presenta el registro del ECG, y en consecuencia tienden a dificultar de manera indirecta la detección de los parámetros necesarios para la identificación de los patrones arŕıtmicos bajo estudio, entre estos elementos podemos citar: cambios de amplitudes, cambios de frecuencia, desplazamiento de la ĺınea base, cambio en la morfoloǵıa t́ıpica del ECG, ruido por interferencias externas, entre otros. Caṕıtulo – 5. Resultados y Discusión 56 Figura 5.6: Gráficas del sujeto de control nsrdb 16273 09:00:00 bajo el esquema de 3 intervalos RR consecutivos bajo observación (Fuente: Elaboración propia).(a) Se muestra serie de intervalos RR. (b) Presencia de intervalos RR irregulares (1) e in- tervalos RR regulares (0). (c) Se muestra la presencia de complejos QRS con un ancho mayor a 120 ms (1) y ausencia de complejos QRS anchos (0). (d) Se muestra la presencia de onda P (1) y ausencia de onda P (0) que acompaña cada complejo. (e) Presencia de frecuencias instantáneas entren 60 y 100 lpm (1) y ausencia de fre- cuencias dentro de este rango(0) en cada intervalo RR. (f) Se muestra presencia(1) y ausencia(0) de algún patrón de las arritmias estudiadas (FAP o TVNS). Caṕıtulo – 5. Resultados y Discusión 57 Figura 5.7: En esta imagen correspondiente a las anotaciones del registro nsrdb-16273 de la base de datos MIT-BIH Normal Sinus Rhythm, se muestra señalado en un ćırculo rojo el instante de tiempo 09:08:46 donde se presenta el patrón de FAP hallado por el prototipo, pero en dichas anotaciones no se reporta tal anomaĺıa. Registro VP VN FN FP nsrdb1626508:04:00 0 460796 0 0 nsrdb-16786-16:48:00 0 460796 0 0 nsrdb-18184-21:34:00 0 460796 0 0 nsrdb-19140-01:39:00 0 460796 0 0 nsrdb-16420-02:55:00 0 460796 0 0 nsrdb-16272-12:45:00 0 460796 0 0 nsrdb-19090-23:50:00 0 460796 0 0 nsrdb-19830-02:56:00 0 460796 0 0 nsrdb-18177-20:30:00 0 460781 0 0 nsrdb-19088-22:58:00 0 460730 0 0 nsrdb-16539-14:40:00 0 460745 0 0 nsrdb-16273-09:00:00 1 460796 0 0 Total 1 5529420 0 0 Resultado R. Control Exactitud( %) 100,00 Sensibilidad( %) 100,00 Especificidad( %) 100,00 Cuadro 5.4: Resultado de pacientes control bajo el esquema de 3 intervalos RR bajo observación 58 Caṕıtulo 6 Conclusiones y Trabajos Futuros En el trabajo presentado se desarrollo un prototipo que permite la detección de dos aritmias (TV, FA) que muchas veces sirven de elementos coadyuvantes o predece- sores de eventos letales como infartos o ACV en el hombre. Siendo las enfermedades cardiovasculares una de las principales causas de muerte en Venezuela [27], este pro- totipo pretende apoyar, a partir de un diagnóstico temprano, la disminución de la tasa de mortalidad. Entre los objetivos logrados se puede mencionar, que por medio del lenguaje de programación C/C++, con las librerias de Qt se pudo llegar al diseño e implementa- ción de un software capaz de reconocer patrones de eventos de FAP y TVNS presentes en registros de series temporales de ECG, a través de la implementación de filtros lineales y no lineales que permitieron reducir interferencias y resaltar los cambios caracteŕısticos de la señal original para luego, a partir de otros métodos computacio- nales, extraer las caracteŕısticas o parámetros que definen cada arritmia, como la onda P y complejo QRS para su posterior análisis. Es importante mencionar que es es posible obtener los parámetros caracteŕısticos necesarios para el reconocimiento de patrones de las arritmias, a partir de las etapas de procesamiento de la señal y el resultado final del algoritmo de Jiapu Pan y Willis J. Tompkins [18] reduciendo el costo computacional que generan otros métodos como el de las transformadas de wavelet ya que requieren una manipulación efectiva de ecuaciones matemáticas. Cabe destacar que a partir de dos parámetros únicos de entrada se llevó a cabo el reconocimiento de la Fibrilación auricular y Taquicardia ventricular, sin ser necesario el uso de más parámetros o una red de neuronas artificiales, e inclusive algoritmos más Caṕıtulo – 6. Conclusiones y Trabajos Futuros 59 complejos de decisión, permitiendo una detección rápida debido al número reducido de cálculos. En la fase de evaluación del sistema de reconocimiento de patrones implementado, se realizaron pruebas sobre un grupo de 36 registros pertenecientes a la base de datos del PhysioNet y del Departamento de Cardioloǵıa de la UCV. Los resultados obtenidos en la fase de evaluación de la herramienta son una sensibilidad de 100 %, una especificidad del 99,99 % y exactitud de 99,99 % en la detección de eventos de TVNS y para el patrón de FAP una sensibilidad del 75 %, especificidad de 99,89 % y exactitud de 99,89 %, usando ventanas de detección que involucran 3 intervalos temporales RR (4 complejos consecutivos). Finalmente, cabe resaltar que con el desarrollo de este trabajo se demuestra que es posible obtener resultados eficientes de la herramienta prototipo propuesta como detector de los eventos tipo TVNS y FAP estudiados, tomando en cuenta un mı́nimo de parámetros que lo caracterizan. 6.1. Trabajos Futuros Como trabajo futuro se propone ampliar las detecciones a un mayor número de arritmias y la inclusión de una interfaz gráfica para visualizar los resultados obtenidos durante el desarrollo. Se sugiere agregar al detector el cálculo de los indicadores estad́ısticos de sensi- bilidad, especificidad, eficiencia y la opción de aumentar el número de muestras a 4 intervalos RR en el análisis de las arritmias FAP y TVNS. El especialista podrá ajus- tar la herramienta a su preferencia dado el resultado de los indicadores estad́ısticos. Se propone incluir una aplicación web que muestre las estad́ısticas de los registros ECG de cada paciente e integre los resultados del prototipo detector, además de una aplicación móvil que permita la consulta de estos datos por el especialista. Se propone la aplicación de técnicas de mineŕıa de datos para generar estad́ısticas más detalladas de la población enferma. Es necesario un número mayor de registros de ECG para tal fin. 60 Acrónimos FAP Fibrilación auricular Parox́ıstica. TVNS Taquicardia ventricular no sostenida. ECG Electrocardiograma. PQRST Complejo PQRST. QRS Complejo QRS. AD Auŕıcula derecha. AI Auŕıcula izquierda. Hz Unidad de frecuencia, hercio. RR Intervalo RR. FN Falsos negativos. VN Verdaderos negativos. FP Falsos positivos. VP Verdaderos positivos. SPK Pico de la señal. NPK Pico de ruido. TH Umbral. XP Programación extrema. VD Ventŕıculo derecho. VD Ventŕıculo izquierdo. ACV Accidente cerebro vascular. 61 Apéndice A Código Fuente #include "calculo.h" #include <stdio.h> #include <string.h> #include <QFile> #include <QDebug> #include <QString> #include <QTextStream> #include <iostream> #include <stdio.h> #include <math.h> #include <QVector> #include<fstream> Calculo::Calculo(QObject * parent): QObject(parent) { } void Calculo::open(double x, QString insertaArchivo) { QFile b; fs = x; samplesRate = floor(x); b.setFileName(insertaArchivo); if (!b.open(QIODevice::ReadOnly | QIODevice::Text)) { qFatal("No puedo abrir el fichero"); } double dat1; //int i=0; QTextStream in2(&b); QString linea2; while (!in2.atEnd()) { Caṕıtulo – A. Código Fuente 62 linea2 = in2.readLine(); dat1 = linea2.toDouble(); canal1v.append(dat1); } b.close(); N = canal1v.size(); bandera = true; } void Calculo::archivoSalida(QString imprimeArchivoFilt, QString imprimeArchivoDect) { QFile write_fich(imprimeArchivoFilt); if (!write_fich.open(QFile::WriteOnly | QFile::Text)) { qDebug() << "No se ha podido abrir el fichero de escritura"; return; } else { QTextStream out(&write_fich); for (long i = 0; i < N; ++i) { out << filtrado[i]; out << "\n"; } } write_fich.close(); QFile write_fich8(imprimeArchivoDect); if (!write_fich8.open(QFile::WriteOnly | QFile::Text)) { qDebug() << "No se ha podido abrir el fichero de escritura"; return; } else { QTextStream out8(&write_fich8); out8 << "\n"; } write_fich8.close(); } void Calculo::calculoSenhal() { Caṕıtulo – A. Código Fuente 63 double *f; double *lineal; f = new double[N]; lineal = new double[N]; filtrado = new double[N]; derivada = new double[N]; integrada = new double[N]; cuadrado = new double[N]; for (int j = 0; j < 12; ++j) { f[j] = canal1v.at(j); } for (int i = 12; i < N; ++i) { f[i] = 2 * f[i - 1] - f[i - 2] + canal1v.at(i) - 2 * canal1v.at(i - 6) + canal1v.at(i - 12); } for (int j = 0; j < 32; ++j) { filtrado[j] = f[j]; } for (int i = 32; i < N; ++i) { filtrado[i] = 32 * f[i - 16] - (filtrado[i - 1] + f[i] - f[i - 32]); } long int s = 1, k = 1, x = samplesRate; double M, B, aux_rl; while (s < N) { if (x > N) x = N; if (s == 1) RegresionLineal(filtrado, &M, &B, s, (x + 0.5 * samplesRate)); else if ((x + 0.5 * samplesRate) >= N) RegresionLineal(filtrado, &M, &B, (s - 0.5 * samplesRate), x); else RegresionLineal(filtrado, &M, &B, (s - 0.5 * samplesRate), (x + 0.5 * samplesRate)); for (int i = s; i < x; ++i) { aux_rl = B + (M * i); lineal[i] = filtrado[i] - aux_rl; Caṕıtulo – A. Código Fuente 64 } s = k * samplesRate; x = s + samplesRate; k++; } for (long int i = 0; i < N; ++i) filtrado[i] = lineal[i]; for (int j = 0; j < N; ++j) { if (j < 4) { derivada[j] = 0; } else { derivada[j] = (2 * filtrado[j] + filtrado[j - 1] - filtrado[j - 3] - filtrado[j - 4]) / 8; } } for (int j = 0; j < N; ++j) { cuadrado[j] = derivada[j] * derivada[j]; } int tamVentana; double aux = 0.0; tamVentana = (150 * samplesRate) / 1000.0; for (int i = 0; i < N; i++) { if (i < tamVentana) { integrada[i] = cuadrado[i]; } else { for (int k = 1; k < tamVentana + 1; k++) { aux += (cuadrado[i - (tamVentana - k)]); } integrada[i] = aux; aux = 0.0; } } canal1v.clear(); delete f; delete lineal; DeteccionQRS(fs); deteccionIrregularidad(); Caṕıtulo – A. Código Fuente 65 anchoQRS(); Detector(); } void Calculo::RegresionLineal(double *sn, double *m, double *b, long inic, long fin) { double sumx, sum_sqx, sumy, sumxy; long n, i; sumx = 0; sum_sqx = 0; sumy = 0; sumxy = 0; n = fin - inic; for (i = inic; i < fin; i++) { sumx = sumx + i; sumy = sumy + sn[i]; sumxy = sumxy + (i * sn[i]); sum_sqx = sum_sqx + (i * i); } *m = (n * sumxy - sumx * sumy) / (n * sum_sqx - sumx * sumx); *b = (sumy - (*m) * sumx) / n; } double Calculo::getMayor(double *arreglo, int dimen) { mayor = arreglo[0]; for (int i = 0; i < dimen; ++i) { if (mayor < arreglo[i]) mayor = arreglo[i]; } return mayor; } double Calculo::getMenor(double *arreglo2, int dimen2) { menor = arreglo2[0]; for (int i = 0; i < dimen2; ++i) { if (menor > arreglo2[i]) menor = arreglo2[i]; } return menor; } Caṕıtulo – A. Código Fuente 66 void Calculo::DeteccionQRS(double j) { long int fs_floor, filtWin, slopeWin, k, first, last, maxPosFilt; double SPKI, NPKI, THRESHI, SPKF, NPKF, THRESHF, waitWin, maxNoDet, aux1, aux2; double maxSlope, lastSlope; long int i, z; QVector < double >SlopeR1; fs_floor = floor(j); double sumPoscDer = 0.0; long ventanaDerivada = 0; while (sumPoscDer < 400) { sumPoscDer += ((1 / fs) * 1000.0); ventanaDerivada++; } double maxI; maxI = getMayor(integrada, fs_floor); SPKI = maxI; NPKI = 0.01 * maxI; THRESHI = NPKI + 0.21 * (SPKI - NPKI); double maxF; maxF = getMayor(filtrado, fs_floor); SPKF = maxF; NPKF = 0.01 * maxF; THRESHF = NPKF + 0.21 * (SPKF - NPKF); waitWin = (200.0 / 1000.0) * fs; maxNoDet = 1.0 * fs; aux1 = (100.0 / 1000.0) * fs; filtWin = floor(aux1); aux2 = (50.0 / 1000.0) * fs; slopeWin = floor(aux2); lastSlope = 0; k = 0; int waitwin_floor = floor(-waitWin); beats.append(waitwin_floor); long x, y, num = 0; double promed1, RR_Average1, RR_LowLimit, RR_HighLimit; double auxpromed1, promed1amplitud, RR_AverageAmplitud1; Caṕıtulo – A. Código Fuente 67 double maxAmplFilt; int opcion = 0; RR_Average1 = maxNoDet; RR_LowLimit = 0.92 * RR_Average1; RR_HighLimit = 1.16 * RR_Average1; for (i = 1; i < N - 1; i++) { if ((i - beats.last()) > waitWin) { if ((integrada[i] > integrada[i - filtWin]) && (integrada[i] > integrada[i + filtWin])) { if (integrada[i] > THRESHI) { first = ((i - filtWin) < 0) ? 0 : (i - filtWin); last = ((i + filtWin) > N) ? (N - 1) : (i + filtWin); maxAmplFilt = filtrado[first]; for (x = first; x < last; x++) { if (maxAmplFilt < filtrado[x]) { maxAmplFilt = filtrado[x]; maxPosFilt = x; } } first = ((i - slopeWin) < 0) ? 0 : (i - slopeWin); last = ((i + slopeWin) > N) ? (N - 1) : (i + slopeWin); for (z = first, maxSlope = derivada[first]; z < last; z++) { if (maxSlope < derivada[z]) maxSlope = derivada[z]; } //ffor double aa, bb; long l; aa = (360.0 / 1000.0) * fs; bb = (360.0 / 1000.0) * fs; if ((filtrado[maxPosFilt] >= THRESHF) && (((maxPosFilt - beats.last()) > (aa)) || ((maxPosFilt - beats.last()) <= (bb) && maxSlope >= (0.85 * lastSlope))) ) { /*El condicional if verifica dos condiciones: 1) si el valor maximo de la se~nal es mayor al umbral y ocurre despues de 360ms 2) si el valor maximo de la se~nal es mayor al umbral y el latido encontrado ocurre antes de los 360ms, se evalua si tiene una pendiente pronunciada, es decir, si la pendiente es mayor a la mitad, si esto ocurre, se descarta que sea una onda T. */ Caṕıtulo – A. Código Fuente 68 l = maxPosFilt; long finDer, posNuevR; double maxDeriv; maxDeriv = derivada[maxPosFilt]; posNuevR = maxPosFilt; finDer = maxPosFilt - ventanaDerivada; if (finDer < (beats.last() + waitWin)) finDer = beats.last() + waitWin; for (long x3 = maxPosFilt; x3 > finDer; --x3) { if (maxDeriv < derivada[x3]) { maxDeriv = derivada[x3]; posNuevR = x3; } } //fforx3 if (maxDeriv > derivada[maxPosFilt]) { maxPosFilt = posNuevR; maxAmplFilt = filtrado [maxPosFilt]; maxSlope = maxDeriv; } beats.append(maxPosFilt); k = k + 1; num = beats.size() - 1; if (num >= 9) { for (y = 0, auxpromed1 = 0.0, promed1amplitud = 0.0; y < 8; y++, num--) { promed1 = (beats.at(num)) - (beats.at((num - 1))); auxpromed1 += promed1; promed1amplitud += filtrado[beats.at(num)]; } auxpromed1 = 0.125 * auxpromed1; RR_Average1 = (auxpromed1 / fs) * 1000; RR_AverageAmplitud1 = 0.125 * promed1amplitud; RR_LowLimit = 0.92 * auxpromed1; RR_HighLimit = 1.16 * auxpromed1; maxNoDet = RR_HighLimit; if (maxNoDet > (2.0 * fs)) maxNoDet = 1.0 * fs; } SPKI = 0.125 * integrada[i] + 0.875 * SPKI; SPKF = 0.125 * RR_AverageAmplitud1 + 0.875 * SPKF; Caṕıtulo – A. Código Fuente 69 NPKI = 0.125 * integrada[i] + 0.875 * NPKI; NPKF = 0.125 * filtrado[maxPosFilt] + 0.875 * NPKF; THRESHI = NPKI + 0.21 * (SPKI - NPKI); THRESHF = NPKF + 0.21 * (SPKF - NPKF); lastSlope = maxSlope; SlopeR1.append(lastSlope); } else { // fin de la condicion > 360ms o <360ms y pendiente del pico candidato a R mayor a la pendiente de onda T } } else { } } /*fin de verificacion de existencia de pico */ else { switch (opcion) { case 0: if ((i - beats.last()) > maxNoDet) { THRESHI = 0.5 * THRESHI; THRESHF = 0.5 * THRESHF; i = beats.last() + waitWin; opcion = 1; } break; case 1: if ((i - beats.last()) > maxNoDet) { THRESHI = THRESHI / 0.5; THRESHF = THRESHF / 0.5; i = beats.last() + waitWin; maxNoDet = 1.3 * RR_HighLimit; opcion = 2; } break; case 2: if ((i - beats.last()) > maxNoDet) { THRESHI = 0.25 * THRESHI; THRESHF = 0.25 * THRESHF; i = beats.last() + waitWin; opcion = 3; } break; case 3: if ((i - beats.last()) > maxNoDet) { THRESHI = THRESHI / 0.25; THRESHF = THRESHF / 0.25; i = beats.last() + 2.0 * waitWin; maxAmplFilt = derivada[i]; maxPosFilt = i; for (long y = i; y < (i + maxNoDet); ++y) { if (maxAmplFilt < derivada[y]) { maxAmplFilt = derivada[y]; maxPosFilt = y; } Caṕıtulo – A. Código Fuente 70 } maxAmplFilt = filtrado[maxPosFilt]; opcion = 4; } break; } //fin de swicth if (opcion == 4) { beats.append(maxPosFilt); k = k + 1; maxNoDet = RR_HighLimit; NPKI = 0.125 * integrada[maxPosFilt] + 0.875 * NPKI; NPKF = 0.125 * filtrado[maxPosFilt] + 0.875 * NPKF; THRESHI = NPKI + 0.21 * (SPKI - NPKI); THRESHF = NPKF + 0.21 * (SPKF - NPKF); SlopeR1.append(lastSlope); opcion = 0; } } } } tamanhoBeats = beats.size(); resultadoBeats = new int[tamanhoBeats]; int *data = beats.data(); for (int m = 0; m < tamanhoBeats; ++m) { resultadoBeats[m] = data[m]; } tamanhoSlope = SlopeR1.size(); SlopeR = new double[tamanhoSlope]; for (int ms = 0; ms < tamanhoSlope; ++ms) { SlopeR[ms] = SlopeR1.at(ms); } } void Calculo::deteccionIrregularidad() { double dt; QVector < double >aux_Int_RR; QVector < int >aux_Posic_latido_irreg; QVector < long >aux_posic_Int_RR; dt = 1 / fs; tiempMuestr = dt * 1000; double promd = 0.0, promd2 = 0.0, aux_muestra2 = 0.0, muestras2 = 0.0, compara2, compara, tiemp2, tiemp, muestras = 0.0, aux_muestra = 0.0; int ind; for (int i = 2; i < tamanhoBeats - 1; i++) { if (i < 9) { aux_muestra = beats.at(i) - beats.at(i - 1)) * tiempMuestr; Caṕıtulo – A. Código Fuente 71 muestras = aux_muestra + muestras; if (i == 8) { promd = (muestras) / 8; tiemp = (beats.at(i + 1) - beats.at(i)) * tiempMuestr; compara = promd - tiemp; if (compara < 0) { //Diferencia positiva compara = (-1) * compara; } } } else { for (int k = 2; k < 8 + 1; k++) { ind = i - (8 - k); aux_muestra2 = (beats.at(ind) - beats.at(ind - 1)) * tiempMuestr; muestras2 = aux_muestra2 + muestras2; } promd2 = (muestras2) / 8; tiemp2 = (beats.at(i + 1) - beats.at(i)) * tiempMuestr; compara2 = promd2 - tiemp2; if (compara2 < 0) { compara2 = (-1) * compara2; } promd2 = 0.0; aux_muestra2 = 0.0; muestras2 = 0.0; compara2 = 0.0; tiemp2 = 0.0; } } double TiempRR = 0.0, aux_Tiem_RR = 0.0, auxFrec; for (int a = 2; a < tamanhoBeats; a++) { aux_Tiem_RR = (beats.at(a) - beats.at(a - 1)) * tiempMuestr; if (aux_Tiem_RR < 0) { aux_Tiem_RR = (-1) * aux_Tiem_RR; } aux_Int_RR.append(aux_Tiem_RR); aux_posic_Int_RR.append(beats.at(a)); } tamanhoRR = aux_Int_RR.size(); Int_RR = new double[tamanhoRR]; posic_Int_RR = new long[tamanhoRR]; posic_Irregularidad = new int[tamanhoRR]; frecuenciaTV.reserve(tamanhoRR); frecuenciaTV.fill(0, tamanhoRR); double *data = aux_Int_RR.data(); for (int m = 0; m < tamanhoRR; ++m) { Int_RR[m] = data[m]; } for (long m2 = 0; m2 < tamanhoRR; ++m2) { posic_Int_RR[m2] = aux_posic_Int_RR.at(m2); posic_Irregularidad[m2] = 0; } Caṕıtulo – A. Código Fuente 72 for (int r = 1; r < tamanhoRR; r++) { TiempRR = (Int_RR[r] - Int_RR[r - 1]); if (TiempRR < 0) { TiempRR = (-1) * TiempRR; } if (TiempRR > 50) { posic_Irregularidad[r] = 1; } auxFrec = (60000 / Int_RR[r]); if ((auxFrec) > 100) { frecuenciaTV.replace(r, 1); } } int k = 1; double numIrreg = 0; while (k < tamanhoRR - 1) { if (posic_Irregularidad[k] == 1 && posic_Irregularidad[k - 1] == 1 && posic_Irregularidad[k + 1] == 1 /* && posic_Irregularidad[k+2] == 1 */ ) { aux_Posic_latido_irreg.append(k); numIrreg = numIrreg++; k++; } else { k++; } } tamnhoPosicIrrg = aux_Posic_latido_irreg.size(); Posic_todo_latido_irreg = new int[tamnhoPosicIrrg * 3]; int *data2 = aux_Posic_latido_irreg.data(); int z = 1, s = 0, m, e; while (z < (tamnhoPosicIrrg * 3)) { m = z; if (s < tamnhoPosicIrrg) { e = aux_Posic_latido_irreg.at(s); Posic_todo_latido_irreg[m - 1] = resultadoBeats[e - 1]; Posic_todo_latido_irreg[m] = resultadoBeats[e]; Posic_todo_latido_irreg[m + 1] = resultadoBeats[e + 1]; z = z + 3; s++; } } double tiempIrreg, a2; for (int a = 0; a < tamnhoPosicIrrg; ++a) { a2 = Posic_todo_latido_irreg[a] / fs; tiempIrreg = a2 / 60; } if (numIrreg > 0) { promedio_Irregularidades = 1; } else { promedio_Irregularidades = 0; } } Caṕıtulo – A. Código Fuente 73 void calculos::anchoQRS() { long posic, x, posic2, xq, temp, tamVentana1 = 0, tamVentana15 = 0, tamVentana40 = 0, min, finS, finQ, numTV; double aux, auxQ, auxS, sumTiemp = 0; long k = 0, t = 0, q = 0; QVector < long >aux_Posic_TV; ondaS = new double[tamanhoBeats - 1]; ondaQ = new double[tamanhoBeats - 1]; posicionS = new long[tamanhoBeats - 1]; posicionQ = new long[tamanhoBeats - 1]; anchQRS = new double[tamanhoBeats - 1]; QRS_ancho = new long[tamanhoBeats - 1]; double dt = 1 / fs; for (int q = 0; q < tamanhoBeats - 1; ++q) { posicionS[q] = 0; posicionQ[q] = 0; ondaQ[q] = 0; ondaS[q] = 0; } sumTiemp = 0; tamVentana1 = 0; while (sumTiemp < 150) { sumTiemp = tiempMuestr + sumTiemp; tamVentana1++; } sumTiemp = 0; tamVentana15 = 0; while (sumTiemp < 15) { sumTiemp = tiempMuestr + sumTiemp; tamVentana15++; } sumTiemp = 0; tamVentana40 = 0; while (sumTiemp < 40) { sumTiemp = tiempMuestr + sumTiemp; tamVentana40++; } for (long t = 0; t < tamanhoBeats - 1; ++t) { posic = resultadoBeats[t]; finS = posic + tamVentana1; for (long s = posic; s < finS; ++s) { if (derivada[s] < 0) { ondaS[t] = derivada[s]; posicionS[t] = s; for (min = s; min < (s + tamVentana40); min++) { if (derivada[min] < ondaS[t]) { ondaS[t] = derivada[min]; posicionS[t] = min; } } break; } } } for (long q = 0; q < tamanhoBeats - 1; q++) { Caṕıtulo – A. Código Fuente 74 posic2 = resultadoBeats[q]; auxQ = posic2 - tamVentana1; if (auxQ < 0) { finQ = 0; } else { finQ = auxQ; } for (long l = posic2; l > (finQ); --l) { if (derivada[l] < 0) { ondaQ[q] = derivada[l]; posicionQ[q] = l; for (min = l; min > (l - tamVentana15); min--) { if (derivada[min] < ondaQ[q]) { ondaQ[q] = derivada[min]; posicionQ[q] = min; } } break; } } } for (long k = 0; k < tamanhoBeats - 1; ++k) { QRS_ancho[k] = 0; anchQRS[k] = 0; } for (long j = 0; j < tamanhoBeats - 1; ++j) { if ((posicionS[j] == 0) || (posicionQ[j] == 0)) { if ((posicionS[j] == 0) && (posicionQ[j] == 0)) { anchQRS[j] = 200; } else if ((posicionS[j] != 0) && (posicionQ[j] == 0)) { anchQRS[j] = 2 * ((posicionS[j] - resultadoBeats[j]) * tiempMuestr); } else if ((posicionS[j] == 0) && (posicionQ[j] != 0)) { anchQRS[j] = 2 * ((resultadoBeats[j] - posicionQ[j]) * tiempMuestr); } } else { temp = posicionS[j] - posicionQ[j]; anchQRS[j] = (tiempMuestr * temp); } } for (long k2 = 0; k2 < tamanhoBeats - 1; ++k2) { if (anchQRS[k2] > 120) { QRS_ancho[k2] = 1; } } long an = 1; while (an < tamanhoBeats - 1) { if (QRS_ancho[an] == 1 && QRS_ancho[an - 1] == 1 && QRS_ancho[an + 1] == 1) { aux_Posic_TV.append(an); numTV = numTV++; an = an + 2; } else { an++; } } tamanhoPTV = aux_Posic_TV.size(); Caṕıtulo – A. Código Fuente 75 posicion_TV = new long[tamanhoPTV * 3]; long aux4, z1 = 1, s = 0, m; long *data3 = aux_Posic_TV.data(); while (z1 < (tamanhoPTV * 3)) { m = z1; if (s < tamanhoPTV) { aux4 = data3[s]; posicion_TV[m - 1] = resultadoBeats[aux4 - 1]; posicion_TV[m] = resultadoBeats[aux4]; posicion_TV[m + 1] = resultadoBeats[aux4 + 1]; z1 = z1 + 3; s++; } } /* Si se encuentran al menos, 1 complejos QRS, con una duración > 120 ms, se asigna 1, porque es indicativo de la existencia de una TV no sostenida */ if (numTV > 0) { promedio_SIhayTV = 1; } else { promedio_SIhayTV = 0; } } double calculos::ausenciaP() { long pos, pos3, fin, pos_aux = 0, ventana = 0, aux_p, *temporal, aux3, pikP, ventanaP = 0, posR, ventana2 = 0, ventanaSalto1 = 0, ventanaSalto2 = 0; double maxP, tPd, tBd, sumTiempM = 0.0, maxpikP = 0.0, sumTiemp2 = 0.0, IntRRp, sumTiemp3 = 0.0; QVector < long >pos_aux_P; QVector < long >posicion_hayP; QVector < double >vector_promedioPendientP; QVector < long >R_quetiene_P; hay_p = new long[tamanhoBeats - 1]; while (sumTiempM < 200) { //Ventana del segmento P-Q de 200ms sumTiempM += tiempMuestr; ventana2++; } sumTiemp3 = 0.0; ventanaSalto1 = 0; while (sumTiemp3 < 10) { sumTiemp3 += tiempMuestr; ventanaSalto1++; } sumTiemp3 = 0.0; ventanaSalto2 = 0; while (sumTiemp3 < 30) { sumTiemp3 += tiempMuestr; ventanaSalto2++; } while (sumTiemp2 < 95) { sumTiemp2 += tiempMuestr; ventanaP++; } double pendienteP = 0.0, promedioPendientP; Caṕıtulo – A. Código Fuente 76 long nroVeces = 0, fin2; for (long p3 = 0; p3 < tamanhoBeats - 1; ++p3) { posR = resultadoBeats[p3 + 1]; if (p3 > 0) { sumTiemp3 = 0.0; ventanaSalto1 = 0; double ind3 = 0.5 * anchQRS[p3]; while (sumTiemp3 < ind3) { sumTiemp3 += tiempMuestr; ventanaSalto1++; } ventanaSalto2 = ventanaSalto1; if (posicionQ[p3] == 0) { pos3 = resultadoBeats[p3] - ventanaSalto2; } else { pos3 = posicionQ[p3] - ventanaSalto1; pos3 = resultadoBeats[p3] - ventanaSalto2; } IntRRp = (resultadoBeats[p3] - resultadoBeats[p3 - 1]) * tiempMuestr; if (((IntRRp - 360) < 200) && ((IntRRp - 360) > 0)) { sumTiempM = 0.0; ventana = 0; while (sumTiempM < (IntRRp - 360)) { sumTiempM += tiempMuestr; ventana++; } } else { ventana = ventana2; } long aux_p = pos3 - ventana; fin = (aux_p < 0) ? 0 : aux_p; double maxpikP3 = filtrado[pos3]; pikP = 0; for (long j2 = pos3; j2 > fin; --j2) { if (maxpikP3 < filtrado[j2]) { maxpikP3 = filtrado[j2]; pikP = j2; } } long finAtras = (pikP - ventanaP); double derivadaPatras, derivadaPadelante, pendMax; long la, ld; if (pikP != 0) { la = 0; for (long atras = pikP; atras > finAtras; --atras) { if ((((derivada[atras] + derivada[atras - 1] + derivada[atras - 2]) - (derivada[atras - 2] + derivada[atras - 3] + derivada[atras - 4])) < 0)) { derivadaPatras = derivada[atras]; la = atras; break; Caṕıtulo – A. Código Fuente 77 } } if (la == 0) derivadaPatras = 0.0; long finAdelante = pikP + ventanaP; ld = 0; for (long adelante = pikP; adelante < finAdelante; ++adelante) { if ((((derivada[adelante] + derivada[adelante + 1] + derivada[adelante + 2]) - (derivada[adelante + 2] + derivada[adelante + 3] + derivada[adelante + 4])) < 0.0)) { derivadaPadelante = derivada[adelante]; ld = adelante; break; } } if (ld == 0) derivadaPadelante = 0.0; double tiempoP, maxpendAtras; long posmaxpendAtras, posmaxpendAdelante, maxpendAdelante; if ((la != 0) && (ld == 0)) { tiempoP = 2.0 * (pikP - la) * tiempMuestr; if ((tiempoP > 30) && (tiempoP < 160)) { maxpendAtras = cuadrado[pikP]; for (long j5 = pikP; j5 > la; --j5) { if (maxpendAtras < cuadrado[j5]) { maxpendAtras = cuadrado[j5]; posmaxpendAtras = j5; } } maxpendAdelante = maxpendAtras; pendMax = maxpendAdelante; } } if ((la == 0) && (ld != 0)) { tiempoP = 2.0 * (ld - pikP) * tiempMuestr; if ((tiempoP > 30) && (tiempoP < 160)) { maxpendAdelante = cuadrado[pikP]; for (long j6 = pikP; j6 < ld; ++j6) { if (maxpendAdelante < cuadrado[j6]) { maxpendAdelante = cuadrado[j6]; posmaxpendAdelante = j6; } } maxpendAtras = maxpendAdelante; pendMax = maxpendAtras; } } if ((la != 0) && (ld != 0) && (la != ld)) { tiempoP = (ld - la) * tiempMuestr; Caṕıtulo – A. Código Fuente 78 if ((tiempoP > 30) && (tiempoP < 160)) { maxpendAtras = cuadrado[pikP]; for (long j5 = pikP; j5 > la; --j5) { if (maxpendAtras < cuadrado[j5]) { maxpendAtras = cuadrado[j5]; posmaxpendAtras = j5; } } maxpendAdelante = cuadrado[pikP]; for (long j6 = pikP; j6 < ld; ++j6) { if (maxpendAdelante < cuadrado[j6]) { maxpendAdelante = cuadrado[j6]; posmaxpendAdelante = j6; } } pendMax = maxpendAdelante; double auxpromedioPendientP; long nroVeces2, posP; posP = vector_promedioPendientP.size() - 1; if (posP >= 9) { nroVeces2 = 0; auxpromedioPendientP = 0.0; for (long y2 = 0; y2 < 8; y2++, posP--) { auxpromedioPendientP += vector_promedioPendientP.at(posP); nroVeces2++; } promedioPendientP = auxpromedioPendientP / nroVeces2; } } } if (((tiempoP > 30) && (tiempoP < 160)) && ((la != 0) || (ld != 0))) { pos_aux_P.append(pikP); posicion_hayP.append(p3); vector_promedioPendientP.append(pendMax); R_quetiene_P.append(posR); } } } } tamanhoP = pos_aux_P.size(); posicionP = new long[tamanhoP]; temporal = new long[tamanhoP]; long *dataP = pos_aux_P.data(); for (long m = 0; m < tamanhoP; ++m) { posicionP[m] = dataP[m]; } for (long x = 0; x < tamanhoBeats - 1; ++x) { hay_p[x] = 0; } long *data_hay = posicion_hayP.data(); for (long st = 0; st < tamanhoP; ++st) { temporal[st] = data_hay[st]; } for (long u = 0; u < tamanhoP; ++u) { Caṕıtulo – A. Código Fuente 79 aux3 = temporal[u]; hay_p[aux3] = 1; } for (long x = 0; x < tamanhoBeats - 1; ++x) { if (hay_p[x] != 0) { tPd++; } } long indPP; binarioP = new long[N]; for (long y1 = 0; y1 < N; ++y1) { binarioP[y1] = 0; } for (long y2 = 0; y2 < tamanhoP; ++y2) { indPP = posicionP[y2]; binarioP[indPP] = 1; } OndaP_IntRR = new int[tamanhoRR]; for (int x2 = 0; x2 < tamanhoRR; ++x2) { OndaP_IntRR[x2] = 0; } long esta; for (int yy = 0; yy < (R_quetiene_P.size()); ++yy) { //(8) esta = R_quetiene_P.at(yy); for (int m2 = 0; m2 < tamanhoRR; ++m2) { if (esta == posic_Int_RR[m2]) { //(7) OndaP_IntRR[m2] = 1; } } } /* Se deberia calcular un promedio, algo asi como el numero de ondas P entre numero de picos R y esa salida, si es 1, significa que no hay ausencia de onda P */ tBd = tamanhoBeats - 1; promedio_SIhayP = tPd / tBd; return promedio_SIhayP; } void calculos::Detector() { long tempTV, tempFA, tempSano; bool hayTV = 0, hayFA = 0; double frecTV, frecTV2; detecciones = new long[tamanhoRR]; QVector < long >TVNS_temp; QVector < long >FAP_temp; for (long z1 = 0; z1 < tamanhoRR; ++z1) { detecciones[z1] = 0; } //*************** TV ************** if (hayTV == 0) { for (long z2 = 1; z2 < tamanhoBeats - 1; ++z2) { if ((QRS_ancho[z2] == 1) && (QRS_ancho[z2 - 1] == 1) && (QRS_ancho[z2 + 1] == 1)) { TVNS_temp.append(z2); hayTV = 1; } } Caṕıtulo – A. Código Fuente 80 for (long z3 = 0; z3 < TVNS_temp.size(); ++z3) { tempTV = TVNS_temp.at(z3); frecTV = 60000 / ((resultadoBeats[tempTV] - resultadoBeats[tempTV - 1]) * tiempMuestr); frecTV2 = 60000 / ((resultadoBeats[tempTV + 1] - resultadoBeats[tempTV]) * tiempMuestr); if ((frecTV > 100) || (frecTV2 > 100)) { detecciones[tempTV] = 1; } } } //***** FA ***************** if ((hayFA == 0)) { //(b) ausenciaP(); for (long z4 = 1; z4 < tamanhoRR; ++z4) { detecciones[z4] = 1; hayFA = 1; } } } } for (long z4 = 1; z4 < tamanhoBeats - 1; ++z4) { if ((hay_p[z4] == 1) && (hay_p[z4 + 1] == 1) && (hay_p[z4 - 1] == 1)) { FAP_temp.append(z4); tempFA; OndaP_IntRR[i] == 1; posic_Irregularidad[r] = 1; if ((OndaP_IntRR[z2 - 1] == 1 && OndaP_IntRR[z2] == 1 && OndaP_IntRR[z2 + 1] == 1) && posic_Int_RR[z2]) { detecciones[z2] = 1; } //***** sanos ***************** if ((hayTV == 0) && (hayFA == 0)) { qDebug() << "ES SANO!!!\n"; } } 81 Bibliograf́ıa [1] Pocock, G. ; Richards, D.C. : Fisioloǵıa Humana: la base de la medicina Editorial Masson, 2da. Edición, año 2005 [2] Koolman, J. ; Röhm , K.H. : Bioqúımica: Textos y Atlas Editorial Médica Panamericana, 3ra. Edición, Pag. 274, año 2004 [3] Prieto, J. ; Gal, B. : Bases de la Fisioloǵıa Editorial Tebar, 2da. Edición, Pag. 95. [4] Castellano, C. ; Perez de Juan, M. ; Attie, F. : Electrocardiograf́ıa Cĺınica Editorial Elsevier, 2da. Edición, Pag. 9-14,16-203,año 2004 [5] Almeida, F. ; Deyanira : Manual de Arritmias Card́ıacas CDHC-UCV, Pag. 145, año 2004 [6] Huszar, R. : Arritmias: Principios, Interpretación y Tratamiento Editorial Elsevier, 3ra. Edición, Pag. 7-21, año 2002 [7] Gutiérrez, O. ; Araya, V. : Manual de Arritmias Cardiacas: Gúıa diagnóstica Terapéutica Editorial de la Universidad de Costa Rica, 1ra. Edición, Pag. 11-12,93, año 2002 [8] Duque, M. ; Vesga, B. : Electrocardiograf́ıa Sociedad Colombiana de Cardio- loǵıa y Ciruǵıa Cardiovascular, 1ra. Edición, Pag. 14–19, año 2008 [9] López, G.L. : Semioloǵıa Cardiovascular 5ta. Edición, Pag. 18-19, año 1999 [10] Palastanga, N. ; Field, D. : Anatomı́a y Movimiento Humano, Estructura y Funcionamiento Editorial Paidotribo, 3ra. Edición, año 2000 Bibliograf́ıa 82 [11] Braunwald, E. : Tratado de Cardioloǵıa Editorial McGraw-Hill Interamerica, Vol. 1, 5ta. Edición, Pag. 599, año 1999 [12] Fuster, V. ; Wayne, R. : HURST: El corazón Editorial McGraw-Hill Inter- america, Vol. 1, 10ma. Edición, Pag. 767 [13] Butler, H. : Como leer un electrocardiograma Editorial Para los médicos, año 1981 [14] Mendis, S. ; Puska P. : Global Atlas on Cardiovascular Diseases Prevention and Control Published by the World Health Organization in collaboration with the World Heart Federation and the World Stroke Organization, Pag. 58, año 2011 [15] Argente, A.H. ; Álvarez, E.M. : Semioloǵıa Médica: fisiopatoloǵıa, se- miotecnia y propedéutica. Enseñanza basada en el paciente Editorial Médica Pan- americana, año 2005 [16] Fernández, V.A. ; López, J. : Fisioloǵıa del ejercicio Editorial Médica Panamericana, 3ra. Edición, Pag. 442-443, año 2006 [17] Armada, F. ; Curcio, P. : Anuario de Mortalidad de Venezuela 2011 Minis- terio del poder popular para la salud, Pag. 10, año 2014 [18] Pan, J. ; Tompkins, W.J. : A Real-Time QRS Detection Algorithm IEEE Transactions on Biomedical Engineering, Vol. BME-32, No. 3, March 1985 [19] Isasi, P. ; Galvan, I. : Redes de Neuronas Artificiales: Un Enfoque Práctico Editorial Pearson Educación, año 2004 [20] Serrano, A.J. ; Soria, E. ; Martin, J.D. : Redes Neuronales Artificiales OCW de la Universitat de Valencia, 3er. Ciclo , año 2009 [21] Sotos, J.M. ; Rieta, J.J. : Aplicación de Redes Neuronales Artificiales en el Procesado Versátil de Señales Electrocardiográficas Universidad Politécnica de Valencia, Julio 2012 [22] Kendall, E.K. ; Kendall, J. : Análisis y diseño de sistemas Editorial Pear- son Educación, 6ta. Edición, año 2005 [23] Ledezma, C. : Pan and Tompkins Detector http://gbbanet.labc.usb.ve/toolbox.php Bibliograf́ıa 83 [24] Bustamante, L. ; Guevara ; Migliore ; Roisinblit : Ecocardiograf́ıa: para la toma de decisiones cĺınicas Editorial Médica Panamericana, Julio 2005 [25] Hinojosa, S. : Detector de QRS basado en el algoritmo de Pan y Tompkins Señales e Imagenes en Biomedicina, 1er. Cuatrimestre, año 2011 [26] Reina, M. : Diseño y Análisis de Confiabilidad de un Algoritmo para la Detec- ción de Fibrilación Auricular Universidad Simon Bolivar, Febrero 2006 [27] Perez, N. ; Curcio, P. : Republica Bolivariana de Venezuela Anuario de Mortalidad 2012 Ministerio del Poder Popular para la Salud, Pag. 6, Septiembre 2014 [28] Meissimilly, G. : Filtros con Coeficientes Potencias de 2: Una Alternativa para Suprimir el Ruido de la Señal ECG en Tiempo Real Usando Microprocesadores de Propósito General Instituto Central de Investigación Digital, año 2002 [29] Gonzales, M. ; Casillas, J. : Reducción de ruido digital en señales ECG utilizando filtraje por convolución Investigación y ciencia de la Universidad de Autónoma de Aguascalientes, No. 40, Enero-Abril 2008 [30] Goldberger, AL.; Amaral, LAN.; Glass, L.; Hausdorff, JM. : Phy- sioBank, PhysioToolkit, and PhysioNet: Components of a New Research Resource for Complex Physiologic Signals Circulation 101(23):e215-e220, June 13 2000 [31] Tomasi, W. : Sistemas de comunicaciones electrónicas Editorial Prentice Hall, 4ta. Edición, año 2003 Índice de figuras Índice de cuadros Resumen Introducción Planteamiento del problema Planteamiento del Problema Objetivo General Objetivos Específicos Alcance Justificación El Corazón Anatomía y Funcionalidad del Corazón Ciclo Cardíaco Sistema de Conducción Cardíaca Alteraciones del Ritmo Cardiaco Arritmias Tipos de Arritmias Arritmias Supraventriculares Arritmias Ventriculares Fibrilación Auricular Taquicardia Ventricular Pruebas Diagnóstico para la Detección de Arritmias Prueba de Esfuerzo Registro Electrocardiográfico de Largo Plazo Derivaciones del Electrocardiógrafo Derivaciones unipolares Derivaciones bipolares Holter Ruido Algoritmo especializado Algoritmos de Detección del QRS Filtro Pasa Banda Filtro Pasa Bajos Filtro Pasa Altos Derivación Función Cuadrática Ventana Móvil Integradora Fase de Detección Umbrales Adaptativos Metodología Base de Datos del Instituto de Medicina Tropical, Departamento de Cardiología de la UCV Base de Datos del MIT-BIH Normal Sinus Rhythm Databases Desarrollo de la Solución Algoritmo de Extracción de Características Detección de los Parámetros Característicos Identificación de Patrones Resultados y Discusión Evaluación de las Pruebas Diagnósticas Efectividad Eficiencia Verdaderos Positivos(VP): Falsos Negativos(FN): Verdaderos Negativos(VN): Falsos Positivos(FP): Sensibilidad o Tasa de Verdaderos Positivos: Especificidad o Tasa de Verdaderos Negativos: Exactitud: Análisis de Resultados Registros con Presencia de Patrones de TVNS Registros con Presencia de Patrones de FAP Registros Control Conclusiones y Trabajos Futuros Trabajos Futuros Acrónimos Código Fuente Referencias Bibliográficas