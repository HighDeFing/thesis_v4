Microsoft Word - TEG LUIS LESSEY FINAL 2 Universidad Central de Venezuela Facultad de Ciencias Escuela de Computación Laboratorio de Comunicación y Redes Propuesta para la Implementación de un Servicio de Televisión utilizando Multicast en la Facultad de Ciencias Trabajo Especial de Grado presentado ante la Ilustre Universidad Central de Venezuela por el Bachiller: Luis Lessey C.I.: 17.077.454 E-mail: personal330@hotmail.com Tutor: Eric Gamess Caracas, Octubre 2015 2 3 4 5 Agradecimientos A Dios por haberme dado la fortaleza y sabiduría necesaria para culminar esta larga e importante etapa de mi vida. Que los que me ven, te vean a ti Señor. “Bienaventurado el varón que soporta la tentación; porque cuando haya resistido la prueba, recibirá la corona de vida, que Dios ha prometido a los que le aman.” Santiago (1:12) A mi Esposa por su amor incondicional. Siempre a mi lado en éste camino cuidando de la familia y mostrando ejemplo de alegría ante las dificultades y adversidades. Tu felicidad es la mía. Gracias por tanto mi pedacito de cielo. Ahora vamos con tu tesis. Te amo infinitamente. DVGNAE. A mi hijo Luis Rafael, por su futuro. Siempre se puede alcanzar una meta sólo hay que seguir adelante siendo perseverante. Gracias por recordarme siempre que aprendes de mí y debo darte el ejemplo. Te amo. A mi Madre por los años invertidos en mi formación, porque te lo debía, porque te lo mereces, eso y mucho más, gracias a tu ejemplo y que a tus 55 años terminaste la licenciatura, me animaste a terminar mi carrera y aquí está el papelito que te prometí. Es también tuyo! PD: Déjame copia!. A mi Padre que fue ejemplo constante en casa de perseverancia manteniendo unida a la familia y llevando 37 años de servicio sobre su espalda para ayudarnos a salir adelante, también te lo mereces, eso y mucho más, gracias a tu ejemplo. A mis abuelos, Luis Humberto (†), Terry Luis (†), Carmen, Isbelia porque fueron pilar fundamental en los valores inculcados. Gracias porque siempre estuvieron presentes y unidos como familia. A mi tutor y profesor Eric Gamess, por acompañarme en este largo recorrido hasta la finalización de lo que resultó ser un maravilloso proyecto. Gracias por sus conocimientos y apoyo, por la orientación y por su inmensa paciencia. Gracias por el buen ambiente que mantiene en LACORE para sus tesistas y por permitirme compartir con el grupo docente del área en lo humano y académico. Dios bendice su labor, infinitas gracias!. A mis familiares y amigos, todo el que de una u otra forma colaboró en el Trabajo Especial de Grado, es tanto el agradecimiento que faltaría papel para expresárselos. 6 7 Universidad Central de Venezuela Facultad de Ciencias Escuela de Computación Laboratorio de Comunicación y Redes TRABAJO ESPECIAL DE GRADO Título: Propuesta para la Implementación de un Servicio de Televisión utilizando Multicast en la Facultad de Ciencias. Autor: Luis O. Lessey V. Unidad de Investigación: LACORE. Palabras Claves: Multicast, Streaming de Video, Transcoding, IGMPv2, PIM-SM. Tutor: Eric Gamess. Fecha de Presentación: Octubre 2015. Resumen El objetivo del presente Trabajo Especial de Grado es investigar los requerimientos necesarios para habilitar un servicio de televisión utilizando multicast para la Facultad de Ciencias de la Universidad Central de Venezuela. Esta investigación se basa en el estudio de la tecnología multicast, su infraestructura y configuración necesaria. Inicia con un proceso de investigación de la tecnología multicast contemplando su origen, evolución e interacción con los nuevos estándares de comunicación IP. Posteriormente, en base a dicha investigación, se propone una infraestructura de red que abarca protocolos, estándares, tecnologías y equipos necesarios para implementar un servicio de televisión utilizando multicast. El protocolo de enrutamiento multicast utilizado es PIM-SM, definido formalmente en un RFC y adoptado por las principales compañías fabricantes de dispositivos de red. Por otra parte, para el servicio de televisión, y tras una investigación de las aplicaciones disponibles, se utilizó Microsoft Expression Encoder para el servidor de transcoding y VLC Player para el servidor multicast. Existe también un servicio web (tv.ciens.ucv.ve) con la dirección de dominio reservada en los servidores DNS de la universidad. Este trabajo difunde seis streamings, de los cuales dos corresponden a capturas tiempo real con decodificadores CANTV y los otros cuatro a contenido pregrabado (hilos de películas) que se transmiten para la Facultad de Ciencias. 8 9 Tabla de Contenidos Lista de Figuras ............................................................................................................. 11 Lista de Tablas .............................................................................................................. 13 1. Introducción ........................................................................................................... 15 2. Planteamiento del Problema ................................................................................. 17 2.1 Justificación del Problema .......................................................................................................... 17 2.2 Objetivos ..................................................................................................................................... 18 2.2.1 Objetivo General ..................................................................................................................... 18 2.2.2 Objetivos Específicos ............................................................................................................... 18 2.3 Antecedentes .............................................................................................................................. 18 3. Marco Teórico ........................................................................................................ 23 3.1 Internet Protocol Version 4 ......................................................................................................... 23 3.2 Direccionamiento en IPv4 ........................................................................................................... 23 3.3 Unicast sobre IPv4 ....................................................................................................................... 24 3.4 Broadcast sobre IPv4 ................................................................................................................... 24 3.5 Multicast sobre IPv4 .................................................................................................................... 25 3.5.1 Direcciones MAC Multicast ..................................................................................................... 27 3.5.2 Correspondencia de IPv4 y MAC en Multicast ........................................................................ 28 3.5.3 Internet Group Management Protocol ................................................................................... 28 3.5.4 Enrutamiento Multicast .......................................................................................................... 34 3.6 Calidad de Servicio en IPv4 ......................................................................................................... 41 3.6.1 Real‐Time Transport Protocol ................................................................................................. 43 3.6.2 Real Time Streaming Protocol ................................................................................................ 45 3.7 Televisión sobre IP ...................................................................................................................... 47 3.7.1 Televisión Analógica ............................................................................................................... 47 3.7.2 Televisión Digital Abierta ........................................................................................................ 48 3.7.3 Diferencias entre TV Analógica y Digital ................................................................................. 51 3.7.4 Formatos de Compresión de Video ......................................................................................... 54 3.7.5 Formato de Encapsulación de Audio y Video .......................................................................... 58 4. Marco Metodológico .............................................................................................. 61 4.1 Red Actual de la Facultad de Ciencias ......................................................................................... 61 4.2 Infraestructura para una Transmisión Multicast ........................................................................ 61 4.2.1 Captura de la Señal de Televisión ........................................................................................... 63 4.2.2 Servidor de Transcoding ......................................................................................................... 70 4.2.3 Servidor Multicast ................................................................................................................... 75 4.2.4 Infraestructura de Red ............................................................................................................ 80 4.2.5 Aplicación de los Clientes ........................................................................................................ 81 5. Conclusiones ......................................................................................................... 93 Recomendaciones ........................................................................................................ 95 Referencias Bibliográficas ........................................................................................... 97 10 11 Lista de Figuras Figura 2.1: Topología de Red de MBone en 1994 .......................................................... 19 Figura 2.2: Arquitectura virtPresenter del Proyecto Opencast Matterhorn ..................... 22 Figura 3.1: Formato de la Cabecera IPv4 ....................................................................... 23 Figura 3.2: Formato Dirección IPv4 Clase D ................................................................... 24 Figura 3.3: Comunicación Unicast ................................................................................. 24 Figura 3.4. Dirección IPv4 Broadcast Dirigido ................................................................ 25 Figura 3.5: Broadcast Limitado ....................................................................................... 25 Figura 3.6: Implementación de Multicast a Nivel de Aplicación ...................................... 26 Figura 3.7: Implementación de Multicast Explícito .......................................................... 27 Figura 3.8: Formato de Direcciones MAC Multicast ........................................................ 27 Figura 3.9: Correspondencia Multicast entre IPv4 y MAC .............................................. 28 Figura 3.10: Encapsulamiento de IGMP ......................................................................... 28 Figura 3.11: Formato de Mensaje IGMPv1 ..................................................................... 29 Figura 3.12: Formato de Mensaje IGMPv2 ..................................................................... 30 Figura 3.13: Formato de Mensaje Membership Query con IGMPv3 ............................... 31 Figura 3.14: Formato de Mensaje Membership Report en IGMPv3 ............................... 32 Figura 3.15: Formato Interno Group Record de un Membership Report ........................ 33 Figura 3.16: Gestión desde el Router con CGMP ........................................................... 34 Figura 3.17: Filtrado de Membership Reports con IGMP Snooping ............................... 34 Figura 3.18: Árbol de Camino más Corto (SPT) ............................................................. 35 Figura 3.19: Árbol de Distribución Compartida ............................................................... 35 Figura 3.20: Éxito y Fallo de RPF Check ........................................................................ 37 Figura 3.21: Cabecera de Mensajes de Control PIM ...................................................... 37 Figura 3.22: Formato de Mensaje PIM Hello .................................................................. 38 Figura 3.23: Formato de Mensaje Join/Prune ................................................................. 40 Figura 3.24: Formato de Mensaje PIM Register ............................................................. 41 Figura 3.25: Formato de Mensaje PIM Register Stop ..................................................... 41 Figura 3.26: Formato de Cabecera RTP ......................................................................... 43 Figura 3.27: Televisión según sus Fases ........................................................................ 49 Figura 3.28: Campo Visual en los Formatos 4:3 y 16:9 .................................................. 53 Figura 3.29: Técnicas de Relleno de Imagen Pillarbox y Letterbox ................................ 53 Figura 3.30: Diferencias de Señal Entrelazada y Progresiva .......................................... 54 Figura 4.1: Extracto de la Red Corporativa de la UCV ................................................... 61 Figura 4.2: Infraestructura para una Transmisión Multicast ............................................ 62 Figura 4.3: Antena de Televisión Conejo Doble Aro ....................................................... 63 Figura 4.4: Decodificador Echostar DSB-646V de Movistar ........................................... 64 Figura 4.5: Tarjeta de Acceso Decodificador Movistar ................................................... 64 Figura 4.6: Antena Parabólica Movistar TV .................................................................... 65 Figura 4.7: Decodificador Konka KHDS866 PVR-R de CANTV ..................................... 65 Figura 4.8: Decodificador Huawei DS360 de CANTV ..................................................... 65 Figura 4.9: Antena Parabólica CANTV Televisión Satelital ............................................ 66 Figura 4.10: Tarjeta Hauppauge 1229 WinTV HVR-2250 ............................................... 66 Figura 4.11: Vista Frontal del Dispositivo Hauppauge 1192 WinTV HVR-1950 ............. 67 Figura 4.12: Vista Trasera del Dispositivo Hauppauge 1192 WinTV HVR 1950 ............ 67 Figura 4.13: Sintonizadora Kworld Analog TV Stick III UB405-A .................................... 68 Figura 4.14: Sintonizadora Easycap SM-USB 007 ......................................................... 69 Figura 4.15: Dialogo de Barras Cruzadas en Microsoft Expression Encoder ................. 72 Figura 4.16: Diálogo Sintonizador de TV Kworld Analog TV Stick III UB405-A .............. 73 12 Figura 4.17: Diálogo de Captura Easycap SM-USB 007 ................................................ 74 Figura 4.18: Imagen 3D Doble Pantalla (Izquierda-Derecha) ......................................... 74 Figura 4.19: Opción AVS Script Creator de MeGUI 2525 ............................................... 75 Figura 4.20: Puntos de Publicación en WMS .................................................................. 77 Figura 4.21: Formatos de Origen en WMS ..................................................................... 77 Figura 4.22: Parámetros para Multicast con Tiempo Real en VLC Player ...................... 78 Figura 4.23: URL para Multicast de Contenido Pregrabado en VLC Player ................... 78 Figura 4.24: Activar Loop One en VLC Player ................................................................ 79 Figura 4.25: Ancho de Banda de Envío en Multicast con Seis Canales de Televisión ... 79 Figura 4.26: Consumo de CPU en Multicast con Seis Canales de Televisión ................ 80 Figura 4.27: Comando Cisco para Habilitar IGMPv3 ...................................................... 80 Figura 4.28: Llave de Registro para Habilitar IGMPv2 en Windows ............................... 81 Figura 4.29: Comando para Habilitar IGMPv2 en Linux ................................................. 81 Figura 4.30: Etiqueta HTML para VLC Plugin ................................................................. 81 Figura 4.31: Diagrama de Casos de Uso del Cliente de CienciasTV ............................. 83 Figura 4.32: Diagrama Entidad-Relación de CienciasTV ................................................ 90 Figura 4.33: Pantalla de Bienvenida a CienciasTV ......................................................... 90 13 Lista de Tablas Tabla 3.1: Clases de Direcciones en IPv4 ...................................................................... 23 Tabla 3.2: Direcciones Multicast Reservadas de Alcance Local ..................................... 26 Tabla 3.3: Ejemplos de Direcciones MAC Multicast ....................................................... 27 Tabla 3.4: URL para RTSP ............................................................................................. 46 Tabla 3.5: Comparación de Parámetros en Televisión Analógica .................................. 48 Tabla 3.6: Requisitos para Implementar TDA ................................................................. 49 Tabla 3.7: Estándares TDA en Latinoamérica ................................................................ 50 Tabla 3.8: Formatos de Televisión Digital ....................................................................... 52 Tabla 3.9: Formatos de Compresión Dominantes en el Mercado Actual ........................ 55 Tabla 3.10: Ancho de Banda en los Formatos de Compresión ...................................... 57 Tabla 3.11: Bit Rate y Resoluciones Recomendadas en VC-1 ....................................... 58 Tabla 4.1: Especificaciones de Hardware de Servidores Utilizados ............................... 63 Tabla 4.2: Equipos de Televisión Digital CANTV y Movistar .......................................... 64 Tabla 4.3: Compatibilidad de las Sintonizadoras con los Sistemas Operativos ............. 69 Tabla 4.4: Casos de Uso de CienciasTV ........................................................................ 82 Tabla 4.5: Descripción de Caso de Uso Ver Inicio .......................................................... 84 Tabla 4.6: Descripción de Caso de Uso Ver Televisión .................................................. 84 Tabla 4.7: Descripción de Caso de Uso Ver Ayuda ........................................................ 85 Tabla 4.8: Descripción de Caso de Uso Escribir en Twitter ............................................ 86 Tabla 4.9: Descripción de Caso de Uso Hacer Tweet .................................................... 86 Tabla 4.10: Descripción de Caso de Uso Cambiar Configuración de VLC ..................... 87 Tabla 4.11: Descripción de Caso de Uso Maximizar Canal ............................................ 88 Tabla 4.12: Descripción de Caso de Uso Ver Ayuda Linux ............................................ 88 Tabla 4.13: Descripción de Caso de Uso Ver Ayuda Windows ...................................... 89 14 15 1. Introducción La oferta de servicios de telecomunicaciones en Venezuela ha crecido constantemente, así también la adquisición de nuevas tecnologías que mejoran la capacidad de procesamiento de datos. Generalmente, la innovación tecnológica busca aprovechar los recursos ofrecidos en un contexto específico para introducir nuevos productos y servicios que impulsan al desarrollo socioeconómico de una entidad. Los servicios de televisión, radio e Internet se han integrado a dispositivos electrónicos de uso común en la sociedad, como relojes, computadores de escritorio y celulares, entre otros; dichos servicios convergen en la alta aceptación que tienen dentro del mercado venezolano, lo que ha originado que los especialistas de estas áreas innoven aceleradamente. La revolución en el hardware ha causado también una revolución en el software que trajo al mercado muchas aplicaciones basadas en streaming, con soporte IPv4 en su mayoría y para IPv6 en algunos casos. IPTV (Internet Protocol Television) es la denominación que ha recibido el servicio de entrega de televisión usando el protocolo IP sobre redes privadas. Éste se basa en la tecnología de video streaming y tiene poco despliegue a nivel nacional dado que los requerimientos de ancho de banda necesarios para su implementación resultan insuficientes. Sin embargo, las empresas privadas de televisión por cable y satélite de otros países ofrecen el servicio en una mezcla denominada Triple Play que combinan IPTV, Internet y VoIP, dado que sus velocidades de ancho de banda son mucho mayores. Es importante destacar que IPTV no debe confundirse con televisión por Internet, ya que ambas difieren en el alcance geográfico, plataformas tecnológicas y modo de acceso al servicio, entre otras cosas. IPTV se usa generalmente en redes seguras y dedicadas, controladas por operadores de telecomunicaciones que sólo alcanzan su base de datos de suscriptores. La televisión por Internet está disponible en cualquier lugar donde la capa de red permita el enrutamiento. El enrutamiento con multicast es el más utilizado cuando se quiere enviar datos desde un origen a varios destinos sin hacer gran impacto en el rendimiento de las infraestructuras de las redes involucradas, ya que se reduce el envío de paquetes. El router es quien debe crear las copias necesarias para reenviar por las interfaces de salida en las que se ha registrado la pertenencia a un grupo multicast. Actualmente, la infraestructura de red de la Facultad de Ciencias en la Universidad Central de Venezuela tiene soporte para Ten Gigabit Ethernet y Gigabit Ethernet en sus troncales y existen gran cantidad de equipos con acceso a dichos enlaces. Sin embargo, los servicios ofrecidos dentro de esta infraestructura son de bajo consumo de ancho de banda, lo que otorga la posibilidad de aprovechar los recursos para servicios de streaming de video y audio. Con este fin y de acuerdo a las necesidades planteadas se estructuró el resto del presente documento en 5 capítulos, que tendrán el orden descrito a continuación:  Capítulo 2: Planteamiento del Problema. Se describe el objetivo general y objetivos específicos del trabajo basados en la implementación del servicio de televisión. Se hace mención a todos los proyectos, estudios, propuestas e implementaciones que han sido investigadas bajo un ámbito global y que han 16 transmitido streamings con multicast. Se mencionan los trabajos relacionados, la historia de multicast y la adaptación de Venezuela con respecto a estas tendencias.  Capítulo 3: Marco Teórico. Se estudian las características y relaciones de IPv4 con el modelo de transmisión multicast. Se describen detalladamente los protocolos de enrutamiento más comunes y las políticas de calidad de servicio sugeridas para el envío de streaming con multicast. Se exploran las nuevas tendencias de transmisión de las señales de televisión en Internet y los estándares definidos para televisión analógica. Se estudian los formatos de codecs y encapsulamiento que pueden aplicarse al streaming para garantizar el soporte en la transmisión y recepción.  Capítulo 4: Marco Metodológico. Se describe la metodología a utilizar en el desarrollo del trabajo, las tecnologías que capturan la señal de televisión, el software que distribuye el streaming con multicast en la red Ethernet y hace transcoding del contenido. Se presenta la herramienta con la que el cliente puede disfrutar el servicio de televisión en la Facultad de Ciencias con soporte en distintas plataformas.  Capítulo 5: Conclusiones. Se presentan las conclusiones y recomendaciones finales del trabajo de investigación. 17 2. Planteamiento del Problema A medida que pasa el tiempo, surgen distintas técnicas y herramientas para mejorar la transmisión por multicast. Las soluciones comunicacionales actuales buscan aprovechar la banda ancha al máximo y el auge del mercado nacional inicia con la implementación de televisión digital abierta. Existe entonces especial interés en el desarrollo tecnológico en materia de redes y telecomunicaciones, lo que motiva la elaboración del presente Trabajo Especial de Grado. El servicio de Internet en la Facultad de Ciencias es de uso fundamental para la comunidad universitaria. Su acceso es público y la descarga de contenidos multimedia utiliza el modelo de transmisión unicast. Las páginas web en Internet con enlaces a transmisión en vivo de programas de televisión son diversas y no están filtradas por los routers. Si varios usuarios quieren ver un partido de futbol establecerán una conexión independiente con el lugar en Internet donde se encuentre el recurso, redundando así en la transmisión del contenido. El ancho de banda tiene un valor importantísimo entre todas las métricas a considerar para enviar streaming, ya que la cantidad de usuarios ha crecido exponencialmente. Por lo tanto, es necesario que cada servidor pueda implementar el mejor esquema de conexión con sus clientes, además de administrar las colas que surgen cuando hay una escalada en la solicitud de recursos. Estas consideraciones hacen que no sea utópico prestar servicios de televisión, videos y conferencias sin retrasos, sobre todo cuando muchos de los equipos que interconectan las redes tienen soporte Gigabit Ethernet o Ten Gigabit Ethernet como es el caso de las troncales en la Universidad Central de Venezuela. Existe una implementación de un servidor de hilos musicales en el Laboratorio de Comunicación y Redes de la Facultad de Ciencias. Este ofrece enviar por multicast canciones almacenadas en un servidor y que son accedidas desde una página web. Aún no existen aplicaciones interactivas y de tiempo real para videos o televisión que pueden ser accedidas por la comunidad universitaria usando multicast. Esta investigación pretende servir de apoyo para utilizar toda la infraestructura de red instalada en la Facultad de Ciencias de la Universidad Central de Venezuela que se encuentra actualmente subutilizada. Se desea enviar canales de televisión por multicast junto a todas las posibles variantes de streaming que ayuden a establecer las bases para investigaciones futuras. 2.1 Justificación del Problema Ahorrar tiempo, ayuda a ser más efectivo en las actividades diarias y reduce costos de recurso humano y tecnológico. La capacidad multitarea del computador hace cada vez más común que muchos usuarios utilicen Internet para ver televisión, videos y escuchar música mientras trabajan. Retrasar la descarga de contenidos digitales desde la web se traduce en pérdida de tiempo para el usuario y a medida que la solicitud de recursos crece, más se sobrecarga la red. El enrutamiento multicast resulta ser una solución de bajo nivel que ahorra tiempo en la descarga de recursos en la red. 18 Un streaming puede transportar la señal de televisión que puede ser accedida vía web desde cualquier parte de la Facultad de Ciencias, previa adecuación de la infraestructura tecnológica existente (servidores, routers y software). Los costos de implementación de un servidor de streaming con multicast pueden ser relativamente bajos ya que sólo se requiere de una configuración adecuada en el esquema cliente- servidor. Además, configurar una política de calidad de servicio a nivel de aplicación garantizaría la eficiencia en la entrega de los paquetes, así como una buena administración de la banda ancha. Por tales motivos la presente investigación representa un reto importante al proponer el envío de televisión con multicast, que está compuesto por video y audio sincronizados, aportando la base de conocimiento científico, teórico, metodológico y académico, para enviar por las redes de la Facultad de Ciencias cualquier contenido en tiempo real que beneficie a la comunidad universitaria. 2.2 Objetivos Con la presente investigación se desea mostrar resultados que permitan proponer la implantación de un servicio de televisión en la Facultad de Ciencias. Se desea brindar a la comunidad universitaria el acceso vía web de contenido audiovisual generado desde un servidor multicast ubicado en la Facultad de Ciencias. 2.2.1 Objetivo General Proponer un servicio de televisión utilizando multicast sobre IPv4 en la Facultad de Ciencias de la Universidad Central de Venezuela. 2.2.2 Objetivos Específicos  Investigar los antecedentes al presente proyecto explorando así las experiencias similares y los problemas o soluciones surgidas durante el desarrollo.  Estudiar el protocolo IPv4 para la implementación de servicios con multicast.  Estudiar los diferentes sintonizadores de televisión para computadores que ayuden a prestar un buen servicio y las nuevas tendencias de transmisión de las señales de televisión.  Estudiar los formatos de codecs que facilitan el transporte de streamings dentro de las redes Ethernet.  Estudiar los protocolos de calidad de servicio que pueden implementarse para optimizar el uso de la banda ancha en la transmisión multicast.  Definir la infraestructura necesaria para colocar en producción un servicio de televisión con multicast.  Proponer una solución para ofrecer un servicio de televisión basado en multicast sobre las redes de la Facultad de Ciencias. 2.3 Antecedentes Por las redes actuales fluye una gran cantidad de datos como videos, música, correos electrónicos y tráfico web que pueden ser accedidos desde dispositivos diversos. La incorporación de computadores dentro de una organización va en crecimiento a la par con las innovaciones que surgen para la época. Habitualmente, en Internet las comunicaciones se establecen extremo a extremo, por lo que, la eficiencia en la entrega de paquetes de una videoconferencia resulta inversamente proporcional al número de 19 receptores en un extremo de la red, obligando a que los paquetes se multipliquen desde la fuente. En la Universidad Central de Venezuela, hay variedad de recursos y servicios públicos disponibles en las redes. Es importante garantizar que el flujo de paquetes no colapse la banda ancha disponible, optando por alternativas de comunicación adecuadas al momento de incluir un servicio. En 1992 se pensó que podría ser interesante difundir las reuniones que periódicamente realiza el IETF (Internet Engineering Tasking Force), de manera que grupos situados en distintos países pudieran participar en estos fórums, por lo que, Van Jacobson, Steve Deering, Stephen Casner junto a varios ingenieros decidieron crear una red virtual (una red que corría sobre Internet) que utilizando técnicas de transmisión multicast optimizara el uso de los recursos. A esta red la llamaron MBone (Multicast Backbone). RedIRIS se unió a este proyecto en 1993 de forma local, dado que las condiciones de los enlaces troncales de la red académica y de investigación no permitían la difusión de MBone por toda ella. RedIRIS es la red académica de investigación española que proporciona servicios avanzados de comunicaciones a la comunidad científica y universitaria incluyendo a Venezuela y a muchos otros países de América Latina [4]. MBone fue creada inicialmente con fines experimentales, se esperaba que después de establecerse estándares para los routers cuya funcionalidad permitiera paquetes multicast no fuera necesario hacer encapsulamiento dentro de los paquetes unicast, este esquema de transporte utilizado por MBone se le conoce como tunneling. Actualmente, las redes MBone han ido desapareciendo quedando sólo en universidades e institutos de investigación. En la Figura 2.1 (tomada de [4]) se presenta un mapa topológico con las trazas de las redes MBone existentes hasta el año 1994. Figura 2.1: Topología de Red de MBone en 1994 Para MBone se han desarrollado o adaptado gran cantidad de herramientas con el fin de experimentar diferentes intercambios multimedia, usando multicast en modo interactivo: audio y video conferencias, editores de texto y pizarras electrónicas compartidas, intercambio de hipertextos; o en procesos no interactivos como sincronización de equipos (NTP multicast), distribución multicast de archivos (FTP multicast). Los protocolos de enrutamiento multicast más utilizados en la MBone son 20 DVMRP, MOSPF, PIM-DM, CBT y PIM-SM, éste último prevalece junto al protocolo IGMP por su escalabilidad y adaptación a sistemas con muchas subredes, IGMP por el soporte que tiene bajo Windows. IPv4 (Internet Protocol version 4) es la primera implementación a gran escala del protocolo IP. Debido a su éxito se expandió poco a poco en el mundo entero, llegando a escasear las direcciones IPv4. En Febrero del 2011, el IANA (Internet Assigned Numbers Authority) entregó sus últimos bloques /8 de direcciones IPv4 a los cinco RIRs (Regional Internet Registries) llevando el problema de la escasez de direcciones IPv4 a un nivel más alto. Como solución al problema, el IETF se vio en la necesidad de crear un nuevo protocolo que inicialmente se conoció como IPng (Internet Protocol Next Generation) y que terminó denominándose IPv6. La cantidad de direcciones IPv6 resulta abrumadora, dando solución a un mundo que crece exponencialmente en la incorporación de servicios y dispositivos a las redes IPv4. Hoy en día existe software que permiten la transmisión de streaming de video y audio bajo demanda utilizando multicast, entre los que se pueden mencionar, Windows Media Services de Microsoft, DVBlast de VideoLAN, Wowza Media Server de Wowza Media Systems, SHOUTcast de Nullsoft, TVersity Media Server de TVersityInc, Unreal Media Server de Unreal Streaming Technologies, entre muchos otros software desarrollados, demostrando el gran interés que existe en la difusión de streaming a través de las redes IPv4. Dichos software en su mayoría requieren que el video o audio a enviar sea codificado, lo que se conoce como coding, por lo que el éxito del mismo queda supeditado a la eficiencia del codificador empleado. Así también, el mercado actual se ha esforzado en el desarrollo de hardware que incorporan televisión al computador por interfaz USB (Universal Serial Bus), PCI convencional o PCI Express, incluso muchos de estos sintonizadores están embebidos en las tarjetas de video. Estos equipos se conocen comúnmente como sintonizadores de televisión y son diseñados tanto para instalación interna como externa adaptados a cada región según el medio de difusión de la señal. El medio de difusión actualmente utilizado en Venezuela es analógico en las señales públicas y digital en algunas compañías privadas, por lo que, la televisión por Internet ha surgido como un medio de comunicación alternativo que ha tomado terreno y donde aún se están desarrollando pruebas, tal como las del proyecto de implantación del servicio denominado IPTV, que lleva a cabo la empresa china ZTE en nuestro país1. La Facultad de Ciencias de la Universidad Central de Venezuela posee un servidor configurado para el envío de streaming de audio [4], dicha iniciativa fue tomada en el año 2010 por el Laboratorio de Comunicación y Redes. El servidor fue programado para ser accedido desde un explorador web compatible con Windows Media Player. Para enviar el streaming se utiliza WMS (Windows Media Services) previa codificación con Windows Media Encoder para obtener el formato deseado para la transmisión en puntos de publicación. Todo se hace desde un mismo servidor ya que el contenido a difundir se encuentra pregrabado, ofreciendo a la comunidad un espacio con diversidad musical sin gran consumo del ancho de banda (dada su implementación con multicast), además que el acceso puede ser mediante IPv4 o IPv6. 1 http://www.con-cafe.com/index.php/2009/04/zte-gano-licitacion-para-desplegar-iptv 21 La incorporación de nuevas tecnologías en el ámbito educativo permite la transformación de los procesos de enseñanza-aprendizaje en línea, la generación de nuevos métodos y el aprendizaje didáctico en la educación; es importante romper los paradigmas conservadores en este ámbito tanto en el docente como el estudiante, para adaptarse al sin fin de variantes que permite la transmisión de streaming, donde el método audiovisual parece ser más aceptado por los estudiantes y ofrece mayor índice de participación en los eventos y actividades. En el Salvador para el año 2007 se presentó un estudio de IPTV utilizando multicast [7], donde el alcance estuvo limitado a generar documentación del uso de las herramientas y temas asociados a dicha tecnología. Se elaboró una demostración sencilla por Intranet y se configuraron los routers (Cisco) para dar soporte multicast. El sistema operativo utilizado en el servidor fue Windows Server 2003, con WMS y Windows Media Encoder destinados al envío del streaming; los clientes estaban configurados bajo Windows XP y se utilizó el reproductor Windows Media Player para capturar el streaming publicado. Los protocolos de enrutamiento estudiados fueron PIM y DVMRP. La implementación de un servicio bajo esta tecnología quedó sobre la mesa para trabajos futuros, aún no se ofrece el servicio en la Universidad. En la Escuela de Computación de la Universidad Nacional de Singapore para el año 2003 se desarrolló e implementó un servidor de televisión en vivo usando herramientas de código abierto [8]; la solución de streaming se denominó NUSCast y permite a los usuarios de la red ver televisión con la posibilidad de seleccionar los canales. Además tienen un repositorio de videos pregrabados que pueden ser accedidos bajo previa autenticación. Lo más interesante de esta implementación es que se utilizó Linux con una tarjeta sintonizadora WinTV Theater (modelo 495) fabricada por Hauppauge y se basaron en el API de Video4Linux para la compatibilidad del sintonizador de TV, codificando el streaming con Theora y Vorbis desarrollados por la fundación Xiph.org. En la Universidad Osnabrück de Alemania existe una central de investigación llamada virtUOS que tiene proyectos como Stud.IP y Opencast Matterhorn. El primero es una plataforma de administración que sirve a profesores, estudiantes, administradores y directivos en su trabajo diario, coordinando eventos, cursos de extensión, entre muchas otras cosas. El segundo se refiere a un proyecto de código abierto que permite registrar conferencias y redistribuirlas por Internet utilizando multicast. Los videos pueden ser reproducidos en paralelo, cambiados de tamaño y calidad, grabados y accedidos mediante una línea de tiempo con estadísticas de los comentarios efectuados. La arquitectura de conexión utilizada se muestra en la Figura 2.2 y cabe destacar que como dispositivo de captura utilizaron una tarjeta PCI fabricada por Hauppauge modelo PVR 150 con codificador MPEG-2 integrado. Dicho proyecto de enseñanza se viene trabajando desde 1998 y ha ido evolucionando, adaptándose incluso a redes sociales como Facebook y servicios como YouTube o iTunes U2. 2 http://www.virtuos.uni-osnabrueck.de/Projekte/StudIP 22 Figura 2.2: Arquitectura virtPresenter del Proyecto Opencast Matterhorn La Universidad de Oregon en Estados Unidos tuvo implementado para el año 1997 un servidor con multicast que transmitía audio y video eficientemente a un gran número de usuarios de la red universitaria. Dicho servidor se conoció como Uversity of Oregon IPTV Server y utilizó la red MBONE. Fue desarrollado para fomentar la educación a distancia, el cliente que interpretaba dicho streaming estuvo disponible para Windows 95 y plataforma NT y podía ser descargado desde cualquier explorador web [9]. Actualmente la universidad tiene equipos CoolSign fabricados por Haivision, un hardware especializado que presta servicios de IPTV con multicast nativo a muy altas prestaciones, además de codificadores Makito que son conocidos en el mercado como los de más baja latencia y más alto rendimiento. El trabajo conjunto de estas tecnologías ha permitido brindar un servicio en el que los juegos de baloncestos de los Ducks of Oregon en el Matthew Knight Arena pueden apreciarse desde más de 140 reproductores CoolSign instalados en zonas comunes del recinto. El sistema CoolSign incluye un servidor CoolSign, DataWatcher, Network Manager y una herramienta de creación de contenidos3. En la Pontificia Universidad Católica del Perú para el año 2012 diseñaron una aplicación interactiva por televisión para educación a distancia [32]. La TDT y un canal de IPTV fueron el medio tecnológico utilizado para tal fin. Los espacios donde no existía cobertura de la señal ISDB-T se cubrieron con IPTV. La aplicación desarrollada llevó el nombre de “El Zorro y el Condor” que implementó la difusión de cuentos tradicionales peruanos. Esta aplicación permite:  Obtener mayor información sobre los personajes y escenarios del cuento.  Modificar el idioma del Español al Quechua.  Mostrar ventana para video de lenguaje de señas, mostrar subtítulos.  Escribir mensajes para los productores de los contenidos, con la ayuda de un teclado virtual.  Autoevaluación interactiva con preguntas relativas al cuento. 3http://www.digitalavmagazine.com/2012/08/16/la-universidad-de-oregon-recurre-a-haivision- para-instalar-un-sistema-de-digital-signage-en-su-nuevo-pabellon-deportivo 23 3. Marco Teórico 3.1 Internet Protocol Version 4 IPv4 [1][3], usa un formato de direcciones de 32 bits, abarcando un conjunto de 232 direcciones únicas, es decir, 4.294.967.296. En la práctica sólo están en uso un 40% de estas direcciones debido a que en 1980 por falta de coordinación en los responsables de la asignación de direcciones IPv4 se dejaron espacios de direcciones discontinuos. Los datos en una red que se basa en IPv4 son enviados en bloques conocidos como paquetes. IPv4 provee un servicio de paquetes no fiable, no orientado a conexión y de mejor esfuerzo. IPv4 no provee ningún mecanismo para determinar si un paquete alcanza o no su destino ya que no mantiene información referente al estado de las conexiones y únicamente proporciona seguridad mediante checksums de sus cabeceras y no de los datos transmitidos. El formato de la cabecera de IPv4 se presenta en la Figura 3.1 tomada de [3]. Figura 3.1: Formato de la Cabecera IPv4 3.2 Direccionamiento en IPv4 Para hablar de direccionamiento hay que entender las diferencias entre los distintos tipos de transmisión (unicast, multicast y broadcast) que involucran el proceso de comunicación: emisor, medio y receptor; en este caso se clasifican las comunicaciones en función al número de receptores. Las direcciones IPv4 que se usan en Internet se escriben en decimal utilizando un punto “.” como separador entre cada 8 bits; por ejemplo, 192.168.100.252. Cada dirección IPv4 se divide en dos partes, una que identifica a la red en la que se encuentra y otra que corresponde al computador. Inicialmente se dividió el espacio de direccionamiento de IPv4 en clases que van desde la A hasta la E, creando así distintos tipos de redes, cada una con un número máximo de computadores distintos. El tipo de red se determina mediante los bits más significativos de la dirección IPv4 y los bits restantes representan el identificador del computador dentro de la red [9]. Clase de Dirección Primeros 8 bits en Decimal Direcciones de Red Posibles Direcciones de Host Posibles A 0.0.0.0 - 127.255.255.255 2^7 2^24 B 128.0.0.0 - 191.255.255.255 2^14 2^16 C 192.0.0.0 - 223.255.255.255 2^21 2^8=256 D 224.0.0.0 - 239.255.255.255 - - E 240.0.0.0 - 255.255.255.255 - - Tabla 3.1: Clases de Direcciones en IPv4 Version Identification 4 16 243 15 23 310 IHL 7 8 Type of Service Total Length Time To Live Protocol Header Checksum Destination Address Source Address Fragment Offset0 DF M F 17 18 19 24 Como se puede observar en la Tabla 3.1, hay pocas redes de clase A pero cada una de ellas puede tener muchos computadores (más de 16 millones), dado que el número de la red sólo ocupa el primer byte dejando los otros tres libres para numerar los computadores. En cambio, hay gran cantidad de redes de clase C (que ocupan tres bytes de la dirección) pero cada una de ellas puede contener un máximo de sólo 256 direcciones IPv4. Las direcciones clase D no se identifican con ninguna red en particular sino con grupos multicast (grupos de computadores que comparten la misma dirección IPv4), pero que tienen una estructura similar a las anteriores. Los cuatro bits más significativos de las direcciones de Clase D se fijan a "1110", y los siguientes 28 bits reciben la denominación de identificador del grupo multicast, no estando por lo tanto, estructuradas las direcciones como las direcciones IPv4 unicast. Su formato es el indicado en la Figura 3.2. Figura 3.2: Formato Dirección IPv4 Clase D Las direcciones clase E abarcan el bloque 240.0.0.0/4 y están reservadas por la IANA para usos futuros. La dirección de broadcast 255.255.255.255 no puede ser transmitida fuera de la subred desde donde se encuentre la fuente [11]. 3.3 Unicast sobre IPv4 Este tipo de dirección se utiliza para enviar un paquete a un computador específico, es válido colocarla como dirección fuente o destino. Por cada destinatario el emisor debe enviar los paquetes, véase la Figura 3.3. Figura 3.3: Comunicación Unicast 3.4 Broadcast sobre IPv4 Las direcciones broadcast refieren a todos los equipos de una dirección de red, sólo son válidas si se usan como destino, nunca como fuente. Cuando un emisor envía un paquete de este tipo puede hacerlo de las siguientes formas:  Broadcast dirigido: La dirección destino tiene la porción que identifica a los equipos con todos los bits en uno y los bits de la subred intactos (véase Figura 3.4). Los routers no reenvían este tipo de paquetes por defecto pero pueden configurarse para que lo hagan. 0 1 1 1 0 3 4 31 group ID 25 Figura 3.4. Dirección IPv4 Broadcast Dirigido  Broadcast limitado: Es utilizada para la comunicación con los computadores dentro de la red local. Estos paquetes llevan como dirección IPv4 destino 255.255.255.255, los routers no reenvían estos broadcast, pero cada computador que lo recibe está obligado a procesar el paquete. Con el protocolo DHCP, cuando un dispositivo está inicializando y desea ingresar a la red se utiliza la dirección de broadcast limitado a fin de asignarle una dirección IPv4 válida (véase la Figura 3.5). Figura 3.5: Broadcast Limitado 3.5 Multicast sobre IPv4 Se define como la transmisión de un paquete a una dirección que corresponde a un grupo de computadores. La filosofía de comunicación es “uno a muchos”, haciendo el mejor esfuerzo y sin garantía de entrega a todos los miembros del grupo [5]. Hay una serie de direcciones multicast reservadas cuyo significado se considera especial y que designan grupos concretos, tal como se observa en la Tabla 3.1 tomada de [9]. El rango de direcciones desde 224.0.0.1 a 224.0.0.255 está reservado para el uso de protocolos de enrutamiento, descubrimiento y mantenimiento de topologías de bajo nivel; si un router recibe un paquete con dirección de destino dentro de este rango no debe reenviarlo. Destacan la dirección 224.0.0.1 que refiere a todos los computadores con soporte multicast en la subred, y 224.0.0.2 refiere a todos los routers con soporte multicast en la subred. Existen también un grupo de direcciones definidas en el rango 239.0.0.0/8 que se utilizan con alcance administrativo dentro de una organización y están definidas en [41]. IPv4 Address Description References 224.0.0.0 Base Address (Reserved) RFC1112, JBP 224.0.0.1 All Systems on this Subnet RFC1112, JBP 224.0.0.2 All Routers on this Subnet JBP 26 224.0.0.3 Unassigned JBP 224.0.0.4 DVMRP Routers RFC1075, JBP 224.0.0.5 All OSPF Routers RFC1583, JXM1 224.0.0.6 OSPF Designated Routers RFC1583, JXM1 224.0.0.7 ST Routers RFC1190, KS14 224.0.0.8 ST Hosts RFC1190, KS14 224.0.0.9 RIPv2 Routers GSM11 224.0.0.10 IGRP Routers Dino Farinacci 224.0.0.11 Mobile-Agents Bill Simpson 224.0.0.12-224.0.0.255 Unassigned JBP Tabla 3.2: Direcciones Multicast Reservadas de Alcance Local La comunicación multicast puede implementarse en las siguientes formas:  Multicast de nivel de aplicación: Múltiples transmisiones de unicast, pero involucrando a los receptores en la replicación. La ventajas es que no requiere soporte multicast en los dispositivos de red intermedios, la desventaja es que se necesita una infraestructura de distribución en la capa de aplicación y se congestiona el segmento de red donde se hace la replicación. La Figura 3.6 muestra que el PC1 recibe el flujo, lo procesa y verifica la lista de distribución (todo esto en capa de aplicación), determinando que el PC2 y PC3 son miembros del grupo multicast, posteriormente se hacen copias de los paquetes y se envían con dirección unicast en el destino. Figura 3.6: Implementación de Multicast a Nivel de Aplicación  Multicast explícito: El emisor transmite un único paquete que se replica en los routers cuando es necesario. La ventaja es que los recursos de red se utilizan de manera óptima y la desventaja es que los dispositivos de la capa de red deben soportar la funcionalidad. La Figura 3.7 muestra que el router conoce que el PC1, PC2 y PC3 son miembros del grupo multicast, por lo que crea copias de los paquetes y los envía directamente. 27 Figura 3.7: Implementación de Multicast Explícito Los routers con capacidad de escuchar las direcciones multicast utilizan protocolos para gestionar la pertenencia a los grupos tal como IGMP definido en [5], por lo tanto deben tener información sobre la necesidad de replicación de paquetes para alcanzar a cualquier miembro del grupo de la red local. 3.5.1 Direcciones MAC Multicast Los dos bits menos significativos del primer byte en una dirección MAC tienen un significado especial. El primero se conoce como I/G (Individual Group), su valor en 0 denota que la dirección es tipo unicast y en caso contrario la dirección es multicast o broadcast. El segundo bit se emplea para indicar si una dirección es única (administrada globalmente por el IEEE) o local (asignada por software) véase la Figura 3.8. Figura 3.8: Formato de Direcciones MAC Multicast En la Tabla 3.3, se puede ver algunas direcciones MAC multicast comúnmente utilizadas. MAC Address References 01-00-0C-CC-CC-CC CDP (Cisco Discovery Protocol), VTP (VLAN Trunking Protocol) 01-00-0C-DD-DD-DD CGMP (Cisco Group Management Protocol) 01-00-5E-00-00-00 DoD Internet Multicast (RFC-1112) 01-80-C2-00-00-00 Spanning tree Protocol (for bridges) 01-80-C2-00-00-01 802.1 alternate Spanning multicast 03-00-00-20-00-00 IPv4 Multicast Address Token Ring (RFC1469) Tabla 3.3: Ejemplos de Direcciones MAC Multicast 28 3.5.2 Correspondencia de IPv4 y MAC en Multicast El IANA ha reservado un grupo de direcciones MAC IEEE-802 para los paquetes multicast sobre IPv4 según [5], con el rango de OUI (Organizationally Unique Identifier) 01-00-5E-00-00-00 al 01-00-5E-7F-FF-FF. Se asignó al IETF dicho rango para mapear las direcciones multicast de IPv4 con las direcciones multicast de MAC. Se disponen solamente de 23 bits para direcciones MAC ya que el bit más significativo del cuarto byte fue establecido en 0 como se indica en la Figura 3.9, con el fin de reservar el rango más alto de direcciones para investigaciones futuras. Una dirección IPv4 multicast se corresponde a una dirección MAC ubicando los 23 bits menos significativos de la dirección IPv4 en los 23 bits menos significativos de la dirección MAC. Los cinco bits ignorados equivalen a 32 direcciones IPv4 multicast posibles que pueden corresponderse con una misma dirección MAC. Esto no supone gran problema ya que la capa de red se encargará de filtrar el tráfico que en condiciones normales debió ser filtrado por la capa de enlace. Figura 3.9: Correspondencia Multicast entre IPv4 y MAC 3.5.3 Internet Group Management Protocol IGMP (Internet Group Management Protocol) ocupa al igual que ICMP (Internet Control Message Protocol) un mismo subnivel de comunicaciones como una parte integral de IPv4, véase la Figura 3.10. Figura 3.10: Encapsulamiento de IGMP El campo protocolo de la cabecera IPv4 utiliza el valor 0x02 para describir un mensaje IGMP. Estos mensajes se utilizan para que los computadores notifiquen a los routers cuáles son los grupos multicast en los que están interesados. Los routers mantienen una lista de los grupos multicast accedidos desde sus interfaces. Los mensajes IGMP Cabecera IP Datos Cabecera Ethernet Datos Cabecera IGMP Datos 29 sólo pueden intercambiarse entre equipos conectados en la red local por lo que el campo TTL (Time To Live) de la cabecera IPv4 siempre es igual a 1. Los computadores pueden usar IGMP para entrar o salir de los grupos en cualquier momento, no hay restricción en el número de computadores por grupo. Un computador puede ser miembro de uno o más grupos y no necesariamente un computador tiene que ser miembro de un grupo para enviar paquetes a éste. Todos los mensajes IGMP son enviados con la opción IP Router Alert en la cabecera IPv4 para indicar a los routers que deben examinar más cuidadosamente el paquete [14]. Cuando el TTL de un paquete multicast tiene un valor mayor que 1 el router local con soporte multicast tiene la responsabilidad de reenviar el flujo a todos los routers de las redes que tengan miembros del grupo, esto lo hace a través de protocolos de enrutamiento especiales para multicast. Actualmente el protocolo IGMP está definido en tres versiones: IGMPv1 definido en [5], IGMPv2 definido en [6] y la última versión IGMPv3 definida en [12]. 3.5.3.1 IGMPv1 IGMPv1 está implementado básicamente en el envío de mensajes Membership Querys y Membership Reports. Figura 3.11: Formato de Mensaje IGMPv1 El formato de mensaje IGMPv1 que se muestra en la Figura 3.11 tomada de [5] se describe a continuación:  Version: Se especifica el valor 1 para esta versión del protocolo IGMP, la versión 0 definida en [13] quedó obsoleta.  Type: Hay dos tipos de mensajes definidos.  Host Membership Query (valor 0x01): Es un mensaje de sondeo o consulta general de pertenencia a grupos enviado por el router a todos los computadores vecinos a la dirección destino 224.0.0.1 de forma periódica.  Host Membership Report (valor 0x02): Es un mensaje de informe de pertenencia a un grupo. Es enviado por un miembro de grupo cuando recibe un mensaje Host Membership Query para permanecer en un grupo o cuando desea unirse a un nuevo grupo. El destino es el router multicast y los computadores de la red local miembros de dicho grupo.  Unused: Campo sin uso.  Checksum: Suma de comprobación de todo el mensaje IGMP.  Group Address: En un mensaje Host Membership Query el campo Group Address es puesto en 0.0.0.0, y en un mensaje Host Membership Report el campo Group Address contiene la dirección IPv4 multicast que se informa. Cada computador miembro de un grupo que reciba un mensaje Host Membership Query inicia un temporizador con un tiempo aleatorio. Cuando el temporizador expira se envía un mensaje Host Membership Report con el grupo a informar. Un reporte es enviado 0 Version 3 4 7 8 15 16 31 Type Unused Checksum Group Address Class D 30 con una dirección IPv4 destino igual a la dirección de grupo que se informa, y con un TTL igual a 1. Cuando un computador escucha un informe de pertenencia de grupo al que pertenece, detiene su temporizador para ese grupo y no genera el mensaje Host Membership Report de respuesta, así pues sólo un informe de respuesta se genera para cada grupo en la red y corresponde al computador quien le venza primero el temporizador. En caso tal que el temporizador no haya vencido y se reciba un mensaje Host Membership Query, este no se restablece a un nuevo valor, sino que continúa corriendo desde su valor actual. Los routers que manejen grupos multicast sólo les interesa asegurarse que al menos un computador pertenece a un grupo dentro de su red, a fin de garantizar el flujo multicast, por lo que periódicamente envían mensajes Host Membership Query (no más de uno por minuto) para evitar sobrecargar la red. 3.5.3.2 IGMPv2 La principal diferencia de IGMP versión 2, es la inclusión de un nuevo mensaje para indicar el abandono de un grupo. Además se especifica que el router cuya dirección IPv4 sea menor es el encargado de generar los mensajes Host Membership Query, ya que en la versión anterior había quedado inconcluso este aspecto. Figura 3.12: Formato de Mensaje IGMPv2 El formato de mensaje que se presenta en la Figura 3.12 tomada de [6] se describe a continuación:  Type: Se definen 4 tipos de mensajes.  Membership Query (valor 0x11): Hace un sondeo general (General Query) cuando en la cabecera IPv4 se asigna 224.0.0.1 como dirección destino y en la dirección de grupo del mensaje IGMP se asigna 0.0.0.0, esto con el fin de mantener compatibilidad con la versión 1. También se incorpora una variante al recibir un informe de abandono de grupo Group Specific Query, consiste en asignar la dirección de grupo a la que pertenece el informe de abandono como dirección IPv4 destino y dirección de grupo del mensaje IGMP, esto se hace para verificar si aún existen miembros en el grupo, se envía en intervalos de 125 segundos.  Version 2 Membership Report (valor 0x16): Todo computador que quiera permanecer como miembro de uno o más grupos debe responder al mensaje de consulta con este mensaje de informe por cada grupo del que es miembro activo.  Leave Group (valor 0x17): Cuando un computador detecta que los procesos locales dejan de ser miembro de un grupo, envía un mensaje de abandono a dicho grupo a la dirección 224.0.0.2 que refiere a todos los routers de la red.  Version 1 Membership Report (valor 0x12): Únicamente para mantener compatibilidad con IGMPv1.  Max Response Time: Especifica el tiempo máximo permitido para el envío de una respuesta, 1 segundo para el Group Specific Query y 10 segundos para el General Query. 0 7 8 15 16 31 Type Max Resp Time Checksum Group Address Class D 31  Checksum: Suma de comprobación de todo el mensaje IGMP.  Group Address: En un mensaje Membership Query el campo Group Address es puesto en 0.0.0.0, y en un mensaje Membership Report el campo Group Address contiene la dirección IPv4 multicast que se informa. Cuando un computador recibe un mensaje Membership Report de la versión 1, debe suprimir el envío del Membership Report versión 2. Cuando un router recibe un mensaje Membership Report de la versión 1 debe ignorar todos los mensajes Leave Group que reciba y fijar un temporizador para ese grupo que debe ser igual al Group Membership Interval. El Group Membership Interval es la cantidad de tiempo que debe transcurrir para que un router decida que no hay más miembros en un grupo multicast Los routers con IGMPv1 envían mensajes Host Membership Query con ceros en el campo Unused, por lo que, los computadores que entienden IGMPv2 saben que se trata de un router IGMPv1 y deben interpretar el valor en 10 segundos como Max Response Time. Así también, un router IGMPv1 espera recibir mensajes Membership Reports versión 1 sin prestar atención a los mensajes Membership Reports de la versión 2. Existe una variable de estado en cada computador que debe ser mantenida para describir que router está funcionando con IGMPv1 o IGMPv2 y según sea el caso deberá suprimir el envío de mensajes Leave Group. 3.5.3.3 IGMPv3 La versión 3 de IGMP está definida en [12], es actualmente la última versión desarrollada. Se enfoca en proporcionar información útil a los protocolos de enrutamiento al conocer las fuentes del tráfico multicast en la que están interesados sus vecinos. Para mantener la compatibilidad con las anteriores versiones de IGMP, se conservan los mensajes cuyos valores son 0x12, 0x16 y 0x17. Los Membership Querys (valor 0x11) que llegan a una interfaz con dirección IPv4 destino multicast conocida y asignada a esa interfaz deben ser procesados. Se incorpora la variante Group and Source Specific Query en el mensaje Membership Query. Figura 3.13: Formato de Mensaje Membership Query con IGMPv3 El formato de mensaje de la Figura 3.13 tomada de [12] se describe a continuación:  Type: Tiene asignado el valor 0x11.  Max Resp Code: Especifica el máximo tiempo permitido para enviar un mensaje Membership Report de respuesta, es calculado dinámicamente. Las ráfagas de mensajes IGMP son inversamente proporcionales al valor del Max Resp Code, sin 0 Type = 0x11 3 4 7 8 15 16 31 Max Resp Code Checksum Group Address Class D 5 Resv S QRV QQIC Number of Sources (N) Source Address (1) Source Address (N) .. .. . 32 embargo, una respuesta más tardía de consultas a grupos específicos es desventajosa porque mantiene el tráfico multicast activo un mayor tiempo cuando el objetivo es suprimirlo.  Checksum: Es la suma de comprobación del mensaje IGMPv3.  Resv: Es un campo reservado y su valor siempre es cero.  S (Flag): Se establece en 1 para indicar a los demás routers que no deben actualizar su temporizador; se establece en 0 en caso contrario.  QRV (Querier’s Robustness Variable): Especifica un valor que se utiliza por el router para la pérdida de paquetes esperada. Cuanto más grande es este valor, mayor es la tolerancia a la pérdida de paquetes. Los routers adoptan el valor QRV desde la consulta más reciente recibida de otros routers, a menos que dicho valor exceda 7 cuyo caso se asigna el valor 2 al campo QRV.  QQIC (Querier’s Query Interval Code): Especifica un valor que ayuda a calcular el intervalo de tiempo en que los routers pueden enviar las consultas.  Number of Sources: Especifica cuantas fuentes se encuentran presentes en la consulta, su valor es 0 en mensajes General Query y Group Specific Query. Pueden especificarse hasta 366 fuentes para los mensajes Group and Source Specific Query. Estos mensajes son enviados desde los routers para conocer si las interfaces vecinas desean recibir un flujo multicast desde alguna dirección específica de una lista de fuentes.  Source Address: Direcciones fuentes IPv4 unicast. Figura 3.14: Formato de Mensaje Membership Report en IGMPv3 Los Membership Reports de IGMPv3 enviados por los computadores informan a los routers vecinos el estado actual de la recepción sobre un flujo multicast particular. En la Figura 3.14 se muestra el formato a seguir para el envío de este tipo de mensajes. En IGMPv3 los mensajes Membership Reports son enviados a la dirección IPv4 224.0.0.22 que corresponde a todos los routers con capacidad de escuchar mensajes IGMPv3. Un bloque Group Record tiene un tamaño mínimo de 8 bytes y contiene información del remitente sobre la pertenencia a un grupo multicast asociado a la interfaz de donde se envía el mensaje (ver Figura 3.15). 0 7 8 15 16 31 Type = 0x22 Reserved Checksum Number of Group Records (M)Reserved Group Record (1) Group Record (M) .. .. . 33 Figura 3.15: Formato Interno Group Record de un Membership Report El campo interno Record Type define seis diferentes maneras de enviar un Membership Report.  Current State Record: Es enviado por un computador en respuesta a un Membership Query. Se reporta el estado actual de escucha de la interfaz por cada dirección multicast. Puede adoptar los siguientes valores:  MODE_IS_INCLUDE (1): Indica que la interfaz tiene un filtro Include para la dirección multicast especificada.  MODE_IS_EXCLUDE (2): Indica que la interfaz tiene un filtro Exclude para la dirección multicast especificada.  Filter Mode Change Record: Es enviado por un computador si cambia el estado de un filtro en la interfaz para una dirección multicast en particular. Puede adoptar los siguientes valores:  CHANGE_TO_INCLUDE_MODE: Indica que la interfaz ha cambiado a modo INCLUDE el filtro de la dirección multicast especificada.  CHANGE_TO_EXCLUDE_MODE: Indica que la interfaz ha cambiado a modo EXCLUDE el filtro de la dirección multicast especificada.  Source List Change Record: Es enviado por un computador si ocurre un cambio en la lista de fuentes de una determinada dirección multicast pero no en el modo del filtro. El registro se incluirá en un informe enviado desde la interfaz en la que se produjo el cambio y puede tener uno de los dos valores siguientes:  ALLOW_NEW_SOURCES: Indica las fuentes que el sistema desea escuchar sobre una dirección multicast particular. Si el cambio se efectúa sobre un INCLUDE, entonces las direcciones serán agregadas a la lista. En caso que el cambio se efectúe sobre un Exclude las direcciones serán borradas de la lista.  BLOCK_OLD SOURCES: Indica las fuentes que el sistema no desea escuchar sobre una dirección multicast particular. Si el cambio se efectúa sobre un Exclude, entonces las direcciones serán agregadas a la lista. En caso que el cambio se efectúe sobre un Include las direcciones serán borradas de la lista. Los routers utilizan el protocolo IGMP sobre todas las interfaces que soporten multicast. La información reunida por IGMP se proporciona a cualquier protocolo de enrutamiento multicast a fin de garantizar que los paquetes lleguen a todas las redes donde haya receptores interesados. En IGMP v3 no existe un comando Leave Group, ya que esta función la desempeña el comando Membership Report 224.1.1.1 Include(). El comando Membership Report 224.1.1.1 Exclude() equivale a una unión indiscriminada a los grupos multicast. 0 7 8 15 16 31 Record Type Aux Data Len Number of Sources (N) Multicast Address Source Address (1) Auxiliary Data .. .. . Source Address (N) 34 3.5.3.4 Conmutación de Tráfico Multicast Usar switches para interconectar redes Ethernet tiene como principal ventaja el separar dominios de colisión a fin de aumentar la escalabilidad de las redes. Por el contrario, el tráfico multicast se reenvía por todos las interfaces de un switch afectando a la red local como si fuese un solo segmento de red. Debido a esto, el control del tráfico multicast en Ethernet cuenta con las siguientes implementaciones:  VLANs: Es un método que puede asociar a un grupo multicast por cada VLAN, sin embargo, no soporta cambios dinámicos.  CGMP (Cisco Group Management Protocol): Este protocolo trabaja muy similar al IGMP Snooping, y permite registrar hasta 64 grupos multicast. La asignación de la dirección multicast a una interfaz se hace con un mensaje que se envía desde el router hacia el switch como se muestra en la Figura 3.16. El switch mantiene una tabla de grupos multicast con la información que el router le envía (un mensaje CGMP por cada miembro que entre o salga de un grupo), esto aumenta el procesamiento del switch y agrega tráfico al enlace [16]. Figura 3.16: Gestión desde el Router con CGMP  IGMP Snooping: El switch tiene la capacidad de capturar y leer todo el tráfico IGMP que pasa a través de él. Existe una tabla de entradas en el switch donde se asocia la interfaz con el grupo multicast, además se establece un temporizador al igual que en los routers para que a su vencimiento se libere el recurso. Cuando el switch recibe múltiples Membership Reports de un mismo grupo, solamente deja pasar una solicitud al router y por cada usuario que se integre a un grupo ya existente, el switch sólo debe asociar el puerto y transmitirle el flujo multicast (ver Figura 3.17). Figura 3.17: Filtrado de Membership Reports con IGMP Snooping 3.5.4 Enrutamiento Multicast Cuando un computador quiere recibir una transmisión multicast, primero necesita encontrar la dirección de grupo. En el primer salto se usa el protocolo IGMP. El router 35 conoce en qué grupos multicast están interesados los computadores de su red. Pero en caso de que el router necesite hacer más saltos existen dos planteamientos, o que todos estén interesados en la emisión del flujo multicast o que no lo estén, por lo cual según sea el caso existen protocolos de enrutamiento multicast en modo denso y modo disperso. Es importante conocer que el enrutamiento multicast requiere crear una variable de estado de reenvío del flujo multicast que debe ser mantenida periódicamente ya que tiene un tiempo de expiración. El enrutamiento multicast está basado en la construcción de “árboles” que conectan los miembros de varios grupos multicast. Los árboles de distribución multicast especifican un camino único de envío entre el origen y el destino. Debido a que los miembros de un grupo multicast entran y salen dinámicamente, los árboles de distribución deben ser actualizables. Los dos tipos básicos de árboles de distribución multicast son:  Árboles de camino más corto o SPT (Shortest Path Tree): La raíz es el origen del tráfico multicast y las ramas las forman las rutas hasta cada uno de los receptores. Las rutas se construyen según el criterio de la ruta más corta y se identifican mediante la tupla (S, G), donde S es la dirección de la fuente, y G la del grupo multicast. Por lo tanto hay un árbol por cada fuente y grupo (Ver Figura 3.18). Figura 3.18: Árbol de Camino más Corto (SPT)  Árboles compartidos: Según el protocolo de enrutamiento implementado, se conocen como RPT (Rendezvous Point Tree) o CBT (Core Based Tree) y usan una sola raíz en común ubicada en algún punto de la red. Utilizan la notación (*, G), donde * se refiere a todos los orígenes, y G representa a un grupo multicast, ya que todos los orígenes tienen un mismo árbol compartido. Sin embargo, los routers saben que el flujo multicast no siempre debe atravesar la raíz del árbol, ya que estos conocen la ruta más corta hacia cualquier punto de la red, pudiendo conmutar a un SPT (S, G). Véase el ejemplo de la Figura 3.19. Figura 3.19: Árbol de Distribución Compartida 36 Los protocolos que utilizan el modo denso con árboles SPT son DVMRP (Distance Vector Multicast Routing Protocol), MOSPF (Multicast Open Shortest Path First) y PIM- DM. Los protocolos que utilizan el modo disperso son CBT y PIM-SM. En multicast existe también una tabla que se conoce como MFIB (Multicast Forwarding Information Base) almacenada en los routers. Mantiene variables de estado y distintas entradas (S, G), cada una tiene la información de reenvío necesaria para la entrega de paquetes multicast que entran por una interfaz. En conclusión, existen tres tipos de tablas en multicast:  Las tablas propias de cada protocolo de enrutamiento (MRIB).  Una tabla de enrutamiento general formada con la información de los diferentes protocolos de enrutamiento.  Las tablas MFIB directamente usadas para controlar el reenvío de un flujo multicast. Si un router soporta múltiples protocolos de enrutamiento multicast, su tabla MRIB (Multicast Routing Information Base) incluirá rutas generadas por cada uno de los protocolos, entonces el router deberá escoger la ruta óptima basándose en las políticas de reenvío y la configuración de enrutamiento multicast establecida. Luego la ruta se asigna como entrada en la tabla MFIB. PIM se basa en un protocolo de recolección de topología subyacente para rellenar la MRIB con rutas. Las rutas de esta tabla se pueden tomar directamente de la tabla de enrutamiento unicast, o pueden ser diferentes y proporcionados por un protocolo de enrutamiento por separado como MBGP (Multicast Border Gateway Protocol). Independientemente de la forma en que se crea, el papel principal de la MRIB en el protocolo PIM es proporcionar al router del siguiente salto en una trayectoria compatible con multidifusión para cada subred de destino. La MRIB es utilizada para determinar el siguiente salto a donde enviar un mensaje Join/Prune. Los datos fluyen a lo largo del camino de retorno de los mensajes Join. Por lo tanto, en contraste con RIB, que especifica el siguiente salto que un paquete de datos necesita para llegar a alguien de una subred, la MRIB da información del camino inverso e indica como un paquete de datos multicast puede ir de su origen al router de la subred que tiene la MRIB. 3.5.4.1 PIM-DM El protocolo de enrutamiento PIM-DM (Protocol Independent Multicast Dense Mode) puede trabajar con cualquier protocolo de enrutamiento unicast y está diseñado para ser eficiente con grupos densos. Este protocolo asume que cuando una fuente inicia el envío de algún streaming, todos los computadores quieren recibir ese flujo, por lo que se distribuye en todas las redes conectadas con soporte PIM. Si alguna red no tiene miembros de grupo interesados, el router debe enviar un mensaje Prune por la rama del árbol, a fin de que los routers de la rama actualicen la variable de estado referente al dispositivo. Cada cierto tiempo el proceso de inundación se repite para mantener actualizado los cambios de fuente, cambios de miembros de grupos o cambios en dispositivos intermedios, generando mucho tráfico en las redes involucradas. Para el enrutamiento multicast es importante conocer si el camino por el que llega el flujo de datos es el correcto, para esto se usa el mecanismo RPF Check (Reverse Path Forwarding Check) que verifica en la MRIB si la interfaz de entrada del paquete 37 multicast es la misma que se usaría para llegar al origen de manera óptima bajo unicast, actualizando así la MRIB. Cuando un paquete multicast es recibido de una fuente S para un destino G, el router primero busca en su tabla MFIB y hace lo siguiente:  Si la entrada (S, G) existe y la interfaz sobre la cual el paquete llega se refiere a la interfaz de entrada de la tabla, el router reenvía el paquete.  Si la entrada (S, G) existe pero la interfaz por la cual llega el paquete no corresponde con la interfaz de entrada en la tabla, se aplica un RPF Check. En caso de éxito se reenvía el paquete y se actualiza la entrada en la tabla MFIB. En caso de fallo el paquete se descarta.  Si la entrada (S, G) no existe, se aplica un RPF Check. Si el RPF Check es exitoso, el router crea una entrada para (S, G) en la tabla MFIB y el paquete se reenvía. De otro modo el paquete es descartado (ver Figura 3.20 tomada de [20]). Figura 3.20: Éxito y Fallo de RPF Check Una desventaja de PIM-DM es que cada router debe almacenar un árbol SPT, lo que compromete los recursos de los dispositivos intermedios, más aún si el número de miembros de un grupo es pequeño o cuando los grupos están distribuidos de forma dispersa. Figura 3.21: Cabecera de Mensajes de Control PIM Todos los mensajes de control PIM tienen la cabecera de la Figura 3.21 tomada de [18] que se referencian a continuación:  Version: En el caso de PIM el valor es 2.  Type: Describe tipos específicos de mensajes PIM y sus valores pueden ser:  0 = Hello.  1 = Register (Solamente para PIM-SM).  2 = Register Stop (Solamente para PIM-SM).  3 = Join/Prune (Join es solamente para PIM-SM).  4 = Bootstrap (Solamente para PIM-SM).  5 = Assert.  6 = Graft.  7 = Graft Ack.  8 = Candidate RP Advertisement (Solamente para PIM-SM).  9 = State Refresh. 0 Version 3 4 7 8 15 16 31 Type Reserved Checksum 38 PIM-DM utiliza mensajes Hello para detectar los routers de la red con soporte PIM. Estos mensajes se envían con multicast periódicamente por las interfaces y cuando son recibidos los routers deben registrar la interfaz junto con la información obtenida en el campo de Option Type. Los mensajes PIM Hello tienen el formato de la Figura 3.22. Figura 3.22: Formato de Mensaje PIM Hello El campo Option Type puede tener los siguientes valores:  0 = Reservado.  1 = Hello Hold Time. Se refiere al tiempo que debe mantenerse el registro del vecino alcanzable.  2 = LAN Prune Delay. Se utiliza para ajustar el retardo de propagación del mensaje Prune.  3-16 = Reservado.  17 = Para ser asignado por la IANA.  18 = Obsoleto y no debe ser usado.  19 = DR Priority (Solamente PIM-SM).  20 = Generation ID. Es un valor aleatorio para la interfaz por la que se envía el mensaje Hello.  21 = State Refresh Capable. Intervalo de actualización del router expresado en segundos.  22 = Bidir Capable.  23-65000 = Para ser asignado por la IANA.  65001-65535 = Reservado para uso privado. Los mensajes Prune generan sobre la interfaz del router un estado Pruned con un temporizador que al vencer deshace dicho estado. Estos mensajes intentan regresar al origen del árbol de distribución viajando de un router a otro, sin embargo, la propagación se detiene en el caso que un router tenga otros miembros del mismo grupo en cuestión. Por esto nace la necesidad de almacenar un estado con la dirección IPv4 y la interfaz asociada al emisor del mensaje Prune. Si una vez podada una rama del árbol aparece un nuevo miembro del grupo en dicha rama, se utiliza el mensaje Graft para volver a incorporarla al árbol de distribución. Los mensajes Graft no pueden utilizarse para incorporar en la emisión multicast a nuevos routers que se inicien en la red ya inundada (por ejemplo routers que se han encendido después de iniciar la emisión). Para dar oportunidad de participar a estos routers, el mecanismo de inundación se repite en PIM-DM cada 3 minutos. Este mecanismo podría hacer innecesario el Graft, sin embargo su utilización permite reducir la latencia en la incorporación de nuevos miembros al grupo. 0 Version 3 4 7 8 15 16 31 Type Reserved Checksum Option Value Option Type Option Lenght .. .. Option Type Option Lenght Option Value 39 Existen casos en que los routers que se encuentran en un mismo enlace son transmisores del mismo flujo multicast desde la fuente, así pues se incurre en el envío de paquetes duplicados dentro del segmento de red. Los mensajes Assert se envían entre los routers de un mismo segmento a fin de negociar quien será escogido como router reenviador del flujo multicast. Se definen tres reglas para la escogencia del reenviador:  El router que genere un Assert con la distancia administrativa más baja es elegido como ganador.  Si la distancia administrativa es la misma, entonces se compara la métrica de enrutamiento (obtenida de la MRIB). El que tenga menor valor en la métrica resulta ganador.  Si la métrica de enrutamiento resulta ser igual, el dispositivo con la dirección IPv4 más alta será elegido como el ganador. El mensaje State Refresh se repite cada 60 segundos para refrescar los árboles de distribución del flujo multicast. 3.5.4.2 PIM-SM El protocolo de enrutamiento PIM-SM (Protocol Independent Multicast Sparse Mode) está orientado a redes que tienen una gran presencia de miembros de grupo esparcidos. Se basa en árboles compartidos, centralizados en un punto de encuentro por grupo y distribuyendo el flujo de esta manera hacia los receptores, que además, según sea el caso pueden conmutarse y crear árboles del camino más corto hacia la fuente. Los puntos de encuentro se conocen como Rendezvous Point (RPs), específicamente es un router que tiene que ser configurado para ser usado como la raíz de un árbol de distribución para un grupo multicast, es un punto en común que tienen todos los equipos de la red. Cada grupo multicast usa este árbol que permite comunicarse con el RP y los receptores del flujo. PIM-SM puede establecer cuál es el umbral de tráfico multicast a partir del cual los routers puedan conmutar de RPT a SPT. En un dominio PIM-SM, también existe un DR (Designated Router) y un BRS (Bootstrap Router), estos participan durante el mantenimiento y la creación del árbol RPT respectivamente. El BSR seleccionado mantiene informados a todos los routers del dominio sobre el actual RP para cada grupo multicast y el DR se comunica con el RP para indicarle los estados de las fuentes de datos y los receptores. El BSR permite descubrir al RP mediante el siguiente procedimiento:  Los candidatos a RP se hacen conocer mediante los mensajes Candidate RP Advertisement o conocido también como RP Discovery, informando su dirección IPv4 y los grupos donde puede prestar servicio, este mensaje se envía a la dirección 224.0.1.40.  Se distribuye la información de todos los routers candidatos a todos los routers PIM- SM a la dirección 224.0.1.39 (RP Announce). El BSR será el router con más alta prioridad configurada, pero si existen múltiples candidatos con prioridad alta se escogerá el que tenga la dirección IPv4 más alta [21]. 40 En una red local donde uno o más routers están trabajando con PIM-SM, los emisores deben registrarse para poder emitir datos y los receptores también para poder recibir el flujo multicast de un grupo, para eso utilizan los mensajes Join/Prune (ver Figura 3.23) que también funcionan para abandonar un grupo y podar el árbol compartido. La dirección de destino de esos mensajes no es el RP o la fuente, sino la dirección multicast 224.0.0.13 propia de PIM, por tanto sólo se mandan al siguiente router. El siguiente router, en función del mensaje recibido y su información de estado multicast, decide si debe o no, propagar el Join o Prune al siguiente router hacia la fuente. Figura 3.23: Formato de Mensaje Join/Prune A continuación se describen los campos más relevantes del mensaje Join/Prune:  Upstream Neighbor Address: Es la dirección IPv4 a la que se refiere el vecino del camino inverso (RPF). Este es el router que envió previamente el mensaje Join/Prune.  Num Groups: Se refiere al número de grupos multicast contenidos en el mensaje.  Holdtime: La cantidad de tiempo que un receptor debe mantener el mensaje en su poder. Si el valor es 0xFFFF, el receptor debe mantener el estado hasta que sea cancelado por una política local.  Multicast Group Address: Tiene la dirección multicast del grupo codificada.  Number of Joined Sources: Número de fuentes a incluir para el grupo especificado en el campo Multicast Group Address.  Number of Pruned Sources: Número de fuentes a excluir para el grupo especificado en el campo Multicast Group Address.  Joined Source Address: Es la dirección multicast fuente de la que se desea recibir el flujo multicast. 0 Version 3 4 7 8 15 16 31 Type Reserved Checksum Num GroupsReserved Upstream Neighbor Address (Encoded-Unicast format) Holdtime .. .. Number of Joined Sources Number of Pruned Sources Joined Source Address 1 (Encoded-Source format) Multicast Group Address 1 (Encoded-Group format) .. .. Joined Source Address r (Encoded-Source format) Pruned Source Address 1 (Encoded-Source format) Pruned Source Address s (Encoded-Source format) .. .. Number of Joined Sources Number of Pruned Sources Joined Source Address 1 (Encoded-Source format) .. .. Joined Source Address t (Encoded-Source format) Pruned Source Address 1 (Encoded-Source format) Pruned Source Address u (Encoded-Source format) Multicast Group Address n (Encoded-Group format) 41  Pruned Source Address: Es la dirección multicast fuente de la que se desea dejar de recibir el flujo multicast. Cuando un receptor desea unirse o abandonar un grupo multicast lo notifica al DR mediante IGMP. Así también si una fuente desea emitir un flujo debe notificarle al DR, que se encarga de enviar dichas peticiones encapsuladas al RP mediante unicast. El mensaje encapsulado enviado por el DR se conoce como Register y debe ser interpretado por el RP (ver Figura 3.24). Figura 3.24: Formato de Mensaje PIM Register Todo mensaje recibido por el DR debe encapsularse. El RP debe iniciar un mensaje Source Specific Join hacia la fuente S, creando así un árbol (S, G) en los routers a lo largo del recorrido. El RP estará recibiendo constantemente los paquetes encapsulados del DR, pero cuando comience a llegar el flujo de forma nativa entonces el RP estará recibiendo paquetes duplicados, teniendo que descartar los paquetes encapsulados y enviando un Register Stop (Figura 3.25) al DR para detener el envío de paquetes encapsulados [22]. El DR es elegido por ser el router con la dirección IPv4 más alta dentro de la subred. Figura 3.25: Formato de Mensaje PIM Register Stop Cabe mencionar el campo Group Address que representa la dirección de grupo registrada en el DR y el campo Source Address que representa la dirección IPv4 unicast de la fuente del grupo registrada. Existen dos variantes que nacen de PIM-SM, que son:  Source Specific Multicast (SSM): Sólo es soportado por modelos uno a muchos. PIM-SSM construye SPTs originados en la raíz del tráfico multicast. Los routers cercanos a receptores interesados son informados de la dirección IPv4 unicast del origen del tráfico multicast; por este motivo PIM-SSM no necesita RP.  Bidireccional (Bidir): La diferencia radica en el mecanismo usado para enviar los datos desde el origen al RP [4]. En PIM-SM, los datos son enviados usando algún tipo de encapsulado o árbol basado en el origen, en PIM-Bidir los datos fluyen al RP por medio del árbol compartido, el cual es un flujo de datos bidireccional a lo largo de las ramas. 3.6 Calidad de Servicio en IPv4 Se puede definir el término QoS (Quality of Service) como la cualidad de gestionar eficientemente el repertorio de recursos, que permiten la efectiva y adecuada 0 Version 3 4 7 8 15 16 31 Type Reserved Checksum B Reserved2 Multicast data packet N 1 2 0 Version 3 4 7 8 15 16 31 Type Reserved Checksum Group Address (Encoded-Group format) Source Address (Encoded-Unicast format) 42 comunicación; usando la red, como herramienta de transmisión de distintos medios, con el fin de garantizar el rendimiento de las aplicaciones a través de ella. Conceptos claves en QoS son: ancho de banda, jitter, latencia y pérdida de paquetes. El ancho de banda es la diferencia entre la frecuencia componente mayor y la menor, en un espectro de señal electromagnética. La latencia es el tiempo que tarda un computador en procesar la información, reensamblarla en un paquete, pasarla por las colas de gestión y colocarla en el medio. El jitter es la variación en el tiempo de llegada de un paquete con respecto a uno previo. Finalmente, la pérdida de paquetes es un suceso que ocurre generalmente cuando existen problemas de congestión en la red. Dado que la información circulante en Internet mayormente son datos, voz y videos, surgen requerimientos diferentes para cada uno, ya que poseen características diferentes, esto a fin de garantizar la calidad del servicio. Los paquetes de voz deben ser entregados en un mínimo de tiempo, de forma ordenada, tolerando pequeñas pérdidas durante la transmisión; por ello, es necesario que la red les otorgue la más alta prioridad de envío y sin retrasos, apoyados por la capa de transporte. En un video, los datos no admiten pérdidas de los paquetes, más sí retrasos; la red debe entregarlos de forma correcta y la aplicación debe poder retransmitir si es necesario además de proveer buffers para minimizar los retrasos excesivos. Si el video es en tiempo real, no pueden ocurrir pérdida ni retrasos de los paquetes. Los juegos de computadores son hoy en día un ejemplo completo en donde se mezclan, datos, voz y videos; por lo que toleran una mínima pérdida de paquetes y tienen una alta prioridad en la red para disminuir la latencia. Actualmente se puede dar prioridad a los paquetes de una red para ofrecer QoS [23]. IEEE 802.1p es la prueba inicial que mediante la inserción de una cabecera adicional, se puede establecer la prioridad de la trama. Esta técnica consta de tres bits que permiten ocho niveles de prioridad. Funciona en conjunto con el estándar IEEE 802.1Q. ToS (Type of Service) es la primera idea de calidad de servicio implementada en el formato de mensaje IPv4, añadiendo un campo de prioridad que es factible sólo en redes simples. Dada su aplicación, se sustituyó por el modelo DiffServ. Los servicios integrados (Integrated Services o IntServ) y diferenciados (Differentiated Services o DiffServ) permiten el soporte de aplicaciones multimedia en tiempo real. La diferencia está en que IntServ asigna un camino para cada aplicación, muy parecido a ATM, para ello, emplea el protocolo RSVP (Resource Reservation Protocol), [33] el cual sustenta cada camino dinámicamente escogiendo routers con carga muy suave para enviar el tráfico. DiffServ etiqueta los flujos y aplica una política sobre un grupo de datos, luego se marca el campo DSCP (Differentiated Services Code Point) con el código apropiado. Así cuando el paquete pasa por una red DiffServ, el DSCP indica el comportamiento de reenvío posible sobre el paquete, y si tiene muy poca prioridad puede llegar a ser descartado. Se comprende, de forma inherente, que gracias a la calidad de servicio, es posible brindar un servicio óptimo, respetando las expectativas de los clientes, fraccionando en distintos niveles de rendimiento la red, cuyo acceso tendrá un costo específico y controlado. 43 3.6.1 Real-Time Transport Protocol RTP (Real-Time Transport Protocol) surgió con la idea de crear un protocolo específico para la gran demanda de recursos en tiempo real por parte de los usuarios de Internet. Trabaja conjuntamente con el protocolo RTCP (Real-Time Transport Control Protocol), cuya función principal es proporcionar mecanismos de realimentación para informar sobre la calidad en la distribución de los datos. El protocolo RTP se establece en el espacio de usuario y se ejecuta, por lo general, sobre UDP, por tener menor retardo que TCP. RTP no garantiza la entrega de paquetes, ni la llegada de estos en el instante adecuado (heredado de UDP/IP). La función básica de RTP es multiplexar varios flujos de datos en tiempo real en un solo flujo de paquetes, pudiéndose enviar tanto en unicast como multicast. Los paquetes son numerados de la siguiente manera:  Se asigna a cada paquete un número mayor que su antecesor, esto será útil para que la aplicación conozca si ha fallado algún paquete o no en la transmisión.  Si ha fallado, al no tener un control de flujo, de errores, de confirmaciones de recepción, ni de solicitud de retransmisión, la mejor opción es la interpolación de los datos (rellenar con datos desconocidos entre dos o más valores conocidos). El timestamping es una característica muy importante para las aplicaciones de contenido multimedia en tiempo real. La idea es permitir que el origen asocie una marca de tiempo con la primera muestra de cada paquete. Las marcas de tiempo son relativas al inicio del flujo, por tanto, solo importa las diferencias entre dichas marcas de tiempo. Figura 3.26: Formato de Cabecera RTP El formato de cabecera RTP consta de 12 bytes variables, siempre y cuando no exista un identificador CSRC. En la Figura 3.26 se describen cada uno de los campos mostrados:  Version (V): El campo identifica la versión de RTP. Por defecto su valor es 2.  Padding (P): Indica si el paquete se ha rellenado a un múltiplo de 4 bytes. El último byte de relleno indica cuántos bytes deben ser ignorados (incluyéndose a sí mismo).  Extension (X): En caso de tener valor 1, indica que una cabecera de extensión con longitud variable debe ser añadida. Luego es que puede añadirse los identificadores CSRC.  CSRC Count (CC): Indica cuantos identificadores CSRC están presentes, pueden ser de 0 a 15, es decir, el número de fuentes contributivas ligadas al paquete.  Marker (M): Es un marcador específico de la aplicación, normalmente un marcador de inicio.  Payload Type (PT): Indica cuál es el algoritmo de codificación que se ha utilizado para que pueda ser interpretado por la aplicación (audio o video). 0 V=2 3 4 7 8 15 16 31 CC PT sequence numberP timestamp synchronization source (SSRC) identifier M 1 2 X 9 contributing source (CSRC) identifiers . . . . 44  Sequence number: Contador que se incrementa en cada paquete RTP enviado, aunque su valor inicial es aleatorio.  Timestamp: Indica cuándo se creó la primera muestra en el paquete. Un protocolo como RTP utiliza marcas temporales en los paquetes emitidos. Estas informaciones son la base de los cálculos que permiten evaluar el retardo y la fluctuación en un sistema de comunicación.  SSRC: Identifica la fuente que ha producido el paquete. Al principio de una sesión, cada participante escoge un número de SSRC. En este caso se habla de sincronización ya que la escala de tiempo establecida por la fuente va a servir de referencia a los receptores para restituir la información correctamente.  CSRC: Se utilizan cuando los mixers están presentes en el estudio. Un mixer es un receptor de un flujo desde distintas fuentes. En ese caso, el mixer es el origen de sincronización, y los SSRCs que han aportado su contribución se añaden en este campo (pueden existir de 0 a 15 entradas). RTP transporta las señales de audio o video codificadas. Los paquetes contienen una cabecera seguida de estas señales que permiten al destino conocer la codificación utilizada (campo PT) y así poder decodificar correctamente. Los números de tipo de contenido están especificados en [25]. A fin de proporcionar un mecanismo de control para el protocolo RTP, se creó RTCP. Este último se basa en la periódica transmisión de paquetes de control a todos los participantes de una sesión, ofreciéndole información sobre la calidad de los datos distribuidos por la fuente. El protocolo de la capa inferior debe proveer de la multiplexación de los datos de control, por ejemplo, utilizando números de puerto UDP separados. RTCP realiza cuatro funciones (tomado de [24]): 1. La función primaria es proveer una realimentación sobre la calidad en la distribución de los datos. Para multicast es de vital importancia diagnosticar las fallas. El envío de informes de realimentación de todos los participantes permite evaluar si el ámbito de una falla en la transmisión es global o local. 2. RTCP lleva un identificador persistente conocido como CNAME. Dado que el identificador SSRC puede cambiar si se descubre un conflicto o un programa es reiniciado, receptores requieren el CNAME para realizar un seguimiento de cada participante. Los receptores también pueden requerir el CNAME para asociar múltiples flujos de datos de un participante dado en una serie de sesiones RTP relacionadas, por ejemplo, para sincronizar audio y video. La sincronización entre la fuente y los destinos requieren que el NTP (Network Time Protocol) y las marcas de tiempo (timestamps RTP) se incluyan en los paquetes RTCP. 3. Las dos primeras funciones necesitan que todos los participantes envíen paquetes RTCP, por lo tanto, la tasa de envío de paquetes debe ser controlada a fin de que RTP pueda escalar a un gran número de participantes sin inconvenientes. Cada receptor de estos paquetes conoce el número de participantes existentes. Este número se utiliza para calcular la velocidad a la que se envían los datos RTP y los intervalos de transmisión entre paquetes RTCP por cada participante. 4. Una cuarta funcionalidad se basa en establecer sesiones para identificar a los participantes, es útil cuando estos entran y salen de una sesión sin un control de afiliación o un parámetro de negociación. 45 Es importante destacar que para el enrutamiento PIM-SSM, no es posible aún adaptar RTCP, ya que este último necesita reenviar los paquetes a todos los receptores vecinos a fin de realimentarse y controlar bien la tasa de flujo de los datos, pero en el protocolo SSM sólo existe una fuente y varios receptores. Se definen varios tipos de paquetes RTCP para poder llevar la información de control a los participantes:  SR (Sender Report): Conjunto de estadísticas de transmisión y recepción que provienen de participantes que son emisores activos.  RR (Receiver Report): Conjunto de estadísticas que provienen de participantes que son sólo receptores.  SDES: Están compuestos de varios elementos descriptivos de la fuente, incluido el CNAME.  BYE: Termina la sesión.  APP: Funciones específicas de una determinada aplicación. Cuando una sesión RTP es abierta, al mismo tiempo se abre una sesión RTCP implícita. RTP y RTCP son protocolos que se sitúan a nivel de aplicación, pueden utilizar transmisión unicast o multicast. RTP utiliza un número de puerto par, y RTCP el número de puerto impar que sigue a continuación. Los números de puerto utilizados por RTP y RTCP están comprendidos entre 1025 y 65535, sin embargo, por defecto son 5004 y 5005 respectivamente. 3.6.2 Real Time Streaming Protocol Se conoce como RTSP (Real Time Streaming Protocol) al protocolo de flujo de datos en tiempo real no orientado a conexión que se utiliza para definir el envío de información entre un servidor y un cliente. Durante una sesión, un cliente puede abrir y cerrar conexiones fiables de transporte con el servidor mediante peticiones RTSP. Este protocolo trabaja a nivel de aplicación y controla que la entrega de datos se realice correctamente, pues el tipo de contenido con el que se trabaja normalmente al hacer streaming es muy sensible a la sincronía temporal (o a la falta de ella). Así pues se podría considerar que RTSP actúa como un control remoto en la red para servidores multimedia. RTSP define diferentes tipos de conexión y diferentes conjuntos de requisitos para intentar conseguir siempre un envío lo más eficiente posible a través de redes IPv4. Controla uno o más flujos de datos sincronizados (audio y video). A tal fin se definió el uso de sesiones, mediante un identificador único del protocolo. Además, RTSP es independiente del protocolo de transporte y puede funcionar con UDP o TCP. Los flujos controlados por RTSP pueden usar RTP como hemos visto, pero el modo de operación de RTSP es independiente del mecanismo de transporte usado para transmitir el continuo flujo de datos. Sin embargo, en la mayoría de casos se utiliza TCP para el control del reproductor y UDP para la transmisión de datos con RTP. RTSP es intencionalmente similar en la sintaxis y en su operación al HTTP, aunque difiere en muchos aspectos según [26], tales como:  RTSP introduce nuevos métodos y tienen un identificador de protocolo diferente. 46  Los servidores RTSP necesitan mantener estados por defecto en casi todos los casos (contrario al estado natural de HTTP).  Tanto el servidor como los clientes pueden emitir solicitudes RTSP.  Las solicitudes de URI (Uniform Resource Identifier) contienen la ruta absoluta del recurso. HTTP lleva sólo la ruta absoluta en la solicitud y devuelve el nombre de host en un campo de la cabecera separada. Entre las operaciones soportadas por RTSP está el proporcionar contenidos multimedia desde un servidor dedicado: El cliente puede pedir una descripción de la presentación vía HTTP o cualquier otro método. Si la presentación está hecha con multicast, la descripción de la presentación contiene la dirección de grupo multicast y los puertos que se deben usar para la recepción del flujo. Si por el contrario la presentación es enviada con unicast, el cliente proporcionará el destino por razones de seguridad. Un ejemplo de URL en RTSP es: rtsp://media.ejemplo.com:554/demo/audio y se expresa detalladamente en la Tabla 3.4: Sección URL Descripción rtsp:// Es el identificador para el esquema TCP, en caso de ser rtspu:// indica UDP. media.ejemplo.com Nombre de Dominio FQDN (Fully Qualified Domain Name) 554 Es el puerto empleado en la comunicación. Demo Refiere al nombre de la presentación Audio Refiere al nombre del flujo de la presentación Tabla 3.4: URL para RTSP Es posible también que un servidor de streaming pueda ser invitado a unirse a una conferencia ya existente, para reproducirla en una presentación. Este modo es muy útil para la distribución de aplicaciones educacionales. Adicionalmente, puede añadirse contenido multimedia a una presentación existente. Es muy útil para presentaciones en vivo que el servidor pueda avisar al cliente sobre los nuevos contenidos adicionales disponibles. Existen métodos definidos para que los clientes y servidores de streaming puedan comunicarse con RTSP. Los métodos son sensibles a mayúsculas y minúsculas. A continuación se explican los métodos establecidos por [26]:  SETUP: El cliente inicia una solicitud especificando todos los parámetros de transporte tales como el protocolo a utilizar para la transmisión de los datos, y el método de transmisión (multicast o unicast), así como el puerto del cliente. Un cliente también puede usar este método sobre un flujo que está siendo transmitido por el servidor. El servidor puede permitir o no la reserva de los recursos. El servidor asigna los recursos, los puertos y establece la sesión.  PLAY: Indica al servidor cuando debe comenzar el envío de datos, con los parámetros especificados en SETUP. El cliente nunca deberá enviar una petición PLAY sin antes haber recibido una confirmación SETUP. El rango NPT (Normal Play Time) indica la posición absoluta del flujo con respecto al inicio.  PAUSE: Detiene temporalmente el flujo de datos y coloca un Pause Point para saber dónde continuar si el flujo es reanudado.  TEARDOWN: Petición para detener completamente el flujo de datos y liberar los recursos asociados. 47  OPTIONS: Esta petición puede ser enviada en cualquier momento y no influye en el estado de la sesión. Es utilizada en el inicio para establecer la sesión con los parámetros necesarios, la versión y los métodos soportados por el servidor.  DESCRIBE: Obtiene una descripción del objeto requerido por la solicitud de un URL a un servidor. Éste puede usar la cabecera Accept para especificar los formatos que el cliente entiende. El servidor responde con una descripción del recurso solicitado.  GET_PARAMETER: Como su propio nombre indica, sirve para recuperar el valor de algún parámetro de la presentación en curso. El servidor responde con la información solicitada por el cliente.  SET_PARAMETER: Sirve para establecer el valor de un parámetro de la presentación en curso. El servidor asigna el valor al parámetro si existe. 3.7 Televisión sobre IP Desde sus inicios la televisión es el mayor entretenimiento de millones de personas y se ha ido mejorando constantemente para satisfacción de los televidentes. El broadcast en televisión se forma por corrientes de video que se distribuyen a todos los usuarios que tengan un receptor, esta metodología de transmisión sigue siendo utilizada por las televisoras locales de Venezuela. Inicialmente, los consumidores reciben las señales de televisión provenientes de las antenas de difusión ubicadas en sitios muy altos. Estas señales son recibidas por antenas y llevadas a los receptores de televisión. Así también, se ha vuelto popular la televisión por cable que sustituye el uso de antenas por un cable coaxial, pero los consumidores siguen recibiendo servicios de difusión broadcast. Hasta ahora fue que las compañías de cable implementaron decodificadores que permiten interpretar la señal de televisión que viene digitalizada. Actualmente, entró en escena la televisión satelital en Venezuela, que aún se encuentra en fase de prueba por CANTV (Compañía Anónima Nacional de Teléfonos de Venezuela). En este caso los consumidores reciben un paquete limitado de canales de televisión, ofrecido por el satélite venezolano Simón Bolívar (VENESAT-1). Las transmisiones en vivo pueden aprovechar la eficiencia de multicast ya que cada usuario recibe exactamente la misma información al mismo tiempo. Si un nuevo receptor se une tardíamente a la transmisión en vivo, el nuevo usuario sólo puede ver el contenido a partir del momento en que se une. 3.7.1 Televisión Analógica Todos los sistemas de televisión se basan en los mismos principios de producción, la diferencia radica en cómo se transmiten los datos al usuario final. El primer sistema de televisión fue analógico, está en uso desde hace 50 años. En un sistema analógico la información se transmite mediante alguna variación infinita de un parámetro continuo como puede ser la tensión en un hilo o la intensidad de flujo de una cinta. Dentro del ancho de banda permisible, cualquier forma de onda es válida. No es posible detectar y corregir un error de base de tiempo en un sistema analógico, por lo que un error de tensión tan sólo hace variar un valor de la señal que es transmitida como válida. En una señal analógica se puede sospechar que existe ruido, pero no se puede diferenciar en tiempo real entre la señal original y qué proporción de la señal recibida corresponde al ruido, esto implica que un sistema análogo es incapaz de detectar distorsiones en tiempo real. 48 Cuando una señal de video compuesto se transmite sobre las ondas de aire por una estación de televisión, lo hace a una frecuencia específica. En esta propagación de ondas se envían las imágenes en movimiento junto al sonido. Las frecuencias televisivas más comunes son VHF (Very High Frecuency) y UHF (Ultra High Frecuency). Los sistemas receptores de televisión utilizan la técnica de barrido de imagen, tanto horizontal como vertical. El barrido horizontal es una agrupación de puntos que se proyectan a lo largo de la pantalla de izquierda a derecha para formar una línea. El barrido vertical es el encargado de formar una imagen, para ello utiliza las líneas horizontales ya creadas y las barre de arriba hacia abajo. La frecuencia con la que se proyectan estas líneas en la pantalla crea sensación de continuidad y conforman la imagen que se ve en el sistema receptor de la señal. A partir de esto, se argumenta que la resolución de la imagen se define por el número de líneas horizontales y por el número de elementos en cada línea. Debido al desarrollo acelerado de la televisión analógica se establecieron estándares, entre los cuales se encuentran:  NTSC (National Television System Committee): Representa la ampliación del tradicional sistema monocromático que codifica y transmite televisión a color en modo entrelazado. Utiliza 484 líneas para resolución vertical y 400 líneas para resolución horizontal, con una velocidad de 30 frames por segundo, mostrando una resolución de imagen de 720x480 pixels. Es utilizado en América y Japón.  PAL (Phase Alternation Line): Para transmitir la información a color de una señal de video se necesita invertir la fase en cada línea. Es utilizado en África, Asia, Europa y Australia. Presenta mejor calidad que NTSC con una resolución de 720x756 pixels. Define la señal de luminancia como rojo, verde y azul, (R, G, B) y la señal de crominancia como azul, rojo y amarillo (B, R, Y) respectivamente.  SECAM (Séquentiel Couleur Avec Mémoire): Basa su codificación del color en modular la frecuencia (FM). Tiene la misma resolución que PAL (720x756 pixels), utiliza una señal de luminancia y dos de crominancia. Parámetro NTSC PAL SECAM Frames/Segundo 29.97 25 25 Líneas/Campo 525/60 625/50 625/50 Frecuencia Horizontal 15.734 kHz 15.625 kHz 15.625 kHz Frecuencia Vertical 60 Hz 50 Hz 50 Hz Ancho de Banda de Video 4.2 MHz 5.0 MHz 5.0 MHz Portadora de Sonido 4.5 MHz 5.5 MHz 5.5 MHz Relación de Aspecto 4:3 4:3 4:3 Tabla 3.5: Comparación de Parámetros en Televisión Analógica La Tabla 3.5 presenta un cuadro comparativo de los parámetros principales de los sistemas de televisión analógica conocidos a nivel mundial. 3.7.2 Televisión Digital Abierta La televisión digital abierta (TDA) permite una mejora en la producción, transmisión y recepción de la imagen y amplía la oferta disponible tanto en el número de canales como en la productividad del sistema. La fase de producción en la televisión digital es donde se generan y captan las imágenes o sonidos, los cuales son tratados para 49 conformar contenidos audiovisuales. La fase de transmisión incluye todos los procesos adecuados para adaptar la señal de televisión al canal radioeléctrico por el que será transmitido el contenido. Esta fase es la que en realidad define cuando la televisión es digital o analógica (ver Figura 3.27). La TDA está compuesta por TDT (Televisión Digital Terrestre), TDC (Televisión Digital por Cable) y TDH (Televisión Directa al Hogar), esta última es vía satelital. Figura 3.27: Televisión según sus Fases La fase de recepción, que depende en su mayor parte del usuario final, requiere la adquisición de los equipos adecuados para poder recibir los contenidos digitales. En la Tabla 3.6 se pueden apreciar los requisitos básicos por fase para migrar a televisión digital. Fase Requisitos Producción  Inversión en sustitución y renovación de hardware y software.  Formación profesional.  Reorganización de las estructuras de producción y de las rutinas profesionales. Transmisión  Adaptación y renovación de la infraestructura de radiodifusión.  Ampliación de la cobertura de radiodifusión. Recepción  Adaptación de las infraestructuras de captación y distribución de la señal en las viviendas.  Renovación de los receptores.  Guías para manipulación de los equipos y programas interactivos. Tabla 3.6: Requisitos para Implementar TDA El tema de la digitalización fue abordado en momentos que no era una necesidad para la sociedad lo que causó poco impacto y baja penetración en el mercado. Sin embargo, la aceptación de migrar tecnológicamente a TDA está ahora presente. La compatibilidad de TDA no se puede garantizar a nivel mundial, sin embargo, determinados países han venido implementando similarmente los estándares creados para difundir el servicio de televisión. Entre ellos se encuentran:  ATSC (Advanced Television Systems Committee): Es un comité creado en 1982 compuesto por aproximadamente 170 miembros que buscan regular los estándares de Televisión Digital. Crearon el estándar ATSC usado en Estados Unidos desde 1998 y posteriormente adoptado en Canadá y Corea del Sur.  DVB-T (Digital Video Broadcasting): Es un estándar europeo definido y formado por un conjunto de documentos que delimita los estándares de transmisión. Televisión digital Televisión analógica Transmisión analógica Producción digital Transmisión digital Producción analógica Televisión analógica Transmisión analógica Producción digital 50  ISDB-T: Es un estándar japonés creado en 1999 por varias empresas y operadoras de Televisión, utiliza una modulación COFDM.  DTMB: Es un estándar chino que fue definido en el año 2006 y recibió la aprobación final de la República Popular de China en agosto del año 2007. La transmisión de datos es implementada mediante el estándar TDS-OFDM.  ISDB-Tb: Es un estándar que tuvo una variante en Brasil quien mejoró los esquemas de codificación pasando de MPEG-2 a MPEG-4. El objetivo de cada país o región es proteger los intereses locales, tanto de transmisores como de receptores; y buscar introducir su estándar en los demás países del mundo. Todos estos sistemas adoptan diferentes patrones de modulación de la señal de difusión, transporte de flujos de audio, video, datos y aplicaciones; codificación, calidad de audio, video y servicios middleware. En Sudamérica, a excepción de Brasil, los países no hay desarrollado tecnologías de televisión digital, adoptando así estándares desarrollados por otros países. Elegir un estándar requiere considerar varios factores técnicos y comerciales, además de aspectos de cooperación en materia de transferencia tecnológica para el desarrollo de la industria local. La Tabla 3.7 tomada de [31] nos muestra los estándares adoptados por algunos países latinoamericanos. Cada país ha expresado públicamente el año en que realizará el apagón tecnológico, para esa fecha no deben existir transmisiones de señales analógicas y ya debería haberse migrado totalmente a TDA. País Estándar Año para Apagón Analógico Argentina ISDB-T 2018 Brasil ISDB-T 2016 Bolivia ISDB-T Sin definir Chile ISDB-T 2017 Colombia DVB-T 2017 República Dominicana ATSC 2015 El Salvador ATSC 2019 Honduras ATSC Sin definir México ATSC 2015 Nicaragua ISDB-T Sin definir Panamá DVB-T 2020 Perú ISDB-T 2020 Uruguay ISDB-T 2015 Venezuela ISDB-T 2020 Tabla 3.7: Estándares TDA en Latinoamérica La ventaja más notable de TDA se basa en la mejora de la calidad de la imagen y del sonido. La digitalización de la señal de televisión permite que por el ancho de banda permitido se puedan transmitir distintos tipos de resolución. SDTV (Standard Definition Television) tiene una resolución similar a la analógica 720x480 pixels, HDTV 720p (High Definition Television) con una resolución de 1280x720 pixels y HDTV 1080p (Full High Definition) con una resolución de 1920x1080 pixels. La imagen al tener mayor resolución tiene mejor calidad, permitiendo una relación de aspecto 16:9. En cuanto al audio, la TDA puede transmitir hasta en seis canales distintos, similar a los Home Teather. Otra ventaja del TDA es su inmunidad al ruido. Las señales analógicas se ven afectadas cuando hay interferencia de otro canal adyacente, también cuando hay cambios de contraste en la imagen o el efecto lluvia. Si la potencia de la señal digital no llega al receptor por encima del umbral definido la imagen no se muestra, a diferencia 51 de la señal analógica que muestra la imagen con calidad degradada. La TDA utiliza varios buffer que dan tiempo a recuperar rápidamente la señal enviada por el transmisor (desfasando un poco el tiempo real de la señal). Una señal TDA puede ser modulada en su transmisión con 16 QAM (Quadrature Amplitude Modulation), 32 QAM, QPSK (Quadrature Phase Shift Keying), PAM (Pulse Amplitud Modulation) y OFDM (Orthogonal Frecuency Division Multiplexing). Un framework para el desarrollo de televisión digital interactiva es Ginga. Es el nombre que se le da a un middleware de código abierto desarrollado en Brasil. Está compuesto por un conjunto estandarizado de tecnologías e innovaciones, con características de mayor resolución de audio, video e interactividad. Dependiendo de la funcionalidad del diseño de cada aplicación interactiva, un modelo de desarrollo de aplicaciones es más adecuado que otro. El middleware4 Ginga puede ser dividido en tres sistemas principales:  Ginga-CC (Ginga Common-Core): Es el núcleo del sistema y da soporte para el uso de ambientes declarativos.  Ginga-J: Desarrollado por la Universidad Federal de Paraíba para dar soporte a la ejecución de aplicaciones basadas en lenguaje de procedimientos Java, llamados Xlet.  Ginga-NCL: Desarrollado por la Pontificia Universidad de Rio de Janeiro, tiene como función soportar la presentación de contenidos escritos en lenguaje NCL (Nested Context Language), con facilidades en torno a la interactividad, sincronismo espacio- tiempo de objetos de media, adaptabilidad y soporte a múltiples dispositivos. Las aplicaciones desarrolladas con Ginga pueden ser probadas en un programa conocido como Virtual Set Top Box. Es instalado en una máquina virtual con sistema operativo Linux bajo distribución Ubuntu, siendo una herramienta importante para las pruebas de las aplicaciones Ginga NCL. Utiliza los recursos necesarios de procesamiento y de memoria como un Set Top Box real, estando limitado por los paquetes instalados. El desarrollo de aplicaciones interactivas para televisión digital está tomando terreno entre los programadores, que ven dentro del mercado la posibilidad de interactuar con los usuarios. Está planteado implementar la educación a distancia (T-Learning), las operaciones bancarias (T-Bank), aplicaciones para prevención y orientación de posibles enfermedades menores (T-Health), aplicaciones para servicios gubernamentales (T- Government) y la posibilidad de poder adquirir productos anunciados directamente por la televisión (T-Commerce). 3.7.3 Diferencias entre TV Analógica y Digital Una de las diferencias más importantes entre la TV digital y la analógica es que al comprimirse la información en formato digital una emisora de TV puede colocar de 6 a 10 canales de programas en la misma banda ancha que ocuparía un canal analógico. Otra ventaja que la tecnología digital tiene sobre la analógica es que las señales digitales pueden ser comprimidas mejor que las señales analógicas. 4 Middleware: Software que intercomunica varias aplicaciones de software, ofrece un conjunto de servicios que hacen posible el funcionamiento de aplicaciones distribuidas sobre plataformas heterogéneas. 52 Para transmitir una imagen de televisión digital, se deben incluir en la señal todos los pixels de dicha imagen. Por ejemplo, la pantalla NTSC estándar incluye 535 líneas por 720 pixels, o sea un total de 378.000 pixels/frame, y esa cantidad de pixels se transmiten por el canal de televisión de 6 MHz de banda ancha. Una pantalla del estándar ATSC puede tener hasta 1080 líneas por 1920 pixels, lo que representan 2.076.600 pixels/frame, más de 5 veces la banda ancha de un canal de TV, sin incluir el sonido comprimido ni los datos. ATSC es un organismo gubernamental de EE.UU. encargado de definir los estándares para los nuevos sistemas de televisión digital. De los 18 formatos de DTV (Digital Television) que existen, 6 son formatos HDTV, 5 de los cuales están basados en escaneos progresivos y 1 en escaneo entrelazado. De los restantes formatos de DTV, 8 son de SDTV (4 formatos de pantalla ancha con una relación de aspecto 16:9 y 4 con formatos convencionales con una relación de aspecto 4:3), y los 4 restantes son formatos VGA (Video Graphics Array). Las estaciones de transmisión son libres de elegir en qué formato van a difundir su transmisión. Se presentan en la Tabla 3.8 los formatos usados en la televisión digital definidos por el estándar ATSC A/53: Formato Formato de imagen Relación de aspecto Velocidad de frame5 HDTV 1920x1080 16:9 30I, 30P, 24P HDTV 1280x720 16:9 60P, 30P, 24P SDTV 704x480 16:9 30I, 60P, 30P, 24P SDTV 640x480 4:3 30I, 60P, 30P, 24P Tabla 3.8: Formatos de Televisión Digital Las estaciones de transmisión están obligadas a comprimir el detalle de las imágenes y la alta calidad de sonido en la misma banda ancha de 6 MHz usado por la TV analógica y para ellos hace falta usar codecs. La televisión digital tiene las características principales siguientes en algunos casos:  Imágenes más amplias.  Mucho mayor detalle en las imágenes.  5.1 (5 + 1 canales = 6) canales independientes CD-quality Dolby.  Capacidad de enviar datos directamente a una pantalla o una PC.  Formato de pantalla 4:3 o 16:9 (relación de aspecto). 3.7.3.1 Relación de Aspecto El término Relación de Aspecto (Aspect Ratio) hace referencia al ancho de una imagen o pantalla en relación con su alto. Dicha relación suele expresarse de varias maneras, como por ejemplo 4x3 ó 4:3 ó 4/3, lo que significa que dicha imagen tiene 4 unidades de ancho por cada 3 unidades de alto. Alternativamente puede expresarse la relación como 1,33 (4 dividido por 3). 5 Progresivo (P) y Entrelazado (I) se refieren al sistema de escaneo de la imagen. 53 En cuanto a la relación de aspecto de 16:9 en HDTV, el formato de la imagen está definido para que las películas se muestren lo más preciso posible a cómo fueron diseñadas. Si se captura una imagen HDTV en una TV analógica con relación de aspecto 4:3, los formatos de las películas deben recortarse en sus lados izquierdo y derecho, perdiendo así el campo visual de la imagen. Si la imagen de captura es 16:9 el campo visual se pierde del lado superior en inferior de la imagen. Ambos casos se contemplan en la Figura 3.28 donde se demarca el área ignorada. Figura 3.28: Campo Visual en los Formatos 4:3 y 16:9 Una alternativa que se usa en la TV analógica para mostrar las películas 16:9 lo más cercano a cómo se diseñaron es poner dos barras negras en las partes superior e inferior para llenar el espacio extra; esta técnica se le conoce como formato letterbox. Así también, está la técnica pillarbox que se basa en colocar barras negras a la izquierda y derecha de la imagen. Ésta última resulta necesaria cuando la imagen de entrada es 4:3 y la salida tiene relación de aspecto 16:9. Ambos casos se muestran e la Figura 3.29. Figura 3.29: Técnicas de Relleno de Imagen Pillarbox y Letterbox 3.7.3.2 Escaneo Entrelazado y Progresivo Estos términos se refieren al sistema de escaneo de la imagen de TV. En el formato entrelazado, la pantalla muestra todas las líneas impares en un escaneo de la pantalla y luego sigue con todas las pares en un segundo escaneo. Cada uno de ellos se llama campos, y se muestran en forma sucesiva. Dado que hay 30 frames por segundo, la pantalla muestra una mitad del frame, es decir, un campo cada 1/60 de segundo. Para pantallas pequeñas, esto no se hace notar. Pero cuando el tamaño de la pantalla crece, el problema con el entrelazado es mayor (Figura 3.30). El formato progresivo muestra la pantalla entera por cada escaneo, las líneas escaneadas se muestran de arriba hacia abajo de un frame completo, lo que trae como consecuencia una imagen más alisada y pareja pero que requiere de un poco más de ancho de banda. 54 Figura 3.30: Diferencias de Señal Entrelazada y Progresiva 3.7.3.3 Desentrelazado de Video Los principales formatos de transmisión de señales de televisión (NTCS, PAL, SECAM) utilizan una señal de video entrelazada, donde sólo se transmiten alternativamente las líneas pares e impares de cada fotograma. De este modo, el ancho de banda de la transmisión se reduce a la mitad de una forma muy efectiva, ya que, debido a las características del sistema de visión humano, el parpadeo provocado por la eliminación de líneas es prácticamente inapreciable. No obstante, el auge de dispositivos que requieren un barrido progresivo de la señal de video (televisores de alta definición, DVDs, proyectores, etc.) ha fomentado el desarrollo de algoritmos de desentrelazado que realizan algún tipo de interpolación espacio-temporal para calcular las líneas no transmitidas. Entre los algoritmos de desentrelazado pueden distinguirse globalmente aquellos que utilizan un vector representativo del movimiento de la imagen para interpolar las líneas ausentes y los que no lo hacen [34]. Se mencionan 3 técnicas de desentrelazado: Weave, adaptativo y Bob. La técnica Weave es el método más sencillo de relleno de las mitades de imágenes. Consiste en mostrar de forma simultánea las imágenes impares y las pares. De este modo, la primera mitad de la imagen rellena las líneas vacías de la segunda mitad. Este método es apropiado cuando ambas mitades de la imagen se originan al mismo tiempo y se pueden intercalar sin que sea notorio. El desentrelazado adaptivo detecta las líneas que faltan en los campos y se añaden teniendo en cuenta los campos de alrededor. Los desentrelazadores adaptables buenos tienen en cuenta hasta cinco imágenes en ambas direcciones. Cuantas más imágenes tenga en cuenta el algoritmo, más se ralentiza el resultado. La técnica Bob detecta las líneas que faltan en los campos, por lo que se expande cada campo para formar una imagen completa. El resultado de esta técnica es la difuminación y la falta de algunos detalles horizontales. 3.7.4 Formatos de Compresión de Video Debido a que las redes tienen un ancho de banda limitado no es posible ni deseable transmitir las secuencias de video sin modificarlas. Para solucionar este problema de ancho de banda se han desarrollado una serie de técnicas de compresión de video e imágenes. Estas técnicas permiten reducir el tamaño de bits que son necesarios para la transmisión y almacenamiento del contenido. Hay actualmente dos principales organizaciones de estándares de formatos de video: la ITU (International Telecommunication Union) y la MPEG (Movie Picture Expert Group). La mayoría de los estándares internacionales fueron escritos por estos dos grupos y los principales estándares fueron aprobados por ambos (MPEG-1, MPEG-2 y MPEG-2 part 55 10 conocido como H.264). Además hay estándares propietarios como DivX (basado en MPEG-4 ASP) y Microsoft Media 9 (similar a H.264). La Tabla 3.9 compara los estándares de formatos de video dominantes en la industria actual: Formato/Estándar Objetivo Calidad Típica Comentarios MPEG-1 Estándar Internacional 1992. Alcanza video y audio verosímiles en grabación y transmisión a aprox. 1.5 Mbps. Calidad VHS a 1.5 Mbps. Resolución típica SIF (Source Intermediate Format). Casi todos los computadores soportan archivos MPEG-1. Usada típicamente para baja resolución de video, pero puede ser usada para cualquier resolución. Sólo progresivo. MPEG-2 Estándar Internacional 1993. Aplicaciones genéricas de alta velocidad incluyendo TV y broadcast. Alta calidad típicamente con resolución Full D1 (broadcast y DVD son MPEG-2) a 8 Mbps en sus comienzos y de 2 Mbps a 4 Mbps en la actualidad. Aplicaciones: DTV, HDTV, DVD, Digital cable, satélite y terrestre. Es el estándar más común. Soporta entrelazado. MPEG-4 parte 2 1998. Muy baja velocidad de codec, habilitando bajas velocidades de frame, baja resolución. Típicamente calidad moderada. En velocidades con full frame, calidad moderada/alta requiere una velocidad similar a MPEG-2. Entrega de contenido de video digital sobre Internet y dispositivos inalámbricos. Videoconferencias usando H.263 se basan en este estándar. MPEG-4 AVC (conocido como H.264). Todos los requerimientos desde HDTV de alta calidad hasta bajas velocidades de transmisión para redes celulares. Variedad de velocidades. Por ejemplo, Full D1 a 30 frames por segundo, calidad DVD a menos de 1 Mbps. CIF (Common Intermediate Format) a 256 kbps. Es el estándar más avanzado y se basa en los estándares previos MPEG. Tabla 3.9: Formatos de Compresión Dominantes en el Mercado Actual La palabra codec viene de codificador/decodificador. El codificador de video comprime los datos de video según un formato y encapsulación, eliminando la información superflua o duplicada. El resultado es un archivo que puede ser almacenado o 56 transmitido por streaming con bajo costo de ancho de banda. El decodificador descomprime los datos de video habilitando el playback del video. Todo esto envuelve algoritmos muy complejos que resultan pesados si la velocidad de transmisión es baja con altas relaciones de compresión de video. Inicialmente los codecs eran implementados por hardware y hoy en día son por software debido a que el poder de procesamiento de los computadores se ha incrementado notablemente. Esta es una ventaja porque es una solución barata y flexible dado que no se tiene que tener el mismo decodificador por hardware en el otro extremo para procesar la señal. La DTV se basa en un esquema de compresión y codificación conocido como MPEG-2 (Movie Picture Expert Group 2). En las técnicas de compresión existe un patrón de video que es una “información” 3D con una dimensión horizontal, otra vertical y la tercera temporal. La compresión en la dimensión de tiempo es diferente que la imagen 2D estática, debido a que el patrón de tiempo necesita sólo transmitir los cambios de un frame a otro. Pero usando un frame de base es posible construir continuos frames mediante la transferencia de pequeñas cantidades de datos que describen las diferencias entre dos frames continuos, hasta que un nuevo frame de base deba ser transferido. La compresión MPEG-2 es una técnica de interpolación para predecir cómo el patrón es creado desde el comienzo hasta el fin. La compresión MPEG está basada en este método y trabaja con tres clases de frame: IFrame (Intra Frame), P-Frame (Predicted Frame) y B-Frame (Bidirectional Interpolated Frame). La compresión 2D JPEG del frame estático es usada para comprimir el frame base (I- Frame). El algoritmo JPEG se basa en el análisis espectral del frame y se focaliza en los principales componentes de frecuencia de la imagen. La calidad de imagen requerida determina la relación de compresión. Cambiando la compresión en la dimensión temporal permite establecer el número de frames interpolados (B-Frame) y los frames previstos (P-Frame) que son almacenados entre un frame de base y otro. MPEG-1 es un estándar dirigido a aplicaciones de almacenamiento de video digital en CD. Por esta circunstancia, la mayoría de los codificadores y decodificadores MPEG-1 necesitan un ancho de banda de aproximadamente 1.5 Mbps. Para MPEG-1 el objetivo es mantener el consumo de ancho de banda relativamente constante aunque varíe la calidad de imagen, que es comparable con la calidad de video VHS. MPEG-2 es el estándar diseñado para video digital de alta calidad DVD, HDTV, medios de almacenamiento interactivo ISM, retransmisión de video digital DVB y televisión por cable. El estándar MPEG-2 se centra en ampliar la técnica de compresión MPEG-1 para cubrir imágenes más grandes y de mayor calidad. MPEG-2 también proporciona herramientas adicionales para mejorar la calidad de video consumiendo el mismo ancho de banda. Esta característica indica que se producen imágenes de muy alta calidad cuando lo comparamos con otras tecnologías de compresión. Por otro lado, este formato es muy bueno filtrando los detalles de las imágenes que el ojo humano ignora. La calidad de la imagen es muy buena y significativamente mayor que la calidad de la imagen de la TV analógica. Una TV digital decodifica la señal MPEG-2 y la muestra igual que como lo hace el monitor de un computador, dándole alta resolución y estabilidad (tomado de [35]). 57 Cuando se habla de MPEG-4 generalmente se refiere a MPEG-4 parte 2. Este es el estándar de transmisión de video clásico MPEG-4. Este estándar incorpora muchas más herramientas para reducir el consumo del ancho de banda en la transmisión y así ajustar una cierta calidad de imagen a una determinada aplicación. Otra mejora de MPEG-4 es el amplio número de perfiles y niveles de perfiles para aplicaciones relacionadas con transmisiones con poco ancho de banda (para dispositivos móviles) así como aplicaciones con una calidad amplia y gran demanda del ancho de banda. MPEG-4 AVC también denominado como H.264 por la ITU, corresponde a un desarrollo posterior en el que MPEG tiene un conjunto completamente nuevo de herramientas que incorporan técnicas más avanzas de compresión. El objetivo es reducir aún más el consumo de ancho de banda en la transmisión con una calidad de imagen buena. Formato Ancho de Banda Relación de Compresión MPEG-1 0,4 – 2,0 Mbps 100:1 MPEG-2 1,5 – 60 Mbps 30-100:1 MPEG-4 28,8 – 500 kbps 100-200:1 H.263 28,8 – 500 kbps 30:1 H.264 15 – 300 kbps 50:1 Tabla 3.10: Ancho de Banda en los Formatos de Compresión Existen diversos formatos de compresión propietarios que tienen sus propias características y no son compatibles con otros formatos como el SMPTE 421M. VC-1 (Video Codec 1) es el nombre informal para el codec de video estándar SMPTE 421M. Fue creado en abril del 2006 por SMPTE (the Society of Motion Picture and Television Engineers). Su implementación más popular es WMV9 (Windows Media Video 9). SMPTE es una organización internacional de desarrollo de estándares. VC-1 es una evolución del diseño del codec de video basado en DCT que también podemos encontrar en H.261, H.263, MPEG-1, MPEG-2 y MPEG-4. Maneja tres perfiles: simple, principal y avanzado. Los perfiles simple y principal fueron desarrollados originalmente para su uso en los entornos informáticos en red de bajo bit rate. Como tal, ciertas suposiciones fueron hechas en relación con el entorno de la pantalla (por ejemplo, relación de aspecto de pixels cuadrados) para mejorar la eficiencia de compresión. El perfil avanzado añade soporte de metadatos, para permitir una experiencia optimizada en una amplia gama de dispositivos de visualización [40]. La Tabla 3.11 muestra las recomendaciones de bit rate y resoluciones de video para el codec VC-1. Perfil Nivel Bit Rate Máximo Resoluciones por Frame Rate Simple Bajo 96 kbps 176 x 144 / 15 Medio 384 kbps 240 x 176 / 30 352 x 288 / 15 Principal Bajo 2 Mbps 320 x 240 / 24 Medio 10 Mbpss 720 x 480 / 30 (480p) 720 x 576 / 25 (576p) Alto 20 Mbps 1920 x 1080 / 30 (1080i) Avanzado Nivel 0 2 Mbps 352 x 288 / 30 58 Nivel 1 8 Mbps 720 x 480 / 30 (NTSC-SD) 720 x 576 / 25 (PAL-SD) Nivel 2 20 Mbps 720 x 480 / 60 (480p) 1280 x 720 / 30 (720p) Nivel 3 45 Mbps 1920 x 1080 / 24 (1080p) 1920 x 1080 / 30 (1080i) 1280 x 720 / 60 (720p) Nivel 4 135 Mbps 1920 x 1080 / 60 (1080p) 2048 x 1536 / 24 Tabla 3.11: Bit Rate y Resoluciones Recomendadas en VC-1 Es ampliamente caracterizado como una alternativa a los últimos codecs de video estándar ITU-T y MPEG. Además contiene herramientas de codificación tanto para secuencias de video entrelazadas como para codificación progresiva. El objetivo principal del desarrollo y estandarización de VC-1 es dar soporte a la compresión de contenido entrelazado sin tener que convertirlo primero a progresivo, haciéndolo más atractivo para profesionales de la industria de la difusión y el video. A pesar de que es ampliamente considerado como un producto de Microsoft, actualmente hay 15 compañías en el consorcio de la patente de VC-1 (en agosto del 2006). Como estándar SMPTE, VC-1 está abierto a implementaciones de otros, aunque se requiere hipotéticamente que los implementadores paguen una cuota por licencias al MPEG LA, al organismo de licencias LLC o directamente a sus miembros. Tanto HD DVD como Blu-ray han adoptado VC-1 como estándar de video obligatorio, lo que significa que sus dispositivos de reproducción de video deben ser capaces de decodificar y reproducir contenido de video comprimido con formato VC-1. Windows Vista y Windows XP con SP2 soporta parcialmente reproducción de HD DVD, incluyendo el decodificador VC-1 y componentes relacionados que son necesarios para la reproducción de películas HD DVD codificadas con VC-1. 3.7.5 Formato de Encapsulación de Audio y Video Un formato multimedia es un tipo de archivo que almacena información de video, audio, subtítulos e información de sincronización siguiendo un formato preestablecido. Un formato contenedor contiene uno o varios flujos ya codificados por un codec. En general, hay un flujo de audio y uno de video. Los flujos que contengan pueden ser codificados utilizando diferentes codecs. Cuando se crea un contenedor, en primer lugar se produce la codificación de las pistas y posteriormente son multiplexadas siguiendo un patrón típico de cada formato. Cuando un archivo debe ser reproducido, en primer lugar actúa un decodificador, él cual conoce el patrón del contenedor y hace la demultiplexación del contenido, separando las pistas de audio y video. Una vez separadas las pistas, cada una de ellas es interpretada por el decodificador y es reproducida. Es necesario que el reproductor cuente con los decodificadores necesarios para reproducir tanto el video como el audio, de lo contrario la información no puede ser interpretada correctamente. Existe algo particular con MPEG, ya que es un formato de compresión de video y también es un formato contenedor de audio y video. Hay varios tipos de MPEG: Elementary Streams (ES), Program Streams (PS) y Transport Streams (TS). Cuando se reproduce por ejemplo un video MPEG de un DVD, el flujo MPEG está 59 compuesto por varios flujos, denominados flujos elementales ES. Un flujo es para video, uno para audio, otro para subtítulos y así sucesivamente. Estos flujos distintos se juntan para formar un único flujo de programa PS. Pero el formato PS no se encuentra adaptado para la difusión de video a través de una red o por satélite. El formato TS es la estructura que se define para la transmisión en medios susceptibles a errores. Este formato utiliza paquetes de longitud constante llamados paquetes de transporte. El streaming de video y audio de cada programa de televisión se comprime independientemente, formándose por cada uno de ellos una corriente elemental que puede tener tamaño variable. Para mantener el streaming total constante durante la transmisión se incluyen paquetes nulos de relleno. El tamaño del paquete TS es de 188 bytes. Este formato permite multiplexar varios programas dentro de un mismo flujo binario de datos. El formato PS es la estructura que define MPEG-2 para el almacenamiento de datos en medios libres de errores (como pueden ser los DVDs, discos duros, CD-ROMs, etc). Este formato está conformado por paquetes de longitud fija o variable y de gran tamaño (por ejemplo 2048 bytes). Solamente se pueden encontrar datos relativos a un único programa. El formato M2TS está basado en el contenedor MPEG-2 Transport Stream. Es utilizado con VBR (Variable Bit Rate) para optimizar el tamaño de almacenamiento en el computador. Los archivos M2TS soportan resoluciones de 720p y 1080p. El tamaño de estos paquetes es de 192 bytes, ya que incorporaron 4 bytes más que su predecesor. La cabecera adicional incluye timestamps para reordenar el contenido rápidamente en el receptor. Debido a que la televisión es una plataforma en tiempo real resulta altamente sensible a pérdidas y retardos. Generalmente, se utiliza una encapsulación del tipo M2TS para transmisiones con video de alta calidad y TS para transmisiones con video de menor calidad. La televisión digital es viable si se cuenta con algoritmos de compresión de video y audio que permitan reducir el consumo del ancho de banda necesario. El formato MKV (Matroska Video) es un formato contenedor de video totalmente libre. El nombre Matroska es en referencia a las muñecas rusas contenidas una dentro de otra. Este formato permite contener video (DivX, Xvid, RV9, etc), sonido (MP3, MP2, AC3, Ogg, AAC, DTS, PCM) y subtítulos (SRT, ASS, SSA, USF, etc.) en un mismo archivo. MKV está basado en una estructura derivada del XML llamada EBML (Extensible Binary Meta Language). Por lo tanto, gracias al formato Matroska, se pueden llevar a cabo funciones de capitulación, crear menús, realizar búsquedas en el archivo, seleccionar una fuente de sonido o elegir un subtítulo. El formato ASF (Advanced Systems Format) agrupa varias tecnologías de video desarrolladas por Microsoft. Lo admiten reproductores como la consola Xbox y todas las aplicaciones en Windows incluyendo Windows Phone. Usualmente, utiliza el codec de video VC-1 y el de audio WMA. Los archivos pueden tener las extensiones .wmv, .avi o .asf. Es un formato propietario de Microsoft. El formato Flash Video es un contenedor creado para transmitir videos en formato flash por Internet. Los videos de YouTube usan este formato y la mayor parte de la publicidad de las páginas de Internet. Para ver este formato en el navegador es necesario instalar el plugin de Flash Player, aunque reproductores como VLC lo soportan. Es un software 60 propietario, por lo que, para codificar videos en este formato es necesario programas de licencia paga como Macromedia Flash de Adobe. El formato AVI es un contenedor de video y audio creado por Microsoft. Puede contener un flujo de video y varios de audio usando distintos codecs (DivX, Xvid o Motion JPEG para el video y AC3 o MP3 para el audio). Los archivos AVI se pueden ver en casi cualquier reproductor, pero dependen de los codecs instalados en el sistema operativo. 61 4. Marco Metodológico 4.1 Red Actual de la Facultad de Ciencias Es importante recordar que el alcance del presente Trabajo Especial de Grado es la Facultad de Ciencias. Sin embargo, la infraestructura de red ya tiene definido el soporte multicast con IGMPv2 y enrutamiento con PIM-SM en el router principal (CORE) del núcleo Caracas según [4]. La Msc. Neudith Morales coordinadora de la Dirección de Tecnología de Información y Comunicaciones de la UCV trabajó en la adecuación del diseño de una red con un backbone redundante capaz de soportar nuevas tecnologías, como QoS. Además se incrementó el ancho de banda de los enlaces que parten del backbone hacia los usuarios; manteniendo siempre una estructura jerárquica y modular que permite la escalabilidad de la plataforma y facilita la detección y solución de fallas (según [36]). Figura 4.1: Extracto de la Red Corporativa de la UCV La Facultad de Ciencias dispone de un enlace de alta velocidad 10 Gbps hacia el CORE de la UCV como se observa en Figura 4.1. El enrutamiento multicast está habilitado en la Facultad de Ciencias y en el CORE principal, por lo que, todo dispositivo interconectado y con soporte capa 2 también disfruta de multicast. Así pues, realizar la transmisión del servicio de televisión desde un segmento de red en el router de la Facultad de Ciencias representa el contexto ideal para transmitir streamings. 4.2 Infraestructura para una Transmisión Multicast El despliegue de una red de televisión multicast requiere de 5 elementos fundamentales: la captura de la señal de televisión, el servidor de transcoding, el 62 servidor multicast, la infraestructura de red y el servidor web con base de datos que gestiona la interfaz de los clientes. En la Figura 4.2 se observa la infraestructura ideal para una transmisión multicast. La adquisición de contenidos de televisión en vivo fue concebida inicialmente como la captura vía microondas de los canales señal abierta que se encuentran en el aire. El contenido pregrabado se refiere a cualquier video en un formato adecuado para que los servidores lo entiendan, lo procesen y lo transmitan. La base de datos contiene la información mostrada a los clientes por otro servidor vía web. Los clientes son computadores que tengan navegadores web instalados, por lo que, actualmente se incluyen también muchos smartphones. Figura 4.2: Infraestructura para una Transmisión Multicast Las pruebas fueron realizadas en LACORE que posee computadores con características de hardware muy similares entre sí. La velocidad del procesador fue un inconveniente durante las pruebas tempranas, por lo que, se solicitó la colaboración a la Escuela de Computación de la Facultad de Ciencias quien prestó un computador de características superiores. Finalmente se utilizaron 2 computadores con el hardware que se muestran en la Tabla 4.1. Nombre de Servidor Descripción Servidor A (HP xw4600 Workstation) Procesador Intel Core 2 Duo E6750 (2.66 GHz). Tarjeta Madre Intel X38 Express. Memoria RAM 4GB. Disco Duro SATA 180GB. 3 Ranuras PCI. 1 Ranuras PCI Express x1. 1 Ranuras PCI Express x8 con soporte x4. 2 Ranuras PCI Express x16. 2 USB 2.0 Frontales. 7 USB 2.0 Traseros. 63 3 USB 2.0 Internos. Servidor B Procesador Intel Core i7 3770 (3.40GHz). Tarjeta Madre Asrock h61M-VG3 Memoria RAM 8GB. 2 Disco Duro SATA 500GB. 2 USB 2.0 Frontales. 4 USB 2.0 Traseros. 2 PCI Express x16 slots. 1 Ranura PCI. Tabla 4.1: Especificaciones de Hardware de Servidores Utilizados Para el presente Trabajo Especial de Grado se utilizan los nombres Servidor A y Servidor B. La solución planteada tiene a uno sólo de ellos en producción con todas las funcionalidades integradas para aprovechar al máximo el hardware disponible. 4.2.1 Captura de la Señal de Televisión El elemento receptor de la señal de televisión disponible para éstos dispositivos de captura inicialmente fue una antena de televisión tipo conejo doble aro (ver Figura 4.3.), sin embargo a mediados del Trabajo Especial de Grado se adquirieron equipos que capturan televisión digital. Figura 4.3: Antena de Televisión Conejo Doble Aro La antena de televisión conejo doble aro no tiene buena recepción en las dependencias de LACORE. La parrillera de canales de televisión está limitada al espectro permitido por CONATEL (Comisión Nacional de Telecomunicaciones) a nivel nacional. Pueden conectarse a esta antena múltiples sintonizadoras de televisión mediante el uso de un splitter, sin embargo, la señal se va degradando debido a la multiplexación del canal. Los equipos de televisión digital se compraron a las compañías: Telefónica Venezolana C.A. (Movistar) y Compañía Anónima Nacional Teléfonos de Venezuela (CANTV). A continuación en la Tabla 4.2 se describen los equipos. Modelo de Equipo Descripción Konka KHDS866 PVR-R 1 entrada coaxial para antena LNB. 1 salida coaxial para antena LNB. 2 salidas por RCA para audio. 1 salida por RCA para video. 1 entrada coaxial para TV. 1 salida coaxial para TV. 1 tarjeta de acceso CANTV con chip. 64 Huawei DS360 1 entrada coaxial para antena LNB. 1 salida coaxial para antena LNB. 2 salidas por RCA para audio. 1 salida por RCA para video. 1 tarjeta de acceso CANTV con chip. 1 puerto USB para almacenamiento. Echostar DSB-646V (Movistar) 1 entrada coaxial para antena LNB. 1 salida coaxial para antena LNB. 2 salidas por RCA para audio. 1 salida por RCA para video. 1 entrada coaxial para TV. 1 salida coaxial para TV. 1 tarjeta de acceso Movistar con chip. Tabla 4.2: Equipos de Televisión Digital CANTV y Movistar Las salidas RCA constan de video compuesto y dos entradas para sonido estereofónico referenciadas por los colores, amarillo, blanco y rojo, respectivamente. Es llamado así por ser la compañía Radio Corporation of America quien introdujo el diseño en el año 1940. La salida de S-Video (Separated-Video) tiene todo el video en un mismo cable pero no transporta audio. Dispone de información independiente sobre el brillo y el color. Por esta razón S-Video tiene mucha más calidad que el video compuesto y es usado también para conectar VCRs o videograbadoras. La principal intención de hacer pruebas con estos decodificadores es obtener una imagen de mejor calidad con las sintonizadoras de televisión. El decodificador de movistar (ver Figura 4.4) tuvo un costo de adquisición de Bs. 1.300,00 para julio del 2014. La recepción es SDTV por lo que la calidad de la imagen aunque es buena (resolución de 720x480 pixels) no es mejor que HDTV. El plan de televisión suscrito tiene un costo de Bs. 264,43 y ofrece una parrillera de 69 canales de programación variada incluyendo los canales nacionales. Figura 4.4: Decodificador Echostar DSB-646V de Movistar La tarjeta de acceso que utiliza el decodificador Movistar es a base de chip (ver Figura 4.5). Está asociada al equipo en los seriales que la identifican. En caso de que se intente colocar otra tarjeta de acceso que no pertenezca al decodificador se bloquea el acceso a la programación. Figura 4.5: Tarjeta de Acceso Decodificador Movistar 65 La antena que utiliza el decodificador movistar es de tipo parabólica y tiene adaptado un LNB simple de banda Ku (ver Figura 4.6). La instalación se hizo por personal técnico de la empresa, bajo previa autorización de la dirección de la Escuela de Computación. Se utilizaron aproximadamente 30 metros de cable coaxial y 2 terminales BNC. La antena se ubicó en el techo de la división de control de estudios de la Facultad de Ciencias por la cercanía que tiene con LACORE. Figura 4.6: Antena Parabólica Movistar TV La televisión digital que brinda CANTV tuvo inicialmente un decodificador básico Konka KHDS866 PVR-R (como se observa en la Figura 4.7). El soporte HDTV es uno de los aspectos más llamativos de su lanzamiento. Este decodificador posee salidas compatibles con HDMI, S-VIDEO, RCA y coaxial. Además de un puente para LNB con el que se pueden conectar más decodificadores. Se adquirieron 2 unidades de este modelo a un costo de 250Bs.F en promoción de CANTV. Figura 4.7: Decodificador Konka KHDS866 PVR-R de CANTV El decodificador Huawei DS360 de CANTV que se muestra en la Figura 4.8 es uno de los más avanzados del mercado actual, tiene la capacidad de grabar utilizando el puerto USB con algún dispositivo de almacenamiento masivo. Tiene soporte HDTV y salidas compatibles con HDMI, S-VIDEO y coaxial. El flujo de transporte de video es MPEG-2, H.264/AVC y el de audio MPEG2 AAC y MPEG4 AAC+HE. El costo de adquisición fue 350Bs.F en promoción de CANTV. Figura 4.8: Decodificador Huawei DS360 de CANTV La antena que utilizan los decodificadores CANTV es de tipo parabólica y tiene adaptado un LNB simple de banda Ku (ver Figura 4.6). Las antenas de ambas compañías se instalaron por el mismo personal técnico de Movistar. Se utilizaron 66 aproximadamente 10 metros de cable coaxial y 2 terminales BNC. La ubicación de la antena requiere línea de vista directa con el satélite, cualquier elemento que interfiera disminuye la señal recibida. En el caso de este Trabajo Especial de Grado la antena se ubicó en el techo de la división de control de estudios de la Facultad de Ciencias por la cercanía que tiene con LACORE, debido a que el personal técnico no encontró otro lugar de instalación de fácil acceso. Es una sola antena utilizada para los 3 decodificadores CANTV. Figura 4.9: Antena Parabólica CANTV Televisión Satelital Para la captura de la señal de televisión se adquirieron los dispositivos Hauppauge 1229 WinTV HVR-2250, Hauppauge 1192 WinTV HVR-1950, Kworld Analog TV Stick III UB405-A y Easycap SM-USB 007. La tarjeta Hauppauge 1229 WinTV HVR-2250 puede sintonizar dos canales de televisión simultáneamente con NTSC, ATSC o QAM. El dispositivo permite ver y grabar programas de televisión al mismo tiempo, soportando todos los formatos digitales de ATSC y QAM, incluyendo HDTV a 1080p. Tiene un chip NXP 7164 que codifica las dos señales en MPEG-2, sin afectar el rendimiento del computador. Figura 4.10: Tarjeta Hauppauge 1229 WinTV HVR-2250 La Figura 4.10 muestra el panel frontal de la tarjeta con dos conectores coaxiales tipo F, el primer conector corresponde a la entrada de la señal de televisión y el segundo a la entrada de la señal de radio. La tarjeta tiene para conectar un control remoto y una entrada para audio y video. Los requisitos recomendados para el uso del dispositivo son: 67  Procesador 2.2 GHz Pentium 4 o su equivalente.  Microsoft Windows 8, 7, Vista Premium o Ultimate con Windows Media Center o Windows XP.  Ranura PCI Express X1 o X8.  Memoria gráfica de 64 MB.  Tarjeta de sonido. Generalmente las tarjetas madres son elaboradas con un limitado número de ranuras PCI Express, limitando así el número de tarjetas Hauppauge 1229 WinTV HVR-2250 que pueden colocarse en el computador. Mientras más canales de TV puedan verse en el computador, más contenidos pueden enviarse con multicast. Es por ello que se incluyó la posibilidad de adicionar más dispositivos utilizando los puertos USB, como es el caso de la Hauppauge 1192 WinTV HVR-1950. El dispositivo Hauppauge 1192 WinTV HVR-1950 se muestra en la Figura 4.11, tiene entradas RCA (2 para audio y 1 para video). Figura 4.11: Vista Frontal del Dispositivo Hauppauge 1192 WinTV HVR-1950 Además tiene una entrada para la señal de TV y otra para radio FM, ambas entradas con conectores coaxiales tipo F (ver Figura 4.12). Tiene una entrada jack IR Blaster utilizada para operar independientemente otros equipos electrónicos (DVD, TV, decodificadores) que soporten la tecnología, para esto el dispositivo trae un control remoto con múltiples funcionalidades incluidas. El conector USB tipo B permite que el dispositivo se comunique con el computador para realizar la instalación y configuración del mismo. El conector +5V se refiere al suministro de energía al dispositivo. El dispositivo utiliza el codificador MPEG-2 Conexant CX23417 incorporado en hardware para desahogar la carga de procesamiento en la CPU. Figura 4.12: Vista Trasera del Dispositivo Hauppauge 1192 WinTV HVR 1950 Los requisitos recomendados para el uso del dispositivo Hauppauge 1192 WinTV HVR- 1950 son:  Procesador Intel Pentium IV 1 GHz ó su equivalente (para televisión analógica)  Procesador 2.2 GHz Intel Pentium IV ó su equivalente (para televisión digital).  Microsoft Windows 8, 7, Vista Premium o Ultimate con Windows Media Center o Windows XP con SP2.  Puerto USB 2.0.  Memoria gráfica de 64 MB.  Tarjeta de sonido. 68 La sintonizadora de televisión Kworld Analog TV Stick III UB405-A se muestra en la Figura 4.13, tiene soporte de los sistemas analógicos. Permite ver y grabar programas de televisión analógica en los formatos MPEG-1, MPEG-2 y MPEG-4. El software que utiliza es TiVme propiedad de Kworld puede reconfigurar el control remoto y hacer grabación silenciosa. Tiene De-noise (función avanzada para disminuir el ruido). Permite grabación programada. Figura 4.13: Sintonizadora Kworld Analog TV Stick III UB405-A Los requisitos mínimos recomendados para el uso del dispositivo Kworld Analog TV Stick III UB405-A son:  Procesador Intel Pentium IV 2.4 GHz ó su equivalente.  Memoria RAM 512 MB.  Puerto de USB 2.0.  Tarjeta de sonido.  Memoria Gráfica de 64 MB.  Microsoft Windows 8, 7, Vista Premium o Ultimate con Windows Media Center o Windows XP con SP2. La sintonizadora Easycap SM-USB 007 se muestra en la Figura 4.14, es un pequeño y avanzado dispositivo que permite transferir señal analógica de video y audio a la computadora. Utiliza el puerto USB y puede capturar imágenes en alta calidad. El software que utiliza es Ulead Video Studio. Se adquirieron 2 dispositivos de este tipo debido a su bajo costo (1750 Bs.F para Enero 2015). Es un dispositivo compatible con Windows 8 y versiones anteriores, además existe un controlador experimental en Linux6. 6 http://linuxtv.org/wiki/index.php/Easycap 69 Figura 4.14: Sintonizadora Easycap SM-USB 007 Los requisitos mínimos recomendados para el uso del dispositivo Easycap SM-USB 007 son:  CPU Pentium III 800 MHz.  Memoria RAM 256MB.  Microsoft Windows 8, 7, Vista Premium o Ultimate con Windows Media Center o Windows XP con SP2 y Linux.  Puerto USB 2.0.  Memoria gráfica de 64 MB.  Tarjeta de sonido. Las capacidades de hardware del Servidor A y Servidor B cumplen con los requisitos mínimos para todas las sintonizadoras de televisión anteriormente descritas. Primeramente se instalaron y probaron las sintonizadoras con el software propietario respectivo y bajo distintas plataformas de Windows. Todos los casos fueron probados en máquinas virtuales con el software VMware Workstation Pro. La Tabla 4.3 muestra los resultados de compatibilidad. Dispositivos Sintonizadores de TV Windows 7 Windows 8 Windows Server 2003 Windows Server 2008 Hauppauge 1229 WinTV HVR- 2250. Sí Sí Sí Sí Hauppauge 1192 WinTV HVR- 1950. Sí Sí Sí Sí Kworld Analog TV Stick III UB405-A. Sí Sí No No Easycap SM-USB 007. Sí Sí No No Tabla 4.3: Compatibilidad de las Sintonizadoras con los Sistemas Operativos La versión de Microsoft Windows Server 2012 no tiene soporte para WMS, característica fundamental para el servicio multicast. El sistema operativo escogido fue Windows 8 por tener compatibilidad con todos los dispositivos. Se instalaron simultáneamente los 2 dispositivos Easycap SM-USB 007 sobre un mismo computador. Las pruebas de captura de señal fueron fallidas cuando los dispositivos se 70 ejecutaban simultáneamente. Luego de investigar al respecto y hacer pruebas, se concluyó que 2 dispositivos sintonizadores Easycap SM-USB 007 no pueden funcionar al mismo tiempo sobre un computador. 4.2.2 Servidor de Transcoding La elaboración de contenidos en un formato digital utilizando procedimientos de compresión se realiza en el servidor de transcoding, así como la distribución hacia el servidor multicast. Existen múltiples software que permiten obtener contenido digital a través de una computadora o de un módulo de conexión que interactúa con las antenas de televisión. El fin es reproducir audio y video de forma continua y sin la necesidad de esperar que la totalidad de la información sea descargada. El contenido debe ser leído de una memoria provisional de almacenamiento o buffer. El principio general se basa en la codificación/decodificación del contenido de audio y video según un formato y a una tasa de transmisión. El primero y más importante reto en el contexto del streaming de televisión es hacer el transcoding manteniendo la reproducción en tiempo real y sin ningún tipo de interrupción del flujo de video. Hay tres requisitos básicos que se deben tomar en cuenta en el transcoding:  La información en el flujo de bits original debe ser explotada tanto como sea posible.  La calidad de video resultante del streaming debe ser tan alta como sea posible, o tan cerca como sea posible del flujo de bits creado por la codificación de la fuente de video original.  En aplicaciones de tiempo real, el retardo de transcoding y el almacenamiento en memoria (buffering) debe reducirse al mínimo para satisfacer las condiciones de tiempo real. Un servidor de transcoding puede proporcionar varias funciones, incluyendo el ajuste del bit rate y la conversión del formato de video y audio. La conversión entre cadenas de bits de video del mismo formato de encapsulación se le conoce como transconding homogéneo. En la presente investigación se utilizó contenido pregrabado (películas en formato DVD y Blu-ray) y las sintonizadoras de televisión anteriormente mencionadas como contenido principal para elaborar los streamings multicast. 4.2.2.1 Transcoding con la Hauppauge 1229 WinTV HVR-2250 La sintonizadora Hauppauge 1229 WinTV HVR-2250, tiene un codificador por hardware que mostró excelentes resultados al ser utilizada con el software propietario de Hauppauge. La resolución de captura para este caso era 1080p con los decodificadores de CANTV y 480p con el de Movistar. Sin embargo, dicho software no tiene las características de hacer una transmisión por red de la señal. Las aplicaciones que se utilizaron para hacer transcoding con este dispositivo fueron Microsoft Expression Encoder, Windows Media Encoder 9 y VLC Player. Cabe destacar que Adobe Flash Media Live Enconder y Helix Broadcaster fueron descartados porque sus características de transmisión en red deben integrarse con Flash Media Server y Helix Universal Media 71 Server, respectivamente. Flash Media Server no soporta multicast y Helix Universal Media Server es de licencia paga, propiedad de RealNetworks. DirectX es una colección de APIs (Application Programming Interface) desarrolladas para facilitar las complejas tareas relacionadas con multimedia. Las aplicaciones de transcoding utilizan específicamente a DirectShow como el API con el cual acceden a las sintonizadoras de televisión. Las capturas de la señal de televisión se realizaron con la conexión coaxial tipo F y con RCA. Los resultados fueron que en Windows Media Encoder 9 y VLC Player, fue posible observar la señal de video; sin embargo, el audio fue requerido como un input en las entradas de la tarjeta de sonido del computador. Esto inhabilitó la posibilidad de capturar el audio y video desde 2 streamings simultáneamente con el dispositivo Hauppauge 1229 WinTV HVR-2250. Con Microsoft Expression Encoder fue posible capturar el audio y video de la sintonizadora Hauppauge 1229 WinTV HVR-2250. Sin embargo, la resolución de captura de video fue baja (352x288 pixels). La sintonizadora utiliza su máximo potencial (1080p) con librerías propietarias de Hauppauge que trabajan directamente con el decodificador por hardware NXP 7164 integrado. La aplicación Microsoft Expression Encoder muestra retrasos de video cuando la captura es con 2 canales simultáneamente. La resolución de salida ajustada a 480p muestra pérdida de calidad en la imagen después del proceso de transcoding. Para este caso Microsoft Expression Encoder fue probado en Windows 7 y Windows 8. 4.2.2.2 Transcoding con Hauppauge 1192 WinTV HVR-1950 Las primeras capturas con Hauppauge 1192 WinTV HVR-1950 fueron satisfactorias con cable coaxial tipo F y con RCA. El software Microsoft Expression Encoder fue el único capaz de capturar la señal de audio y video conjunta. La señal de entrada fue 720x480 pixels ya que la máxima capacidad de la sintonizadora (1080p) sólo se observa con el software Hauppauge cuyas librerías manejan el chip Conexant CX23417. Sin embargo, 720x480 pixels es una buena resolución de entrada de video para hacer transcoding. Es importante mencionar que para todos los dispositivos debe seleccionarse la opción de agregar un origen en directo en la configuración inicial del software Microsoft Expression Encoder. También la opción Dispositivo de video y Dispositivo de audio deben corresponder en la selección del dispositivo Hauppauge 1192 WinTV HVR-1950. Luego, en la opción configuración del dispositivo de video, hay que escoger diálogo de barras cruzadas y asegurarse que la casilla Link Related Streams está seleccionada tal como se muestra en la Figura 4.15. 72 Figura 4.15: Dialogo de Barras Cruzadas en Microsoft Expression Encoder El formato de salida de codificación es VC-1 avanzado para video y WMA para audio. La resolución de video de salida fue 720x480 pixels a una velocidad de 29,97 frames por segundo. Microsoft Expression Encoder codifica según CBR (Constant Bit Rate). El problema de CBR llega con escenas de acción en las que la cámara se mueve con rapidez y un fotograma es muy, o totalmente diferente, del anterior o del siguiente. En ese caso, el almacenamiento necesario para guardar los cambios entre fotograma y fotograma crece considerablemente. Por lo general, el bit rate de películas en DVD actuales varía desde los 2 Mbps a los 4 Mbps, así que una tasa de 4 Mbps es un buen valor para cada señal de televisión multicast utilizando CBR. Las opciones de audio se ajustaron a una velocidad de muestra de 48 kHz y bit rate de 128 kbps. Es necesario que en la opción de preprocesamiento de video se seleccione forzar el desentrelazado bob, esto a fin de evitar los problemas descritos en la Sección 3.7.3.2 sobre el entrelazado de video. La salida por red puede ser por difusión o por un punto de publicación que se conecta directamente a un servidor multicast. Para el primer caso es conveniente que el servidor de transcoding esté en el mismo segmento de red que el servidor multicast y que dicho segmento no tenga otros receptores que puedan comprometer el streaming. También se recomienda escoger un puerto distinto al 8080 y permitir máximo una conexión. Todas las recomendaciones aquí dadas están basadas en el mejor resultado obtenido de las variantes aplicadas a las métricas anteriormente mencionadas. Al cabo de varios días en funcionamiento, el dispositivo mostró un desfase progresivo entre el audio y el video en el servidor de transcoding. No se encontró solución al problema por lo que el uso de este dispositivo fue descartado como solución al tema propuesto. 4.2.2.3 Transcoding con Kworld Analog TV Stick III UB405-A Las capturas con el dispositivo Kworld Analog TV Stick III UB405-A fueron realizadas con el conector coaxial tipo F ya que la capturadora sólo tiene este soporte. Es importante seleccionar la opción Sintonizador en la línea de video, y que se configure el diálogo sintonizador de TV en la configuración del dispositivo de video. Los codificadores de CANTV trabajan por defecto con el canal 3, sin embargo, el valor 73 puede ser cambiado al canal 4. Hay que seleccionar el mismo canal que tiene establecido el codificador como se muestra en la Figura 4.16, de lo contrario, no se obtendrá señal de entrada. La opción Link Related Streams también debe estar activada. Figura 4.16: Diálogo Sintonizador de TV Kworld Analog TV Stick III UB405-A El formato de salida fue con VC-1 avanzado para video y WMA para audio. La resolución de video de salida fue 720x480 pixels ajustado a una velocidad de 29,97 frames por segundo. El bit rate se configuró a 4 Mbps y el preprocesamiento de video tuvo activa la opción forzar el desentrelazado bob. Las opciones de audio se ajustaron a una velocidad de muestra de 48 kHz y bit rate a 128 kbps. La salida fue por difusión por el puerto 8081. Los resultados de transcoding fueron satisfactorios, el consumo de CPU osciló entre 20% y 50% en base a 60 segundos de monitoreo. El dispositivo cumplió los requerimientos para ser utilizado como parte de la solución en la presente investigación. 4.2.2.4 Transcoding con Easycap SM-USB 007 El dispositivo Easycap SM-USB 007 solo permite entradas por RCA, por lo que la línea de video seleccionada fue video compuesto. Es importante señalar que la configuración del diálogo de captura debe tener la resolución 720x480 pixels, de lo contrario la imagen sufrirá congelamiento y el dispositivo dejara de funcionar. Para realizar este cambio debe seleccionarse como entrada de video estándar la opción NTSC_M o NTSC_M_J, tal como se muestra en la Figura 4.17. Finalmente la opción Link Related Streams debe estar también activada. 74 Figura 4.17: Diálogo de Captura Easycap SM-USB 007 Igual que los casos anteriores el formato de salida fue VC-1 avanzado para video y WMA para audio. La resolución de video de salida fue 720x480 pixels ajustado a una velocidad de 29,97 frames por segundo. El bit rate se configuró a 4 Mbps y el preprocesamiento de video tuvo activa la opción forzar el desentrelazado bob. Las opciones de audio se ajustaron a una velocidad de muestra de 48 kHz y bit rate de 128 kbps. La salida fue por difusión en el puerto 8082. Los resultados de transcoding fueron satisfactorios, el uso del CPU osciló entre 20% y 50% para 60 segundos de monitoreo. El dispositivo cumplió los requerimientos para ser utilizado como parte de la solución en la presente investigación. 4.2.2.5 Transcoding de Contenido Pregrabado El formato de encapsulación de entrada del contenido pregrabado fue MKV. La resolución de entrada estuvo entre el rango de 480p a 1080p dependiendo de la película. Algunos formatos estaban en 3D con doble pantalla (izquierda y derecha), por lo que fue necesario trabajar por separado el flujo de video y el de audio. La Figura 4.18 muestra un ejemplo del formato 3D doble pantalla. Figura 4.18: Imagen 3D Doble Pantalla (Izquierda-Derecha) El software MeGUI 2525 permite extraer del video 3D el área con el contenido deseado. Es necesario usar la opción AVS Script Creator y luego seleccionar Crop (ver Figura 4.19), para ir cortando el contenido hasta dejar una sola de las imágenes. Este 75 procedimiento llevó mucha carga de procesamiento en la CPU, llegando al 100% durante su ejecución en el Servidor B. Figura 4.19: Opción AVS Script Creator de MeGUI 2525 La salida contiene el flujo de video únicamente, por lo que es necesario extraer el audio con el software MKVExtractGUI. El procedimiento es bastante sencillo ya que esta aplicación es capaz de identificar todo el contenido encapsulado (video, audio y subtítulos) y extraerlo. Finalmente, se utiliza el software MKVToolNix GUI que es capaz de multiplexar el audio y el video uniéndolos en un mismo flujo y encapsulando todo en el formato MKV. Una vez que todo el contenido pregrabado está en el formato de encapsulación MKV se realiza el transcoding al formato más adecuado para la transmisión por la red. Según la investigación realizada, el formato de salida más adecuado para la red es el M2TS. 4.2.3 Servidor Multicast El servidor multicast utilizado para la transmisión de streaming de televisión fue escogido según las experiencias adquiridas en un ambiente de pruebas local. Debido a la falta de inversión en recursos de hardware, todos los servicios se ejecutan en un solo computador. Las exigencias de las aplicaciones demandan alto procesamiento, memoria y almacenamiento en disco, por lo que se decidió escoger al Servidor B (mencionado en la sección 4.2) para prestar los servicios. Para la implementación de un servidor multicast se debe considerar:  Capacidad del Procesador y Número de Procesadores.  Origen del contenido.  Ancho de Banda.  Memoria del Sistema. El origen del contenido puede ser estático, contenido pregrabado. Se recomienda evitar almacenar los archivos de contenido multimedia en el mismo disco duro donde se instaló el sistema operativo del servidor multicast. 76 Cuando el origen del contenido es remoto se debe usar las interfaces de red dedicadas para la entrada y salida del tráfico. Además, las interfaces de red deben soportar transferencias full-duplex. El monitoreo del trafico con herramientas como Wireshark no es recomendado mientras el servidor esta en producción ya que consume muchos recursos del hardware. Inicialmente se implementó el servidor multicast con WMS. Durante las pruebas el resultado fue satisfactorio y el servicio funcionaba con la aplicación del cliente soportando la transmisión con el plugin en el navegador de WMP (Windows Media Player). Seguidamente se observó que varias computadoras que se estaban instalando en la Facultad de Ciencias tenían el sistema operativo Windows N, éste último no incluye el reproductor WMP. Era necesario entonces hacer la instalación de la característica WMP como un paso adicional por parte del cliente. El Centro de Computación de la Facultad de Ciencias tiene planificado ejecutar una migración masiva hacia Linux. Así que, se decidió implementar el servidor multicast con VLC Player que tiene soporte en Linux. Una ventaja adicional de este cambio en el servidor multicast es que Windows y MAC OS X también soportan VLC Player. Finalmente ésta implementación del servidor multicast representa una propuesta según las experiencias adquiridas durante la investigación. 4.2.3.1 Servidor con Windows Media Services Aunque el servidor con WMS no parece la mejor opción para implementar el servicio de televisión en la Facultad de Ciencias, igualmente se realizaron pruebas con el mismo. La instalación del Servicio de WMS se realiza agregando la característica como un componente adicional en Windows Server 2008. Es necesario contar con el DVD de instalación del sistema operativo. La versión de sistema operativo Windows Server 2008 resulta más robusta que su antecesor Windows Server 2003. Antes de poder transmitir contenido se debe comunicar a los usuarios que el mismo se encuentra disponible, e informar a los reproductores los parámetros necesarios para poder conectarse e interpretar de manera correcta el contenido. La comunicación con los clientes se hace mediante la red social twitter como se explica en la sección 4.2.5 y la información que necesitan los reproductores para encontrar el flujo multicast se entrega por medio de un archivo de información de multidifusión (archivos de extensión nsc). Un archivo de información de multidifusión posee básicamente la siguiente información:  Dirección IP de multidifusión.  Puerto de multidifusión.  Período de vida (TTL).  Intervalo de corrección de errores predeterminado.  Formatos de secuencia usados por el contenido que se entrega. Esta información viene codificada y sólo puede ser decodificada por reproductores de WMP. Otra configuración importante en el servidor multicast son los puntos de publicación mostrados en la Figura 4.20, es decir, el medio por el cual se distribuye el contenido (archivos de audio, video, etc.) a los usuarios. 77 Figura 4.20: Puntos de Publicación en WMS Al momento de definir un punto de publicación se debe indicar un origen del contenido, este origen puede ser un archivo, un directorio, una lista de reproducción, un codificador o un punto de publicación remoto como se muestra en la Figura 4.21. Para enviar la señal de televisión integrada al Microsoft Expression Encoder se utilizó como origen la opción codificador. Figura 4.21: Formatos de Origen en WMS Para el contenido pregrabado se utilizó una lista de reproducción, la cual no es más que un archivo que hace referencia a piezas de contenido digital y permite organizarlos. La ventaja de utilizar como origen una lista de reproducción es que permite tener control sobre el orden de la reproducción, como por ejemplo, indicar que se desea reproducir aleatoriamente los archivos seleccionados. 78 WMS tiene soporte de entrada para los formatos de video .asf, .wma, .wmv y .wm y para metarchivos .asx, .wax, .wvx, .wpl. Generalmente los videos deben encapsularse mediante el servidor de transcoding en los formatos soportados. Luego pueden ser almacenados en un lugar de fácil acceso para el servidor multicast. Finalmente el servicio entra en producción con el inicio del punto de publicación, para lo cual WMS asigna una dirección IPv4 e IPv6 multicast de alcance administrativo. 4.2.3.2 Servidor con VLC Player El servidor multicast utilizado con el reproductor VLC Player fue el Servidor B. La señal de televisión adquirida por el servidor de transcoding es a tiempo real y obliga a codificar en el formato de encapsulación de Microsoft (.wmv). Sin embargo, VLC Player puede nuevamente aplicar transcoding para tener una salida M2TS, dado que es más fácil transportar por la red este tipo de formato. Los parámetros que utiliza VLC Player para emitir una señal a tiempo real desde un servidor de transcoding utilizando multicast son los que se muestran en la Figura 4.22. VLC Player tiene incorporado un wizard que facilita la creación de esta cadena de salida. En el wizard de VLC Player es necesario seleccionar la opción Stream, luego Network e incluir allí el URL correspondiente a la dirección IP y el puerto del servidor de transcoding. Figura 4.22: Parámetros para Multicast con Tiempo Real en VLC Player Para el caso en que desea transmitirse el contenido pregrabado debe introducirse el directorio que contiene las películas. También hay que ingresar a la opción Stream, luego Network e incluir allí el URL correspondiente al directorio de películas, siguiendo el formato que se muestra en la Figura 4.23. Figura 4.23: URL para Multicast de Contenido Pregrabado en VLC Player Cuando la transmisión multicast ha iniciado es necesario seleccionar en el cuadro de controles de VLC Player la opción loop one que se refiere a repetir el directorio constantemente (ver la Figura 4.24). 79 Figura 4.24: Activar Loop One en VLC Player Ya que hay seis canales de televisión (contenido pregrabado y señal en vivo) se necesitan seis instancias de VLC Player (una por cada streaming) para transmitir el servicio por la red. Esto representa un consumo en ancho de banda de 32 Mbps en promedio por 60 segundos de monitoreo de red (ver Figura 4.25). Figura 4.25: Ancho de Banda de Envío en Multicast con Seis Canales de Televisión El consumo de CPU también representa un valor importante dado que el servidor multicast realiza transcoding de la señal en vivo que recibe desde Microsoft Expression Encoder. Adicionalmente VLC Player requiere procesar el encapsulamiento M2TS para armar los ES que van a ser enviados por la red. Todo el envío de multicast desde el servidor se hace a través del protocolo UDP soportado por VLC Player. El consumo de CPU se muestra en la Figura 4.26, se puede observar que el valor reflejado no llega al 100% por lo que sería posible emitir más canales de televisión. 80 Figura 4.26: Consumo de CPU en Multicast con Seis Canales de Televisión 4.2.4 Infraestructura de Red La infraestructura de red utilizada en la Facultad de Ciencias cuenta con routers y switches marca Cisco. El servicio de televisión trabaja actualmente con IGMPv2. Es posible mejorar las características de multicast utilizando IGMPv3, pero para ello todos los routers participantes deben trabajar con IGMPv3. El comando a introducir en un router marca Cisco es el que se muestra en la Figura 4.27. Figura 4.27: Comando Cisco para Habilitar IGMPv3 Un beneficio de IGMPv3 es admitir solamente fuentes específicas en la transmisión multicast, es de allí que se conoce cuál es la debilidad de IGMPv2. La reproducción de un streaming puede ser intervenida en su flujo normal por cualquier otra fuente que inyecte paquetes sobre un grupo multicast que no le pertenece. Si el flujo es también de televisión, las imágenes de video y el audio se intercalan durante la reproducción del streaming. Así pues, sería ideal incluir en los routers el soporte a IGMPv3 y que la aplicación VLC player ejecute un Join al grupo multicast especificando la fuente, sin embargo, no se conoce esta característica en el reproductor de video. También se necesita un protocolo para el enrutamiento de los paquetes multicast desde el origen hasta los destinos, para esto se recurrió a PIM-SM. PIM-SM necesita de un protocolo de enrutamiento unicast subyacente que colabore en la creación los árboles de distribución multicast. El protocolo utilizado fue EIGRP, ambos protocolos son los utilizados actualmente en la red de datos de la UCV [4]. Los switches que tienen habilitado IGMP Snooping deben tener soporte para IGMPv3, de lo contrario no reconocerán el mensaje y los descartarán. Se puede forzar el sistema operativo del servidor a utilizar IGMPv2. En el caso de Windows es necesario agregar la 81 llave de registro DWORD IGMPVersion = 3, para ello es necesario ubicar la ruta en el registro que se muestra en la Figura 4.28, para habilitar IGMPv2. Figura 4.28: Llave de Registro para Habilitar IGMPv2 en Windows En el caso de Linux se requiere autenticarse como root e introducir el comando mostrado en la Figura 4.29. Figura 4.29: Comando para Habilitar IGMPv2 en Linux 4.2.5 Aplicación de los Clientes Los clientes del servicio de televisión acceden a través de una página web. El enlace es tv.ciens.ucv.ve y el nombre de la página es CienciasTV. Las tecnologías de desarrollo utilizadas fueron: HTML5, PHP, CSS (Cascading Style Sheets), JavaScript, JQuery, Ajax y MySQL. La metodología de desarrollo empleada para la página web CienciasTV fue eXtreme Programming ya que hubo bastantes cambios y adaptaciones efectuadas durante la marcha y así fue adaptándose a los objetivos del presente Trabajo Especial de Grado. La simplicidad es base en el eXtreme Programming, se simplifica el diseño para agilizar el desarrollo y facilitar el mantenimiento. Un diseño complejo del código junto a sucesivas modificaciones por parte de diferentes desarrolladores hace que la complejidad aumente exponencialmente. Un aspecto importante a señalar es el segmento de código utilizado para incorporar el plugin de VLC Player en el navegador. La sentencia de código a incorporar se muestra en Figura 4.30, que corresponde a una etiqueta tipo embed. Los elementos tipo embed representan un punto de integración para una aplicación externa o de contenido interactivo. Figura 4.30: Etiqueta HTML para VLC Plugin El atributo más importante es el campo type, ya que define el elemento a incrustar según el estándar MIME (Multipurpose Internet Mail Extensions). El API de desarrollo de VLC se conoce como NPAPI (Netscape Plugin Application Programming Interface). El soporte de NPAPI para navegadores como Chrome y Opera representan problemas de seguridad para el usuario, ya que se puede obtener acceso sin restricciones a la máquina local. Ambas compañías deciden inhabilitar el complemento y desde septiembre del 2015 no se permite la ejecución en el navegador Chrome. Sin embargo, el navegador Internet Explorer, Mozilla Firefox y Safari aun lo soportan. Para la ejecución del VLC Player el equipo cliente debe poseer las siguientes características mínimas:  Sistema Operativo Windows XP SP2 o superior.  VLC Player versión 2.1 o superior, con los complementos web instalados. 82  Navegadores:  Mozilla Firefox versión 4 o superior.  Safari versión 5 o superior. Si la aplicación hubiera sido implementada con WMS la información contenida en los archivos de información de multidifusión (archivos .nsc) sólo podrían ser decodificados por reproductores Windows Media Player. El equipo cliente tendría que poseer las siguientes características mínimas:  Sistema Operativo Windows XP SP2 o superior.  Windows Media Player versión 9 o superior.  Navegadores:  Internet Explorer versión 7 o superior.  Mozilla Firefox versión 4 o superior, además se requiere el plugin de Windows Media Player instalado para poder ejecutar el componente.  Safari versión 5 o superior.  Opera versión 32. Los casos de uso permiten definir los requerimientos funcionales del sistema. Desde el punto de vista del usuario, un caso de uso determina el comportamiento de un requerimiento y es un modelo adecuado para presentar las funcionalidades del sitio web. El actor que interactúa con el sistema es:  Visitante: Consta de aquellos usuarios que ingresan al sitio web de CienciasTV a interactuar con las distintas secciones del mismo. La Tabla 4.4 muestra los casos de uso asociados al sitio web tv.ciens.ucv.ve (CienciasTV). Código Caso de Uso Actor 1.1 Especifica el ingreso del usuario a la sección Inicio. Visitante 1.2 Especifica el ingreso del usuario a la sección Televisión. Visitante 1.3 Especifica el ingreso del usuario a la sección Ayuda. Visitante 1.4 Especifica el ingreso del usuario al envío de mensajes en twitter. Visitante 1.5 Especifica el ingreso del usuario para hacer tweet de CienciasTV en twitter. Visitante 1.6 Especifica la gestión de la configuración del reproductor VLC. Visitante 1.7 Especifica el ingreso del usuario al canal de televisión maximizado. Visitante 1.8 Especifica el ingreso del usuario a la sección de ayuda para Linux. Visitante 1.9 Especifica el ingreso del usuario a la sección de ayuda para Windows. Visitante Tabla 4.4: Casos de Uso de CienciasTV El visitante tiene asociado el diagrama de casos de uso mostrado en la Figura 4.31. 83 Figura 4.31: Diagrama de Casos de Uso del Cliente de CienciasTV La explicación detallada de los casos de uso se presenta en las tablas a continuación. 1.1 Ver Inicio Nombre: Ver Inicio. Descripción: Se ingresa a la sección Inicio, es indispensable que se haga clic sobre el botón Inicio. Requerimiento: Contar con una sección Inicio accedida mediante un botón. Precondición: Haber accedido al sitio web tv.ciens.ucv.ve, y que el contenido se haya cargado por completo. Flujo Normal: Se muestra el contenido de la sección Inicio, se da la bienvenida al visitante y se informa sobre los requerimientos mínimos de software. Actor: Sistema: 1. El visitante hace clic en el botón Inicio. 3. El visitante visualiza el texto de bienvenida y los requisitos de software. 2. Se abre el contenido en la página. Flujo Alterno: El navegador muestra un mensaje de error en la carga de la página. Actor: Sistema: 1.1 El visitante hace clic en el botón Inicio. 3.1 El visitante visualiza un mensaje de error. 2.1 No es posible cargar la página y devuelve un mensaje de error. Postcondición: Despliegue del texto referente a la bienvenida del servicio y sus requisitos de software. Requerimientos Especiales: 1. Entrada al navegador en correcto 84 funcionamiento. Puntos de Extensión: 1. Se escribe en twitter. 2. Se hace tweet en twitter. Tabla 4.5: Descripción de Caso de Uso Ver Inicio 1.2 Ver Televisión Nombre: Ver Televisión. Descripción: Se ingresa a la sección Televisión, es indispensable que se haga clic sobre el botón Televisión. Requerimiento: Contar con una sección Televisión accedida mediante un botón. Precondición: Haber accedido al sitio web tv.ciens.ucv.ve, y que el contenido se haya cargado por completo. Instalar el plugin de VLC en el navegador web. Los URLs del streaming multicast y el nombre del streaming deben estar cargados en la base de datos. Flujo Normal: Se muestra el contenido de la sección Televisión, se muestran cuatro canales de televisión que capturan el streaming multicast correspondiente de la red. Actor: Sistema: 1. El visitante hace clic en el botón Televisión. 3. El visitante visualiza los seis canales presentes en la página. 2. Se abre el contenido en la página. Flujo Alterno: El navegador muestra un mensaje de error en la carga de la página. Actor: Sistema: 1.1 El visitante hace clic en el botón Televisión. 3.1 El visitante visualiza un mensaje de error. 2.1 No es posible cargar la página y devuelve un mensaje de error. Postcondición: Despliegue de los seis canales de televisión. Requerimientos Especiales: 1. Entrada al navegador en correcto funcionamiento. 2. Instalación del plugin de VLC. Puntos de Extensión: 1. Se selecciona el botón ampliar. 2. Se escribe en twitter. 3. Se hace tweet en twitter. Tabla 4.6: Descripción de Caso de Uso Ver Televisión 1.3 Ver Ayuda Nombre: Ver Ayuda. Descripción: Se ingresa a la sección Ayuda, es indispensable que se haga clic sobre el botón Ayuda. Requerimiento: Contar con una sección Ayuda accedida 85 mediante un botón. Precondición: Haber accedido al sitio web tv.ciens.ucv.ve, y que el contenido se haya cargado por completo. Flujo Normal: Se muestra el contenido de la sección Ayuda, se muestran dos botones para seleccionar la ayuda deseada según el sistema operativo. Actor: Sistema: 1. El visitante hace clic en el botón Ayuda. 3. El visitante visualiza dos botones para seleccionar según su requerimiento. 2. Se abre el contenido en la página. Flujo Alterno: El navegador muestra un mensaje de error en la carga de la página. Actor: Sistema: 1.1 El visitante hace clic en el botón Ayuda. 3.1 El visitante visualiza un mensaje de error. 2.1 No es posible cargar la página y devuelve un mensaje de error. Postcondición: Despliegue de los dos botones de ayuda. Requerimientos Especiales: 1. Entrada al navegador en correcto funcionamiento. Puntos de Extensión: 1. Se escribe en twitter. 2. Se hace tweet en twitter. Tabla 4.7: Descripción de Caso de Uso Ver Ayuda 1.4 Escribir en Twitter Nombre: Escribir en twitter Descripción: Se envía un mensaje de texto (tweet) desde el widget de la página principal. Este mensaje es enviado desde la cuenta de twitter del visitante. Requerimiento: El soporte JavaScript debe estar habilitado. Precondición: Haber accedido al sitio web tv.ciens.ucv.ve y autenticarse en twitter. Flujo Normal: Se envía un tweet a la cuenta @UCVCienciasTV una vez que el visitante se autentique en twitter. Actor: Sistema: 1. El visitante hace clic en el widget y se autentica. 3. El visitante escribe un tweet. 2. El sistema verifica que sea un usuario válido. 4. El sistema envía el mensaje a @UCVCienciasTV. Flujo Alterno: El navegador muestra un mensaje de error en la carga del widget. Actor: Sistema: 1.1 El visitante hace clic en el widget. 3.1 El visitante visualiza un mensaje de error. 2.1 No es posible cargar el widget y devuelve un mensaje de error. Postcondición: Se actualizará el estado del usuario con el 86 tweet escrito. Requerimientos Especiales: Entrada al navegador con JavaScript habilitado. Autenticación del visitante en twitter. Puntos de Extensión: 1. Se envía un tweet adicional. 2. Se selecciona follow en twitter. Tabla 4.8: Descripción de Caso de Uso Escribir en Twitter 1.5 Hacer Tweet Nombre: Hacer tweet. Descripción: Se muestra un mensaje de texto en una ventana adicional para hacer tweet de CienciasTV. Este mensaje es enviado desde la cuenta del usuario de twitter. Requerimiento: El soporte JavaScript debe estar habilitado. Precondición: Haber accedido al sitio web tv.ciens.ucv.ve y autenticarse en twitter. Flujo Normal: Se muestra el icono de twitter con el número de tweets realizados por parte de los visitantes. El visitante puede hacer tweet dando publicidad a CienciasTV a través de twitter. Actor: Sistema: 1. El visitante hace clic en el botón tweet y se autentica. 3. El visitante visualiza el incremento de los tweets. 2. El sistema verifica que sea un usuario válido e incrementa un tweet publicitando a CienciasTV. Flujo Alterno: El navegador muestra un mensaje de error en la carga de la página. Actor: Sistema: 1.1 El visitante hace clic en el botón tweet. 3.1 El visitante visualiza un mensaje de error. 2.1 No es posible cargar la página y devuelve un mensaje de error. Postcondición: Incremento del contador de tweets. Requerimientos Especiales: Entrada al navegador con JavaScript habilitado. Autenticación del visitante en twitter. Puntos de Extensión: 1. Se escribe en twitter. 2. Se selecciona follow en twitter. Tabla 4.9: Descripción de Caso de Uso Hacer Tweet 1.6 Cambiar configuración de VLC Nombre: Cambiar configuración de VLC. Descripción: Este caso de uso brinda la posibilidad al usuario de gestionar la visualización de la película utilizando los controles de reproducción. Es indispensable que se haga clic sobre los botones de control que proporciona VLC según la opción a aplicar. 87 Requerimiento: Instalar el plugin de VLC en el navegador. Precondición: Haber accedido al sitio web tv.ciens.ucv.ve, y que el contenido se haya cargado por completo. Instalar el plugin de VLC. Los URLs del streaming multicast y el nombre del streaming deben estar cargados en la base de datos. Flujo Normal: Se manejan exitosamente los botones de control del reproductor VLC. Actor: Sistema: 1. El visitante hace clic en un botón de control. 2. Se efectúa el cambio en la transmisión de la película. Flujo Alterno: El plugin de VLC no está activado en el navegador. Actor: Sistema: 1.1 El visitante no visualiza el canal de televisión. 3.1 El visitante visualiza el mensaje de activación de VLC. 2.1 La página indica que se debe activar el plugin de VLC. Postcondición: Despliegue de los botones. Requerimientos Especiales: Entrada al navegador en correcto funcionamiento. Instalación del plugin de VLC. Los URLs del streaming multicast deben estar cargados en la base de datos. Puntos de Extensión: 1. Se selecciona otro botón del reproductor. 2. Se escribe en twitter. 3. Se hace tweet en twitter. Tabla 4.10: Descripción de Caso de Uso Cambiar Configuración de VLC 1.7 Maximizar Canal Nombre: Maximizar Canal. Descripción: Se ingresa a la sección Maximizar Canal, es indispensable que se haga clic sobre el botón Maximizar. Requerimiento: Contar con una sección Maximizar Canal accedida mediante un botón. Precondición: Haber accedido al sitio tv.ciens.ucv.ve, y que el contenido se haya cargado por completo. Que el contenido del canal esté cargado en la base de datos. Flujo Normal: Se muestra el contenido de la sección Maximizar Canal, se despliega la programación existente. Actor: Sistema: 1. El visitante hace clic en el botón Maximizar. 3. El visitante visualiza el canal y la programación existente. 2. Se abre el contenido en la página. 88 Flujo Alterno: El navegador muestra un mensaje de error en la carga de la página. Actor: Sistema: 1.1 El visitante hace clic en el botón Maximizar. 3.1 El visitante visualiza un mensaje de error. 2.1 No es posible cargar la página y devuelve un mensaje de error. Postcondición: Despliegue del canal seleccionado y de su programación. Requerimientos Especiales: 1. Entrada al navegador en correcto funcionamiento. 2. Que el contenido del canal esté cargado en la base de datos. Puntos de Extensión: 1. Se selecciona de la lista de programación el contenido del canal y su descripción. 2. Se escribe en twitter. 3. Se hace tweet en twitter. Tabla 4.11: Descripción de Caso de Uso Maximizar Canal 1.8 Ver Ayuda Linux Nombre: Ver ayuda Linux. Descripción: Se ingresa a la sección Ayuda para Linux, es indispensable que se haga clic sobre el botón de Ayuda para Linux. Requerimiento: Contar con una sección Ayuda para Linux accedida mediante un botón. Precondición: Haber accedido al sitio tv.ciens.ucv.ve, y que el contenido se haya cargado por completo. Flujo Normal: Se muestra el contenido de la sección Ayuda para Linux. Actor: Sistema: 1. El visitante hace clic en el botón Ayuda para Linux. 3. El visitante visualiza el contenido en la página. 2. Se abre el contenido en la página. Flujo Alterno: El navegador muestra un mensaje de error en la carga de la página. Actor: Sistema: 1.1 El visitante hace clic en el botón Ayuda para Linux. 3.1 El visitante visualiza un mensaje de error. 2.1 No es posible cargar la página y devuelve un mensaje de error. Postcondición: Se finaliza la carga de la sección. Requerimientos Especiales: Entrada al navegador en correcto funcionamiento. Puntos de Extensión: 1. Se escribe en twitter. 2. Se hace tweet en twitter. Tabla 4.12: Descripción de Caso de Uso Ver Ayuda Linux 89 1.9 Ver Ayuda Windows Nombre: Ver ayuda Windows. Descripción: Se ingresa a la sección Ayuda para Windows, es indispensable que se haga clic sobre el enlace de “Windows”. Requerimiento: Contar con una sección Ayuda para Windows accedida mediante un botón. Precondición: Haber accedido al sitio tv.ciens.ucv.ve, y que el contenido se haya cargado por completo. Flujo Normal: Se muestra el contenido de la sección Ayuda para Windows. Actor: Sistema: 1. El visitante hace clic en el enlace Ayuda para Windows. 3. El visitante visualiza el contenido en la página. 2. Se abre el contenido en la página. Flujo Alterno: El navegador muestra un mensaje de error en la carga de la página. Actor: Sistema: 1.1 El visitante hace clic en el enlace Ayuda para Windows. 3.1 El visitante visualiza un mensaje de error. 2.1 No es posible cargar la página y devuelve un mensaje de error. Postcondición: Se finaliza la carga de la sección. Requerimientos Especiales: Entrada al navegador en correcto funcionamiento. Puntos de Extensión: 1. Se escribe en twitter. 2. Se hace tweet en twitter. 3. Se descarga VLC para Windows. Tabla 4.13: Descripción de Caso de Uso Ver Ayuda Windows La base de datos implementada es inicialmente pequeña en su estructura, pero tiene una enorme importancia en la ejecución de la aplicación del cliente. Los datos de cada canal son almacenados en una tabla llamada Stream, es allí donde la página web consulta la cantidad de registros almacenados y muestra la previsualización de todos los canales al usuario. El plugin web de VLC Player recibe los URLs de la tabla Stream. Existe también un identificador único por cada canal que está relacionado como campo clave con las otras tablas, dicho campo se llama id_streaming, permite también dar dinamismo a la página web agregando y borrando canales según sea necesario Las otras dos tablas se llaman Películas y Television, contienen la descripción del contenido pregrabado transmitido y de la señal obtenida del codificador respectivamente. El campo llamado url_fotos se refiere a la ruta relativa donde se encuentra la imagen mostrada en la descripción con respecto a la página web. El campo hastag almacena la información que permite identificar al canal ó película con la red social twitter. Es un mecanismo por mediante el cual el usuario podrá comunicarse usando el widget incorporado en la página web. 90 Finalmente se muestra en la Figura 4.32 el diagrama entidad relación correspondiente a la base de datos de CienciasTV. Figura 4.32: Diagrama Entidad-Relación de CienciasTV Es importante acotar que inicialmente la tecnología empleada fue con Windows Media Player. Esto brindaba soporte con C#, incorporando previamente el módulo wmp.dll al código. Se realizó el experimento con multicast y el resultado fue satisfactorio. El flujo multicast podía capturarse perfectamente con una aplicación desarrollada en este lenguaje e incrustando el Windows Media Player. Sin embargo, más adelante se decidió cambiar por el reproductor VLC debido a la compatibilidad que tiene con distintos sistemas operativos, por lo que el código de C# quedó en desuso. Las capturas de pantalla a continuación muestran el contenido de la página CienciasTV. Figura 4.33: Pantalla de Bienvenida a CienciasTV 91 Figura 4.34: Previsualización de Canales en CienciasTV Figura 4.35: Maximización de un Canal en CienciasTV 92 93 5. Conclusiones Desde sus inicios, la televisión ha sido el mayor entretenimiento de millones de personas. Internet concentra millones de redes alrededor del mundo, multicast muestra una solución viable para transmitir contenidos audiovisuales por este medio. Existen diferencias entre IPTV y televisión por Internet. IPTV es implementado por compañías que buscan introducir un servicio de televisión en un mercado privado cuyos receptores comúnmente son Set Top Boxes. Los medios de transmisión de IPTV están en una red privada que puede ser cableada o satelital, mientras que la televisión por Internet se muestra en navegadores web o aplicaciones interactivas que son ejecutadas en computadores con acceso a Internet. El uso de sistemas propietarios en la recepción de contenidos es el mayor obstáculo para reducir costos de televisión digital. Si bien algunos formatos de transporte son estándares abiertos, sus componentes y sistemas de comunicación son casi siempre propietarios. La televisión por Internet es altamente escalable utilizando multicast, además que es muy flexible en permitir la entrada y salida de usuarios para acceder a los contenidos. Las políticas de calidad de servicio aplicadas en la red juegan un papel importante durante la transmisión. Existen protocolos en capa de aplicación como RTP y RTSP que optimizan el uso del ancho de banda, buscando garantizar también la sincronía del flujo de datos multimedia pero con multicast no muestran los mejores resultados. En las redes locales, protocolos como IGMP permiten la gestión de grupos multicast y ha ido evolucionando constantemente agregando seguridad, escalabilidad y optimizando recursos de la red. En Internet es un poco más complicado enviar datos por multicast, ya que utiliza protocolos de enrutamiento basados en árboles que pueden sobrecargar la red. La distribución puede hacerse asumiendo que todos quieren recibir el flujo de datos y luego ir podando a quienes lo rechacen (PIM-DM), o solicitar ingresar a un grupo a través de un Rendezvous Point que concentra la información de quienes transmiten y quienes reciben el flujo de datos (PIM-SM). Existe hardware especializado que en capa de enlace puede reconocer paquetes IGMP, a esto se le conoce como IGMP Snooping. Los switches Cisco pueden hacer algo similar manejando el protocolo CGMP. La TDA que en sus inicios no tuvo gran impacto en el mercado, hoy comienza a tomar terreno, ya que los costos de producción de su tecnología han ido disminuyendo. Se han realizado mejoras sustanciosas de los estándares y otros nuevos han aparecido. Latinoamérica parece advocarse a ISDB-T, y Brasil desarrolló su propio estándar mejorando la codificación de video de MPEG-2 a MPEG-4 llamándolo ISDB-Tb. La calidad de audio también es mejorada por medio de la compresión HE-AAC (High- Efficiency Advanced Audio Coding). En el caso de Venezuela, el estándar adoptado es ISDB-Tb, que originalmente nació en Japón pero fue mejorado por Brasil. La compañía CANTV está implementando a nivel nacional la televisión digital abierta (compuesta por TDT, TDH). Los televidentes reciben una señal de alta calidad de imagen y sonido codificado en MPEG-4, similar a la que se experimenta con un DVD. La señal digital no se limita sólo a los hogares, llega también a equipos celulares, y tablets que tengan un receptor ISDB-Tb, ampliando así la posibilidad en el desarrollo de contenidos exclusivos para dispositivos móviles. 94 En la Facultad de Ciencias, transmitir señal de televisión por la red tiene un impacto significativo para la comunidad universitaria. Se abre así las puertas al T-Learning, que refiere al aprendizaje a distancia utilizando aulas virtuales. El formato de encapsulamiento más apropiado para enviar streamings por red fue M2TS. Sin embargo, las capturadoras de televisión fueron sometidas a un proceso de doble transcoding donde el servidor multicast tuvo que codificar de WMV a TS con VLC Player. Cabe destacar que VLC Player no encapsula M2TS. El otro caso es utilizar un servidor multicast con WMS ya que su formato de encapsulamiento dio muy buenos resultados. Es necesario tener un servidor de transcoding dedicado, ya que los requisitos de hardware son elevados para procesar una buena calidad de imagen de video. El servidor multicast también debe estar dedicado al envío del streaming, por lo que, el ancho de banda de red debe ser lo más elevado posible. Las capturadoras aconsejadas para equipos HDTV deben tener soporte HDMI, comúnmente son utilizadas para grabar juegos de XBOX o PlayStation con muy altas prestaciones en calidad de imagen. Los clientes pueden aprovechar las ventajas de la etiqueta video en HTML5 si se construye un servicio con sockets UDP multicast que sea capaz de integrarse con IGMP y entregar el flujo en un source que la etiqueta video reconozca. Éste es un aspecto importante porque no sería necesario el plugin incrustado en el navegador. Es importante destacar que la capacidad de captura depende mucho de la compatibilidad de los dispositivos con el sistema operativo y sus librerías DirectX. Los antecedentes al presente proyecto ayudaron a escoger los diferentes sintonizadores de televisión y a explorar las nuevas tendencias de transmisión de las señales de televisión. Los formatos de encapsulación y codecs facilitaron el transporte de streamings multicast, sin embargo, no hubo un protocolo de calidad de servicio que se adaptara a la solución propuesta. Finalmente, se definió la infraestructura necesaria para colocar en producción el servicio de televisión con multicast y se implementó como una solución para las redes de la Facultad de Ciencias. 95 Recomendaciones  Para explotar las capacidades de multicast la infraestructura propuesta permite implementar soluciones en el área de enseñanza (T-Learning), video vigilancia y conferencias por la red de la Facultad de Ciencias.  Las webcams en su mayoría poseen buena compatibilidad con DirectX y son de bajo costo por lo que se recomiendan como dispositivos de captura.  Las capturadoras de televisión recomendadas para adquirir la señal de los decodificadores CANTV deben tener soporte HDMI, tales como:  Colossus con WinTV v7 01412.  Thanko HDMI Video Capture Card HDMVC4UC.  Es posible hacer una implementación del servicio sobre IPv6 ya que las herramientas utilizadas lo soportan.  El hardware de los servidores implementados en la solución puede ubicarse en una dependencia de la universidad donde los enlaces tengan mayor ancho de banda, siempre y cuando exista el soporte multicast.  Toda facultad o dependencia de la universidad interconectada con equipos que soporten PIM-SM pueden activar y disfrutar el servicio.  La cuenta @UCVCienciasTV de la solución propuesta puede integrarse a otras redes sociales como Instagram o Facebook. Se necesita alguien que las administre constantemente para publicar contenidos. 96 97 Referencias Bibliográficas [1] W. Stalling. Data and Computer Communications. Prentice Hall. 9th Edition. August 2010. [2] S. Bradner and A. Mankin. The Recommendation for the IP Next Generation Protocol, RFC 1752, January 1995. [3] J. Postel. Internet Protocol. RFC 791. September 1981. [4] A. Sánchez. Propuesta para la Implementación de un Servidor de Hilos Musicales utilizando IPv6 Multicast. Universidad Central de Venezuela. Julio 2010. [5] S. Deering. Host Extensions for IP Multicasting. RFC 1112. August 1989. [6] W. Fenner. Internet Group Management Protocol Version 2. RFC 2236. November 1997. [7] M. Escobar y J. Treminio. Estudio de IP/TV Multicasting para la Universidad Don Bosco. Enero 2007. [8] J. Petisme and L. Teng. Design and Implementation of a Live TV Server using Open-Sourced Tools. In proceedings to 9th National Undergraduate Research Opportunities Programme Congress, Nanyang Technological University. September 2003. [9] The Computing Center in University of Oregon. IP/TV Brings the World to your Screen. Computing News, Vol. 12(6). May 1997. [10] J. Reynolds and J. Postel. Assigned Numbers. RFC 1700. October 1994. [11] M. Cotton and L. Vegoda. Special Use IPv4 Addresses. RFC 5735. January 2010. [12] B. Cain, S. Deering, I. Kouvelas, B. Fenner, and A. Thyagarajan. Internet Group Management Protocol Version 3. RFC 3376. October 2002. [13] S. Deering. Host Extensions for IP Multicasting. RFC 988. July 1986. [14] D. Katz. IP Router Alert Option. RFC 2113. February 1997. [15] S. Bhattacharyya. An Overview of Source Specific Multicast (SSM). RFC 3569. July 2003. [16] Javvin Tecnologies. Network Protocols Handbook. 2nd Edition. January 2005 [17] P. Savola. Overview of the Internet Multicast Routing Architecture. RFC 5110. January 2008. [18] A. Adams, J. Nicholas, and W. Siadak. Protocol Independent Multicast – Dense Mode (PIM-DM). RFC 3973. January 2005. [19] B. Fenner, M. Handley, H. Holbrook, and I. Kouvelas. Protocol Independent Multicast – Sparse Mode (PIM-SM). RFC 4601. August 2006. [20] B. Williamson. Developing IP Multicast Networks. 1st. Ed., Cisco Press. October 1999. [21] N. Bhaskar, A. Gall, J. Lingard, and S. Venaas. Bootstrap Router (BSR) Mechanism for Protocol Independent Multicast (PIM). RFC 5059. January 2008. [22] M. Piedra. Estudio de los Mensajes de Control del Protocolo Multicast PIM-SM. Universidad Autónoma de Barcelona, Junio 2010. [23] M. Baldi and P. Nicoletti. Switched LAN. McGraw-Hill. July 2002. [24] H. Schulzrinne, S. Casner, R. Frederick, and V. Jacobson. RTP: A Transport Protocol for Real-Time Applications. RFC 3550. July 2003. [25] H. Schulzrinne and S. Casner. RTP Profile for Audio and Video Conferences with Minimal Control. RFC 3551. July 2003. [26] H. Schulzrinne, A. Rao, and R. Lanphier. Real Time Streaming Protocol (RTSP). RFC 2326. April 1998. [27] K. Islas y I. Sandoval. Tecnología de la Alta Definición en la Televisión de Alta Definición. Instituto Politécnico Nacional de Culhuacan. Marzo 2007. 98 [28] J. Cajamarca y B. Calle. Estudio de Factibilidad del Proceso de Migración de Televisión Analógica Terrestre a Televisión Digital Terrestre del Canal de Televisión Austral TV de la Ciudad de Azogues. Universidad Politécnica Salesiana de Ecuador. Mayo 2013. [29] C. Yonso. Propuesta de Tecnología IPTV para la Red de la Universidad Centroccidental Lisandro Alvarado. Julio 2012. [30] K. Rottmann. Diseño e Implementación de un Laboratorio de IPTV, Medición y Gestión. Universidad de Chile. Enero 2010. [31] M. Mayorga. La Televisión Digital Terrestre en el Perú: Contexto Actual y Políticas Públicas para su Desarrollo. Pontificia Universidad Católica del Perú. 2011. [32] D. Záratte. Diseño e Implementación de una Aplicación Interactiva para Educación a Distancia: T-Learning a Través de un Canal TDT Universitario y un Canal IPTV en la Ciudad de Lima. Pontificia Universidad Católica del Perú. Septiembre 2012. [33] J. Wroclawski. The Use of RSVP with IETF Integrated Services. RFC 2210. September 1997. [34] P. Brox, I. Baturone, S. Sánchez, J. Gutiérrez y F. Fernández. Algoritmo Adaptativo con el Grado de Movimiento para el Desentrelazado de Video. Facultad de Informática de la universidad Politécnica de Madrid. 2006. [35] A. Cabrera. HDTV sobre IP en Internet2. Facultad de Informática de la Universidad Nacional de la Plata, Argentina. Diciembre 2005. [36] J. Contreras. Estudio de Factibilidad para el Uso de un Sistema de Comunicación Multimedia Vía IP como Apoyo a la Educación a Distancia en SADPRO-UCV. Caracas 2008. [37] L. Venegas. Generación de una trama Broadcast Transport Stream (BTS) usando el software libre Opencaster. Lima, Mayo del 2012. [38] I. Ahmad. Video Transcoding: An Overview of Various Techniques and Research Issues. October 2005. [39] E. Leyton. Diseño de un Sistema De Seguridad Bajo Plataforma IP para el Campus Prosperina (Gustavo Galindo) de la Escuela Superior Politécnica Del Litoral, Facultad de Ingeniería en Electricidad y Computación, Ecuador. 2007. [40] Society of Motion Picture and Television Engineers. Proposed SMPTE Standard for Television: VC-1 Compressed Video Bitstream Format and Decoding Process. August 2005. [41] D. Meyer. Administratively Scoped IP Multicast. RFC 2365. July 1998.Microsoft Word - TEG LUIS LESSEY FINAL 2 Universidad Central de Venezuela Facultad de Ciencias Escuela de Computación Laboratorio de Comunicación y Redes Propuesta para la Implementación de un Servicio de Televisión utilizando Multicast en la Facultad de Ciencias Trabajo Especial de Grado presentado ante la Ilustre Universidad Central de Venezuela por el Bachiller: Luis Lessey C.I.: 17.077.454 E-mail: personal330@hotmail.com Tutor: Eric Gamess Caracas, Octubre 2015 2 3 4 5 Agradecimientos A Dios por haberme dado la fortaleza y sabiduría necesaria para culminar esta larga e importante etapa de mi vida. Que los que me ven, te vean a ti Señor. “Bienaventurado el varón que soporta la tentación; porque cuando haya resistido la prueba, recibirá la corona de vida, que Dios ha prometido a los que le aman.” Santiago (1:12) A mi Esposa por su amor incondicional. Siempre a mi lado en éste camino cuidando de la familia y mostrando ejemplo de alegría ante las dificultades y adversidades. Tu felicidad es la mía. Gracias por tanto mi pedacito de cielo. Ahora vamos con tu tesis. Te amo infinitamente. DVGNAE. A mi hijo Luis Rafael, por su futuro. Siempre se puede alcanzar una meta sólo hay que seguir adelante siendo perseverante. Gracias por recordarme siempre que aprendes de mí y debo darte el ejemplo. Te amo. A mi Madre por los años invertidos en mi formación, porque te lo debía, porque te lo mereces, eso y mucho más, gracias a tu ejemplo y que a tus 55 años terminaste la licenciatura, me animaste a terminar mi carrera y aquí está el papelito que te prometí. Es también tuyo! PD: Déjame copia!. A mi Padre que fue ejemplo constante en casa de perseverancia manteniendo unida a la familia y llevando 37 años de servicio sobre su espalda para ayudarnos a salir adelante, también te lo mereces, eso y mucho más, gracias a tu ejemplo. A mis abuelos, Luis Humberto (†), Terry Luis (†), Carmen, Isbelia porque fueron pilar fundamental en los valores inculcados. Gracias porque siempre estuvieron presentes y unidos como familia. A mi tutor y profesor Eric Gamess, por acompañarme en este largo recorrido hasta la finalización de lo que resultó ser un maravilloso proyecto. Gracias por sus conocimientos y apoyo, por la orientación y por su inmensa paciencia. Gracias por el buen ambiente que mantiene en LACORE para sus tesistas y por permitirme compartir con el grupo docente del área en lo humano y académico. Dios bendice su labor, infinitas gracias!. A mis familiares y amigos, todo el que de una u otra forma colaboró en el Trabajo Especial de Grado, es tanto el agradecimiento que faltaría papel para expresárselos. 6 7 Universidad Central de Venezuela Facultad de Ciencias Escuela de Computación Laboratorio de Comunicación y Redes TRABAJO ESPECIAL DE GRADO Título: Propuesta para la Implementación de un Servicio de Televisión utilizando Multicast en la Facultad de Ciencias. Autor: Luis O. Lessey V. Unidad de Investigación: LACORE. Palabras Claves: Multicast, Streaming de Video, Transcoding, IGMPv2, PIM-SM. Tutor: Eric Gamess. Fecha de Presentación: Octubre 2015. Resumen El objetivo del presente Trabajo Especial de Grado es investigar los requerimientos necesarios para habilitar un servicio de televisión utilizando multicast para la Facultad de Ciencias de la Universidad Central de Venezuela. Esta investigación se basa en el estudio de la tecnología multicast, su infraestructura y configuración necesaria. Inicia con un proceso de investigación de la tecnología multicast contemplando su origen, evolución e interacción con los nuevos estándares de comunicación IP. Posteriormente, en base a dicha investigación, se propone una infraestructura de red que abarca protocolos, estándares, tecnologías y equipos necesarios para implementar un servicio de televisión utilizando multicast. El protocolo de enrutamiento multicast utilizado es PIM-SM, definido formalmente en un RFC y adoptado por las principales compañías fabricantes de dispositivos de red. Por otra parte, para el servicio de televisión, y tras una investigación de las aplicaciones disponibles, se utilizó Microsoft Expression Encoder para el servidor de transcoding y VLC Player para el servidor multicast. Existe también un servicio web (tv.ciens.ucv.ve) con la dirección de dominio reservada en los servidores DNS de la universidad. Este trabajo difunde seis streamings, de los cuales dos corresponden a capturas tiempo real con decodificadores CANTV y los otros cuatro a contenido pregrabado (hilos de películas) que se transmiten para la Facultad de Ciencias. 8 9 Tabla de Contenidos Lista de Figuras ............................................................................................................. 11 Lista de Tablas .............................................................................................................. 13 1. Introducción ........................................................................................................... 15 2. Planteamiento del Problema ................................................................................. 17 2.1 Justificación del Problema .......................................................................................................... 17 2.2 Objetivos ..................................................................................................................................... 18 2.2.1 Objetivo General ..................................................................................................................... 18 2.2.2 Objetivos Específicos ............................................................................................................... 18 2.3 Antecedentes .............................................................................................................................. 18 3. Marco Teórico ........................................................................................................ 23 3.1 Internet Protocol Version 4 ......................................................................................................... 23 3.2 Direccionamiento en IPv4 ........................................................................................................... 23 3.3 Unicast sobre IPv4 ....................................................................................................................... 24 3.4 Broadcast sobre IPv4 ................................................................................................................... 24 3.5 Multicast sobre IPv4 .................................................................................................................... 25 3.5.1 Direcciones MAC Multicast ..................................................................................................... 27 3.5.2 Correspondencia de IPv4 y MAC en Multicast ........................................................................ 28 3.5.3 Internet Group Management Protocol ................................................................................... 28 3.5.4 Enrutamiento Multicast .......................................................................................................... 34 3.6 Calidad de Servicio en IPv4 ......................................................................................................... 41 3.6.1 Real‐Time Transport Protocol ................................................................................................. 43 3.6.2 Real Time Streaming Protocol ................................................................................................ 45 3.7 Televisión sobre IP ...................................................................................................................... 47 3.7.1 Televisión Analógica ............................................................................................................... 47 3.7.2 Televisión Digital Abierta ........................................................................................................ 48 3.7.3 Diferencias entre TV Analógica y Digital ................................................................................. 51 3.7.4 Formatos de Compresión de Video ......................................................................................... 54 3.7.5 Formato de Encapsulación de Audio y Video .......................................................................... 58 4. Marco Metodológico .............................................................................................. 61 4.1 Red Actual de la Facultad de Ciencias ......................................................................................... 61 4.2 Infraestructura para una Transmisión Multicast ........................................................................ 61 4.2.1 Captura de la Señal de Televisión ........................................................................................... 63 4.2.2 Servidor de Transcoding ......................................................................................................... 70 4.2.3 Servidor Multicast ................................................................................................................... 75 4.2.4 Infraestructura de Red ............................................................................................................ 80 4.2.5 Aplicación de los Clientes ........................................................................................................ 81 5. Conclusiones ......................................................................................................... 93 Recomendaciones ........................................................................................................ 95 Referencias Bibliográficas ........................................................................................... 97 10 11 Lista de Figuras Figura 2.1: Topología de Red de MBone en 1994 .......................................................... 19 Figura 2.2: Arquitectura virtPresenter del Proyecto Opencast Matterhorn ..................... 22 Figura 3.1: Formato de la Cabecera IPv4 ....................................................................... 23 Figura 3.2: Formato Dirección IPv4 Clase D ................................................................... 24 Figura 3.3: Comunicación Unicast ................................................................................. 24 Figura 3.4. Dirección IPv4 Broadcast Dirigido ................................................................ 25 Figura 3.5: Broadcast Limitado ....................................................................................... 25 Figura 3.6: Implementación de Multicast a Nivel de Aplicación ...................................... 26 Figura 3.7: Implementación de Multicast Explícito .......................................................... 27 Figura 3.8: Formato de Direcciones MAC Multicast ........................................................ 27 Figura 3.9: Correspondencia Multicast entre IPv4 y MAC .............................................. 28 Figura 3.10: Encapsulamiento de IGMP ......................................................................... 28 Figura 3.11: Formato de Mensaje IGMPv1 ..................................................................... 29 Figura 3.12: Formato de Mensaje IGMPv2 ..................................................................... 30 Figura 3.13: Formato de Mensaje Membership Query con IGMPv3 ............................... 31 Figura 3.14: Formato de Mensaje Membership Report en IGMPv3 ............................... 32 Figura 3.15: Formato Interno Group Record de un Membership Report ........................ 33 Figura 3.16: Gestión desde el Router con CGMP ........................................................... 34 Figura 3.17: Filtrado de Membership Reports con IGMP Snooping ............................... 34 Figura 3.18: Árbol de Camino más Corto (SPT) ............................................................. 35 Figura 3.19: Árbol de Distribución Compartida ............................................................... 35 Figura 3.20: Éxito y Fallo de RPF Check ........................................................................ 37 Figura 3.21: Cabecera de Mensajes de Control PIM ...................................................... 37 Figura 3.22: Formato de Mensaje PIM Hello .................................................................. 38 Figura 3.23: Formato de Mensaje Join/Prune ................................................................. 40 Figura 3.24: Formato de Mensaje PIM Register ............................................................. 41 Figura 3.25: Formato de Mensaje PIM Register Stop ..................................................... 41 Figura 3.26: Formato de Cabecera RTP ......................................................................... 43 Figura 3.27: Televisión según sus Fases ........................................................................ 49 Figura 3.28: Campo Visual en los Formatos 4:3 y 16:9 .................................................. 53 Figura 3.29: Técnicas de Relleno de Imagen Pillarbox y Letterbox ................................ 53 Figura 3.30: Diferencias de Señal Entrelazada y Progresiva .......................................... 54 Figura 4.1: Extracto de la Red Corporativa de la UCV ................................................... 61 Figura 4.2: Infraestructura para una Transmisión Multicast ............................................ 62 Figura 4.3: Antena de Televisión Conejo Doble Aro ....................................................... 63 Figura 4.4: Decodificador Echostar DSB-646V de Movistar ........................................... 64 Figura 4.5: Tarjeta de Acceso Decodificador Movistar ................................................... 64 Figura 4.6: Antena Parabólica Movistar TV .................................................................... 65 Figura 4.7: Decodificador Konka KHDS866 PVR-R de CANTV ..................................... 65 Figura 4.8: Decodificador Huawei DS360 de CANTV ..................................................... 65 Figura 4.9: Antena Parabólica CANTV Televisión Satelital ............................................ 66 Figura 4.10: Tarjeta Hauppauge 1229 WinTV HVR-2250 ............................................... 66 Figura 4.11: Vista Frontal del Dispositivo Hauppauge 1192 WinTV HVR-1950 ............. 67 Figura 4.12: Vista Trasera del Dispositivo Hauppauge 1192 WinTV HVR 1950 ............ 67 Figura 4.13: Sintonizadora Kworld Analog TV Stick III UB405-A .................................... 68 Figura 4.14: Sintonizadora Easycap SM-USB 007 ......................................................... 69 Figura 4.15: Dialogo de Barras Cruzadas en Microsoft Expression Encoder ................. 72 Figura 4.16: Diálogo Sintonizador de TV Kworld Analog TV Stick III UB405-A .............. 73 12 Figura 4.17: Diálogo de Captura Easycap SM-USB 007 ................................................ 74 Figura 4.18: Imagen 3D Doble Pantalla (Izquierda-Derecha) ......................................... 74 Figura 4.19: Opción AVS Script Creator de MeGUI 2525 ............................................... 75 Figura 4.20: Puntos de Publicación en WMS .................................................................. 77 Figura 4.21: Formatos de Origen en WMS ..................................................................... 77 Figura 4.22: Parámetros para Multicast con Tiempo Real en VLC Player ...................... 78 Figura 4.23: URL para Multicast de Contenido Pregrabado en VLC Player ................... 78 Figura 4.24: Activar Loop One en VLC Player ................................................................ 79 Figura 4.25: Ancho de Banda de Envío en Multicast con Seis Canales de Televisión ... 79 Figura 4.26: Consumo de CPU en Multicast con Seis Canales de Televisión ................ 80 Figura 4.27: Comando Cisco para Habilitar IGMPv3 ...................................................... 80 Figura 4.28: Llave de Registro para Habilitar IGMPv2 en Windows ............................... 81 Figura 4.29: Comando para Habilitar IGMPv2 en Linux ................................................. 81 Figura 4.30: Etiqueta HTML para VLC Plugin ................................................................. 81 Figura 4.31: Diagrama de Casos de Uso del Cliente de CienciasTV ............................. 83 Figura 4.32: Diagrama Entidad-Relación de CienciasTV ................................................ 90 Figura 4.33: Pantalla de Bienvenida a CienciasTV ......................................................... 90 13 Lista de Tablas Tabla 3.1: Clases de Direcciones en IPv4 ...................................................................... 23 Tabla 3.2: Direcciones Multicast Reservadas de Alcance Local ..................................... 26 Tabla 3.3: Ejemplos de Direcciones MAC Multicast ....................................................... 27 Tabla 3.4: URL para RTSP ............................................................................................. 46 Tabla 3.5: Comparación de Parámetros en Televisión Analógica .................................. 48 Tabla 3.6: Requisitos para Implementar TDA ................................................................. 49 Tabla 3.7: Estándares TDA en Latinoamérica ................................................................ 50 Tabla 3.8: Formatos de Televisión Digital ....................................................................... 52 Tabla 3.9: Formatos de Compresión Dominantes en el Mercado Actual ........................ 55 Tabla 3.10: Ancho de Banda en los Formatos de Compresión ...................................... 57 Tabla 3.11: Bit Rate y Resoluciones Recomendadas en VC-1 ....................................... 58 Tabla 4.1: Especificaciones de Hardware de Servidores Utilizados ............................... 63 Tabla 4.2: Equipos de Televisión Digital CANTV y Movistar .......................................... 64 Tabla 4.3: Compatibilidad de las Sintonizadoras con los Sistemas Operativos ............. 69 Tabla 4.4: Casos de Uso de CienciasTV ........................................................................ 82 Tabla 4.5: Descripción de Caso de Uso Ver Inicio .......................................................... 84 Tabla 4.6: Descripción de Caso de Uso Ver Televisión .................................................. 84 Tabla 4.7: Descripción de Caso de Uso Ver Ayuda ........................................................ 85 Tabla 4.8: Descripción de Caso de Uso Escribir en Twitter ............................................ 86 Tabla 4.9: Descripción de Caso de Uso Hacer Tweet .................................................... 86 Tabla 4.10: Descripción de Caso de Uso Cambiar Configuración de VLC ..................... 87 Tabla 4.11: Descripción de Caso de Uso Maximizar Canal ............................................ 88 Tabla 4.12: Descripción de Caso de Uso Ver Ayuda Linux ............................................ 88 Tabla 4.13: Descripción de Caso de Uso Ver Ayuda Windows ...................................... 89 14 15 1. Introducción La oferta de servicios de telecomunicaciones en Venezuela ha crecido constantemente, así también la adquisición de nuevas tecnologías que mejoran la capacidad de procesamiento de datos. Generalmente, la innovación tecnológica busca aprovechar los recursos ofrecidos en un contexto específico para introducir nuevos productos y servicios que impulsan al desarrollo socioeconómico de una entidad. Los servicios de televisión, radio e Internet se han integrado a dispositivos electrónicos de uso común en la sociedad, como relojes, computadores de escritorio y celulares, entre otros; dichos servicios convergen en la alta aceptación que tienen dentro del mercado venezolano, lo que ha originado que los especialistas de estas áreas innoven aceleradamente. La revolución en el hardware ha causado también una revolución en el software que trajo al mercado muchas aplicaciones basadas en streaming, con soporte IPv4 en su mayoría y para IPv6 en algunos casos. IPTV (Internet Protocol Television) es la denominación que ha recibido el servicio de entrega de televisión usando el protocolo IP sobre redes privadas. Éste se basa en la tecnología de video streaming y tiene poco despliegue a nivel nacional dado que los requerimientos de ancho de banda necesarios para su implementación resultan insuficientes. Sin embargo, las empresas privadas de televisión por cable y satélite de otros países ofrecen el servicio en una mezcla denominada Triple Play que combinan IPTV, Internet y VoIP, dado que sus velocidades de ancho de banda son mucho mayores. Es importante destacar que IPTV no debe confundirse con televisión por Internet, ya que ambas difieren en el alcance geográfico, plataformas tecnológicas y modo de acceso al servicio, entre otras cosas. IPTV se usa generalmente en redes seguras y dedicadas, controladas por operadores de telecomunicaciones que sólo alcanzan su base de datos de suscriptores. La televisión por Internet está disponible en cualquier lugar donde la capa de red permita el enrutamiento. El enrutamiento con multicast es el más utilizado cuando se quiere enviar datos desde un origen a varios destinos sin hacer gran impacto en el rendimiento de las infraestructuras de las redes involucradas, ya que se reduce el envío de paquetes. El router es quien debe crear las copias necesarias para reenviar por las interfaces de salida en las que se ha registrado la pertenencia a un grupo multicast. Actualmente, la infraestructura de red de la Facultad de Ciencias en la Universidad Central de Venezuela tiene soporte para Ten Gigabit Ethernet y Gigabit Ethernet en sus troncales y existen gran cantidad de equipos con acceso a dichos enlaces. Sin embargo, los servicios ofrecidos dentro de esta infraestructura son de bajo consumo de ancho de banda, lo que otorga la posibilidad de aprovechar los recursos para servicios de streaming de video y audio. Con este fin y de acuerdo a las necesidades planteadas se estructuró el resto del presente documento en 5 capítulos, que tendrán el orden descrito a continuación:  Capítulo 2: Planteamiento del Problema. Se describe el objetivo general y objetivos específicos del trabajo basados en la implementación del servicio de televisión. Se hace mención a todos los proyectos, estudios, propuestas e implementaciones que han sido investigadas bajo un ámbito global y que han 16 transmitido streamings con multicast. Se mencionan los trabajos relacionados, la historia de multicast y la adaptación de Venezuela con respecto a estas tendencias.  Capítulo 3: Marco Teórico. Se estudian las características y relaciones de IPv4 con el modelo de transmisión multicast. Se describen detalladamente los protocolos de enrutamiento más comunes y las políticas de calidad de servicio sugeridas para el envío de streaming con multicast. Se exploran las nuevas tendencias de transmisión de las señales de televisión en Internet y los estándares definidos para televisión analógica. Se estudian los formatos de codecs y encapsulamiento que pueden aplicarse al streaming para garantizar el soporte en la transmisión y recepción.  Capítulo 4: Marco Metodológico. Se describe la metodología a utilizar en el desarrollo del trabajo, las tecnologías que capturan la señal de televisión, el software que distribuye el streaming con multicast en la red Ethernet y hace transcoding del contenido. Se presenta la herramienta con la que el cliente puede disfrutar el servicio de televisión en la Facultad de Ciencias con soporte en distintas plataformas.  Capítulo 5: Conclusiones. Se presentan las conclusiones y recomendaciones finales del trabajo de investigación. 17 2. Planteamiento del Problema A medida que pasa el tiempo, surgen distintas técnicas y herramientas para mejorar la transmisión por multicast. Las soluciones comunicacionales actuales buscan aprovechar la banda ancha al máximo y el auge del mercado nacional inicia con la implementación de televisión digital abierta. Existe entonces especial interés en el desarrollo tecnológico en materia de redes y telecomunicaciones, lo que motiva la elaboración del presente Trabajo Especial de Grado. El servicio de Internet en la Facultad de Ciencias es de uso fundamental para la comunidad universitaria. Su acceso es público y la descarga de contenidos multimedia utiliza el modelo de transmisión unicast. Las páginas web en Internet con enlaces a transmisión en vivo de programas de televisión son diversas y no están filtradas por los routers. Si varios usuarios quieren ver un partido de futbol establecerán una conexión independiente con el lugar en Internet donde se encuentre el recurso, redundando así en la transmisión del contenido. El ancho de banda tiene un valor importantísimo entre todas las métricas a considerar para enviar streaming, ya que la cantidad de usuarios ha crecido exponencialmente. Por lo tanto, es necesario que cada servidor pueda implementar el mejor esquema de conexión con sus clientes, además de administrar las colas que surgen cuando hay una escalada en la solicitud de recursos. Estas consideraciones hacen que no sea utópico prestar servicios de televisión, videos y conferencias sin retrasos, sobre todo cuando muchos de los equipos que interconectan las redes tienen soporte Gigabit Ethernet o Ten Gigabit Ethernet como es el caso de las troncales en la Universidad Central de Venezuela. Existe una implementación de un servidor de hilos musicales en el Laboratorio de Comunicación y Redes de la Facultad de Ciencias. Este ofrece enviar por multicast canciones almacenadas en un servidor y que son accedidas desde una página web. Aún no existen aplicaciones interactivas y de tiempo real para videos o televisión que pueden ser accedidas por la comunidad universitaria usando multicast. Esta investigación pretende servir de apoyo para utilizar toda la infraestructura de red instalada en la Facultad de Ciencias de la Universidad Central de Venezuela que se encuentra actualmente subutilizada. Se desea enviar canales de televisión por multicast junto a todas las posibles variantes de streaming que ayuden a establecer las bases para investigaciones futuras. 2.1 Justificación del Problema Ahorrar tiempo, ayuda a ser más efectivo en las actividades diarias y reduce costos de recurso humano y tecnológico. La capacidad multitarea del computador hace cada vez más común que muchos usuarios utilicen Internet para ver televisión, videos y escuchar música mientras trabajan. Retrasar la descarga de contenidos digitales desde la web se traduce en pérdida de tiempo para el usuario y a medida que la solicitud de recursos crece, más se sobrecarga la red. El enrutamiento multicast resulta ser una solución de bajo nivel que ahorra tiempo en la descarga de recursos en la red. 18 Un streaming puede transportar la señal de televisión que puede ser accedida vía web desde cualquier parte de la Facultad de Ciencias, previa adecuación de la infraestructura tecnológica existente (servidores, routers y software). Los costos de implementación de un servidor de streaming con multicast pueden ser relativamente bajos ya que sólo se requiere de una configuración adecuada en el esquema cliente- servidor. Además, configurar una política de calidad de servicio a nivel de aplicación garantizaría la eficiencia en la entrega de los paquetes, así como una buena administración de la banda ancha. Por tales motivos la presente investigación representa un reto importante al proponer el envío de televisión con multicast, que está compuesto por video y audio sincronizados, aportando la base de conocimiento científico, teórico, metodológico y académico, para enviar por las redes de la Facultad de Ciencias cualquier contenido en tiempo real que beneficie a la comunidad universitaria. 2.2 Objetivos Con la presente investigación se desea mostrar resultados que permitan proponer la implantación de un servicio de televisión en la Facultad de Ciencias. Se desea brindar a la comunidad universitaria el acceso vía web de contenido audiovisual generado desde un servidor multicast ubicado en la Facultad de Ciencias. 2.2.1 Objetivo General Proponer un servicio de televisión utilizando multicast sobre IPv4 en la Facultad de Ciencias de la Universidad Central de Venezuela. 2.2.2 Objetivos Específicos  Investigar los antecedentes al presente proyecto explorando así las experiencias similares y los problemas o soluciones surgidas durante el desarrollo.  Estudiar el protocolo IPv4 para la implementación de servicios con multicast.  Estudiar los diferentes sintonizadores de televisión para computadores que ayuden a prestar un buen servicio y las nuevas tendencias de transmisión de las señales de televisión.  Estudiar los formatos de codecs que facilitan el transporte de streamings dentro de las redes Ethernet.  Estudiar los protocolos de calidad de servicio que pueden implementarse para optimizar el uso de la banda ancha en la transmisión multicast.  Definir la infraestructura necesaria para colocar en producción un servicio de televisión con multicast.  Proponer una solución para ofrecer un servicio de televisión basado en multicast sobre las redes de la Facultad de Ciencias. 2.3 Antecedentes Por las redes actuales fluye una gran cantidad de datos como videos, música, correos electrónicos y tráfico web que pueden ser accedidos desde dispositivos diversos. La incorporación de computadores dentro de una organización va en crecimiento a la par con las innovaciones que surgen para la época. Habitualmente, en Internet las comunicaciones se establecen extremo a extremo, por lo que, la eficiencia en la entrega de paquetes de una videoconferencia resulta inversamente proporcional al número de 19 receptores en un extremo de la red, obligando a que los paquetes se multipliquen desde la fuente. En la Universidad Central de Venezuela, hay variedad de recursos y servicios públicos disponibles en las redes. Es importante garantizar que el flujo de paquetes no colapse la banda ancha disponible, optando por alternativas de comunicación adecuadas al momento de incluir un servicio. En 1992 se pensó que podría ser interesante difundir las reuniones que periódicamente realiza el IETF (Internet Engineering Tasking Force), de manera que grupos situados en distintos países pudieran participar en estos fórums, por lo que, Van Jacobson, Steve Deering, Stephen Casner junto a varios ingenieros decidieron crear una red virtual (una red que corría sobre Internet) que utilizando técnicas de transmisión multicast optimizara el uso de los recursos. A esta red la llamaron MBone (Multicast Backbone). RedIRIS se unió a este proyecto en 1993 de forma local, dado que las condiciones de los enlaces troncales de la red académica y de investigación no permitían la difusión de MBone por toda ella. RedIRIS es la red académica de investigación española que proporciona servicios avanzados de comunicaciones a la comunidad científica y universitaria incluyendo a Venezuela y a muchos otros países de América Latina [4]. MBone fue creada inicialmente con fines experimentales, se esperaba que después de establecerse estándares para los routers cuya funcionalidad permitiera paquetes multicast no fuera necesario hacer encapsulamiento dentro de los paquetes unicast, este esquema de transporte utilizado por MBone se le conoce como tunneling. Actualmente, las redes MBone han ido desapareciendo quedando sólo en universidades e institutos de investigación. En la Figura 2.1 (tomada de [4]) se presenta un mapa topológico con las trazas de las redes MBone existentes hasta el año 1994. Figura 2.1: Topología de Red de MBone en 1994 Para MBone se han desarrollado o adaptado gran cantidad de herramientas con el fin de experimentar diferentes intercambios multimedia, usando multicast en modo interactivo: audio y video conferencias, editores de texto y pizarras electrónicas compartidas, intercambio de hipertextos; o en procesos no interactivos como sincronización de equipos (NTP multicast), distribución multicast de archivos (FTP multicast). Los protocolos de enrutamiento multicast más utilizados en la MBone son 20 DVMRP, MOSPF, PIM-DM, CBT y PIM-SM, éste último prevalece junto al protocolo IGMP por su escalabilidad y adaptación a sistemas con muchas subredes, IGMP por el soporte que tiene bajo Windows. IPv4 (Internet Protocol version 4) es la primera implementación a gran escala del protocolo IP. Debido a su éxito se expandió poco a poco en el mundo entero, llegando a escasear las direcciones IPv4. En Febrero del 2011, el IANA (Internet Assigned Numbers Authority) entregó sus últimos bloques /8 de direcciones IPv4 a los cinco RIRs (Regional Internet Registries) llevando el problema de la escasez de direcciones IPv4 a un nivel más alto. Como solución al problema, el IETF se vio en la necesidad de crear un nuevo protocolo que inicialmente se conoció como IPng (Internet Protocol Next Generation) y que terminó denominándose IPv6. La cantidad de direcciones IPv6 resulta abrumadora, dando solución a un mundo que crece exponencialmente en la incorporación de servicios y dispositivos a las redes IPv4. Hoy en día existe software que permiten la transmisión de streaming de video y audio bajo demanda utilizando multicast, entre los que se pueden mencionar, Windows Media Services de Microsoft, DVBlast de VideoLAN, Wowza Media Server de Wowza Media Systems, SHOUTcast de Nullsoft, TVersity Media Server de TVersityInc, Unreal Media Server de Unreal Streaming Technologies, entre muchos otros software desarrollados, demostrando el gran interés que existe en la difusión de streaming a través de las redes IPv4. Dichos software en su mayoría requieren que el video o audio a enviar sea codificado, lo que se conoce como coding, por lo que el éxito del mismo queda supeditado a la eficiencia del codificador empleado. Así también, el mercado actual se ha esforzado en el desarrollo de hardware que incorporan televisión al computador por interfaz USB (Universal Serial Bus), PCI convencional o PCI Express, incluso muchos de estos sintonizadores están embebidos en las tarjetas de video. Estos equipos se conocen comúnmente como sintonizadores de televisión y son diseñados tanto para instalación interna como externa adaptados a cada región según el medio de difusión de la señal. El medio de difusión actualmente utilizado en Venezuela es analógico en las señales públicas y digital en algunas compañías privadas, por lo que, la televisión por Internet ha surgido como un medio de comunicación alternativo que ha tomado terreno y donde aún se están desarrollando pruebas, tal como las del proyecto de implantación del servicio denominado IPTV, que lleva a cabo la empresa china ZTE en nuestro país1. La Facultad de Ciencias de la Universidad Central de Venezuela posee un servidor configurado para el envío de streaming de audio [4], dicha iniciativa fue tomada en el año 2010 por el Laboratorio de Comunicación y Redes. El servidor fue programado para ser accedido desde un explorador web compatible con Windows Media Player. Para enviar el streaming se utiliza WMS (Windows Media Services) previa codificación con Windows Media Encoder para obtener el formato deseado para la transmisión en puntos de publicación. Todo se hace desde un mismo servidor ya que el contenido a difundir se encuentra pregrabado, ofreciendo a la comunidad un espacio con diversidad musical sin gran consumo del ancho de banda (dada su implementación con multicast), además que el acceso puede ser mediante IPv4 o IPv6. 1 http://www.con-cafe.com/index.php/2009/04/zte-gano-licitacion-para-desplegar-iptv 21 La incorporación de nuevas tecnologías en el ámbito educativo permite la transformación de los procesos de enseñanza-aprendizaje en línea, la generación de nuevos métodos y el aprendizaje didáctico en la educación; es importante romper los paradigmas conservadores en este ámbito tanto en el docente como el estudiante, para adaptarse al sin fin de variantes que permite la transmisión de streaming, donde el método audiovisual parece ser más aceptado por los estudiantes y ofrece mayor índice de participación en los eventos y actividades. En el Salvador para el año 2007 se presentó un estudio de IPTV utilizando multicast [7], donde el alcance estuvo limitado a generar documentación del uso de las herramientas y temas asociados a dicha tecnología. Se elaboró una demostración sencilla por Intranet y se configuraron los routers (Cisco) para dar soporte multicast. El sistema operativo utilizado en el servidor fue Windows Server 2003, con WMS y Windows Media Encoder destinados al envío del streaming; los clientes estaban configurados bajo Windows XP y se utilizó el reproductor Windows Media Player para capturar el streaming publicado. Los protocolos de enrutamiento estudiados fueron PIM y DVMRP. La implementación de un servicio bajo esta tecnología quedó sobre la mesa para trabajos futuros, aún no se ofrece el servicio en la Universidad. En la Escuela de Computación de la Universidad Nacional de Singapore para el año 2003 se desarrolló e implementó un servidor de televisión en vivo usando herramientas de código abierto [8]; la solución de streaming se denominó NUSCast y permite a los usuarios de la red ver televisión con la posibilidad de seleccionar los canales. Además tienen un repositorio de videos pregrabados que pueden ser accedidos bajo previa autenticación. Lo más interesante de esta implementación es que se utilizó Linux con una tarjeta sintonizadora WinTV Theater (modelo 495) fabricada por Hauppauge y se basaron en el API de Video4Linux para la compatibilidad del sintonizador de TV, codificando el streaming con Theora y Vorbis desarrollados por la fundación Xiph.org. En la Universidad Osnabrück de Alemania existe una central de investigación llamada virtUOS que tiene proyectos como Stud.IP y Opencast Matterhorn. El primero es una plataforma de administración que sirve a profesores, estudiantes, administradores y directivos en su trabajo diario, coordinando eventos, cursos de extensión, entre muchas otras cosas. El segundo se refiere a un proyecto de código abierto que permite registrar conferencias y redistribuirlas por Internet utilizando multicast. Los videos pueden ser reproducidos en paralelo, cambiados de tamaño y calidad, grabados y accedidos mediante una línea de tiempo con estadísticas de los comentarios efectuados. La arquitectura de conexión utilizada se muestra en la Figura 2.2 y cabe destacar que como dispositivo de captura utilizaron una tarjeta PCI fabricada por Hauppauge modelo PVR 150 con codificador MPEG-2 integrado. Dicho proyecto de enseñanza se viene trabajando desde 1998 y ha ido evolucionando, adaptándose incluso a redes sociales como Facebook y servicios como YouTube o iTunes U2. 2 http://www.virtuos.uni-osnabrueck.de/Projekte/StudIP 22 Figura 2.2: Arquitectura virtPresenter del Proyecto Opencast Matterhorn La Universidad de Oregon en Estados Unidos tuvo implementado para el año 1997 un servidor con multicast que transmitía audio y video eficientemente a un gran número de usuarios de la red universitaria. Dicho servidor se conoció como Uversity of Oregon IPTV Server y utilizó la red MBONE. Fue desarrollado para fomentar la educación a distancia, el cliente que interpretaba dicho streaming estuvo disponible para Windows 95 y plataforma NT y podía ser descargado desde cualquier explorador web [9]. Actualmente la universidad tiene equipos CoolSign fabricados por Haivision, un hardware especializado que presta servicios de IPTV con multicast nativo a muy altas prestaciones, además de codificadores Makito que son conocidos en el mercado como los de más baja latencia y más alto rendimiento. El trabajo conjunto de estas tecnologías ha permitido brindar un servicio en el que los juegos de baloncestos de los Ducks of Oregon en el Matthew Knight Arena pueden apreciarse desde más de 140 reproductores CoolSign instalados en zonas comunes del recinto. El sistema CoolSign incluye un servidor CoolSign, DataWatcher, Network Manager y una herramienta de creación de contenidos3. En la Pontificia Universidad Católica del Perú para el año 2012 diseñaron una aplicación interactiva por televisión para educación a distancia [32]. La TDT y un canal de IPTV fueron el medio tecnológico utilizado para tal fin. Los espacios donde no existía cobertura de la señal ISDB-T se cubrieron con IPTV. La aplicación desarrollada llevó el nombre de “El Zorro y el Condor” que implementó la difusión de cuentos tradicionales peruanos. Esta aplicación permite:  Obtener mayor información sobre los personajes y escenarios del cuento.  Modificar el idioma del Español al Quechua.  Mostrar ventana para video de lenguaje de señas, mostrar subtítulos.  Escribir mensajes para los productores de los contenidos, con la ayuda de un teclado virtual.  Autoevaluación interactiva con preguntas relativas al cuento. 3http://www.digitalavmagazine.com/2012/08/16/la-universidad-de-oregon-recurre-a-haivision- para-instalar-un-sistema-de-digital-signage-en-su-nuevo-pabellon-deportivo 23 3. Marco Teórico 3.1 Internet Protocol Version 4 IPv4 [1][3], usa un formato de direcciones de 32 bits, abarcando un conjunto de 232 direcciones únicas, es decir, 4.294.967.296. En la práctica sólo están en uso un 40% de estas direcciones debido a que en 1980 por falta de coordinación en los responsables de la asignación de direcciones IPv4 se dejaron espacios de direcciones discontinuos. Los datos en una red que se basa en IPv4 son enviados en bloques conocidos como paquetes. IPv4 provee un servicio de paquetes no fiable, no orientado a conexión y de mejor esfuerzo. IPv4 no provee ningún mecanismo para determinar si un paquete alcanza o no su destino ya que no mantiene información referente al estado de las conexiones y únicamente proporciona seguridad mediante checksums de sus cabeceras y no de los datos transmitidos. El formato de la cabecera de IPv4 se presenta en la Figura 3.1 tomada de [3]. Figura 3.1: Formato de la Cabecera IPv4 3.2 Direccionamiento en IPv4 Para hablar de direccionamiento hay que entender las diferencias entre los distintos tipos de transmisión (unicast, multicast y broadcast) que involucran el proceso de comunicación: emisor, medio y receptor; en este caso se clasifican las comunicaciones en función al número de receptores. Las direcciones IPv4 que se usan en Internet se escriben en decimal utilizando un punto “.” como separador entre cada 8 bits; por ejemplo, 192.168.100.252. Cada dirección IPv4 se divide en dos partes, una que identifica a la red en la que se encuentra y otra que corresponde al computador. Inicialmente se dividió el espacio de direccionamiento de IPv4 en clases que van desde la A hasta la E, creando así distintos tipos de redes, cada una con un número máximo de computadores distintos. El tipo de red se determina mediante los bits más significativos de la dirección IPv4 y los bits restantes representan el identificador del computador dentro de la red [9]. Clase de Dirección Primeros 8 bits en Decimal Direcciones de Red Posibles Direcciones de Host Posibles A 0.0.0.0 - 127.255.255.255 2^7 2^24 B 128.0.0.0 - 191.255.255.255 2^14 2^16 C 192.0.0.0 - 223.255.255.255 2^21 2^8=256 D 224.0.0.0 - 239.255.255.255 - - E 240.0.0.0 - 255.255.255.255 - - Tabla 3.1: Clases de Direcciones en IPv4 Version Identification 4 16 243 15 23 310 IHL 7 8 Type of Service Total Length Time To Live Protocol Header Checksum Destination Address Source Address Fragment Offset0 DF M F 17 18 19 24 Como se puede observar en la Tabla 3.1, hay pocas redes de clase A pero cada una de ellas puede tener muchos computadores (más de 16 millones), dado que el número de la red sólo ocupa el primer byte dejando los otros tres libres para numerar los computadores. En cambio, hay gran cantidad de redes de clase C (que ocupan tres bytes de la dirección) pero cada una de ellas puede contener un máximo de sólo 256 direcciones IPv4. Las direcciones clase D no se identifican con ninguna red en particular sino con grupos multicast (grupos de computadores que comparten la misma dirección IPv4), pero que tienen una estructura similar a las anteriores. Los cuatro bits más significativos de las direcciones de Clase D se fijan a "1110", y los siguientes 28 bits reciben la denominación de identificador del grupo multicast, no estando por lo tanto, estructuradas las direcciones como las direcciones IPv4 unicast. Su formato es el indicado en la Figura 3.2. Figura 3.2: Formato Dirección IPv4 Clase D Las direcciones clase E abarcan el bloque 240.0.0.0/4 y están reservadas por la IANA para usos futuros. La dirección de broadcast 255.255.255.255 no puede ser transmitida fuera de la subred desde donde se encuentre la fuente [11]. 3.3 Unicast sobre IPv4 Este tipo de dirección se utiliza para enviar un paquete a un computador específico, es válido colocarla como dirección fuente o destino. Por cada destinatario el emisor debe enviar los paquetes, véase la Figura 3.3. Figura 3.3: Comunicación Unicast 3.4 Broadcast sobre IPv4 Las direcciones broadcast refieren a todos los equipos de una dirección de red, sólo son válidas si se usan como destino, nunca como fuente. Cuando un emisor envía un paquete de este tipo puede hacerlo de las siguientes formas:  Broadcast dirigido: La dirección destino tiene la porción que identifica a los equipos con todos los bits en uno y los bits de la subred intactos (véase Figura 3.4). Los routers no reenvían este tipo de paquetes por defecto pero pueden configurarse para que lo hagan. 0 1 1 1 0 3 4 31 group ID 25 Figura 3.4. Dirección IPv4 Broadcast Dirigido  Broadcast limitado: Es utilizada para la comunicación con los computadores dentro de la red local. Estos paquetes llevan como dirección IPv4 destino 255.255.255.255, los routers no reenvían estos broadcast, pero cada computador que lo recibe está obligado a procesar el paquete. Con el protocolo DHCP, cuando un dispositivo está inicializando y desea ingresar a la red se utiliza la dirección de broadcast limitado a fin de asignarle una dirección IPv4 válida (véase la Figura 3.5). Figura 3.5: Broadcast Limitado 3.5 Multicast sobre IPv4 Se define como la transmisión de un paquete a una dirección que corresponde a un grupo de computadores. La filosofía de comunicación es “uno a muchos”, haciendo el mejor esfuerzo y sin garantía de entrega a todos los miembros del grupo [5]. Hay una serie de direcciones multicast reservadas cuyo significado se considera especial y que designan grupos concretos, tal como se observa en la Tabla 3.1 tomada de [9]. El rango de direcciones desde 224.0.0.1 a 224.0.0.255 está reservado para el uso de protocolos de enrutamiento, descubrimiento y mantenimiento de topologías de bajo nivel; si un router recibe un paquete con dirección de destino dentro de este rango no debe reenviarlo. Destacan la dirección 224.0.0.1 que refiere a todos los computadores con soporte multicast en la subred, y 224.0.0.2 refiere a todos los routers con soporte multicast en la subred. Existen también un grupo de direcciones definidas en el rango 239.0.0.0/8 que se utilizan con alcance administrativo dentro de una organización y están definidas en [41]. IPv4 Address Description References 224.0.0.0 Base Address (Reserved) RFC1112, JBP 224.0.0.1 All Systems on this Subnet RFC1112, JBP 224.0.0.2 All Routers on this Subnet JBP 26 224.0.0.3 Unassigned JBP 224.0.0.4 DVMRP Routers RFC1075, JBP 224.0.0.5 All OSPF Routers RFC1583, JXM1 224.0.0.6 OSPF Designated Routers RFC1583, JXM1 224.0.0.7 ST Routers RFC1190, KS14 224.0.0.8 ST Hosts RFC1190, KS14 224.0.0.9 RIPv2 Routers GSM11 224.0.0.10 IGRP Routers Dino Farinacci 224.0.0.11 Mobile-Agents Bill Simpson 224.0.0.12-224.0.0.255 Unassigned JBP Tabla 3.2: Direcciones Multicast Reservadas de Alcance Local La comunicación multicast puede implementarse en las siguientes formas:  Multicast de nivel de aplicación: Múltiples transmisiones de unicast, pero involucrando a los receptores en la replicación. La ventajas es que no requiere soporte multicast en los dispositivos de red intermedios, la desventaja es que se necesita una infraestructura de distribución en la capa de aplicación y se congestiona el segmento de red donde se hace la replicación. La Figura 3.6 muestra que el PC1 recibe el flujo, lo procesa y verifica la lista de distribución (todo esto en capa de aplicación), determinando que el PC2 y PC3 son miembros del grupo multicast, posteriormente se hacen copias de los paquetes y se envían con dirección unicast en el destino. Figura 3.6: Implementación de Multicast a Nivel de Aplicación  Multicast explícito: El emisor transmite un único paquete que se replica en los routers cuando es necesario. La ventaja es que los recursos de red se utilizan de manera óptima y la desventaja es que los dispositivos de la capa de red deben soportar la funcionalidad. La Figura 3.7 muestra que el router conoce que el PC1, PC2 y PC3 son miembros del grupo multicast, por lo que crea copias de los paquetes y los envía directamente. 27 Figura 3.7: Implementación de Multicast Explícito Los routers con capacidad de escuchar las direcciones multicast utilizan protocolos para gestionar la pertenencia a los grupos tal como IGMP definido en [5], por lo tanto deben tener información sobre la necesidad de replicación de paquetes para alcanzar a cualquier miembro del grupo de la red local. 3.5.1 Direcciones MAC Multicast Los dos bits menos significativos del primer byte en una dirección MAC tienen un significado especial. El primero se conoce como I/G (Individual Group), su valor en 0 denota que la dirección es tipo unicast y en caso contrario la dirección es multicast o broadcast. El segundo bit se emplea para indicar si una dirección es única (administrada globalmente por el IEEE) o local (asignada por software) véase la Figura 3.8. Figura 3.8: Formato de Direcciones MAC Multicast En la Tabla 3.3, se puede ver algunas direcciones MAC multicast comúnmente utilizadas. MAC Address References 01-00-0C-CC-CC-CC CDP (Cisco Discovery Protocol), VTP (VLAN Trunking Protocol) 01-00-0C-DD-DD-DD CGMP (Cisco Group Management Protocol) 01-00-5E-00-00-00 DoD Internet Multicast (RFC-1112) 01-80-C2-00-00-00 Spanning tree Protocol (for bridges) 01-80-C2-00-00-01 802.1 alternate Spanning multicast 03-00-00-20-00-00 IPv4 Multicast Address Token Ring (RFC1469) Tabla 3.3: Ejemplos de Direcciones MAC Multicast 28 3.5.2 Correspondencia de IPv4 y MAC en Multicast El IANA ha reservado un grupo de direcciones MAC IEEE-802 para los paquetes multicast sobre IPv4 según [5], con el rango de OUI (Organizationally Unique Identifier) 01-00-5E-00-00-00 al 01-00-5E-7F-FF-FF. Se asignó al IETF dicho rango para mapear las direcciones multicast de IPv4 con las direcciones multicast de MAC. Se disponen solamente de 23 bits para direcciones MAC ya que el bit más significativo del cuarto byte fue establecido en 0 como se indica en la Figura 3.9, con el fin de reservar el rango más alto de direcciones para investigaciones futuras. Una dirección IPv4 multicast se corresponde a una dirección MAC ubicando los 23 bits menos significativos de la dirección IPv4 en los 23 bits menos significativos de la dirección MAC. Los cinco bits ignorados equivalen a 32 direcciones IPv4 multicast posibles que pueden corresponderse con una misma dirección MAC. Esto no supone gran problema ya que la capa de red se encargará de filtrar el tráfico que en condiciones normales debió ser filtrado por la capa de enlace. Figura 3.9: Correspondencia Multicast entre IPv4 y MAC 3.5.3 Internet Group Management Protocol IGMP (Internet Group Management Protocol) ocupa al igual que ICMP (Internet Control Message Protocol) un mismo subnivel de comunicaciones como una parte integral de IPv4, véase la Figura 3.10. Figura 3.10: Encapsulamiento de IGMP El campo protocolo de la cabecera IPv4 utiliza el valor 0x02 para describir un mensaje IGMP. Estos mensajes se utilizan para que los computadores notifiquen a los routers cuáles son los grupos multicast en los que están interesados. Los routers mantienen una lista de los grupos multicast accedidos desde sus interfaces. Los mensajes IGMP Cabecera IP Datos Cabecera Ethernet Datos Cabecera IGMP Datos 29 sólo pueden intercambiarse entre equipos conectados en la red local por lo que el campo TTL (Time To Live) de la cabecera IPv4 siempre es igual a 1. Los computadores pueden usar IGMP para entrar o salir de los grupos en cualquier momento, no hay restricción en el número de computadores por grupo. Un computador puede ser miembro de uno o más grupos y no necesariamente un computador tiene que ser miembro de un grupo para enviar paquetes a éste. Todos los mensajes IGMP son enviados con la opción IP Router Alert en la cabecera IPv4 para indicar a los routers que deben examinar más cuidadosamente el paquete [14]. Cuando el TTL de un paquete multicast tiene un valor mayor que 1 el router local con soporte multicast tiene la responsabilidad de reenviar el flujo a todos los routers de las redes que tengan miembros del grupo, esto lo hace a través de protocolos de enrutamiento especiales para multicast. Actualmente el protocolo IGMP está definido en tres versiones: IGMPv1 definido en [5], IGMPv2 definido en [6] y la última versión IGMPv3 definida en [12]. 3.5.3.1 IGMPv1 IGMPv1 está implementado básicamente en el envío de mensajes Membership Querys y Membership Reports. Figura 3.11: Formato de Mensaje IGMPv1 El formato de mensaje IGMPv1 que se muestra en la Figura 3.11 tomada de [5] se describe a continuación:  Version: Se especifica el valor 1 para esta versión del protocolo IGMP, la versión 0 definida en [13] quedó obsoleta.  Type: Hay dos tipos de mensajes definidos.  Host Membership Query (valor 0x01): Es un mensaje de sondeo o consulta general de pertenencia a grupos enviado por el router a todos los computadores vecinos a la dirección destino 224.0.0.1 de forma periódica.  Host Membership Report (valor 0x02): Es un mensaje de informe de pertenencia a un grupo. Es enviado por un miembro de grupo cuando recibe un mensaje Host Membership Query para permanecer en un grupo o cuando desea unirse a un nuevo grupo. El destino es el router multicast y los computadores de la red local miembros de dicho grupo.  Unused: Campo sin uso.  Checksum: Suma de comprobación de todo el mensaje IGMP.  Group Address: En un mensaje Host Membership Query el campo Group Address es puesto en 0.0.0.0, y en un mensaje Host Membership Report el campo Group Address contiene la dirección IPv4 multicast que se informa. Cada computador miembro de un grupo que reciba un mensaje Host Membership Query inicia un temporizador con un tiempo aleatorio. Cuando el temporizador expira se envía un mensaje Host Membership Report con el grupo a informar. Un reporte es enviado 0 Version 3 4 7 8 15 16 31 Type Unused Checksum Group Address Class D 30 con una dirección IPv4 destino igual a la dirección de grupo que se informa, y con un TTL igual a 1. Cuando un computador escucha un informe de pertenencia de grupo al que pertenece, detiene su temporizador para ese grupo y no genera el mensaje Host Membership Report de respuesta, así pues sólo un informe de respuesta se genera para cada grupo en la red y corresponde al computador quien le venza primero el temporizador. En caso tal que el temporizador no haya vencido y se reciba un mensaje Host Membership Query, este no se restablece a un nuevo valor, sino que continúa corriendo desde su valor actual. Los routers que manejen grupos multicast sólo les interesa asegurarse que al menos un computador pertenece a un grupo dentro de su red, a fin de garantizar el flujo multicast, por lo que periódicamente envían mensajes Host Membership Query (no más de uno por minuto) para evitar sobrecargar la red. 3.5.3.2 IGMPv2 La principal diferencia de IGMP versión 2, es la inclusión de un nuevo mensaje para indicar el abandono de un grupo. Además se especifica que el router cuya dirección IPv4 sea menor es el encargado de generar los mensajes Host Membership Query, ya que en la versión anterior había quedado inconcluso este aspecto. Figura 3.12: Formato de Mensaje IGMPv2 El formato de mensaje que se presenta en la Figura 3.12 tomada de [6] se describe a continuación:  Type: Se definen 4 tipos de mensajes.  Membership Query (valor 0x11): Hace un sondeo general (General Query) cuando en la cabecera IPv4 se asigna 224.0.0.1 como dirección destino y en la dirección de grupo del mensaje IGMP se asigna 0.0.0.0, esto con el fin de mantener compatibilidad con la versión 1. También se incorpora una variante al recibir un informe de abandono de grupo Group Specific Query, consiste en asignar la dirección de grupo a la que pertenece el informe de abandono como dirección IPv4 destino y dirección de grupo del mensaje IGMP, esto se hace para verificar si aún existen miembros en el grupo, se envía en intervalos de 125 segundos.  Version 2 Membership Report (valor 0x16): Todo computador que quiera permanecer como miembro de uno o más grupos debe responder al mensaje de consulta con este mensaje de informe por cada grupo del que es miembro activo.  Leave Group (valor 0x17): Cuando un computador detecta que los procesos locales dejan de ser miembro de un grupo, envía un mensaje de abandono a dicho grupo a la dirección 224.0.0.2 que refiere a todos los routers de la red.  Version 1 Membership Report (valor 0x12): Únicamente para mantener compatibilidad con IGMPv1.  Max Response Time: Especifica el tiempo máximo permitido para el envío de una respuesta, 1 segundo para el Group Specific Query y 10 segundos para el General Query. 0 7 8 15 16 31 Type Max Resp Time Checksum Group Address Class D 31  Checksum: Suma de comprobación de todo el mensaje IGMP.  Group Address: En un mensaje Membership Query el campo Group Address es puesto en 0.0.0.0, y en un mensaje Membership Report el campo Group Address contiene la dirección IPv4 multicast que se informa. Cuando un computador recibe un mensaje Membership Report de la versión 1, debe suprimir el envío del Membership Report versión 2. Cuando un router recibe un mensaje Membership Report de la versión 1 debe ignorar todos los mensajes Leave Group que reciba y fijar un temporizador para ese grupo que debe ser igual al Group Membership Interval. El Group Membership Interval es la cantidad de tiempo que debe transcurrir para que un router decida que no hay más miembros en un grupo multicast Los routers con IGMPv1 envían mensajes Host Membership Query con ceros en el campo Unused, por lo que, los computadores que entienden IGMPv2 saben que se trata de un router IGMPv1 y deben interpretar el valor en 10 segundos como Max Response Time. Así también, un router IGMPv1 espera recibir mensajes Membership Reports versión 1 sin prestar atención a los mensajes Membership Reports de la versión 2. Existe una variable de estado en cada computador que debe ser mantenida para describir que router está funcionando con IGMPv1 o IGMPv2 y según sea el caso deberá suprimir el envío de mensajes Leave Group. 3.5.3.3 IGMPv3 La versión 3 de IGMP está definida en [12], es actualmente la última versión desarrollada. Se enfoca en proporcionar información útil a los protocolos de enrutamiento al conocer las fuentes del tráfico multicast en la que están interesados sus vecinos. Para mantener la compatibilidad con las anteriores versiones de IGMP, se conservan los mensajes cuyos valores son 0x12, 0x16 y 0x17. Los Membership Querys (valor 0x11) que llegan a una interfaz con dirección IPv4 destino multicast conocida y asignada a esa interfaz deben ser procesados. Se incorpora la variante Group and Source Specific Query en el mensaje Membership Query. Figura 3.13: Formato de Mensaje Membership Query con IGMPv3 El formato de mensaje de la Figura 3.13 tomada de [12] se describe a continuación:  Type: Tiene asignado el valor 0x11.  Max Resp Code: Especifica el máximo tiempo permitido para enviar un mensaje Membership Report de respuesta, es calculado dinámicamente. Las ráfagas de mensajes IGMP son inversamente proporcionales al valor del Max Resp Code, sin 0 Type = 0x11 3 4 7 8 15 16 31 Max Resp Code Checksum Group Address Class D 5 Resv S QRV QQIC Number of Sources (N) Source Address (1) Source Address (N) .. .. . 32 embargo, una respuesta más tardía de consultas a grupos específicos es desventajosa porque mantiene el tráfico multicast activo un mayor tiempo cuando el objetivo es suprimirlo.  Checksum: Es la suma de comprobación del mensaje IGMPv3.  Resv: Es un campo reservado y su valor siempre es cero.  S (Flag): Se establece en 1 para indicar a los demás routers que no deben actualizar su temporizador; se establece en 0 en caso contrario.  QRV (Querier’s Robustness Variable): Especifica un valor que se utiliza por el router para la pérdida de paquetes esperada. Cuanto más grande es este valor, mayor es la tolerancia a la pérdida de paquetes. Los routers adoptan el valor QRV desde la consulta más reciente recibida de otros routers, a menos que dicho valor exceda 7 cuyo caso se asigna el valor 2 al campo QRV.  QQIC (Querier’s Query Interval Code): Especifica un valor que ayuda a calcular el intervalo de tiempo en que los routers pueden enviar las consultas.  Number of Sources: Especifica cuantas fuentes se encuentran presentes en la consulta, su valor es 0 en mensajes General Query y Group Specific Query. Pueden especificarse hasta 366 fuentes para los mensajes Group and Source Specific Query. Estos mensajes son enviados desde los routers para conocer si las interfaces vecinas desean recibir un flujo multicast desde alguna dirección específica de una lista de fuentes.  Source Address: Direcciones fuentes IPv4 unicast. Figura 3.14: Formato de Mensaje Membership Report en IGMPv3 Los Membership Reports de IGMPv3 enviados por los computadores informan a los routers vecinos el estado actual de la recepción sobre un flujo multicast particular. En la Figura 3.14 se muestra el formato a seguir para el envío de este tipo de mensajes. En IGMPv3 los mensajes Membership Reports son enviados a la dirección IPv4 224.0.0.22 que corresponde a todos los routers con capacidad de escuchar mensajes IGMPv3. Un bloque Group Record tiene un tamaño mínimo de 8 bytes y contiene información del remitente sobre la pertenencia a un grupo multicast asociado a la interfaz de donde se envía el mensaje (ver Figura 3.15). 0 7 8 15 16 31 Type = 0x22 Reserved Checksum Number of Group Records (M)Reserved Group Record (1) Group Record (M) .. .. . 33 Figura 3.15: Formato Interno Group Record de un Membership Report El campo interno Record Type define seis diferentes maneras de enviar un Membership Report.  Current State Record: Es enviado por un computador en respuesta a un Membership Query. Se reporta el estado actual de escucha de la interfaz por cada dirección multicast. Puede adoptar los siguientes valores:  MODE_IS_INCLUDE (1): Indica que la interfaz tiene un filtro Include para la dirección multicast especificada.  MODE_IS_EXCLUDE (2): Indica que la interfaz tiene un filtro Exclude para la dirección multicast especificada.  Filter Mode Change Record: Es enviado por un computador si cambia el estado de un filtro en la interfaz para una dirección multicast en particular. Puede adoptar los siguientes valores:  CHANGE_TO_INCLUDE_MODE: Indica que la interfaz ha cambiado a modo INCLUDE el filtro de la dirección multicast especificada.  CHANGE_TO_EXCLUDE_MODE: Indica que la interfaz ha cambiado a modo EXCLUDE el filtro de la dirección multicast especificada.  Source List Change Record: Es enviado por un computador si ocurre un cambio en la lista de fuentes de una determinada dirección multicast pero no en el modo del filtro. El registro se incluirá en un informe enviado desde la interfaz en la que se produjo el cambio y puede tener uno de los dos valores siguientes:  ALLOW_NEW_SOURCES: Indica las fuentes que el sistema desea escuchar sobre una dirección multicast particular. Si el cambio se efectúa sobre un INCLUDE, entonces las direcciones serán agregadas a la lista. En caso que el cambio se efectúe sobre un Exclude las direcciones serán borradas de la lista.  BLOCK_OLD SOURCES: Indica las fuentes que el sistema no desea escuchar sobre una dirección multicast particular. Si el cambio se efectúa sobre un Exclude, entonces las direcciones serán agregadas a la lista. En caso que el cambio se efectúe sobre un Include las direcciones serán borradas de la lista. Los routers utilizan el protocolo IGMP sobre todas las interfaces que soporten multicast. La información reunida por IGMP se proporciona a cualquier protocolo de enrutamiento multicast a fin de garantizar que los paquetes lleguen a todas las redes donde haya receptores interesados. En IGMP v3 no existe un comando Leave Group, ya que esta función la desempeña el comando Membership Report 224.1.1.1 Include(). El comando Membership Report 224.1.1.1 Exclude() equivale a una unión indiscriminada a los grupos multicast. 0 7 8 15 16 31 Record Type Aux Data Len Number of Sources (N) Multicast Address Source Address (1) Auxiliary Data .. .. . Source Address (N) 34 3.5.3.4 Conmutación de Tráfico Multicast Usar switches para interconectar redes Ethernet tiene como principal ventaja el separar dominios de colisión a fin de aumentar la escalabilidad de las redes. Por el contrario, el tráfico multicast se reenvía por todos las interfaces de un switch afectando a la red local como si fuese un solo segmento de red. Debido a esto, el control del tráfico multicast en Ethernet cuenta con las siguientes implementaciones:  VLANs: Es un método que puede asociar a un grupo multicast por cada VLAN, sin embargo, no soporta cambios dinámicos.  CGMP (Cisco Group Management Protocol): Este protocolo trabaja muy similar al IGMP Snooping, y permite registrar hasta 64 grupos multicast. La asignación de la dirección multicast a una interfaz se hace con un mensaje que se envía desde el router hacia el switch como se muestra en la Figura 3.16. El switch mantiene una tabla de grupos multicast con la información que el router le envía (un mensaje CGMP por cada miembro que entre o salga de un grupo), esto aumenta el procesamiento del switch y agrega tráfico al enlace [16]. Figura 3.16: Gestión desde el Router con CGMP  IGMP Snooping: El switch tiene la capacidad de capturar y leer todo el tráfico IGMP que pasa a través de él. Existe una tabla de entradas en el switch donde se asocia la interfaz con el grupo multicast, además se establece un temporizador al igual que en los routers para que a su vencimiento se libere el recurso. Cuando el switch recibe múltiples Membership Reports de un mismo grupo, solamente deja pasar una solicitud al router y por cada usuario que se integre a un grupo ya existente, el switch sólo debe asociar el puerto y transmitirle el flujo multicast (ver Figura 3.17). Figura 3.17: Filtrado de Membership Reports con IGMP Snooping 3.5.4 Enrutamiento Multicast Cuando un computador quiere recibir una transmisión multicast, primero necesita encontrar la dirección de grupo. En el primer salto se usa el protocolo IGMP. El router 35 conoce en qué grupos multicast están interesados los computadores de su red. Pero en caso de que el router necesite hacer más saltos existen dos planteamientos, o que todos estén interesados en la emisión del flujo multicast o que no lo estén, por lo cual según sea el caso existen protocolos de enrutamiento multicast en modo denso y modo disperso. Es importante conocer que el enrutamiento multicast requiere crear una variable de estado de reenvío del flujo multicast que debe ser mantenida periódicamente ya que tiene un tiempo de expiración. El enrutamiento multicast está basado en la construcción de “árboles” que conectan los miembros de varios grupos multicast. Los árboles de distribución multicast especifican un camino único de envío entre el origen y el destino. Debido a que los miembros de un grupo multicast entran y salen dinámicamente, los árboles de distribución deben ser actualizables. Los dos tipos básicos de árboles de distribución multicast son:  Árboles de camino más corto o SPT (Shortest Path Tree): La raíz es el origen del tráfico multicast y las ramas las forman las rutas hasta cada uno de los receptores. Las rutas se construyen según el criterio de la ruta más corta y se identifican mediante la tupla (S, G), donde S es la dirección de la fuente, y G la del grupo multicast. Por lo tanto hay un árbol por cada fuente y grupo (Ver Figura 3.18). Figura 3.18: Árbol de Camino más Corto (SPT)  Árboles compartidos: Según el protocolo de enrutamiento implementado, se conocen como RPT (Rendezvous Point Tree) o CBT (Core Based Tree) y usan una sola raíz en común ubicada en algún punto de la red. Utilizan la notación (*, G), donde * se refiere a todos los orígenes, y G representa a un grupo multicast, ya que todos los orígenes tienen un mismo árbol compartido. Sin embargo, los routers saben que el flujo multicast no siempre debe atravesar la raíz del árbol, ya que estos conocen la ruta más corta hacia cualquier punto de la red, pudiendo conmutar a un SPT (S, G). Véase el ejemplo de la Figura 3.19. Figura 3.19: Árbol de Distribución Compartida 36 Los protocolos que utilizan el modo denso con árboles SPT son DVMRP (Distance Vector Multicast Routing Protocol), MOSPF (Multicast Open Shortest Path First) y PIM- DM. Los protocolos que utilizan el modo disperso son CBT y PIM-SM. En multicast existe también una tabla que se conoce como MFIB (Multicast Forwarding Information Base) almacenada en los routers. Mantiene variables de estado y distintas entradas (S, G), cada una tiene la información de reenvío necesaria para la entrega de paquetes multicast que entran por una interfaz. En conclusión, existen tres tipos de tablas en multicast:  Las tablas propias de cada protocolo de enrutamiento (MRIB).  Una tabla de enrutamiento general formada con la información de los diferentes protocolos de enrutamiento.  Las tablas MFIB directamente usadas para controlar el reenvío de un flujo multicast. Si un router soporta múltiples protocolos de enrutamiento multicast, su tabla MRIB (Multicast Routing Information Base) incluirá rutas generadas por cada uno de los protocolos, entonces el router deberá escoger la ruta óptima basándose en las políticas de reenvío y la configuración de enrutamiento multicast establecida. Luego la ruta se asigna como entrada en la tabla MFIB. PIM se basa en un protocolo de recolección de topología subyacente para rellenar la MRIB con rutas. Las rutas de esta tabla se pueden tomar directamente de la tabla de enrutamiento unicast, o pueden ser diferentes y proporcionados por un protocolo de enrutamiento por separado como MBGP (Multicast Border Gateway Protocol). Independientemente de la forma en que se crea, el papel principal de la MRIB en el protocolo PIM es proporcionar al router del siguiente salto en una trayectoria compatible con multidifusión para cada subred de destino. La MRIB es utilizada para determinar el siguiente salto a donde enviar un mensaje Join/Prune. Los datos fluyen a lo largo del camino de retorno de los mensajes Join. Por lo tanto, en contraste con RIB, que especifica el siguiente salto que un paquete de datos necesita para llegar a alguien de una subred, la MRIB da información del camino inverso e indica como un paquete de datos multicast puede ir de su origen al router de la subred que tiene la MRIB. 3.5.4.1 PIM-DM El protocolo de enrutamiento PIM-DM (Protocol Independent Multicast Dense Mode) puede trabajar con cualquier protocolo de enrutamiento unicast y está diseñado para ser eficiente con grupos densos. Este protocolo asume que cuando una fuente inicia el envío de algún streaming, todos los computadores quieren recibir ese flujo, por lo que se distribuye en todas las redes conectadas con soporte PIM. Si alguna red no tiene miembros de grupo interesados, el router debe enviar un mensaje Prune por la rama del árbol, a fin de que los routers de la rama actualicen la variable de estado referente al dispositivo. Cada cierto tiempo el proceso de inundación se repite para mantener actualizado los cambios de fuente, cambios de miembros de grupos o cambios en dispositivos intermedios, generando mucho tráfico en las redes involucradas. Para el enrutamiento multicast es importante conocer si el camino por el que llega el flujo de datos es el correcto, para esto se usa el mecanismo RPF Check (Reverse Path Forwarding Check) que verifica en la MRIB si la interfaz de entrada del paquete 37 multicast es la misma que se usaría para llegar al origen de manera óptima bajo unicast, actualizando así la MRIB. Cuando un paquete multicast es recibido de una fuente S para un destino G, el router primero busca en su tabla MFIB y hace lo siguiente:  Si la entrada (S, G) existe y la interfaz sobre la cual el paquete llega se refiere a la interfaz de entrada de la tabla, el router reenvía el paquete.  Si la entrada (S, G) existe pero la interfaz por la cual llega el paquete no corresponde con la interfaz de entrada en la tabla, se aplica un RPF Check. En caso de éxito se reenvía el paquete y se actualiza la entrada en la tabla MFIB. En caso de fallo el paquete se descarta.  Si la entrada (S, G) no existe, se aplica un RPF Check. Si el RPF Check es exitoso, el router crea una entrada para (S, G) en la tabla MFIB y el paquete se reenvía. De otro modo el paquete es descartado (ver Figura 3.20 tomada de [20]). Figura 3.20: Éxito y Fallo de RPF Check Una desventaja de PIM-DM es que cada router debe almacenar un árbol SPT, lo que compromete los recursos de los dispositivos intermedios, más aún si el número de miembros de un grupo es pequeño o cuando los grupos están distribuidos de forma dispersa. Figura 3.21: Cabecera de Mensajes de Control PIM Todos los mensajes de control PIM tienen la cabecera de la Figura 3.21 tomada de [18] que se referencian a continuación:  Version: En el caso de PIM el valor es 2.  Type: Describe tipos específicos de mensajes PIM y sus valores pueden ser:  0 = Hello.  1 = Register (Solamente para PIM-SM).  2 = Register Stop (Solamente para PIM-SM).  3 = Join/Prune (Join es solamente para PIM-SM).  4 = Bootstrap (Solamente para PIM-SM).  5 = Assert.  6 = Graft.  7 = Graft Ack.  8 = Candidate RP Advertisement (Solamente para PIM-SM).  9 = State Refresh. 0 Version 3 4 7 8 15 16 31 Type Reserved Checksum 38 PIM-DM utiliza mensajes Hello para detectar los routers de la red con soporte PIM. Estos mensajes se envían con multicast periódicamente por las interfaces y cuando son recibidos los routers deben registrar la interfaz junto con la información obtenida en el campo de Option Type. Los mensajes PIM Hello tienen el formato de la Figura 3.22. Figura 3.22: Formato de Mensaje PIM Hello El campo Option Type puede tener los siguientes valores:  0 = Reservado.  1 = Hello Hold Time. Se refiere al tiempo que debe mantenerse el registro del vecino alcanzable.  2 = LAN Prune Delay. Se utiliza para ajustar el retardo de propagación del mensaje Prune.  3-16 = Reservado.  17 = Para ser asignado por la IANA.  18 = Obsoleto y no debe ser usado.  19 = DR Priority (Solamente PIM-SM).  20 = Generation ID. Es un valor aleatorio para la interfaz por la que se envía el mensaje Hello.  21 = State Refresh Capable. Intervalo de actualización del router expresado en segundos.  22 = Bidir Capable.  23-65000 = Para ser asignado por la IANA.  65001-65535 = Reservado para uso privado. Los mensajes Prune generan sobre la interfaz del router un estado Pruned con un temporizador que al vencer deshace dicho estado. Estos mensajes intentan regresar al origen del árbol de distribución viajando de un router a otro, sin embargo, la propagación se detiene en el caso que un router tenga otros miembros del mismo grupo en cuestión. Por esto nace la necesidad de almacenar un estado con la dirección IPv4 y la interfaz asociada al emisor del mensaje Prune. Si una vez podada una rama del árbol aparece un nuevo miembro del grupo en dicha rama, se utiliza el mensaje Graft para volver a incorporarla al árbol de distribución. Los mensajes Graft no pueden utilizarse para incorporar en la emisión multicast a nuevos routers que se inicien en la red ya inundada (por ejemplo routers que se han encendido después de iniciar la emisión). Para dar oportunidad de participar a estos routers, el mecanismo de inundación se repite en PIM-DM cada 3 minutos. Este mecanismo podría hacer innecesario el Graft, sin embargo su utilización permite reducir la latencia en la incorporación de nuevos miembros al grupo. 0 Version 3 4 7 8 15 16 31 Type Reserved Checksum Option Value Option Type Option Lenght .. .. Option Type Option Lenght Option Value 39 Existen casos en que los routers que se encuentran en un mismo enlace son transmisores del mismo flujo multicast desde la fuente, así pues se incurre en el envío de paquetes duplicados dentro del segmento de red. Los mensajes Assert se envían entre los routers de un mismo segmento a fin de negociar quien será escogido como router reenviador del flujo multicast. Se definen tres reglas para la escogencia del reenviador:  El router que genere un Assert con la distancia administrativa más baja es elegido como ganador.  Si la distancia administrativa es la misma, entonces se compara la métrica de enrutamiento (obtenida de la MRIB). El que tenga menor valor en la métrica resulta ganador.  Si la métrica de enrutamiento resulta ser igual, el dispositivo con la dirección IPv4 más alta será elegido como el ganador. El mensaje State Refresh se repite cada 60 segundos para refrescar los árboles de distribución del flujo multicast. 3.5.4.2 PIM-SM El protocolo de enrutamiento PIM-SM (Protocol Independent Multicast Sparse Mode) está orientado a redes que tienen una gran presencia de miembros de grupo esparcidos. Se basa en árboles compartidos, centralizados en un punto de encuentro por grupo y distribuyendo el flujo de esta manera hacia los receptores, que además, según sea el caso pueden conmutarse y crear árboles del camino más corto hacia la fuente. Los puntos de encuentro se conocen como Rendezvous Point (RPs), específicamente es un router que tiene que ser configurado para ser usado como la raíz de un árbol de distribución para un grupo multicast, es un punto en común que tienen todos los equipos de la red. Cada grupo multicast usa este árbol que permite comunicarse con el RP y los receptores del flujo. PIM-SM puede establecer cuál es el umbral de tráfico multicast a partir del cual los routers puedan conmutar de RPT a SPT. En un dominio PIM-SM, también existe un DR (Designated Router) y un BRS (Bootstrap Router), estos participan durante el mantenimiento y la creación del árbol RPT respectivamente. El BSR seleccionado mantiene informados a todos los routers del dominio sobre el actual RP para cada grupo multicast y el DR se comunica con el RP para indicarle los estados de las fuentes de datos y los receptores. El BSR permite descubrir al RP mediante el siguiente procedimiento:  Los candidatos a RP se hacen conocer mediante los mensajes Candidate RP Advertisement o conocido también como RP Discovery, informando su dirección IPv4 y los grupos donde puede prestar servicio, este mensaje se envía a la dirección 224.0.1.40.  Se distribuye la información de todos los routers candidatos a todos los routers PIM- SM a la dirección 224.0.1.39 (RP Announce). El BSR será el router con más alta prioridad configurada, pero si existen múltiples candidatos con prioridad alta se escogerá el que tenga la dirección IPv4 más alta [21]. 40 En una red local donde uno o más routers están trabajando con PIM-SM, los emisores deben registrarse para poder emitir datos y los receptores también para poder recibir el flujo multicast de un grupo, para eso utilizan los mensajes Join/Prune (ver Figura 3.23) que también funcionan para abandonar un grupo y podar el árbol compartido. La dirección de destino de esos mensajes no es el RP o la fuente, sino la dirección multicast 224.0.0.13 propia de PIM, por tanto sólo se mandan al siguiente router. El siguiente router, en función del mensaje recibido y su información de estado multicast, decide si debe o no, propagar el Join o Prune al siguiente router hacia la fuente. Figura 3.23: Formato de Mensaje Join/Prune A continuación se describen los campos más relevantes del mensaje Join/Prune:  Upstream Neighbor Address: Es la dirección IPv4 a la que se refiere el vecino del camino inverso (RPF). Este es el router que envió previamente el mensaje Join/Prune.  Num Groups: Se refiere al número de grupos multicast contenidos en el mensaje.  Holdtime: La cantidad de tiempo que un receptor debe mantener el mensaje en su poder. Si el valor es 0xFFFF, el receptor debe mantener el estado hasta que sea cancelado por una política local.  Multicast Group Address: Tiene la dirección multicast del grupo codificada.  Number of Joined Sources: Número de fuentes a incluir para el grupo especificado en el campo Multicast Group Address.  Number of Pruned Sources: Número de fuentes a excluir para el grupo especificado en el campo Multicast Group Address.  Joined Source Address: Es la dirección multicast fuente de la que se desea recibir el flujo multicast. 0 Version 3 4 7 8 15 16 31 Type Reserved Checksum Num GroupsReserved Upstream Neighbor Address (Encoded-Unicast format) Holdtime .. .. Number of Joined Sources Number of Pruned Sources Joined Source Address 1 (Encoded-Source format) Multicast Group Address 1 (Encoded-Group format) .. .. Joined Source Address r (Encoded-Source format) Pruned Source Address 1 (Encoded-Source format) Pruned Source Address s (Encoded-Source format) .. .. Number of Joined Sources Number of Pruned Sources Joined Source Address 1 (Encoded-Source format) .. .. Joined Source Address t (Encoded-Source format) Pruned Source Address 1 (Encoded-Source format) Pruned Source Address u (Encoded-Source format) Multicast Group Address n (Encoded-Group format) 41  Pruned Source Address: Es la dirección multicast fuente de la que se desea dejar de recibir el flujo multicast. Cuando un receptor desea unirse o abandonar un grupo multicast lo notifica al DR mediante IGMP. Así también si una fuente desea emitir un flujo debe notificarle al DR, que se encarga de enviar dichas peticiones encapsuladas al RP mediante unicast. El mensaje encapsulado enviado por el DR se conoce como Register y debe ser interpretado por el RP (ver Figura 3.24). Figura 3.24: Formato de Mensaje PIM Register Todo mensaje recibido por el DR debe encapsularse. El RP debe iniciar un mensaje Source Specific Join hacia la fuente S, creando así un árbol (S, G) en los routers a lo largo del recorrido. El RP estará recibiendo constantemente los paquetes encapsulados del DR, pero cuando comience a llegar el flujo de forma nativa entonces el RP estará recibiendo paquetes duplicados, teniendo que descartar los paquetes encapsulados y enviando un Register Stop (Figura 3.25) al DR para detener el envío de paquetes encapsulados [22]. El DR es elegido por ser el router con la dirección IPv4 más alta dentro de la subred. Figura 3.25: Formato de Mensaje PIM Register Stop Cabe mencionar el campo Group Address que representa la dirección de grupo registrada en el DR y el campo Source Address que representa la dirección IPv4 unicast de la fuente del grupo registrada. Existen dos variantes que nacen de PIM-SM, que son:  Source Specific Multicast (SSM): Sólo es soportado por modelos uno a muchos. PIM-SSM construye SPTs originados en la raíz del tráfico multicast. Los routers cercanos a receptores interesados son informados de la dirección IPv4 unicast del origen del tráfico multicast; por este motivo PIM-SSM no necesita RP.  Bidireccional (Bidir): La diferencia radica en el mecanismo usado para enviar los datos desde el origen al RP [4]. En PIM-SM, los datos son enviados usando algún tipo de encapsulado o árbol basado en el origen, en PIM-Bidir los datos fluyen al RP por medio del árbol compartido, el cual es un flujo de datos bidireccional a lo largo de las ramas. 3.6 Calidad de Servicio en IPv4 Se puede definir el término QoS (Quality of Service) como la cualidad de gestionar eficientemente el repertorio de recursos, que permiten la efectiva y adecuada 0 Version 3 4 7 8 15 16 31 Type Reserved Checksum B Reserved2 Multicast data packet N 1 2 0 Version 3 4 7 8 15 16 31 Type Reserved Checksum Group Address (Encoded-Group format) Source Address (Encoded-Unicast format) 42 comunicación; usando la red, como herramienta de transmisión de distintos medios, con el fin de garantizar el rendimiento de las aplicaciones a través de ella. Conceptos claves en QoS son: ancho de banda, jitter, latencia y pérdida de paquetes. El ancho de banda es la diferencia entre la frecuencia componente mayor y la menor, en un espectro de señal electromagnética. La latencia es el tiempo que tarda un computador en procesar la información, reensamblarla en un paquete, pasarla por las colas de gestión y colocarla en el medio. El jitter es la variación en el tiempo de llegada de un paquete con respecto a uno previo. Finalmente, la pérdida de paquetes es un suceso que ocurre generalmente cuando existen problemas de congestión en la red. Dado que la información circulante en Internet mayormente son datos, voz y videos, surgen requerimientos diferentes para cada uno, ya que poseen características diferentes, esto a fin de garantizar la calidad del servicio. Los paquetes de voz deben ser entregados en un mínimo de tiempo, de forma ordenada, tolerando pequeñas pérdidas durante la transmisión; por ello, es necesario que la red les otorgue la más alta prioridad de envío y sin retrasos, apoyados por la capa de transporte. En un video, los datos no admiten pérdidas de los paquetes, más sí retrasos; la red debe entregarlos de forma correcta y la aplicación debe poder retransmitir si es necesario además de proveer buffers para minimizar los retrasos excesivos. Si el video es en tiempo real, no pueden ocurrir pérdida ni retrasos de los paquetes. Los juegos de computadores son hoy en día un ejemplo completo en donde se mezclan, datos, voz y videos; por lo que toleran una mínima pérdida de paquetes y tienen una alta prioridad en la red para disminuir la latencia. Actualmente se puede dar prioridad a los paquetes de una red para ofrecer QoS [23]. IEEE 802.1p es la prueba inicial que mediante la inserción de una cabecera adicional, se puede establecer la prioridad de la trama. Esta técnica consta de tres bits que permiten ocho niveles de prioridad. Funciona en conjunto con el estándar IEEE 802.1Q. ToS (Type of Service) es la primera idea de calidad de servicio implementada en el formato de mensaje IPv4, añadiendo un campo de prioridad que es factible sólo en redes simples. Dada su aplicación, se sustituyó por el modelo DiffServ. Los servicios integrados (Integrated Services o IntServ) y diferenciados (Differentiated Services o DiffServ) permiten el soporte de aplicaciones multimedia en tiempo real. La diferencia está en que IntServ asigna un camino para cada aplicación, muy parecido a ATM, para ello, emplea el protocolo RSVP (Resource Reservation Protocol), [33] el cual sustenta cada camino dinámicamente escogiendo routers con carga muy suave para enviar el tráfico. DiffServ etiqueta los flujos y aplica una política sobre un grupo de datos, luego se marca el campo DSCP (Differentiated Services Code Point) con el código apropiado. Así cuando el paquete pasa por una red DiffServ, el DSCP indica el comportamiento de reenvío posible sobre el paquete, y si tiene muy poca prioridad puede llegar a ser descartado. Se comprende, de forma inherente, que gracias a la calidad de servicio, es posible brindar un servicio óptimo, respetando las expectativas de los clientes, fraccionando en distintos niveles de rendimiento la red, cuyo acceso tendrá un costo específico y controlado. 43 3.6.1 Real-Time Transport Protocol RTP (Real-Time Transport Protocol) surgió con la idea de crear un protocolo específico para la gran demanda de recursos en tiempo real por parte de los usuarios de Internet. Trabaja conjuntamente con el protocolo RTCP (Real-Time Transport Control Protocol), cuya función principal es proporcionar mecanismos de realimentación para informar sobre la calidad en la distribución de los datos. El protocolo RTP se establece en el espacio de usuario y se ejecuta, por lo general, sobre UDP, por tener menor retardo que TCP. RTP no garantiza la entrega de paquetes, ni la llegada de estos en el instante adecuado (heredado de UDP/IP). La función básica de RTP es multiplexar varios flujos de datos en tiempo real en un solo flujo de paquetes, pudiéndose enviar tanto en unicast como multicast. Los paquetes son numerados de la siguiente manera:  Se asigna a cada paquete un número mayor que su antecesor, esto será útil para que la aplicación conozca si ha fallado algún paquete o no en la transmisión.  Si ha fallado, al no tener un control de flujo, de errores, de confirmaciones de recepción, ni de solicitud de retransmisión, la mejor opción es la interpolación de los datos (rellenar con datos desconocidos entre dos o más valores conocidos). El timestamping es una característica muy importante para las aplicaciones de contenido multimedia en tiempo real. La idea es permitir que el origen asocie una marca de tiempo con la primera muestra de cada paquete. Las marcas de tiempo son relativas al inicio del flujo, por tanto, solo importa las diferencias entre dichas marcas de tiempo. Figura 3.26: Formato de Cabecera RTP El formato de cabecera RTP consta de 12 bytes variables, siempre y cuando no exista un identificador CSRC. En la Figura 3.26 se describen cada uno de los campos mostrados:  Version (V): El campo identifica la versión de RTP. Por defecto su valor es 2.  Padding (P): Indica si el paquete se ha rellenado a un múltiplo de 4 bytes. El último byte de relleno indica cuántos bytes deben ser ignorados (incluyéndose a sí mismo).  Extension (X): En caso de tener valor 1, indica que una cabecera de extensión con longitud variable debe ser añadida. Luego es que puede añadirse los identificadores CSRC.  CSRC Count (CC): Indica cuantos identificadores CSRC están presentes, pueden ser de 0 a 15, es decir, el número de fuentes contributivas ligadas al paquete.  Marker (M): Es un marcador específico de la aplicación, normalmente un marcador de inicio.  Payload Type (PT): Indica cuál es el algoritmo de codificación que se ha utilizado para que pueda ser interpretado por la aplicación (audio o video). 0 V=2 3 4 7 8 15 16 31 CC PT sequence numberP timestamp synchronization source (SSRC) identifier M 1 2 X 9 contributing source (CSRC) identifiers . . . . 44  Sequence number: Contador que se incrementa en cada paquete RTP enviado, aunque su valor inicial es aleatorio.  Timestamp: Indica cuándo se creó la primera muestra en el paquete. Un protocolo como RTP utiliza marcas temporales en los paquetes emitidos. Estas informaciones son la base de los cálculos que permiten evaluar el retardo y la fluctuación en un sistema de comunicación.  SSRC: Identifica la fuente que ha producido el paquete. Al principio de una sesión, cada participante escoge un número de SSRC. En este caso se habla de sincronización ya que la escala de tiempo establecida por la fuente va a servir de referencia a los receptores para restituir la información correctamente.  CSRC: Se utilizan cuando los mixers están presentes en el estudio. Un mixer es un receptor de un flujo desde distintas fuentes. En ese caso, el mixer es el origen de sincronización, y los SSRCs que han aportado su contribución se añaden en este campo (pueden existir de 0 a 15 entradas). RTP transporta las señales de audio o video codificadas. Los paquetes contienen una cabecera seguida de estas señales que permiten al destino conocer la codificación utilizada (campo PT) y así poder decodificar correctamente. Los números de tipo de contenido están especificados en [25]. A fin de proporcionar un mecanismo de control para el protocolo RTP, se creó RTCP. Este último se basa en la periódica transmisión de paquetes de control a todos los participantes de una sesión, ofreciéndole información sobre la calidad de los datos distribuidos por la fuente. El protocolo de la capa inferior debe proveer de la multiplexación de los datos de control, por ejemplo, utilizando números de puerto UDP separados. RTCP realiza cuatro funciones (tomado de [24]): 1. La función primaria es proveer una realimentación sobre la calidad en la distribución de los datos. Para multicast es de vital importancia diagnosticar las fallas. El envío de informes de realimentación de todos los participantes permite evaluar si el ámbito de una falla en la transmisión es global o local. 2. RTCP lleva un identificador persistente conocido como CNAME. Dado que el identificador SSRC puede cambiar si se descubre un conflicto o un programa es reiniciado, receptores requieren el CNAME para realizar un seguimiento de cada participante. Los receptores también pueden requerir el CNAME para asociar múltiples flujos de datos de un participante dado en una serie de sesiones RTP relacionadas, por ejemplo, para sincronizar audio y video. La sincronización entre la fuente y los destinos requieren que el NTP (Network Time Protocol) y las marcas de tiempo (timestamps RTP) se incluyan en los paquetes RTCP. 3. Las dos primeras funciones necesitan que todos los participantes envíen paquetes RTCP, por lo tanto, la tasa de envío de paquetes debe ser controlada a fin de que RTP pueda escalar a un gran número de participantes sin inconvenientes. Cada receptor de estos paquetes conoce el número de participantes existentes. Este número se utiliza para calcular la velocidad a la que se envían los datos RTP y los intervalos de transmisión entre paquetes RTCP por cada participante. 4. Una cuarta funcionalidad se basa en establecer sesiones para identificar a los participantes, es útil cuando estos entran y salen de una sesión sin un control de afiliación o un parámetro de negociación. 45 Es importante destacar que para el enrutamiento PIM-SSM, no es posible aún adaptar RTCP, ya que este último necesita reenviar los paquetes a todos los receptores vecinos a fin de realimentarse y controlar bien la tasa de flujo de los datos, pero en el protocolo SSM sólo existe una fuente y varios receptores. Se definen varios tipos de paquetes RTCP para poder llevar la información de control a los participantes:  SR (Sender Report): Conjunto de estadísticas de transmisión y recepción que provienen de participantes que son emisores activos.  RR (Receiver Report): Conjunto de estadísticas que provienen de participantes que son sólo receptores.  SDES: Están compuestos de varios elementos descriptivos de la fuente, incluido el CNAME.  BYE: Termina la sesión.  APP: Funciones específicas de una determinada aplicación. Cuando una sesión RTP es abierta, al mismo tiempo se abre una sesión RTCP implícita. RTP y RTCP son protocolos que se sitúan a nivel de aplicación, pueden utilizar transmisión unicast o multicast. RTP utiliza un número de puerto par, y RTCP el número de puerto impar que sigue a continuación. Los números de puerto utilizados por RTP y RTCP están comprendidos entre 1025 y 65535, sin embargo, por defecto son 5004 y 5005 respectivamente. 3.6.2 Real Time Streaming Protocol Se conoce como RTSP (Real Time Streaming Protocol) al protocolo de flujo de datos en tiempo real no orientado a conexión que se utiliza para definir el envío de información entre un servidor y un cliente. Durante una sesión, un cliente puede abrir y cerrar conexiones fiables de transporte con el servidor mediante peticiones RTSP. Este protocolo trabaja a nivel de aplicación y controla que la entrega de datos se realice correctamente, pues el tipo de contenido con el que se trabaja normalmente al hacer streaming es muy sensible a la sincronía temporal (o a la falta de ella). Así pues se podría considerar que RTSP actúa como un control remoto en la red para servidores multimedia. RTSP define diferentes tipos de conexión y diferentes conjuntos de requisitos para intentar conseguir siempre un envío lo más eficiente posible a través de redes IPv4. Controla uno o más flujos de datos sincronizados (audio y video). A tal fin se definió el uso de sesiones, mediante un identificador único del protocolo. Además, RTSP es independiente del protocolo de transporte y puede funcionar con UDP o TCP. Los flujos controlados por RTSP pueden usar RTP como hemos visto, pero el modo de operación de RTSP es independiente del mecanismo de transporte usado para transmitir el continuo flujo de datos. Sin embargo, en la mayoría de casos se utiliza TCP para el control del reproductor y UDP para la transmisión de datos con RTP. RTSP es intencionalmente similar en la sintaxis y en su operación al HTTP, aunque difiere en muchos aspectos según [26], tales como:  RTSP introduce nuevos métodos y tienen un identificador de protocolo diferente. 46  Los servidores RTSP necesitan mantener estados por defecto en casi todos los casos (contrario al estado natural de HTTP).  Tanto el servidor como los clientes pueden emitir solicitudes RTSP.  Las solicitudes de URI (Uniform Resource Identifier) contienen la ruta absoluta del recurso. HTTP lleva sólo la ruta absoluta en la solicitud y devuelve el nombre de host en un campo de la cabecera separada. Entre las operaciones soportadas por RTSP está el proporcionar contenidos multimedia desde un servidor dedicado: El cliente puede pedir una descripción de la presentación vía HTTP o cualquier otro método. Si la presentación está hecha con multicast, la descripción de la presentación contiene la dirección de grupo multicast y los puertos que se deben usar para la recepción del flujo. Si por el contrario la presentación es enviada con unicast, el cliente proporcionará el destino por razones de seguridad. Un ejemplo de URL en RTSP es: rtsp://media.ejemplo.com:554/demo/audio y se expresa detalladamente en la Tabla 3.4: Sección URL Descripción rtsp:// Es el identificador para el esquema TCP, en caso de ser rtspu:// indica UDP. media.ejemplo.com Nombre de Dominio FQDN (Fully Qualified Domain Name) 554 Es el puerto empleado en la comunicación. Demo Refiere al nombre de la presentación Audio Refiere al nombre del flujo de la presentación Tabla 3.4: URL para RTSP Es posible también que un servidor de streaming pueda ser invitado a unirse a una conferencia ya existente, para reproducirla en una presentación. Este modo es muy útil para la distribución de aplicaciones educacionales. Adicionalmente, puede añadirse contenido multimedia a una presentación existente. Es muy útil para presentaciones en vivo que el servidor pueda avisar al cliente sobre los nuevos contenidos adicionales disponibles. Existen métodos definidos para que los clientes y servidores de streaming puedan comunicarse con RTSP. Los métodos son sensibles a mayúsculas y minúsculas. A continuación se explican los métodos establecidos por [26]:  SETUP: El cliente inicia una solicitud especificando todos los parámetros de transporte tales como el protocolo a utilizar para la transmisión de los datos, y el método de transmisión (multicast o unicast), así como el puerto del cliente. Un cliente también puede usar este método sobre un flujo que está siendo transmitido por el servidor. El servidor puede permitir o no la reserva de los recursos. El servidor asigna los recursos, los puertos y establece la sesión.  PLAY: Indica al servidor cuando debe comenzar el envío de datos, con los parámetros especificados en SETUP. El cliente nunca deberá enviar una petición PLAY sin antes haber recibido una confirmación SETUP. El rango NPT (Normal Play Time) indica la posición absoluta del flujo con respecto al inicio.  PAUSE: Detiene temporalmente el flujo de datos y coloca un Pause Point para saber dónde continuar si el flujo es reanudado.  TEARDOWN: Petición para detener completamente el flujo de datos y liberar los recursos asociados. 47  OPTIONS: Esta petición puede ser enviada en cualquier momento y no influye en el estado de la sesión. Es utilizada en el inicio para establecer la sesión con los parámetros necesarios, la versión y los métodos soportados por el servidor.  DESCRIBE: Obtiene una descripción del objeto requerido por la solicitud de un URL a un servidor. Éste puede usar la cabecera Accept para especificar los formatos que el cliente entiende. El servidor responde con una descripción del recurso solicitado.  GET_PARAMETER: Como su propio nombre indica, sirve para recuperar el valor de algún parámetro de la presentación en curso. El servidor responde con la información solicitada por el cliente.  SET_PARAMETER: Sirve para establecer el valor de un parámetro de la presentación en curso. El servidor asigna el valor al parámetro si existe. 3.7 Televisión sobre IP Desde sus inicios la televisión es el mayor entretenimiento de millones de personas y se ha ido mejorando constantemente para satisfacción de los televidentes. El broadcast en televisión se forma por corrientes de video que se distribuyen a todos los usuarios que tengan un receptor, esta metodología de transmisión sigue siendo utilizada por las televisoras locales de Venezuela. Inicialmente, los consumidores reciben las señales de televisión provenientes de las antenas de difusión ubicadas en sitios muy altos. Estas señales son recibidas por antenas y llevadas a los receptores de televisión. Así también, se ha vuelto popular la televisión por cable que sustituye el uso de antenas por un cable coaxial, pero los consumidores siguen recibiendo servicios de difusión broadcast. Hasta ahora fue que las compañías de cable implementaron decodificadores que permiten interpretar la señal de televisión que viene digitalizada. Actualmente, entró en escena la televisión satelital en Venezuela, que aún se encuentra en fase de prueba por CANTV (Compañía Anónima Nacional de Teléfonos de Venezuela). En este caso los consumidores reciben un paquete limitado de canales de televisión, ofrecido por el satélite venezolano Simón Bolívar (VENESAT-1). Las transmisiones en vivo pueden aprovechar la eficiencia de multicast ya que cada usuario recibe exactamente la misma información al mismo tiempo. Si un nuevo receptor se une tardíamente a la transmisión en vivo, el nuevo usuario sólo puede ver el contenido a partir del momento en que se une. 3.7.1 Televisión Analógica Todos los sistemas de televisión se basan en los mismos principios de producción, la diferencia radica en cómo se transmiten los datos al usuario final. El primer sistema de televisión fue analógico, está en uso desde hace 50 años. En un sistema analógico la información se transmite mediante alguna variación infinita de un parámetro continuo como puede ser la tensión en un hilo o la intensidad de flujo de una cinta. Dentro del ancho de banda permisible, cualquier forma de onda es válida. No es posible detectar y corregir un error de base de tiempo en un sistema analógico, por lo que un error de tensión tan sólo hace variar un valor de la señal que es transmitida como válida. En una señal analógica se puede sospechar que existe ruido, pero no se puede diferenciar en tiempo real entre la señal original y qué proporción de la señal recibida corresponde al ruido, esto implica que un sistema análogo es incapaz de detectar distorsiones en tiempo real. 48 Cuando una señal de video compuesto se transmite sobre las ondas de aire por una estación de televisión, lo hace a una frecuencia específica. En esta propagación de ondas se envían las imágenes en movimiento junto al sonido. Las frecuencias televisivas más comunes son VHF (Very High Frecuency) y UHF (Ultra High Frecuency). Los sistemas receptores de televisión utilizan la técnica de barrido de imagen, tanto horizontal como vertical. El barrido horizontal es una agrupación de puntos que se proyectan a lo largo de la pantalla de izquierda a derecha para formar una línea. El barrido vertical es el encargado de formar una imagen, para ello utiliza las líneas horizontales ya creadas y las barre de arriba hacia abajo. La frecuencia con la que se proyectan estas líneas en la pantalla crea sensación de continuidad y conforman la imagen que se ve en el sistema receptor de la señal. A partir de esto, se argumenta que la resolución de la imagen se define por el número de líneas horizontales y por el número de elementos en cada línea. Debido al desarrollo acelerado de la televisión analógica se establecieron estándares, entre los cuales se encuentran:  NTSC (National Television System Committee): Representa la ampliación del tradicional sistema monocromático que codifica y transmite televisión a color en modo entrelazado. Utiliza 484 líneas para resolución vertical y 400 líneas para resolución horizontal, con una velocidad de 30 frames por segundo, mostrando una resolución de imagen de 720x480 pixels. Es utilizado en América y Japón.  PAL (Phase Alternation Line): Para transmitir la información a color de una señal de video se necesita invertir la fase en cada línea. Es utilizado en África, Asia, Europa y Australia. Presenta mejor calidad que NTSC con una resolución de 720x756 pixels. Define la señal de luminancia como rojo, verde y azul, (R, G, B) y la señal de crominancia como azul, rojo y amarillo (B, R, Y) respectivamente.  SECAM (Séquentiel Couleur Avec Mémoire): Basa su codificación del color en modular la frecuencia (FM). Tiene la misma resolución que PAL (720x756 pixels), utiliza una señal de luminancia y dos de crominancia. Parámetro NTSC PAL SECAM Frames/Segundo 29.97 25 25 Líneas/Campo 525/60 625/50 625/50 Frecuencia Horizontal 15.734 kHz 15.625 kHz 15.625 kHz Frecuencia Vertical 60 Hz 50 Hz 50 Hz Ancho de Banda de Video 4.2 MHz 5.0 MHz 5.0 MHz Portadora de Sonido 4.5 MHz 5.5 MHz 5.5 MHz Relación de Aspecto 4:3 4:3 4:3 Tabla 3.5: Comparación de Parámetros en Televisión Analógica La Tabla 3.5 presenta un cuadro comparativo de los parámetros principales de los sistemas de televisión analógica conocidos a nivel mundial. 3.7.2 Televisión Digital Abierta La televisión digital abierta (TDA) permite una mejora en la producción, transmisión y recepción de la imagen y amplía la oferta disponible tanto en el número de canales como en la productividad del sistema. La fase de producción en la televisión digital es donde se generan y captan las imágenes o sonidos, los cuales son tratados para 49 conformar contenidos audiovisuales. La fase de transmisión incluye todos los procesos adecuados para adaptar la señal de televisión al canal radioeléctrico por el que será transmitido el contenido. Esta fase es la que en realidad define cuando la televisión es digital o analógica (ver Figura 3.27). La TDA está compuesta por TDT (Televisión Digital Terrestre), TDC (Televisión Digital por Cable) y TDH (Televisión Directa al Hogar), esta última es vía satelital. Figura 3.27: Televisión según sus Fases La fase de recepción, que depende en su mayor parte del usuario final, requiere la adquisición de los equipos adecuados para poder recibir los contenidos digitales. En la Tabla 3.6 se pueden apreciar los requisitos básicos por fase para migrar a televisión digital. Fase Requisitos Producción  Inversión en sustitución y renovación de hardware y software.  Formación profesional.  Reorganización de las estructuras de producción y de las rutinas profesionales. Transmisión  Adaptación y renovación de la infraestructura de radiodifusión.  Ampliación de la cobertura de radiodifusión. Recepción  Adaptación de las infraestructuras de captación y distribución de la señal en las viviendas.  Renovación de los receptores.  Guías para manipulación de los equipos y programas interactivos. Tabla 3.6: Requisitos para Implementar TDA El tema de la digitalización fue abordado en momentos que no era una necesidad para la sociedad lo que causó poco impacto y baja penetración en el mercado. Sin embargo, la aceptación de migrar tecnológicamente a TDA está ahora presente. La compatibilidad de TDA no se puede garantizar a nivel mundial, sin embargo, determinados países han venido implementando similarmente los estándares creados para difundir el servicio de televisión. Entre ellos se encuentran:  ATSC (Advanced Television Systems Committee): Es un comité creado en 1982 compuesto por aproximadamente 170 miembros que buscan regular los estándares de Televisión Digital. Crearon el estándar ATSC usado en Estados Unidos desde 1998 y posteriormente adoptado en Canadá y Corea del Sur.  DVB-T (Digital Video Broadcasting): Es un estándar europeo definido y formado por un conjunto de documentos que delimita los estándares de transmisión. Televisión digital Televisión analógica Transmisión analógica Producción digital Transmisión digital Producción analógica Televisión analógica Transmisión analógica Producción digital 50  ISDB-T: Es un estándar japonés creado en 1999 por varias empresas y operadoras de Televisión, utiliza una modulación COFDM.  DTMB: Es un estándar chino que fue definido en el año 2006 y recibió la aprobación final de la República Popular de China en agosto del año 2007. La transmisión de datos es implementada mediante el estándar TDS-OFDM.  ISDB-Tb: Es un estándar que tuvo una variante en Brasil quien mejoró los esquemas de codificación pasando de MPEG-2 a MPEG-4. El objetivo de cada país o región es proteger los intereses locales, tanto de transmisores como de receptores; y buscar introducir su estándar en los demás países del mundo. Todos estos sistemas adoptan diferentes patrones de modulación de la señal de difusión, transporte de flujos de audio, video, datos y aplicaciones; codificación, calidad de audio, video y servicios middleware. En Sudamérica, a excepción de Brasil, los países no hay desarrollado tecnologías de televisión digital, adoptando así estándares desarrollados por otros países. Elegir un estándar requiere considerar varios factores técnicos y comerciales, además de aspectos de cooperación en materia de transferencia tecnológica para el desarrollo de la industria local. La Tabla 3.7 tomada de [31] nos muestra los estándares adoptados por algunos países latinoamericanos. Cada país ha expresado públicamente el año en que realizará el apagón tecnológico, para esa fecha no deben existir transmisiones de señales analógicas y ya debería haberse migrado totalmente a TDA. País Estándar Año para Apagón Analógico Argentina ISDB-T 2018 Brasil ISDB-T 2016 Bolivia ISDB-T Sin definir Chile ISDB-T 2017 Colombia DVB-T 2017 República Dominicana ATSC 2015 El Salvador ATSC 2019 Honduras ATSC Sin definir México ATSC 2015 Nicaragua ISDB-T Sin definir Panamá DVB-T 2020 Perú ISDB-T 2020 Uruguay ISDB-T 2015 Venezuela ISDB-T 2020 Tabla 3.7: Estándares TDA en Latinoamérica La ventaja más notable de TDA se basa en la mejora de la calidad de la imagen y del sonido. La digitalización de la señal de televisión permite que por el ancho de banda permitido se puedan transmitir distintos tipos de resolución. SDTV (Standard Definition Television) tiene una resolución similar a la analógica 720x480 pixels, HDTV 720p (High Definition Television) con una resolución de 1280x720 pixels y HDTV 1080p (Full High Definition) con una resolución de 1920x1080 pixels. La imagen al tener mayor resolución tiene mejor calidad, permitiendo una relación de aspecto 16:9. En cuanto al audio, la TDA puede transmitir hasta en seis canales distintos, similar a los Home Teather. Otra ventaja del TDA es su inmunidad al ruido. Las señales analógicas se ven afectadas cuando hay interferencia de otro canal adyacente, también cuando hay cambios de contraste en la imagen o el efecto lluvia. Si la potencia de la señal digital no llega al receptor por encima del umbral definido la imagen no se muestra, a diferencia 51 de la señal analógica que muestra la imagen con calidad degradada. La TDA utiliza varios buffer que dan tiempo a recuperar rápidamente la señal enviada por el transmisor (desfasando un poco el tiempo real de la señal). Una señal TDA puede ser modulada en su transmisión con 16 QAM (Quadrature Amplitude Modulation), 32 QAM, QPSK (Quadrature Phase Shift Keying), PAM (Pulse Amplitud Modulation) y OFDM (Orthogonal Frecuency Division Multiplexing). Un framework para el desarrollo de televisión digital interactiva es Ginga. Es el nombre que se le da a un middleware de código abierto desarrollado en Brasil. Está compuesto por un conjunto estandarizado de tecnologías e innovaciones, con características de mayor resolución de audio, video e interactividad. Dependiendo de la funcionalidad del diseño de cada aplicación interactiva, un modelo de desarrollo de aplicaciones es más adecuado que otro. El middleware4 Ginga puede ser dividido en tres sistemas principales:  Ginga-CC (Ginga Common-Core): Es el núcleo del sistema y da soporte para el uso de ambientes declarativos.  Ginga-J: Desarrollado por la Universidad Federal de Paraíba para dar soporte a la ejecución de aplicaciones basadas en lenguaje de procedimientos Java, llamados Xlet.  Ginga-NCL: Desarrollado por la Pontificia Universidad de Rio de Janeiro, tiene como función soportar la presentación de contenidos escritos en lenguaje NCL (Nested Context Language), con facilidades en torno a la interactividad, sincronismo espacio- tiempo de objetos de media, adaptabilidad y soporte a múltiples dispositivos. Las aplicaciones desarrolladas con Ginga pueden ser probadas en un programa conocido como Virtual Set Top Box. Es instalado en una máquina virtual con sistema operativo Linux bajo distribución Ubuntu, siendo una herramienta importante para las pruebas de las aplicaciones Ginga NCL. Utiliza los recursos necesarios de procesamiento y de memoria como un Set Top Box real, estando limitado por los paquetes instalados. El desarrollo de aplicaciones interactivas para televisión digital está tomando terreno entre los programadores, que ven dentro del mercado la posibilidad de interactuar con los usuarios. Está planteado implementar la educación a distancia (T-Learning), las operaciones bancarias (T-Bank), aplicaciones para prevención y orientación de posibles enfermedades menores (T-Health), aplicaciones para servicios gubernamentales (T- Government) y la posibilidad de poder adquirir productos anunciados directamente por la televisión (T-Commerce). 3.7.3 Diferencias entre TV Analógica y Digital Una de las diferencias más importantes entre la TV digital y la analógica es que al comprimirse la información en formato digital una emisora de TV puede colocar de 6 a 10 canales de programas en la misma banda ancha que ocuparía un canal analógico. Otra ventaja que la tecnología digital tiene sobre la analógica es que las señales digitales pueden ser comprimidas mejor que las señales analógicas. 4 Middleware: Software que intercomunica varias aplicaciones de software, ofrece un conjunto de servicios que hacen posible el funcionamiento de aplicaciones distribuidas sobre plataformas heterogéneas. 52 Para transmitir una imagen de televisión digital, se deben incluir en la señal todos los pixels de dicha imagen. Por ejemplo, la pantalla NTSC estándar incluye 535 líneas por 720 pixels, o sea un total de 378.000 pixels/frame, y esa cantidad de pixels se transmiten por el canal de televisión de 6 MHz de banda ancha. Una pantalla del estándar ATSC puede tener hasta 1080 líneas por 1920 pixels, lo que representan 2.076.600 pixels/frame, más de 5 veces la banda ancha de un canal de TV, sin incluir el sonido comprimido ni los datos. ATSC es un organismo gubernamental de EE.UU. encargado de definir los estándares para los nuevos sistemas de televisión digital. De los 18 formatos de DTV (Digital Television) que existen, 6 son formatos HDTV, 5 de los cuales están basados en escaneos progresivos y 1 en escaneo entrelazado. De los restantes formatos de DTV, 8 son de SDTV (4 formatos de pantalla ancha con una relación de aspecto 16:9 y 4 con formatos convencionales con una relación de aspecto 4:3), y los 4 restantes son formatos VGA (Video Graphics Array). Las estaciones de transmisión son libres de elegir en qué formato van a difundir su transmisión. Se presentan en la Tabla 3.8 los formatos usados en la televisión digital definidos por el estándar ATSC A/53: Formato Formato de imagen Relación de aspecto Velocidad de frame5 HDTV 1920x1080 16:9 30I, 30P, 24P HDTV 1280x720 16:9 60P, 30P, 24P SDTV 704x480 16:9 30I, 60P, 30P, 24P SDTV 640x480 4:3 30I, 60P, 30P, 24P Tabla 3.8: Formatos de Televisión Digital Las estaciones de transmisión están obligadas a comprimir el detalle de las imágenes y la alta calidad de sonido en la misma banda ancha de 6 MHz usado por la TV analógica y para ellos hace falta usar codecs. La televisión digital tiene las características principales siguientes en algunos casos:  Imágenes más amplias.  Mucho mayor detalle en las imágenes.  5.1 (5 + 1 canales = 6) canales independientes CD-quality Dolby.  Capacidad de enviar datos directamente a una pantalla o una PC.  Formato de pantalla 4:3 o 16:9 (relación de aspecto). 3.7.3.1 Relación de Aspecto El término Relación de Aspecto (Aspect Ratio) hace referencia al ancho de una imagen o pantalla en relación con su alto. Dicha relación suele expresarse de varias maneras, como por ejemplo 4x3 ó 4:3 ó 4/3, lo que significa que dicha imagen tiene 4 unidades de ancho por cada 3 unidades de alto. Alternativamente puede expresarse la relación como 1,33 (4 dividido por 3). 5 Progresivo (P) y Entrelazado (I) se refieren al sistema de escaneo de la imagen. 53 En cuanto a la relación de aspecto de 16:9 en HDTV, el formato de la imagen está definido para que las películas se muestren lo más preciso posible a cómo fueron diseñadas. Si se captura una imagen HDTV en una TV analógica con relación de aspecto 4:3, los formatos de las películas deben recortarse en sus lados izquierdo y derecho, perdiendo así el campo visual de la imagen. Si la imagen de captura es 16:9 el campo visual se pierde del lado superior en inferior de la imagen. Ambos casos se contemplan en la Figura 3.28 donde se demarca el área ignorada. Figura 3.28: Campo Visual en los Formatos 4:3 y 16:9 Una alternativa que se usa en la TV analógica para mostrar las películas 16:9 lo más cercano a cómo se diseñaron es poner dos barras negras en las partes superior e inferior para llenar el espacio extra; esta técnica se le conoce como formato letterbox. Así también, está la técnica pillarbox que se basa en colocar barras negras a la izquierda y derecha de la imagen. Ésta última resulta necesaria cuando la imagen de entrada es 4:3 y la salida tiene relación de aspecto 16:9. Ambos casos se muestran e la Figura 3.29. Figura 3.29: Técnicas de Relleno de Imagen Pillarbox y Letterbox 3.7.3.2 Escaneo Entrelazado y Progresivo Estos términos se refieren al sistema de escaneo de la imagen de TV. En el formato entrelazado, la pantalla muestra todas las líneas impares en un escaneo de la pantalla y luego sigue con todas las pares en un segundo escaneo. Cada uno de ellos se llama campos, y se muestran en forma sucesiva. Dado que hay 30 frames por segundo, la pantalla muestra una mitad del frame, es decir, un campo cada 1/60 de segundo. Para pantallas pequeñas, esto no se hace notar. Pero cuando el tamaño de la pantalla crece, el problema con el entrelazado es mayor (Figura 3.30). El formato progresivo muestra la pantalla entera por cada escaneo, las líneas escaneadas se muestran de arriba hacia abajo de un frame completo, lo que trae como consecuencia una imagen más alisada y pareja pero que requiere de un poco más de ancho de banda. 54 Figura 3.30: Diferencias de Señal Entrelazada y Progresiva 3.7.3.3 Desentrelazado de Video Los principales formatos de transmisión de señales de televisión (NTCS, PAL, SECAM) utilizan una señal de video entrelazada, donde sólo se transmiten alternativamente las líneas pares e impares de cada fotograma. De este modo, el ancho de banda de la transmisión se reduce a la mitad de una forma muy efectiva, ya que, debido a las características del sistema de visión humano, el parpadeo provocado por la eliminación de líneas es prácticamente inapreciable. No obstante, el auge de dispositivos que requieren un barrido progresivo de la señal de video (televisores de alta definición, DVDs, proyectores, etc.) ha fomentado el desarrollo de algoritmos de desentrelazado que realizan algún tipo de interpolación espacio-temporal para calcular las líneas no transmitidas. Entre los algoritmos de desentrelazado pueden distinguirse globalmente aquellos que utilizan un vector representativo del movimiento de la imagen para interpolar las líneas ausentes y los que no lo hacen [34]. Se mencionan 3 técnicas de desentrelazado: Weave, adaptativo y Bob. La técnica Weave es el método más sencillo de relleno de las mitades de imágenes. Consiste en mostrar de forma simultánea las imágenes impares y las pares. De este modo, la primera mitad de la imagen rellena las líneas vacías de la segunda mitad. Este método es apropiado cuando ambas mitades de la imagen se originan al mismo tiempo y se pueden intercalar sin que sea notorio. El desentrelazado adaptivo detecta las líneas que faltan en los campos y se añaden teniendo en cuenta los campos de alrededor. Los desentrelazadores adaptables buenos tienen en cuenta hasta cinco imágenes en ambas direcciones. Cuantas más imágenes tenga en cuenta el algoritmo, más se ralentiza el resultado. La técnica Bob detecta las líneas que faltan en los campos, por lo que se expande cada campo para formar una imagen completa. El resultado de esta técnica es la difuminación y la falta de algunos detalles horizontales. 3.7.4 Formatos de Compresión de Video Debido a que las redes tienen un ancho de banda limitado no es posible ni deseable transmitir las secuencias de video sin modificarlas. Para solucionar este problema de ancho de banda se han desarrollado una serie de técnicas de compresión de video e imágenes. Estas técnicas permiten reducir el tamaño de bits que son necesarios para la transmisión y almacenamiento del contenido. Hay actualmente dos principales organizaciones de estándares de formatos de video: la ITU (International Telecommunication Union) y la MPEG (Movie Picture Expert Group). La mayoría de los estándares internacionales fueron escritos por estos dos grupos y los principales estándares fueron aprobados por ambos (MPEG-1, MPEG-2 y MPEG-2 part 55 10 conocido como H.264). Además hay estándares propietarios como DivX (basado en MPEG-4 ASP) y Microsoft Media 9 (similar a H.264). La Tabla 3.9 compara los estándares de formatos de video dominantes en la industria actual: Formato/Estándar Objetivo Calidad Típica Comentarios MPEG-1 Estándar Internacional 1992. Alcanza video y audio verosímiles en grabación y transmisión a aprox. 1.5 Mbps. Calidad VHS a 1.5 Mbps. Resolución típica SIF (Source Intermediate Format). Casi todos los computadores soportan archivos MPEG-1. Usada típicamente para baja resolución de video, pero puede ser usada para cualquier resolución. Sólo progresivo. MPEG-2 Estándar Internacional 1993. Aplicaciones genéricas de alta velocidad incluyendo TV y broadcast. Alta calidad típicamente con resolución Full D1 (broadcast y DVD son MPEG-2) a 8 Mbps en sus comienzos y de 2 Mbps a 4 Mbps en la actualidad. Aplicaciones: DTV, HDTV, DVD, Digital cable, satélite y terrestre. Es el estándar más común. Soporta entrelazado. MPEG-4 parte 2 1998. Muy baja velocidad de codec, habilitando bajas velocidades de frame, baja resolución. Típicamente calidad moderada. En velocidades con full frame, calidad moderada/alta requiere una velocidad similar a MPEG-2. Entrega de contenido de video digital sobre Internet y dispositivos inalámbricos. Videoconferencias usando H.263 se basan en este estándar. MPEG-4 AVC (conocido como H.264). Todos los requerimientos desde HDTV de alta calidad hasta bajas velocidades de transmisión para redes celulares. Variedad de velocidades. Por ejemplo, Full D1 a 30 frames por segundo, calidad DVD a menos de 1 Mbps. CIF (Common Intermediate Format) a 256 kbps. Es el estándar más avanzado y se basa en los estándares previos MPEG. Tabla 3.9: Formatos de Compresión Dominantes en el Mercado Actual La palabra codec viene de codificador/decodificador. El codificador de video comprime los datos de video según un formato y encapsulación, eliminando la información superflua o duplicada. El resultado es un archivo que puede ser almacenado o 56 transmitido por streaming con bajo costo de ancho de banda. El decodificador descomprime los datos de video habilitando el playback del video. Todo esto envuelve algoritmos muy complejos que resultan pesados si la velocidad de transmisión es baja con altas relaciones de compresión de video. Inicialmente los codecs eran implementados por hardware y hoy en día son por software debido a que el poder de procesamiento de los computadores se ha incrementado notablemente. Esta es una ventaja porque es una solución barata y flexible dado que no se tiene que tener el mismo decodificador por hardware en el otro extremo para procesar la señal. La DTV se basa en un esquema de compresión y codificación conocido como MPEG-2 (Movie Picture Expert Group 2). En las técnicas de compresión existe un patrón de video que es una “información” 3D con una dimensión horizontal, otra vertical y la tercera temporal. La compresión en la dimensión de tiempo es diferente que la imagen 2D estática, debido a que el patrón de tiempo necesita sólo transmitir los cambios de un frame a otro. Pero usando un frame de base es posible construir continuos frames mediante la transferencia de pequeñas cantidades de datos que describen las diferencias entre dos frames continuos, hasta que un nuevo frame de base deba ser transferido. La compresión MPEG-2 es una técnica de interpolación para predecir cómo el patrón es creado desde el comienzo hasta el fin. La compresión MPEG está basada en este método y trabaja con tres clases de frame: IFrame (Intra Frame), P-Frame (Predicted Frame) y B-Frame (Bidirectional Interpolated Frame). La compresión 2D JPEG del frame estático es usada para comprimir el frame base (I- Frame). El algoritmo JPEG se basa en el análisis espectral del frame y se focaliza en los principales componentes de frecuencia de la imagen. La calidad de imagen requerida determina la relación de compresión. Cambiando la compresión en la dimensión temporal permite establecer el número de frames interpolados (B-Frame) y los frames previstos (P-Frame) que son almacenados entre un frame de base y otro. MPEG-1 es un estándar dirigido a aplicaciones de almacenamiento de video digital en CD. Por esta circunstancia, la mayoría de los codificadores y decodificadores MPEG-1 necesitan un ancho de banda de aproximadamente 1.5 Mbps. Para MPEG-1 el objetivo es mantener el consumo de ancho de banda relativamente constante aunque varíe la calidad de imagen, que es comparable con la calidad de video VHS. MPEG-2 es el estándar diseñado para video digital de alta calidad DVD, HDTV, medios de almacenamiento interactivo ISM, retransmisión de video digital DVB y televisión por cable. El estándar MPEG-2 se centra en ampliar la técnica de compresión MPEG-1 para cubrir imágenes más grandes y de mayor calidad. MPEG-2 también proporciona herramientas adicionales para mejorar la calidad de video consumiendo el mismo ancho de banda. Esta característica indica que se producen imágenes de muy alta calidad cuando lo comparamos con otras tecnologías de compresión. Por otro lado, este formato es muy bueno filtrando los detalles de las imágenes que el ojo humano ignora. La calidad de la imagen es muy buena y significativamente mayor que la calidad de la imagen de la TV analógica. Una TV digital decodifica la señal MPEG-2 y la muestra igual que como lo hace el monitor de un computador, dándole alta resolución y estabilidad (tomado de [35]). 57 Cuando se habla de MPEG-4 generalmente se refiere a MPEG-4 parte 2. Este es el estándar de transmisión de video clásico MPEG-4. Este estándar incorpora muchas más herramientas para reducir el consumo del ancho de banda en la transmisión y así ajustar una cierta calidad de imagen a una determinada aplicación. Otra mejora de MPEG-4 es el amplio número de perfiles y niveles de perfiles para aplicaciones relacionadas con transmisiones con poco ancho de banda (para dispositivos móviles) así como aplicaciones con una calidad amplia y gran demanda del ancho de banda. MPEG-4 AVC también denominado como H.264 por la ITU, corresponde a un desarrollo posterior en el que MPEG tiene un conjunto completamente nuevo de herramientas que incorporan técnicas más avanzas de compresión. El objetivo es reducir aún más el consumo de ancho de banda en la transmisión con una calidad de imagen buena. Formato Ancho de Banda Relación de Compresión MPEG-1 0,4 – 2,0 Mbps 100:1 MPEG-2 1,5 – 60 Mbps 30-100:1 MPEG-4 28,8 – 500 kbps 100-200:1 H.263 28,8 – 500 kbps 30:1 H.264 15 – 300 kbps 50:1 Tabla 3.10: Ancho de Banda en los Formatos de Compresión Existen diversos formatos de compresión propietarios que tienen sus propias características y no son compatibles con otros formatos como el SMPTE 421M. VC-1 (Video Codec 1) es el nombre informal para el codec de video estándar SMPTE 421M. Fue creado en abril del 2006 por SMPTE (the Society of Motion Picture and Television Engineers). Su implementación más popular es WMV9 (Windows Media Video 9). SMPTE es una organización internacional de desarrollo de estándares. VC-1 es una evolución del diseño del codec de video basado en DCT que también podemos encontrar en H.261, H.263, MPEG-1, MPEG-2 y MPEG-4. Maneja tres perfiles: simple, principal y avanzado. Los perfiles simple y principal fueron desarrollados originalmente para su uso en los entornos informáticos en red de bajo bit rate. Como tal, ciertas suposiciones fueron hechas en relación con el entorno de la pantalla (por ejemplo, relación de aspecto de pixels cuadrados) para mejorar la eficiencia de compresión. El perfil avanzado añade soporte de metadatos, para permitir una experiencia optimizada en una amplia gama de dispositivos de visualización [40]. La Tabla 3.11 muestra las recomendaciones de bit rate y resoluciones de video para el codec VC-1. Perfil Nivel Bit Rate Máximo Resoluciones por Frame Rate Simple Bajo 96 kbps 176 x 144 / 15 Medio 384 kbps 240 x 176 / 30 352 x 288 / 15 Principal Bajo 2 Mbps 320 x 240 / 24 Medio 10 Mbpss 720 x 480 / 30 (480p) 720 x 576 / 25 (576p) Alto 20 Mbps 1920 x 1080 / 30 (1080i) Avanzado Nivel 0 2 Mbps 352 x 288 / 30 58 Nivel 1 8 Mbps 720 x 480 / 30 (NTSC-SD) 720 x 576 / 25 (PAL-SD) Nivel 2 20 Mbps 720 x 480 / 60 (480p) 1280 x 720 / 30 (720p) Nivel 3 45 Mbps 1920 x 1080 / 24 (1080p) 1920 x 1080 / 30 (1080i) 1280 x 720 / 60 (720p) Nivel 4 135 Mbps 1920 x 1080 / 60 (1080p) 2048 x 1536 / 24 Tabla 3.11: Bit Rate y Resoluciones Recomendadas en VC-1 Es ampliamente caracterizado como una alternativa a los últimos codecs de video estándar ITU-T y MPEG. Además contiene herramientas de codificación tanto para secuencias de video entrelazadas como para codificación progresiva. El objetivo principal del desarrollo y estandarización de VC-1 es dar soporte a la compresión de contenido entrelazado sin tener que convertirlo primero a progresivo, haciéndolo más atractivo para profesionales de la industria de la difusión y el video. A pesar de que es ampliamente considerado como un producto de Microsoft, actualmente hay 15 compañías en el consorcio de la patente de VC-1 (en agosto del 2006). Como estándar SMPTE, VC-1 está abierto a implementaciones de otros, aunque se requiere hipotéticamente que los implementadores paguen una cuota por licencias al MPEG LA, al organismo de licencias LLC o directamente a sus miembros. Tanto HD DVD como Blu-ray han adoptado VC-1 como estándar de video obligatorio, lo que significa que sus dispositivos de reproducción de video deben ser capaces de decodificar y reproducir contenido de video comprimido con formato VC-1. Windows Vista y Windows XP con SP2 soporta parcialmente reproducción de HD DVD, incluyendo el decodificador VC-1 y componentes relacionados que son necesarios para la reproducción de películas HD DVD codificadas con VC-1. 3.7.5 Formato de Encapsulación de Audio y Video Un formato multimedia es un tipo de archivo que almacena información de video, audio, subtítulos e información de sincronización siguiendo un formato preestablecido. Un formato contenedor contiene uno o varios flujos ya codificados por un codec. En general, hay un flujo de audio y uno de video. Los flujos que contengan pueden ser codificados utilizando diferentes codecs. Cuando se crea un contenedor, en primer lugar se produce la codificación de las pistas y posteriormente son multiplexadas siguiendo un patrón típico de cada formato. Cuando un archivo debe ser reproducido, en primer lugar actúa un decodificador, él cual conoce el patrón del contenedor y hace la demultiplexación del contenido, separando las pistas de audio y video. Una vez separadas las pistas, cada una de ellas es interpretada por el decodificador y es reproducida. Es necesario que el reproductor cuente con los decodificadores necesarios para reproducir tanto el video como el audio, de lo contrario la información no puede ser interpretada correctamente. Existe algo particular con MPEG, ya que es un formato de compresión de video y también es un formato contenedor de audio y video. Hay varios tipos de MPEG: Elementary Streams (ES), Program Streams (PS) y Transport Streams (TS). Cuando se reproduce por ejemplo un video MPEG de un DVD, el flujo MPEG está 59 compuesto por varios flujos, denominados flujos elementales ES. Un flujo es para video, uno para audio, otro para subtítulos y así sucesivamente. Estos flujos distintos se juntan para formar un único flujo de programa PS. Pero el formato PS no se encuentra adaptado para la difusión de video a través de una red o por satélite. El formato TS es la estructura que se define para la transmisión en medios susceptibles a errores. Este formato utiliza paquetes de longitud constante llamados paquetes de transporte. El streaming de video y audio de cada programa de televisión se comprime independientemente, formándose por cada uno de ellos una corriente elemental que puede tener tamaño variable. Para mantener el streaming total constante durante la transmisión se incluyen paquetes nulos de relleno. El tamaño del paquete TS es de 188 bytes. Este formato permite multiplexar varios programas dentro de un mismo flujo binario de datos. El formato PS es la estructura que define MPEG-2 para el almacenamiento de datos en medios libres de errores (como pueden ser los DVDs, discos duros, CD-ROMs, etc). Este formato está conformado por paquetes de longitud fija o variable y de gran tamaño (por ejemplo 2048 bytes). Solamente se pueden encontrar datos relativos a un único programa. El formato M2TS está basado en el contenedor MPEG-2 Transport Stream. Es utilizado con VBR (Variable Bit Rate) para optimizar el tamaño de almacenamiento en el computador. Los archivos M2TS soportan resoluciones de 720p y 1080p. El tamaño de estos paquetes es de 192 bytes, ya que incorporaron 4 bytes más que su predecesor. La cabecera adicional incluye timestamps para reordenar el contenido rápidamente en el receptor. Debido a que la televisión es una plataforma en tiempo real resulta altamente sensible a pérdidas y retardos. Generalmente, se utiliza una encapsulación del tipo M2TS para transmisiones con video de alta calidad y TS para transmisiones con video de menor calidad. La televisión digital es viable si se cuenta con algoritmos de compresión de video y audio que permitan reducir el consumo del ancho de banda necesario. El formato MKV (Matroska Video) es un formato contenedor de video totalmente libre. El nombre Matroska es en referencia a las muñecas rusas contenidas una dentro de otra. Este formato permite contener video (DivX, Xvid, RV9, etc), sonido (MP3, MP2, AC3, Ogg, AAC, DTS, PCM) y subtítulos (SRT, ASS, SSA, USF, etc.) en un mismo archivo. MKV está basado en una estructura derivada del XML llamada EBML (Extensible Binary Meta Language). Por lo tanto, gracias al formato Matroska, se pueden llevar a cabo funciones de capitulación, crear menús, realizar búsquedas en el archivo, seleccionar una fuente de sonido o elegir un subtítulo. El formato ASF (Advanced Systems Format) agrupa varias tecnologías de video desarrolladas por Microsoft. Lo admiten reproductores como la consola Xbox y todas las aplicaciones en Windows incluyendo Windows Phone. Usualmente, utiliza el codec de video VC-1 y el de audio WMA. Los archivos pueden tener las extensiones .wmv, .avi o .asf. Es un formato propietario de Microsoft. El formato Flash Video es un contenedor creado para transmitir videos en formato flash por Internet. Los videos de YouTube usan este formato y la mayor parte de la publicidad de las páginas de Internet. Para ver este formato en el navegador es necesario instalar el plugin de Flash Player, aunque reproductores como VLC lo soportan. Es un software 60 propietario, por lo que, para codificar videos en este formato es necesario programas de licencia paga como Macromedia Flash de Adobe. El formato AVI es un contenedor de video y audio creado por Microsoft. Puede contener un flujo de video y varios de audio usando distintos codecs (DivX, Xvid o Motion JPEG para el video y AC3 o MP3 para el audio). Los archivos AVI se pueden ver en casi cualquier reproductor, pero dependen de los codecs instalados en el sistema operativo. 61 4. Marco Metodológico 4.1 Red Actual de la Facultad de Ciencias Es importante recordar que el alcance del presente Trabajo Especial de Grado es la Facultad de Ciencias. Sin embargo, la infraestructura de red ya tiene definido el soporte multicast con IGMPv2 y enrutamiento con PIM-SM en el router principal (CORE) del núcleo Caracas según [4]. La Msc. Neudith Morales coordinadora de la Dirección de Tecnología de Información y Comunicaciones de la UCV trabajó en la adecuación del diseño de una red con un backbone redundante capaz de soportar nuevas tecnologías, como QoS. Además se incrementó el ancho de banda de los enlaces que parten del backbone hacia los usuarios; manteniendo siempre una estructura jerárquica y modular que permite la escalabilidad de la plataforma y facilita la detección y solución de fallas (según [36]). Figura 4.1: Extracto de la Red Corporativa de la UCV La Facultad de Ciencias dispone de un enlace de alta velocidad 10 Gbps hacia el CORE de la UCV como se observa en Figura 4.1. El enrutamiento multicast está habilitado en la Facultad de Ciencias y en el CORE principal, por lo que, todo dispositivo interconectado y con soporte capa 2 también disfruta de multicast. Así pues, realizar la transmisión del servicio de televisión desde un segmento de red en el router de la Facultad de Ciencias representa el contexto ideal para transmitir streamings. 4.2 Infraestructura para una Transmisión Multicast El despliegue de una red de televisión multicast requiere de 5 elementos fundamentales: la captura de la señal de televisión, el servidor de transcoding, el 62 servidor multicast, la infraestructura de red y el servidor web con base de datos que gestiona la interfaz de los clientes. En la Figura 4.2 se observa la infraestructura ideal para una transmisión multicast. La adquisición de contenidos de televisión en vivo fue concebida inicialmente como la captura vía microondas de los canales señal abierta que se encuentran en el aire. El contenido pregrabado se refiere a cualquier video en un formato adecuado para que los servidores lo entiendan, lo procesen y lo transmitan. La base de datos contiene la información mostrada a los clientes por otro servidor vía web. Los clientes son computadores que tengan navegadores web instalados, por lo que, actualmente se incluyen también muchos smartphones. Figura 4.2: Infraestructura para una Transmisión Multicast Las pruebas fueron realizadas en LACORE que posee computadores con características de hardware muy similares entre sí. La velocidad del procesador fue un inconveniente durante las pruebas tempranas, por lo que, se solicitó la colaboración a la Escuela de Computación de la Facultad de Ciencias quien prestó un computador de características superiores. Finalmente se utilizaron 2 computadores con el hardware que se muestran en la Tabla 4.1. Nombre de Servidor Descripción Servidor A (HP xw4600 Workstation) Procesador Intel Core 2 Duo E6750 (2.66 GHz). Tarjeta Madre Intel X38 Express. Memoria RAM 4GB. Disco Duro SATA 180GB. 3 Ranuras PCI. 1 Ranuras PCI Express x1. 1 Ranuras PCI Express x8 con soporte x4. 2 Ranuras PCI Express x16. 2 USB 2.0 Frontales. 7 USB 2.0 Traseros. 63 3 USB 2.0 Internos. Servidor B Procesador Intel Core i7 3770 (3.40GHz). Tarjeta Madre Asrock h61M-VG3 Memoria RAM 8GB. 2 Disco Duro SATA 500GB. 2 USB 2.0 Frontales. 4 USB 2.0 Traseros. 2 PCI Express x16 slots. 1 Ranura PCI. Tabla 4.1: Especificaciones de Hardware de Servidores Utilizados Para el presente Trabajo Especial de Grado se utilizan los nombres Servidor A y Servidor B. La solución planteada tiene a uno sólo de ellos en producción con todas las funcionalidades integradas para aprovechar al máximo el hardware disponible. 4.2.1 Captura de la Señal de Televisión El elemento receptor de la señal de televisión disponible para éstos dispositivos de captura inicialmente fue una antena de televisión tipo conejo doble aro (ver Figura 4.3.), sin embargo a mediados del Trabajo Especial de Grado se adquirieron equipos que capturan televisión digital. Figura 4.3: Antena de Televisión Conejo Doble Aro La antena de televisión conejo doble aro no tiene buena recepción en las dependencias de LACORE. La parrillera de canales de televisión está limitada al espectro permitido por CONATEL (Comisión Nacional de Telecomunicaciones) a nivel nacional. Pueden conectarse a esta antena múltiples sintonizadoras de televisión mediante el uso de un splitter, sin embargo, la señal se va degradando debido a la multiplexación del canal. Los equipos de televisión digital se compraron a las compañías: Telefónica Venezolana C.A. (Movistar) y Compañía Anónima Nacional Teléfonos de Venezuela (CANTV). A continuación en la Tabla 4.2 se describen los equipos. Modelo de Equipo Descripción Konka KHDS866 PVR-R 1 entrada coaxial para antena LNB. 1 salida coaxial para antena LNB. 2 salidas por RCA para audio. 1 salida por RCA para video. 1 entrada coaxial para TV. 1 salida coaxial para TV. 1 tarjeta de acceso CANTV con chip. 64 Huawei DS360 1 entrada coaxial para antena LNB. 1 salida coaxial para antena LNB. 2 salidas por RCA para audio. 1 salida por RCA para video. 1 tarjeta de acceso CANTV con chip. 1 puerto USB para almacenamiento. Echostar DSB-646V (Movistar) 1 entrada coaxial para antena LNB. 1 salida coaxial para antena LNB. 2 salidas por RCA para audio. 1 salida por RCA para video. 1 entrada coaxial para TV. 1 salida coaxial para TV. 1 tarjeta de acceso Movistar con chip. Tabla 4.2: Equipos de Televisión Digital CANTV y Movistar Las salidas RCA constan de video compuesto y dos entradas para sonido estereofónico referenciadas por los colores, amarillo, blanco y rojo, respectivamente. Es llamado así por ser la compañía Radio Corporation of America quien introdujo el diseño en el año 1940. La salida de S-Video (Separated-Video) tiene todo el video en un mismo cable pero no transporta audio. Dispone de información independiente sobre el brillo y el color. Por esta razón S-Video tiene mucha más calidad que el video compuesto y es usado también para conectar VCRs o videograbadoras. La principal intención de hacer pruebas con estos decodificadores es obtener una imagen de mejor calidad con las sintonizadoras de televisión. El decodificador de movistar (ver Figura 4.4) tuvo un costo de adquisición de Bs. 1.300,00 para julio del 2014. La recepción es SDTV por lo que la calidad de la imagen aunque es buena (resolución de 720x480 pixels) no es mejor que HDTV. El plan de televisión suscrito tiene un costo de Bs. 264,43 y ofrece una parrillera de 69 canales de programación variada incluyendo los canales nacionales. Figura 4.4: Decodificador Echostar DSB-646V de Movistar La tarjeta de acceso que utiliza el decodificador Movistar es a base de chip (ver Figura 4.5). Está asociada al equipo en los seriales que la identifican. En caso de que se intente colocar otra tarjeta de acceso que no pertenezca al decodificador se bloquea el acceso a la programación. Figura 4.5: Tarjeta de Acceso Decodificador Movistar 65 La antena que utiliza el decodificador movistar es de tipo parabólica y tiene adaptado un LNB simple de banda Ku (ver Figura 4.6). La instalación se hizo por personal técnico de la empresa, bajo previa autorización de la dirección de la Escuela de Computación. Se utilizaron aproximadamente 30 metros de cable coaxial y 2 terminales BNC. La antena se ubicó en el techo de la división de control de estudios de la Facultad de Ciencias por la cercanía que tiene con LACORE. Figura 4.6: Antena Parabólica Movistar TV La televisión digital que brinda CANTV tuvo inicialmente un decodificador básico Konka KHDS866 PVR-R (como se observa en la Figura 4.7). El soporte HDTV es uno de los aspectos más llamativos de su lanzamiento. Este decodificador posee salidas compatibles con HDMI, S-VIDEO, RCA y coaxial. Además de un puente para LNB con el que se pueden conectar más decodificadores. Se adquirieron 2 unidades de este modelo a un costo de 250Bs.F en promoción de CANTV. Figura 4.7: Decodificador Konka KHDS866 PVR-R de CANTV El decodificador Huawei DS360 de CANTV que se muestra en la Figura 4.8 es uno de los más avanzados del mercado actual, tiene la capacidad de grabar utilizando el puerto USB con algún dispositivo de almacenamiento masivo. Tiene soporte HDTV y salidas compatibles con HDMI, S-VIDEO y coaxial. El flujo de transporte de video es MPEG-2, H.264/AVC y el de audio MPEG2 AAC y MPEG4 AAC+HE. El costo de adquisición fue 350Bs.F en promoción de CANTV. Figura 4.8: Decodificador Huawei DS360 de CANTV La antena que utilizan los decodificadores CANTV es de tipo parabólica y tiene adaptado un LNB simple de banda Ku (ver Figura 4.6). Las antenas de ambas compañías se instalaron por el mismo personal técnico de Movistar. Se utilizaron 66 aproximadamente 10 metros de cable coaxial y 2 terminales BNC. La ubicación de la antena requiere línea de vista directa con el satélite, cualquier elemento que interfiera disminuye la señal recibida. En el caso de este Trabajo Especial de Grado la antena se ubicó en el techo de la división de control de estudios de la Facultad de Ciencias por la cercanía que tiene con LACORE, debido a que el personal técnico no encontró otro lugar de instalación de fácil acceso. Es una sola antena utilizada para los 3 decodificadores CANTV. Figura 4.9: Antena Parabólica CANTV Televisión Satelital Para la captura de la señal de televisión se adquirieron los dispositivos Hauppauge 1229 WinTV HVR-2250, Hauppauge 1192 WinTV HVR-1950, Kworld Analog TV Stick III UB405-A y Easycap SM-USB 007. La tarjeta Hauppauge 1229 WinTV HVR-2250 puede sintonizar dos canales de televisión simultáneamente con NTSC, ATSC o QAM. El dispositivo permite ver y grabar programas de televisión al mismo tiempo, soportando todos los formatos digitales de ATSC y QAM, incluyendo HDTV a 1080p. Tiene un chip NXP 7164 que codifica las dos señales en MPEG-2, sin afectar el rendimiento del computador. Figura 4.10: Tarjeta Hauppauge 1229 WinTV HVR-2250 La Figura 4.10 muestra el panel frontal de la tarjeta con dos conectores coaxiales tipo F, el primer conector corresponde a la entrada de la señal de televisión y el segundo a la entrada de la señal de radio. La tarjeta tiene para conectar un control remoto y una entrada para audio y video. Los requisitos recomendados para el uso del dispositivo son: 67  Procesador 2.2 GHz Pentium 4 o su equivalente.  Microsoft Windows 8, 7, Vista Premium o Ultimate con Windows Media Center o Windows XP.  Ranura PCI Express X1 o X8.  Memoria gráfica de 64 MB.  Tarjeta de sonido. Generalmente las tarjetas madres son elaboradas con un limitado número de ranuras PCI Express, limitando así el número de tarjetas Hauppauge 1229 WinTV HVR-2250 que pueden colocarse en el computador. Mientras más canales de TV puedan verse en el computador, más contenidos pueden enviarse con multicast. Es por ello que se incluyó la posibilidad de adicionar más dispositivos utilizando los puertos USB, como es el caso de la Hauppauge 1192 WinTV HVR-1950. El dispositivo Hauppauge 1192 WinTV HVR-1950 se muestra en la Figura 4.11, tiene entradas RCA (2 para audio y 1 para video). Figura 4.11: Vista Frontal del Dispositivo Hauppauge 1192 WinTV HVR-1950 Además tiene una entrada para la señal de TV y otra para radio FM, ambas entradas con conectores coaxiales tipo F (ver Figura 4.12). Tiene una entrada jack IR Blaster utilizada para operar independientemente otros equipos electrónicos (DVD, TV, decodificadores) que soporten la tecnología, para esto el dispositivo trae un control remoto con múltiples funcionalidades incluidas. El conector USB tipo B permite que el dispositivo se comunique con el computador para realizar la instalación y configuración del mismo. El conector +5V se refiere al suministro de energía al dispositivo. El dispositivo utiliza el codificador MPEG-2 Conexant CX23417 incorporado en hardware para desahogar la carga de procesamiento en la CPU. Figura 4.12: Vista Trasera del Dispositivo Hauppauge 1192 WinTV HVR 1950 Los requisitos recomendados para el uso del dispositivo Hauppauge 1192 WinTV HVR- 1950 son:  Procesador Intel Pentium IV 1 GHz ó su equivalente (para televisión analógica)  Procesador 2.2 GHz Intel Pentium IV ó su equivalente (para televisión digital).  Microsoft Windows 8, 7, Vista Premium o Ultimate con Windows Media Center o Windows XP con SP2.  Puerto USB 2.0.  Memoria gráfica de 64 MB.  Tarjeta de sonido. 68 La sintonizadora de televisión Kworld Analog TV Stick III UB405-A se muestra en la Figura 4.13, tiene soporte de los sistemas analógicos. Permite ver y grabar programas de televisión analógica en los formatos MPEG-1, MPEG-2 y MPEG-4. El software que utiliza es TiVme propiedad de Kworld puede reconfigurar el control remoto y hacer grabación silenciosa. Tiene De-noise (función avanzada para disminuir el ruido). Permite grabación programada. Figura 4.13: Sintonizadora Kworld Analog TV Stick III UB405-A Los requisitos mínimos recomendados para el uso del dispositivo Kworld Analog TV Stick III UB405-A son:  Procesador Intel Pentium IV 2.4 GHz ó su equivalente.  Memoria RAM 512 MB.  Puerto de USB 2.0.  Tarjeta de sonido.  Memoria Gráfica de 64 MB.  Microsoft Windows 8, 7, Vista Premium o Ultimate con Windows Media Center o Windows XP con SP2. La sintonizadora Easycap SM-USB 007 se muestra en la Figura 4.14, es un pequeño y avanzado dispositivo que permite transferir señal analógica de video y audio a la computadora. Utiliza el puerto USB y puede capturar imágenes en alta calidad. El software que utiliza es Ulead Video Studio. Se adquirieron 2 dispositivos de este tipo debido a su bajo costo (1750 Bs.F para Enero 2015). Es un dispositivo compatible con Windows 8 y versiones anteriores, además existe un controlador experimental en Linux6. 6 http://linuxtv.org/wiki/index.php/Easycap 69 Figura 4.14: Sintonizadora Easycap SM-USB 007 Los requisitos mínimos recomendados para el uso del dispositivo Easycap SM-USB 007 son:  CPU Pentium III 800 MHz.  Memoria RAM 256MB.  Microsoft Windows 8, 7, Vista Premium o Ultimate con Windows Media Center o Windows XP con SP2 y Linux.  Puerto USB 2.0.  Memoria gráfica de 64 MB.  Tarjeta de sonido. Las capacidades de hardware del Servidor A y Servidor B cumplen con los requisitos mínimos para todas las sintonizadoras de televisión anteriormente descritas. Primeramente se instalaron y probaron las sintonizadoras con el software propietario respectivo y bajo distintas plataformas de Windows. Todos los casos fueron probados en máquinas virtuales con el software VMware Workstation Pro. La Tabla 4.3 muestra los resultados de compatibilidad. Dispositivos Sintonizadores de TV Windows 7 Windows 8 Windows Server 2003 Windows Server 2008 Hauppauge 1229 WinTV HVR- 2250. Sí Sí Sí Sí Hauppauge 1192 WinTV HVR- 1950. Sí Sí Sí Sí Kworld Analog TV Stick III UB405-A. Sí Sí No No Easycap SM-USB 007. Sí Sí No No Tabla 4.3: Compatibilidad de las Sintonizadoras con los Sistemas Operativos La versión de Microsoft Windows Server 2012 no tiene soporte para WMS, característica fundamental para el servicio multicast. El sistema operativo escogido fue Windows 8 por tener compatibilidad con todos los dispositivos. Se instalaron simultáneamente los 2 dispositivos Easycap SM-USB 007 sobre un mismo computador. Las pruebas de captura de señal fueron fallidas cuando los dispositivos se 70 ejecutaban simultáneamente. Luego de investigar al respecto y hacer pruebas, se concluyó que 2 dispositivos sintonizadores Easycap SM-USB 007 no pueden funcionar al mismo tiempo sobre un computador. 4.2.2 Servidor de Transcoding La elaboración de contenidos en un formato digital utilizando procedimientos de compresión se realiza en el servidor de transcoding, así como la distribución hacia el servidor multicast. Existen múltiples software que permiten obtener contenido digital a través de una computadora o de un módulo de conexión que interactúa con las antenas de televisión. El fin es reproducir audio y video de forma continua y sin la necesidad de esperar que la totalidad de la información sea descargada. El contenido debe ser leído de una memoria provisional de almacenamiento o buffer. El principio general se basa en la codificación/decodificación del contenido de audio y video según un formato y a una tasa de transmisión. El primero y más importante reto en el contexto del streaming de televisión es hacer el transcoding manteniendo la reproducción en tiempo real y sin ningún tipo de interrupción del flujo de video. Hay tres requisitos básicos que se deben tomar en cuenta en el transcoding:  La información en el flujo de bits original debe ser explotada tanto como sea posible.  La calidad de video resultante del streaming debe ser tan alta como sea posible, o tan cerca como sea posible del flujo de bits creado por la codificación de la fuente de video original.  En aplicaciones de tiempo real, el retardo de transcoding y el almacenamiento en memoria (buffering) debe reducirse al mínimo para satisfacer las condiciones de tiempo real. Un servidor de transcoding puede proporcionar varias funciones, incluyendo el ajuste del bit rate y la conversión del formato de video y audio. La conversión entre cadenas de bits de video del mismo formato de encapsulación se le conoce como transconding homogéneo. En la presente investigación se utilizó contenido pregrabado (películas en formato DVD y Blu-ray) y las sintonizadoras de televisión anteriormente mencionadas como contenido principal para elaborar los streamings multicast. 4.2.2.1 Transcoding con la Hauppauge 1229 WinTV HVR-2250 La sintonizadora Hauppauge 1229 WinTV HVR-2250, tiene un codificador por hardware que mostró excelentes resultados al ser utilizada con el software propietario de Hauppauge. La resolución de captura para este caso era 1080p con los decodificadores de CANTV y 480p con el de Movistar. Sin embargo, dicho software no tiene las características de hacer una transmisión por red de la señal. Las aplicaciones que se utilizaron para hacer transcoding con este dispositivo fueron Microsoft Expression Encoder, Windows Media Encoder 9 y VLC Player. Cabe destacar que Adobe Flash Media Live Enconder y Helix Broadcaster fueron descartados porque sus características de transmisión en red deben integrarse con Flash Media Server y Helix Universal Media 71 Server, respectivamente. Flash Media Server no soporta multicast y Helix Universal Media Server es de licencia paga, propiedad de RealNetworks. DirectX es una colección de APIs (Application Programming Interface) desarrolladas para facilitar las complejas tareas relacionadas con multimedia. Las aplicaciones de transcoding utilizan específicamente a DirectShow como el API con el cual acceden a las sintonizadoras de televisión. Las capturas de la señal de televisión se realizaron con la conexión coaxial tipo F y con RCA. Los resultados fueron que en Windows Media Encoder 9 y VLC Player, fue posible observar la señal de video; sin embargo, el audio fue requerido como un input en las entradas de la tarjeta de sonido del computador. Esto inhabilitó la posibilidad de capturar el audio y video desde 2 streamings simultáneamente con el dispositivo Hauppauge 1229 WinTV HVR-2250. Con Microsoft Expression Encoder fue posible capturar el audio y video de la sintonizadora Hauppauge 1229 WinTV HVR-2250. Sin embargo, la resolución de captura de video fue baja (352x288 pixels). La sintonizadora utiliza su máximo potencial (1080p) con librerías propietarias de Hauppauge que trabajan directamente con el decodificador por hardware NXP 7164 integrado. La aplicación Microsoft Expression Encoder muestra retrasos de video cuando la captura es con 2 canales simultáneamente. La resolución de salida ajustada a 480p muestra pérdida de calidad en la imagen después del proceso de transcoding. Para este caso Microsoft Expression Encoder fue probado en Windows 7 y Windows 8. 4.2.2.2 Transcoding con Hauppauge 1192 WinTV HVR-1950 Las primeras capturas con Hauppauge 1192 WinTV HVR-1950 fueron satisfactorias con cable coaxial tipo F y con RCA. El software Microsoft Expression Encoder fue el único capaz de capturar la señal de audio y video conjunta. La señal de entrada fue 720x480 pixels ya que la máxima capacidad de la sintonizadora (1080p) sólo se observa con el software Hauppauge cuyas librerías manejan el chip Conexant CX23417. Sin embargo, 720x480 pixels es una buena resolución de entrada de video para hacer transcoding. Es importante mencionar que para todos los dispositivos debe seleccionarse la opción de agregar un origen en directo en la configuración inicial del software Microsoft Expression Encoder. También la opción Dispositivo de video y Dispositivo de audio deben corresponder en la selección del dispositivo Hauppauge 1192 WinTV HVR-1950. Luego, en la opción configuración del dispositivo de video, hay que escoger diálogo de barras cruzadas y asegurarse que la casilla Link Related Streams está seleccionada tal como se muestra en la Figura 4.15. 72 Figura 4.15: Dialogo de Barras Cruzadas en Microsoft Expression Encoder El formato de salida de codificación es VC-1 avanzado para video y WMA para audio. La resolución de video de salida fue 720x480 pixels a una velocidad de 29,97 frames por segundo. Microsoft Expression Encoder codifica según CBR (Constant Bit Rate). El problema de CBR llega con escenas de acción en las que la cámara se mueve con rapidez y un fotograma es muy, o totalmente diferente, del anterior o del siguiente. En ese caso, el almacenamiento necesario para guardar los cambios entre fotograma y fotograma crece considerablemente. Por lo general, el bit rate de películas en DVD actuales varía desde los 2 Mbps a los 4 Mbps, así que una tasa de 4 Mbps es un buen valor para cada señal de televisión multicast utilizando CBR. Las opciones de audio se ajustaron a una velocidad de muestra de 48 kHz y bit rate de 128 kbps. Es necesario que en la opción de preprocesamiento de video se seleccione forzar el desentrelazado bob, esto a fin de evitar los problemas descritos en la Sección 3.7.3.2 sobre el entrelazado de video. La salida por red puede ser por difusión o por un punto de publicación que se conecta directamente a un servidor multicast. Para el primer caso es conveniente que el servidor de transcoding esté en el mismo segmento de red que el servidor multicast y que dicho segmento no tenga otros receptores que puedan comprometer el streaming. También se recomienda escoger un puerto distinto al 8080 y permitir máximo una conexión. Todas las recomendaciones aquí dadas están basadas en el mejor resultado obtenido de las variantes aplicadas a las métricas anteriormente mencionadas. Al cabo de varios días en funcionamiento, el dispositivo mostró un desfase progresivo entre el audio y el video en el servidor de transcoding. No se encontró solución al problema por lo que el uso de este dispositivo fue descartado como solución al tema propuesto. 4.2.2.3 Transcoding con Kworld Analog TV Stick III UB405-A Las capturas con el dispositivo Kworld Analog TV Stick III UB405-A fueron realizadas con el conector coaxial tipo F ya que la capturadora sólo tiene este soporte. Es importante seleccionar la opción Sintonizador en la línea de video, y que se configure el diálogo sintonizador de TV en la configuración del dispositivo de video. Los codificadores de CANTV trabajan por defecto con el canal 3, sin embargo, el valor 73 puede ser cambiado al canal 4. Hay que seleccionar el mismo canal que tiene establecido el codificador como se muestra en la Figura 4.16, de lo contrario, no se obtendrá señal de entrada. La opción Link Related Streams también debe estar activada. Figura 4.16: Diálogo Sintonizador de TV Kworld Analog TV Stick III UB405-A El formato de salida fue con VC-1 avanzado para video y WMA para audio. La resolución de video de salida fue 720x480 pixels ajustado a una velocidad de 29,97 frames por segundo. El bit rate se configuró a 4 Mbps y el preprocesamiento de video tuvo activa la opción forzar el desentrelazado bob. Las opciones de audio se ajustaron a una velocidad de muestra de 48 kHz y bit rate a 128 kbps. La salida fue por difusión por el puerto 8081. Los resultados de transcoding fueron satisfactorios, el consumo de CPU osciló entre 20% y 50% en base a 60 segundos de monitoreo. El dispositivo cumplió los requerimientos para ser utilizado como parte de la solución en la presente investigación. 4.2.2.4 Transcoding con Easycap SM-USB 007 El dispositivo Easycap SM-USB 007 solo permite entradas por RCA, por lo que la línea de video seleccionada fue video compuesto. Es importante señalar que la configuración del diálogo de captura debe tener la resolución 720x480 pixels, de lo contrario la imagen sufrirá congelamiento y el dispositivo dejara de funcionar. Para realizar este cambio debe seleccionarse como entrada de video estándar la opción NTSC_M o NTSC_M_J, tal como se muestra en la Figura 4.17. Finalmente la opción Link Related Streams debe estar también activada. 74 Figura 4.17: Diálogo de Captura Easycap SM-USB 007 Igual que los casos anteriores el formato de salida fue VC-1 avanzado para video y WMA para audio. La resolución de video de salida fue 720x480 pixels ajustado a una velocidad de 29,97 frames por segundo. El bit rate se configuró a 4 Mbps y el preprocesamiento de video tuvo activa la opción forzar el desentrelazado bob. Las opciones de audio se ajustaron a una velocidad de muestra de 48 kHz y bit rate de 128 kbps. La salida fue por difusión en el puerto 8082. Los resultados de transcoding fueron satisfactorios, el uso del CPU osciló entre 20% y 50% para 60 segundos de monitoreo. El dispositivo cumplió los requerimientos para ser utilizado como parte de la solución en la presente investigación. 4.2.2.5 Transcoding de Contenido Pregrabado El formato de encapsulación de entrada del contenido pregrabado fue MKV. La resolución de entrada estuvo entre el rango de 480p a 1080p dependiendo de la película. Algunos formatos estaban en 3D con doble pantalla (izquierda y derecha), por lo que fue necesario trabajar por separado el flujo de video y el de audio. La Figura 4.18 muestra un ejemplo del formato 3D doble pantalla. Figura 4.18: Imagen 3D Doble Pantalla (Izquierda-Derecha) El software MeGUI 2525 permite extraer del video 3D el área con el contenido deseado. Es necesario usar la opción AVS Script Creator y luego seleccionar Crop (ver Figura 4.19), para ir cortando el contenido hasta dejar una sola de las imágenes. Este 75 procedimiento llevó mucha carga de procesamiento en la CPU, llegando al 100% durante su ejecución en el Servidor B. Figura 4.19: Opción AVS Script Creator de MeGUI 2525 La salida contiene el flujo de video únicamente, por lo que es necesario extraer el audio con el software MKVExtractGUI. El procedimiento es bastante sencillo ya que esta aplicación es capaz de identificar todo el contenido encapsulado (video, audio y subtítulos) y extraerlo. Finalmente, se utiliza el software MKVToolNix GUI que es capaz de multiplexar el audio y el video uniéndolos en un mismo flujo y encapsulando todo en el formato MKV. Una vez que todo el contenido pregrabado está en el formato de encapsulación MKV se realiza el transcoding al formato más adecuado para la transmisión por la red. Según la investigación realizada, el formato de salida más adecuado para la red es el M2TS. 4.2.3 Servidor Multicast El servidor multicast utilizado para la transmisión de streaming de televisión fue escogido según las experiencias adquiridas en un ambiente de pruebas local. Debido a la falta de inversión en recursos de hardware, todos los servicios se ejecutan en un solo computador. Las exigencias de las aplicaciones demandan alto procesamiento, memoria y almacenamiento en disco, por lo que se decidió escoger al Servidor B (mencionado en la sección 4.2) para prestar los servicios. Para la implementación de un servidor multicast se debe considerar:  Capacidad del Procesador y Número de Procesadores.  Origen del contenido.  Ancho de Banda.  Memoria del Sistema. El origen del contenido puede ser estático, contenido pregrabado. Se recomienda evitar almacenar los archivos de contenido multimedia en el mismo disco duro donde se instaló el sistema operativo del servidor multicast. 76 Cuando el origen del contenido es remoto se debe usar las interfaces de red dedicadas para la entrada y salida del tráfico. Además, las interfaces de red deben soportar transferencias full-duplex. El monitoreo del trafico con herramientas como Wireshark no es recomendado mientras el servidor esta en producción ya que consume muchos recursos del hardware. Inicialmente se implementó el servidor multicast con WMS. Durante las pruebas el resultado fue satisfactorio y el servicio funcionaba con la aplicación del cliente soportando la transmisión con el plugin en el navegador de WMP (Windows Media Player). Seguidamente se observó que varias computadoras que se estaban instalando en la Facultad de Ciencias tenían el sistema operativo Windows N, éste último no incluye el reproductor WMP. Era necesario entonces hacer la instalación de la característica WMP como un paso adicional por parte del cliente. El Centro de Computación de la Facultad de Ciencias tiene planificado ejecutar una migración masiva hacia Linux. Así que, se decidió implementar el servidor multicast con VLC Player que tiene soporte en Linux. Una ventaja adicional de este cambio en el servidor multicast es que Windows y MAC OS X también soportan VLC Player. Finalmente ésta implementación del servidor multicast representa una propuesta según las experiencias adquiridas durante la investigación. 4.2.3.1 Servidor con Windows Media Services Aunque el servidor con WMS no parece la mejor opción para implementar el servicio de televisión en la Facultad de Ciencias, igualmente se realizaron pruebas con el mismo. La instalación del Servicio de WMS se realiza agregando la característica como un componente adicional en Windows Server 2008. Es necesario contar con el DVD de instalación del sistema operativo. La versión de sistema operativo Windows Server 2008 resulta más robusta que su antecesor Windows Server 2003. Antes de poder transmitir contenido se debe comunicar a los usuarios que el mismo se encuentra disponible, e informar a los reproductores los parámetros necesarios para poder conectarse e interpretar de manera correcta el contenido. La comunicación con los clientes se hace mediante la red social twitter como se explica en la sección 4.2.5 y la información que necesitan los reproductores para encontrar el flujo multicast se entrega por medio de un archivo de información de multidifusión (archivos de extensión nsc). Un archivo de información de multidifusión posee básicamente la siguiente información:  Dirección IP de multidifusión.  Puerto de multidifusión.  Período de vida (TTL).  Intervalo de corrección de errores predeterminado.  Formatos de secuencia usados por el contenido que se entrega. Esta información viene codificada y sólo puede ser decodificada por reproductores de WMP. Otra configuración importante en el servidor multicast son los puntos de publicación mostrados en la Figura 4.20, es decir, el medio por el cual se distribuye el contenido (archivos de audio, video, etc.) a los usuarios. 77 Figura 4.20: Puntos de Publicación en WMS Al momento de definir un punto de publicación se debe indicar un origen del contenido, este origen puede ser un archivo, un directorio, una lista de reproducción, un codificador o un punto de publicación remoto como se muestra en la Figura 4.21. Para enviar la señal de televisión integrada al Microsoft Expression Encoder se utilizó como origen la opción codificador. Figura 4.21: Formatos de Origen en WMS Para el contenido pregrabado se utilizó una lista de reproducción, la cual no es más que un archivo que hace referencia a piezas de contenido digital y permite organizarlos. La ventaja de utilizar como origen una lista de reproducción es que permite tener control sobre el orden de la reproducción, como por ejemplo, indicar que se desea reproducir aleatoriamente los archivos seleccionados. 78 WMS tiene soporte de entrada para los formatos de video .asf, .wma, .wmv y .wm y para metarchivos .asx, .wax, .wvx, .wpl. Generalmente los videos deben encapsularse mediante el servidor de transcoding en los formatos soportados. Luego pueden ser almacenados en un lugar de fácil acceso para el servidor multicast. Finalmente el servicio entra en producción con el inicio del punto de publicación, para lo cual WMS asigna una dirección IPv4 e IPv6 multicast de alcance administrativo. 4.2.3.2 Servidor con VLC Player El servidor multicast utilizado con el reproductor VLC Player fue el Servidor B. La señal de televisión adquirida por el servidor de transcoding es a tiempo real y obliga a codificar en el formato de encapsulación de Microsoft (.wmv). Sin embargo, VLC Player puede nuevamente aplicar transcoding para tener una salida M2TS, dado que es más fácil transportar por la red este tipo de formato. Los parámetros que utiliza VLC Player para emitir una señal a tiempo real desde un servidor de transcoding utilizando multicast son los que se muestran en la Figura 4.22. VLC Player tiene incorporado un wizard que facilita la creación de esta cadena de salida. En el wizard de VLC Player es necesario seleccionar la opción Stream, luego Network e incluir allí el URL correspondiente a la dirección IP y el puerto del servidor de transcoding. Figura 4.22: Parámetros para Multicast con Tiempo Real en VLC Player Para el caso en que desea transmitirse el contenido pregrabado debe introducirse el directorio que contiene las películas. También hay que ingresar a la opción Stream, luego Network e incluir allí el URL correspondiente al directorio de películas, siguiendo el formato que se muestra en la Figura 4.23. Figura 4.23: URL para Multicast de Contenido Pregrabado en VLC Player Cuando la transmisión multicast ha iniciado es necesario seleccionar en el cuadro de controles de VLC Player la opción loop one que se refiere a repetir el directorio constantemente (ver la Figura 4.24). 79 Figura 4.24: Activar Loop One en VLC Player Ya que hay seis canales de televisión (contenido pregrabado y señal en vivo) se necesitan seis instancias de VLC Player (una por cada streaming) para transmitir el servicio por la red. Esto representa un consumo en ancho de banda de 32 Mbps en promedio por 60 segundos de monitoreo de red (ver Figura 4.25). Figura 4.25: Ancho de Banda de Envío en Multicast con Seis Canales de Televisión El consumo de CPU también representa un valor importante dado que el servidor multicast realiza transcoding de la señal en vivo que recibe desde Microsoft Expression Encoder. Adicionalmente VLC Player requiere procesar el encapsulamiento M2TS para armar los ES que van a ser enviados por la red. Todo el envío de multicast desde el servidor se hace a través del protocolo UDP soportado por VLC Player. El consumo de CPU se muestra en la Figura 4.26, se puede observar que el valor reflejado no llega al 100% por lo que sería posible emitir más canales de televisión. 80 Figura 4.26: Consumo de CPU en Multicast con Seis Canales de Televisión 4.2.4 Infraestructura de Red La infraestructura de red utilizada en la Facultad de Ciencias cuenta con routers y switches marca Cisco. El servicio de televisión trabaja actualmente con IGMPv2. Es posible mejorar las características de multicast utilizando IGMPv3, pero para ello todos los routers participantes deben trabajar con IGMPv3. El comando a introducir en un router marca Cisco es el que se muestra en la Figura 4.27. Figura 4.27: Comando Cisco para Habilitar IGMPv3 Un beneficio de IGMPv3 es admitir solamente fuentes específicas en la transmisión multicast, es de allí que se conoce cuál es la debilidad de IGMPv2. La reproducción de un streaming puede ser intervenida en su flujo normal por cualquier otra fuente que inyecte paquetes sobre un grupo multicast que no le pertenece. Si el flujo es también de televisión, las imágenes de video y el audio se intercalan durante la reproducción del streaming. Así pues, sería ideal incluir en los routers el soporte a IGMPv3 y que la aplicación VLC player ejecute un Join al grupo multicast especificando la fuente, sin embargo, no se conoce esta característica en el reproductor de video. También se necesita un protocolo para el enrutamiento de los paquetes multicast desde el origen hasta los destinos, para esto se recurrió a PIM-SM. PIM-SM necesita de un protocolo de enrutamiento unicast subyacente que colabore en la creación los árboles de distribución multicast. El protocolo utilizado fue EIGRP, ambos protocolos son los utilizados actualmente en la red de datos de la UCV [4]. Los switches que tienen habilitado IGMP Snooping deben tener soporte para IGMPv3, de lo contrario no reconocerán el mensaje y los descartarán. Se puede forzar el sistema operativo del servidor a utilizar IGMPv2. En el caso de Windows es necesario agregar la 81 llave de registro DWORD IGMPVersion = 3, para ello es necesario ubicar la ruta en el registro que se muestra en la Figura 4.28, para habilitar IGMPv2. Figura 4.28: Llave de Registro para Habilitar IGMPv2 en Windows En el caso de Linux se requiere autenticarse como root e introducir el comando mostrado en la Figura 4.29. Figura 4.29: Comando para Habilitar IGMPv2 en Linux 4.2.5 Aplicación de los Clientes Los clientes del servicio de televisión acceden a través de una página web. El enlace es tv.ciens.ucv.ve y el nombre de la página es CienciasTV. Las tecnologías de desarrollo utilizadas fueron: HTML5, PHP, CSS (Cascading Style Sheets), JavaScript, JQuery, Ajax y MySQL. La metodología de desarrollo empleada para la página web CienciasTV fue eXtreme Programming ya que hubo bastantes cambios y adaptaciones efectuadas durante la marcha y así fue adaptándose a los objetivos del presente Trabajo Especial de Grado. La simplicidad es base en el eXtreme Programming, se simplifica el diseño para agilizar el desarrollo y facilitar el mantenimiento. Un diseño complejo del código junto a sucesivas modificaciones por parte de diferentes desarrolladores hace que la complejidad aumente exponencialmente. Un aspecto importante a señalar es el segmento de código utilizado para incorporar el plugin de VLC Player en el navegador. La sentencia de código a incorporar se muestra en Figura 4.30, que corresponde a una etiqueta tipo embed. Los elementos tipo embed representan un punto de integración para una aplicación externa o de contenido interactivo. Figura 4.30: Etiqueta HTML para VLC Plugin El atributo más importante es el campo type, ya que define el elemento a incrustar según el estándar MIME (Multipurpose Internet Mail Extensions). El API de desarrollo de VLC se conoce como NPAPI (Netscape Plugin Application Programming Interface). El soporte de NPAPI para navegadores como Chrome y Opera representan problemas de seguridad para el usuario, ya que se puede obtener acceso sin restricciones a la máquina local. Ambas compañías deciden inhabilitar el complemento y desde septiembre del 2015 no se permite la ejecución en el navegador Chrome. Sin embargo, el navegador Internet Explorer, Mozilla Firefox y Safari aun lo soportan. Para la ejecución del VLC Player el equipo cliente debe poseer las siguientes características mínimas:  Sistema Operativo Windows XP SP2 o superior.  VLC Player versión 2.1 o superior, con los complementos web instalados. 82  Navegadores:  Mozilla Firefox versión 4 o superior.  Safari versión 5 o superior. Si la aplicación hubiera sido implementada con WMS la información contenida en los archivos de información de multidifusión (archivos .nsc) sólo podrían ser decodificados por reproductores Windows Media Player. El equipo cliente tendría que poseer las siguientes características mínimas:  Sistema Operativo Windows XP SP2 o superior.  Windows Media Player versión 9 o superior.  Navegadores:  Internet Explorer versión 7 o superior.  Mozilla Firefox versión 4 o superior, además se requiere el plugin de Windows Media Player instalado para poder ejecutar el componente.  Safari versión 5 o superior.  Opera versión 32. Los casos de uso permiten definir los requerimientos funcionales del sistema. Desde el punto de vista del usuario, un caso de uso determina el comportamiento de un requerimiento y es un modelo adecuado para presentar las funcionalidades del sitio web. El actor que interactúa con el sistema es:  Visitante: Consta de aquellos usuarios que ingresan al sitio web de CienciasTV a interactuar con las distintas secciones del mismo. La Tabla 4.4 muestra los casos de uso asociados al sitio web tv.ciens.ucv.ve (CienciasTV). Código Caso de Uso Actor 1.1 Especifica el ingreso del usuario a la sección Inicio. Visitante 1.2 Especifica el ingreso del usuario a la sección Televisión. Visitante 1.3 Especifica el ingreso del usuario a la sección Ayuda. Visitante 1.4 Especifica el ingreso del usuario al envío de mensajes en twitter. Visitante 1.5 Especifica el ingreso del usuario para hacer tweet de CienciasTV en twitter. Visitante 1.6 Especifica la gestión de la configuración del reproductor VLC. Visitante 1.7 Especifica el ingreso del usuario al canal de televisión maximizado. Visitante 1.8 Especifica el ingreso del usuario a la sección de ayuda para Linux. Visitante 1.9 Especifica el ingreso del usuario a la sección de ayuda para Windows. Visitante Tabla 4.4: Casos de Uso de CienciasTV El visitante tiene asociado el diagrama de casos de uso mostrado en la Figura 4.31. 83 Figura 4.31: Diagrama de Casos de Uso del Cliente de CienciasTV La explicación detallada de los casos de uso se presenta en las tablas a continuación. 1.1 Ver Inicio Nombre: Ver Inicio. Descripción: Se ingresa a la sección Inicio, es indispensable que se haga clic sobre el botón Inicio. Requerimiento: Contar con una sección Inicio accedida mediante un botón. Precondición: Haber accedido al sitio web tv.ciens.ucv.ve, y que el contenido se haya cargado por completo. Flujo Normal: Se muestra el contenido de la sección Inicio, se da la bienvenida al visitante y se informa sobre los requerimientos mínimos de software. Actor: Sistema: 1. El visitante hace clic en el botón Inicio. 3. El visitante visualiza el texto de bienvenida y los requisitos de software. 2. Se abre el contenido en la página. Flujo Alterno: El navegador muestra un mensaje de error en la carga de la página. Actor: Sistema: 1.1 El visitante hace clic en el botón Inicio. 3.1 El visitante visualiza un mensaje de error. 2.1 No es posible cargar la página y devuelve un mensaje de error. Postcondición: Despliegue del texto referente a la bienvenida del servicio y sus requisitos de software. Requerimientos Especiales: 1. Entrada al navegador en correcto 84 funcionamiento. Puntos de Extensión: 1. Se escribe en twitter. 2. Se hace tweet en twitter. Tabla 4.5: Descripción de Caso de Uso Ver Inicio 1.2 Ver Televisión Nombre: Ver Televisión. Descripción: Se ingresa a la sección Televisión, es indispensable que se haga clic sobre el botón Televisión. Requerimiento: Contar con una sección Televisión accedida mediante un botón. Precondición: Haber accedido al sitio web tv.ciens.ucv.ve, y que el contenido se haya cargado por completo. Instalar el plugin de VLC en el navegador web. Los URLs del streaming multicast y el nombre del streaming deben estar cargados en la base de datos. Flujo Normal: Se muestra el contenido de la sección Televisión, se muestran cuatro canales de televisión que capturan el streaming multicast correspondiente de la red. Actor: Sistema: 1. El visitante hace clic en el botón Televisión. 3. El visitante visualiza los seis canales presentes en la página. 2. Se abre el contenido en la página. Flujo Alterno: El navegador muestra un mensaje de error en la carga de la página. Actor: Sistema: 1.1 El visitante hace clic en el botón Televisión. 3.1 El visitante visualiza un mensaje de error. 2.1 No es posible cargar la página y devuelve un mensaje de error. Postcondición: Despliegue de los seis canales de televisión. Requerimientos Especiales: 1. Entrada al navegador en correcto funcionamiento. 2. Instalación del plugin de VLC. Puntos de Extensión: 1. Se selecciona el botón ampliar. 2. Se escribe en twitter. 3. Se hace tweet en twitter. Tabla 4.6: Descripción de Caso de Uso Ver Televisión 1.3 Ver Ayuda Nombre: Ver Ayuda. Descripción: Se ingresa a la sección Ayuda, es indispensable que se haga clic sobre el botón Ayuda. Requerimiento: Contar con una sección Ayuda accedida 85 mediante un botón. Precondición: Haber accedido al sitio web tv.ciens.ucv.ve, y que el contenido se haya cargado por completo. Flujo Normal: Se muestra el contenido de la sección Ayuda, se muestran dos botones para seleccionar la ayuda deseada según el sistema operativo. Actor: Sistema: 1. El visitante hace clic en el botón Ayuda. 3. El visitante visualiza dos botones para seleccionar según su requerimiento. 2. Se abre el contenido en la página. Flujo Alterno: El navegador muestra un mensaje de error en la carga de la página. Actor: Sistema: 1.1 El visitante hace clic en el botón Ayuda. 3.1 El visitante visualiza un mensaje de error. 2.1 No es posible cargar la página y devuelve un mensaje de error. Postcondición: Despliegue de los dos botones de ayuda. Requerimientos Especiales: 1. Entrada al navegador en correcto funcionamiento. Puntos de Extensión: 1. Se escribe en twitter. 2. Se hace tweet en twitter. Tabla 4.7: Descripción de Caso de Uso Ver Ayuda 1.4 Escribir en Twitter Nombre: Escribir en twitter Descripción: Se envía un mensaje de texto (tweet) desde el widget de la página principal. Este mensaje es enviado desde la cuenta de twitter del visitante. Requerimiento: El soporte JavaScript debe estar habilitado. Precondición: Haber accedido al sitio web tv.ciens.ucv.ve y autenticarse en twitter. Flujo Normal: Se envía un tweet a la cuenta @UCVCienciasTV una vez que el visitante se autentique en twitter. Actor: Sistema: 1. El visitante hace clic en el widget y se autentica. 3. El visitante escribe un tweet. 2. El sistema verifica que sea un usuario válido. 4. El sistema envía el mensaje a @UCVCienciasTV. Flujo Alterno: El navegador muestra un mensaje de error en la carga del widget. Actor: Sistema: 1.1 El visitante hace clic en el widget. 3.1 El visitante visualiza un mensaje de error. 2.1 No es posible cargar el widget y devuelve un mensaje de error. Postcondición: Se actualizará el estado del usuario con el 86 tweet escrito. Requerimientos Especiales: Entrada al navegador con JavaScript habilitado. Autenticación del visitante en twitter. Puntos de Extensión: 1. Se envía un tweet adicional. 2. Se selecciona follow en twitter. Tabla 4.8: Descripción de Caso de Uso Escribir en Twitter 1.5 Hacer Tweet Nombre: Hacer tweet. Descripción: Se muestra un mensaje de texto en una ventana adicional para hacer tweet de CienciasTV. Este mensaje es enviado desde la cuenta del usuario de twitter. Requerimiento: El soporte JavaScript debe estar habilitado. Precondición: Haber accedido al sitio web tv.ciens.ucv.ve y autenticarse en twitter. Flujo Normal: Se muestra el icono de twitter con el número de tweets realizados por parte de los visitantes. El visitante puede hacer tweet dando publicidad a CienciasTV a través de twitter. Actor: Sistema: 1. El visitante hace clic en el botón tweet y se autentica. 3. El visitante visualiza el incremento de los tweets. 2. El sistema verifica que sea un usuario válido e incrementa un tweet publicitando a CienciasTV. Flujo Alterno: El navegador muestra un mensaje de error en la carga de la página. Actor: Sistema: 1.1 El visitante hace clic en el botón tweet. 3.1 El visitante visualiza un mensaje de error. 2.1 No es posible cargar la página y devuelve un mensaje de error. Postcondición: Incremento del contador de tweets. Requerimientos Especiales: Entrada al navegador con JavaScript habilitado. Autenticación del visitante en twitter. Puntos de Extensión: 1. Se escribe en twitter. 2. Se selecciona follow en twitter. Tabla 4.9: Descripción de Caso de Uso Hacer Tweet 1.6 Cambiar configuración de VLC Nombre: Cambiar configuración de VLC. Descripción: Este caso de uso brinda la posibilidad al usuario de gestionar la visualización de la película utilizando los controles de reproducción. Es indispensable que se haga clic sobre los botones de control que proporciona VLC según la opción a aplicar. 87 Requerimiento: Instalar el plugin de VLC en el navegador. Precondición: Haber accedido al sitio web tv.ciens.ucv.ve, y que el contenido se haya cargado por completo. Instalar el plugin de VLC. Los URLs del streaming multicast y el nombre del streaming deben estar cargados en la base de datos. Flujo Normal: Se manejan exitosamente los botones de control del reproductor VLC. Actor: Sistema: 1. El visitante hace clic en un botón de control. 2. Se efectúa el cambio en la transmisión de la película. Flujo Alterno: El plugin de VLC no está activado en el navegador. Actor: Sistema: 1.1 El visitante no visualiza el canal de televisión. 3.1 El visitante visualiza el mensaje de activación de VLC. 2.1 La página indica que se debe activar el plugin de VLC. Postcondición: Despliegue de los botones. Requerimientos Especiales: Entrada al navegador en correcto funcionamiento. Instalación del plugin de VLC. Los URLs del streaming multicast deben estar cargados en la base de datos. Puntos de Extensión: 1. Se selecciona otro botón del reproductor. 2. Se escribe en twitter. 3. Se hace tweet en twitter. Tabla 4.10: Descripción de Caso de Uso Cambiar Configuración de VLC 1.7 Maximizar Canal Nombre: Maximizar Canal. Descripción: Se ingresa a la sección Maximizar Canal, es indispensable que se haga clic sobre el botón Maximizar. Requerimiento: Contar con una sección Maximizar Canal accedida mediante un botón. Precondición: Haber accedido al sitio tv.ciens.ucv.ve, y que el contenido se haya cargado por completo. Que el contenido del canal esté cargado en la base de datos. Flujo Normal: Se muestra el contenido de la sección Maximizar Canal, se despliega la programación existente. Actor: Sistema: 1. El visitante hace clic en el botón Maximizar. 3. El visitante visualiza el canal y la programación existente. 2. Se abre el contenido en la página. 88 Flujo Alterno: El navegador muestra un mensaje de error en la carga de la página. Actor: Sistema: 1.1 El visitante hace clic en el botón Maximizar. 3.1 El visitante visualiza un mensaje de error. 2.1 No es posible cargar la página y devuelve un mensaje de error. Postcondición: Despliegue del canal seleccionado y de su programación. Requerimientos Especiales: 1. Entrada al navegador en correcto funcionamiento. 2. Que el contenido del canal esté cargado en la base de datos. Puntos de Extensión: 1. Se selecciona de la lista de programación el contenido del canal y su descripción. 2. Se escribe en twitter. 3. Se hace tweet en twitter. Tabla 4.11: Descripción de Caso de Uso Maximizar Canal 1.8 Ver Ayuda Linux Nombre: Ver ayuda Linux. Descripción: Se ingresa a la sección Ayuda para Linux, es indispensable que se haga clic sobre el botón de Ayuda para Linux. Requerimiento: Contar con una sección Ayuda para Linux accedida mediante un botón. Precondición: Haber accedido al sitio tv.ciens.ucv.ve, y que el contenido se haya cargado por completo. Flujo Normal: Se muestra el contenido de la sección Ayuda para Linux. Actor: Sistema: 1. El visitante hace clic en el botón Ayuda para Linux. 3. El visitante visualiza el contenido en la página. 2. Se abre el contenido en la página. Flujo Alterno: El navegador muestra un mensaje de error en la carga de la página. Actor: Sistema: 1.1 El visitante hace clic en el botón Ayuda para Linux. 3.1 El visitante visualiza un mensaje de error. 2.1 No es posible cargar la página y devuelve un mensaje de error. Postcondición: Se finaliza la carga de la sección. Requerimientos Especiales: Entrada al navegador en correcto funcionamiento. Puntos de Extensión: 1. Se escribe en twitter. 2. Se hace tweet en twitter. Tabla 4.12: Descripción de Caso de Uso Ver Ayuda Linux 89 1.9 Ver Ayuda Windows Nombre: Ver ayuda Windows. Descripción: Se ingresa a la sección Ayuda para Windows, es indispensable que se haga clic sobre el enlace de “Windows”. Requerimiento: Contar con una sección Ayuda para Windows accedida mediante un botón. Precondición: Haber accedido al sitio tv.ciens.ucv.ve, y que el contenido se haya cargado por completo. Flujo Normal: Se muestra el contenido de la sección Ayuda para Windows. Actor: Sistema: 1. El visitante hace clic en el enlace Ayuda para Windows. 3. El visitante visualiza el contenido en la página. 2. Se abre el contenido en la página. Flujo Alterno: El navegador muestra un mensaje de error en la carga de la página. Actor: Sistema: 1.1 El visitante hace clic en el enlace Ayuda para Windows. 3.1 El visitante visualiza un mensaje de error. 2.1 No es posible cargar la página y devuelve un mensaje de error. Postcondición: Se finaliza la carga de la sección. Requerimientos Especiales: Entrada al navegador en correcto funcionamiento. Puntos de Extensión: 1. Se escribe en twitter. 2. Se hace tweet en twitter. 3. Se descarga VLC para Windows. Tabla 4.13: Descripción de Caso de Uso Ver Ayuda Windows La base de datos implementada es inicialmente pequeña en su estructura, pero tiene una enorme importancia en la ejecución de la aplicación del cliente. Los datos de cada canal son almacenados en una tabla llamada Stream, es allí donde la página web consulta la cantidad de registros almacenados y muestra la previsualización de todos los canales al usuario. El plugin web de VLC Player recibe los URLs de la tabla Stream. Existe también un identificador único por cada canal que está relacionado como campo clave con las otras tablas, dicho campo se llama id_streaming, permite también dar dinamismo a la página web agregando y borrando canales según sea necesario Las otras dos tablas se llaman Películas y Television, contienen la descripción del contenido pregrabado transmitido y de la señal obtenida del codificador respectivamente. El campo llamado url_fotos se refiere a la ruta relativa donde se encuentra la imagen mostrada en la descripción con respecto a la página web. El campo hastag almacena la información que permite identificar al canal ó película con la red social twitter. Es un mecanismo por mediante el cual el usuario podrá comunicarse usando el widget incorporado en la página web. 90 Finalmente se muestra en la Figura 4.32 el diagrama entidad relación correspondiente a la base de datos de CienciasTV. Figura 4.32: Diagrama Entidad-Relación de CienciasTV Es importante acotar que inicialmente la tecnología empleada fue con Windows Media Player. Esto brindaba soporte con C#, incorporando previamente el módulo wmp.dll al código. Se realizó el experimento con multicast y el resultado fue satisfactorio. El flujo multicast podía capturarse perfectamente con una aplicación desarrollada en este lenguaje e incrustando el Windows Media Player. Sin embargo, más adelante se decidió cambiar por el reproductor VLC debido a la compatibilidad que tiene con distintos sistemas operativos, por lo que el código de C# quedó en desuso. Las capturas de pantalla a continuación muestran el contenido de la página CienciasTV. Figura 4.33: Pantalla de Bienvenida a CienciasTV 91 Figura 4.34: Previsualización de Canales en CienciasTV Figura 4.35: Maximización de un Canal en CienciasTV 92 93 5. Conclusiones Desde sus inicios, la televisión ha sido el mayor entretenimiento de millones de personas. Internet concentra millones de redes alrededor del mundo, multicast muestra una solución viable para transmitir contenidos audiovisuales por este medio. Existen diferencias entre IPTV y televisión por Internet. IPTV es implementado por compañías que buscan introducir un servicio de televisión en un mercado privado cuyos receptores comúnmente son Set Top Boxes. Los medios de transmisión de IPTV están en una red privada que puede ser cableada o satelital, mientras que la televisión por Internet se muestra en navegadores web o aplicaciones interactivas que son ejecutadas en computadores con acceso a Internet. El uso de sistemas propietarios en la recepción de contenidos es el mayor obstáculo para reducir costos de televisión digital. Si bien algunos formatos de transporte son estándares abiertos, sus componentes y sistemas de comunicación son casi siempre propietarios. La televisión por Internet es altamente escalable utilizando multicast, además que es muy flexible en permitir la entrada y salida de usuarios para acceder a los contenidos. Las políticas de calidad de servicio aplicadas en la red juegan un papel importante durante la transmisión. Existen protocolos en capa de aplicación como RTP y RTSP que optimizan el uso del ancho de banda, buscando garantizar también la sincronía del flujo de datos multimedia pero con multicast no muestran los mejores resultados. En las redes locales, protocolos como IGMP permiten la gestión de grupos multicast y ha ido evolucionando constantemente agregando seguridad, escalabilidad y optimizando recursos de la red. En Internet es un poco más complicado enviar datos por multicast, ya que utiliza protocolos de enrutamiento basados en árboles que pueden sobrecargar la red. La distribución puede hacerse asumiendo que todos quieren recibir el flujo de datos y luego ir podando a quienes lo rechacen (PIM-DM), o solicitar ingresar a un grupo a través de un Rendezvous Point que concentra la información de quienes transmiten y quienes reciben el flujo de datos (PIM-SM). Existe hardware especializado que en capa de enlace puede reconocer paquetes IGMP, a esto se le conoce como IGMP Snooping. Los switches Cisco pueden hacer algo similar manejando el protocolo CGMP. La TDA que en sus inicios no tuvo gran impacto en el mercado, hoy comienza a tomar terreno, ya que los costos de producción de su tecnología han ido disminuyendo. Se han realizado mejoras sustanciosas de los estándares y otros nuevos han aparecido. Latinoamérica parece advocarse a ISDB-T, y Brasil desarrolló su propio estándar mejorando la codificación de video de MPEG-2 a MPEG-4 llamándolo ISDB-Tb. La calidad de audio también es mejorada por medio de la compresión HE-AAC (High- Efficiency Advanced Audio Coding). En el caso de Venezuela, el estándar adoptado es ISDB-Tb, que originalmente nació en Japón pero fue mejorado por Brasil. La compañía CANTV está implementando a nivel nacional la televisión digital abierta (compuesta por TDT, TDH). Los televidentes reciben una señal de alta calidad de imagen y sonido codificado en MPEG-4, similar a la que se experimenta con un DVD. La señal digital no se limita sólo a los hogares, llega también a equipos celulares, y tablets que tengan un receptor ISDB-Tb, ampliando así la posibilidad en el desarrollo de contenidos exclusivos para dispositivos móviles. 94 En la Facultad de Ciencias, transmitir señal de televisión por la red tiene un impacto significativo para la comunidad universitaria. Se abre así las puertas al T-Learning, que refiere al aprendizaje a distancia utilizando aulas virtuales. El formato de encapsulamiento más apropiado para enviar streamings por red fue M2TS. Sin embargo, las capturadoras de televisión fueron sometidas a un proceso de doble transcoding donde el servidor multicast tuvo que codificar de WMV a TS con VLC Player. Cabe destacar que VLC Player no encapsula M2TS. El otro caso es utilizar un servidor multicast con WMS ya que su formato de encapsulamiento dio muy buenos resultados. Es necesario tener un servidor de transcoding dedicado, ya que los requisitos de hardware son elevados para procesar una buena calidad de imagen de video. El servidor multicast también debe estar dedicado al envío del streaming, por lo que, el ancho de banda de red debe ser lo más elevado posible. Las capturadoras aconsejadas para equipos HDTV deben tener soporte HDMI, comúnmente son utilizadas para grabar juegos de XBOX o PlayStation con muy altas prestaciones en calidad de imagen. Los clientes pueden aprovechar las ventajas de la etiqueta video en HTML5 si se construye un servicio con sockets UDP multicast que sea capaz de integrarse con IGMP y entregar el flujo en un source que la etiqueta video reconozca. Éste es un aspecto importante porque no sería necesario el plugin incrustado en el navegador. Es importante destacar que la capacidad de captura depende mucho de la compatibilidad de los dispositivos con el sistema operativo y sus librerías DirectX. Los antecedentes al presente proyecto ayudaron a escoger los diferentes sintonizadores de televisión y a explorar las nuevas tendencias de transmisión de las señales de televisión. Los formatos de encapsulación y codecs facilitaron el transporte de streamings multicast, sin embargo, no hubo un protocolo de calidad de servicio que se adaptara a la solución propuesta. Finalmente, se definió la infraestructura necesaria para colocar en producción el servicio de televisión con multicast y se implementó como una solución para las redes de la Facultad de Ciencias. 95 Recomendaciones  Para explotar las capacidades de multicast la infraestructura propuesta permite implementar soluciones en el área de enseñanza (T-Learning), video vigilancia y conferencias por la red de la Facultad de Ciencias.  Las webcams en su mayoría poseen buena compatibilidad con DirectX y son de bajo costo por lo que se recomiendan como dispositivos de captura.  Las capturadoras de televisión recomendadas para adquirir la señal de los decodificadores CANTV deben tener soporte HDMI, tales como:  Colossus con WinTV v7 01412.  Thanko HDMI Video Capture Card HDMVC4UC.  Es posible hacer una implementación del servicio sobre IPv6 ya que las herramientas utilizadas lo soportan.  El hardware de los servidores implementados en la solución puede ubicarse en una dependencia de la universidad donde los enlaces tengan mayor ancho de banda, siempre y cuando exista el soporte multicast.  Toda facultad o dependencia de la universidad interconectada con equipos que soporten PIM-SM pueden activar y disfrutar el servicio.  La cuenta @UCVCienciasTV de la solución propuesta puede integrarse a otras redes sociales como Instagram o Facebook. Se necesita alguien que las administre constantemente para publicar contenidos. 96 97 Referencias Bibliográficas [1] W. Stalling. Data and Computer Communications. Prentice Hall. 9th Edition. August 2010. [2] S. Bradner and A. Mankin. The Recommendation for the IP Next Generation Protocol, RFC 1752, January 1995. [3] J. Postel. Internet Protocol. RFC 791. September 1981. [4] A. Sánchez. Propuesta para la Implementación de un Servidor de Hilos Musicales utilizando IPv6 Multicast. Universidad Central de Venezuela. Julio 2010. [5] S. Deering. Host Extensions for IP Multicasting. RFC 1112. August 1989. [6] W. Fenner. Internet Group Management Protocol Version 2. RFC 2236. November 1997. [7] M. Escobar y J. Treminio. Estudio de IP/TV Multicasting para la Universidad Don Bosco. Enero 2007. [8] J. Petisme and L. Teng. Design and Implementation of a Live TV Server using Open-Sourced Tools. In proceedings to 9th National Undergraduate Research Opportunities Programme Congress, Nanyang Technological University. September 2003. [9] The Computing Center in University of Oregon. IP/TV Brings the World to your Screen. Computing News, Vol. 12(6). May 1997. [10] J. Reynolds and J. Postel. Assigned Numbers. RFC 1700. October 1994. [11] M. Cotton and L. Vegoda. Special Use IPv4 Addresses. RFC 5735. January 2010. [12] B. Cain, S. Deering, I. Kouvelas, B. Fenner, and A. Thyagarajan. Internet Group Management Protocol Version 3. RFC 3376. October 2002. [13] S. Deering. Host Extensions for IP Multicasting. RFC 988. July 1986. [14] D. Katz. IP Router Alert Option. RFC 2113. February 1997. [15] S. Bhattacharyya. An Overview of Source Specific Multicast (SSM). RFC 3569. July 2003. [16] Javvin Tecnologies. Network Protocols Handbook. 2nd Edition. January 2005 [17] P. Savola. Overview of the Internet Multicast Routing Architecture. RFC 5110. January 2008. [18] A. Adams, J. Nicholas, and W. Siadak. Protocol Independent Multicast – Dense Mode (PIM-DM). RFC 3973. January 2005. [19] B. Fenner, M. Handley, H. Holbrook, and I. Kouvelas. Protocol Independent Multicast – Sparse Mode (PIM-SM). RFC 4601. August 2006. [20] B. Williamson. Developing IP Multicast Networks. 1st. Ed., Cisco Press. October 1999. [21] N. Bhaskar, A. Gall, J. Lingard, and S. Venaas. Bootstrap Router (BSR) Mechanism for Protocol Independent Multicast (PIM). RFC 5059. January 2008. [22] M. Piedra. Estudio de los Mensajes de Control del Protocolo Multicast PIM-SM. Universidad Autónoma de Barcelona, Junio 2010. [23] M. Baldi and P. Nicoletti. Switched LAN. McGraw-Hill. July 2002. [24] H. Schulzrinne, S. Casner, R. Frederick, and V. Jacobson. RTP: A Transport Protocol for Real-Time Applications. RFC 3550. July 2003. [25] H. Schulzrinne and S. Casner. RTP Profile for Audio and Video Conferences with Minimal Control. RFC 3551. July 2003. [26] H. Schulzrinne, A. Rao, and R. Lanphier. Real Time Streaming Protocol (RTSP). RFC 2326. April 1998. [27] K. Islas y I. Sandoval. Tecnología de la Alta Definición en la Televisión de Alta Definición. Instituto Politécnico Nacional de Culhuacan. Marzo 2007. 98 [28] J. Cajamarca y B. Calle. Estudio de Factibilidad del Proceso de Migración de Televisión Analógica Terrestre a Televisión Digital Terrestre del Canal de Televisión Austral TV de la Ciudad de Azogues. Universidad Politécnica Salesiana de Ecuador. Mayo 2013. [29] C. Yonso. Propuesta de Tecnología IPTV para la Red de la Universidad Centroccidental Lisandro Alvarado. Julio 2012. [30] K. Rottmann. Diseño e Implementación de un Laboratorio de IPTV, Medición y Gestión. Universidad de Chile. Enero 2010. [31] M. Mayorga. La Televisión Digital Terrestre en el Perú: Contexto Actual y Políticas Públicas para su Desarrollo. Pontificia Universidad Católica del Perú. 2011. [32] D. Záratte. Diseño e Implementación de una Aplicación Interactiva para Educación a Distancia: T-Learning a Través de un Canal TDT Universitario y un Canal IPTV en la Ciudad de Lima. Pontificia Universidad Católica del Perú. Septiembre 2012. [33] J. Wroclawski. The Use of RSVP with IETF Integrated Services. RFC 2210. September 1997. [34] P. Brox, I. Baturone, S. Sánchez, J. Gutiérrez y F. Fernández. Algoritmo Adaptativo con el Grado de Movimiento para el Desentrelazado de Video. Facultad de Informática de la universidad Politécnica de Madrid. 2006. [35] A. Cabrera. HDTV sobre IP en Internet2. Facultad de Informática de la Universidad Nacional de la Plata, Argentina. Diciembre 2005. [36] J. Contreras. Estudio de Factibilidad para el Uso de un Sistema de Comunicación Multimedia Vía IP como Apoyo a la Educación a Distancia en SADPRO-UCV. Caracas 2008. [37] L. Venegas. Generación de una trama Broadcast Transport Stream (BTS) usando el software libre Opencaster. Lima, Mayo del 2012. [38] I. Ahmad. Video Transcoding: An Overview of Various Techniques and Research Issues. October 2005. [39] E. Leyton. Diseño de un Sistema De Seguridad Bajo Plataforma IP para el Campus Prosperina (Gustavo Galindo) de la Escuela Superior Politécnica Del Litoral, Facultad de Ingeniería en Electricidad y Computación, Ecuador. 2007. [40] Society of Motion Picture and Television Engineers. Proposed SMPTE Standard for Television: VC-1 Compressed Video Bitstream Format and Decoding Process. August 2005. [41] D. Meyer. Administratively Scoped IP Multicast. RFC 2365. July 1998.