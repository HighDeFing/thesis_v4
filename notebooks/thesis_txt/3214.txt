1 UNIVERSIDAD CENTRAL DE VENEZUELA FACULTAD DE CIENCIAS ESCUELA DE COMPUTACI√ìN OPCI√ìN PROFESIONAL: COMPUTACI√ìN GR√ÅFICA SEGMENTACI√ìN MULTICANAL DE TUMORES CEREBRALES EN IMAGENOLOG√çA DE RESONANCIA MAGN√âTICA CON AUT√ìMATAS CELULARES PARALELIZADOS EN GPU Trabajo Especial de Grado presentado ante la Ilustre Universidad Central de Venezuela Por el Bachiller Antonio Rueda Toicen para optar al t√≠tulo de Licenciado en Computaci√≥n Tutores: Prof. Rhadam√©s Carmona, Prof. Miguel Mart√≠n Landrove Caracas, Octubre 2013 2 Caracas, Octubre de 2013 Universidad Central de Venezuela Facultad de Ciencias Escuela de Computaci√≥n ACTA DEL VEREDICTO Quienes suscriben, Miembros del Jurado designado por el Consejo de la Escuela de Computaci√≥n para examinar el Trabajo Especial de Grado, presentado por el Bachiller Antonio Ernesto Rueda Toicen C.I.: 16971216, con el t√≠tulo ‚ÄúSEGMENTACI√ìN MULTICANAL DE TUMORES CEREBRALES EN IMAGENOLOG√çA DE RESONANCIA MAGN√âTICA CON AUT√ìMATAS CELULARES PARALELIZADOS EN GPU‚Äù, a los fines de cumplir con el requisito legal para optar al t√≠tulo de Licenciado en Computaci√≥n, dejan constancia de lo siguiente: Le√≠do el trabajo por cada uno de los Miembros del Jurado, se fij√≥ el d√≠a 29 de Octubre de 2013, a las 11 am, para que su autor lo defendiera en forma p√∫blica, en el Centro de Computaci√≥n Gr√°fica, lo cual este realiz√≥ mediante una exposici√≥n oral de su contenido, y luego respondi√≥ satisfactoriamente a las preguntas que les fueron formuladas por el Jurado, todo ello conforme a lo dispuesto en la Ley de Universidades y dem√°s normativas vigentes de la Universidad Central de Venezuela. Finalizada la defensa p√∫blica del Trabajo Especial de Grado, el jurado decidi√≥ aprobarlo. En fe de lo cual se levanta la presente acta, en Caracas el 29 de Octubre de 2013, dej√°ndose tambi√©n constancia de que actu√≥ como Coordinador del Jurado el Profesor Tutor Rhadam√©s Carmona. ___________________________ __________________________ Prof. Rhadam√©s Carmona Prof. Miguel Mart√≠n (Tutor) (Tutor) ___________________________ ___________________________ Prof. H√©ctor Navarro Prof. Carlos Acosta (Jurado Principal) (Jurado Principal) 3 RESUMEN La segmentaci√≥n de im√°genes es el proceso de particionar una imagen en m√∫ltiples conjuntos de p√≠xeles o v√≥xeles que compartan alguna caracter√≠stica visual. Existen diversos m√©todos de segmentaci√≥n, entre los cuales encontramos algunos basados en morfolog√≠a matem√°tica, contornos activos y modelos gr√°ficos probabil√≠sticos. Los m√©todos basados en aut√≥matas celulares pueden acoplarse a m√°s de uno de estos m√©todos. Entre los m√©todos de segmentaci√≥n basados en aut√≥matas celulares se encuentra el algoritmo GrowCut, el cual define una regla de aut√≥mata celular determin√≠stico que simula el crecimiento competitivo de varias colonias de bacterias cuyo territorio es el espacio de la imagen. En este trabajo se presentan nuevas reglas para este tipo de aut√≥matas, as√≠ como una metodolog√≠a para comparar su desempe√±o y calidad de segmentaci√≥n en problemas de segmentaci√≥n de tumores cerebrales para planificaci√≥n de radiocirug√≠a estereot√°ctica. Se presentan una comparaci√≥n de resultados en t√©rminos de calidad de segmentaci√≥n y tiempo de respuesta para un conjunto de reglas y distintos casos de prueba. Adicionalmente, se especifica un patr√≥n de implementaci√≥n en CUDA que aprovecha la capacidad de paralelismo inherente de los aut√≥matas celulares y un m√©todo para la selecci√≥n no supervisada de la configuraci√≥n inicial del aut√≥mata. Palabras claves: Aut√≥mata Celular, Procesamiento de Im√°genes, Segmentaci√≥n, GPU 4 CONTENIDO CAPITULO 1 - INTRODUCCI√ìN ..................................................................................................... 7 1.1 Planteamiento del Problema .................................................................................................. 8 1.2 Propuesta de Soluci√≥n ........................................................................................................... 9 1.3 Objetivo General .................................................................................................................... 9 1.4 Objetivos Espec√≠ficos ............................................................................................................ 9 CAP√çTULO 2 - MARCO TE√ìRICO ..................................................................................................11 2.1 Radiocirug√≠a Estereot√°ctica con Gamma Knife ................................................................... 13 2.1.1 Uso y Colocaci√≥n de Marco Estereot√°ctico (ME) ........................................................ 14 2.1.2 Coregistro de Im√°genes de Resonancia Magn√©tica ...................................................... 15 2.1.3 Est√°ndar DICOM .......................................................................................................... 16 2.2 Volume Rendering ............................................................................................................... 19 2.2.1 Ray Casting .................................................................................................................. 20 2.2.2 Visualizaci√≥n de Isosuperficies .................................................................................... 22 2.3 Programaci√≥n de GPU con CUDA ...................................................................................... 25 2.3.1 Modelo de Ejecuci√≥n de CUDA ................................................................................... 25 2.3.2 Jerarqu√≠a de Memoria en CUDA .................................................................................. 28 2.4 M√©tricas de Calidad de Segmentaci√≥n ................................................................................. 30 2.4.1 Verdad Fundamental a Trav√©s de TumorSim ............................................................... 33 CAP√çTULO 3 - M√âTODOS DE SEGMENTACI√ìN DE IMAGENOLOG√çA DE RESONANCIA MAGN√âTICA .................................................................................................................................... 35 3.1 Segmentaci√≥n Autom√°tica ................................................................................................... 35 3.1.1 Clustering por K-means ............................................................................................... 35 3.1.2 Segmentaci√≥n con Modelos Gr√°ficos Probabil√≠sticos .................................................. 37 3.2 Segmentaci√≥n Asistida de IRM ........................................................................................... 42 3.2.1 Crecimiento de Regi√≥n ................................................................................................. 43 3.2.2 Transformada Watershed Basada en Marcadores ......................................................... 44 3.2.3 M√©todos Basados en Contornos Activos ...................................................................... 45 3.3 Cortes en Grafos .................................................................................................................. 50 3.3.1 GrabCut ........................................................................................................................ 51 3.4 Random Walker ................................................................................................................... 53 CAP√çTULO 4 - Aut√≥matas Celulares Deterministas para Segmentaci√≥n de Im√°genes ..................... 58 4.1 Definici√≥n Formal y Entendimiento Intuitivo de Evoluci√≥n ............................................... 59 4.2 Regla GrowCut .................................................................................................................... 60 4.3 Ventajas de Implementaci√≥n y Capacidades de Paralelismo de los Aut√≥matas Celulares Deterministas .................................................................................................................................. 63 5 4.3.1 Correcci√≥n a GrowCut ................................................................................................. 64 4.3.2 Criterio de Convergencia .............................................................................................. 65 4.3.3 Variaciones en la Fuerza de Ataque .............................................................................. 66 4.3.3 AutomaClass, Configuraci√≥n No Supervisada del Estado Inicial del Aut√≥mata ......... 71 CAP√çTULO 5 - Detalles de Implementaci√≥n ..................................................................................... 76 5.1 Implementaci√≥n de Aut√≥matas Celulares Deterministas en Matlab ................................ 76 5.2 Implementaci√≥n de Aut√≥matas Celulares Deterministas en CUDA ................................ 77 5.3 Interfaz Gr√°fica para Segmentaci√≥n Asistida ................................................................... 80 CAP√çTULO 6 - PRUEBAS Y RESULTADOS .................................................................................. 82 6.1 Bounding Box de Validaci√≥n ............................................................................................... 83 6.2 Comparaci√≥n entre Criterios de Dispersi√≥n de Semillas ..................................................... 84 6.3 Comparaci√≥n de Convergencia Completa Frente a Convergencia por Criterio de Celdas Etiquetadas ..................................................................................................................................... 88 6.4 Estudio del Efecto de N√∫mero de Semillas Correctas Suministradas por el Usuario en la Calidad de Segmentaci√≥n ............................................................................................................... 93 6.5 Comparaci√≥n de Fuerza de Ataque Determinada por Distancia Manhattan contra Fuerza de Ataque Determinada por Distancia Euclidiana .............................................................................. 94 6.6 Introducci√≥n de Error e Incertidumbre en la Configuraci√≥n Inicial del Aut√≥mata .............. 96 6.7 Comparaci√≥n entre Vecindad Moore 3D y Vecindad Von Neumann 3D .......................... 100 6.8 Comparaci√≥n entre Calidad de Segmentaci√≥n Obtenida con M√∫ltiples Versiones de GrowCut ....................................................................................................................................... 102 6.8.1 GrowCut Corregido .................................................................................................... 103 6.8.2 GrowCut con Penalizaci√≥n a Fuerza de Ataque ......................................................... 104 6.9 Comparaci√≥n de Calidad de Segmentaci√≥n entre Canales Individuales ............................ 108 6.10 Comparaci√≥n de Calidad de Segmentaci√≥n al Realizar Combinaci√≥n de Canales ......... 111 6.10.1 Combinaci√≥n de 4 Canales .......................................................................................... 111 6.10.2 Combinaciones de 3 Canales .......................................................................................112 6.10.3 Combinaciones de 2 Canales .......................................................................................113 6.11 Pruebas con Algoritmo de Selecci√≥n de Semillas ‚ÄúAutomaClass‚Äù ....................................115 CONCLUSIONES ........................................................................................................................... 120 TRABAJOS FUTUROS .................................................................................................................. 121 BIBLIOGRAF√çA .............................................................................................................................. 122 6 Dedicatoria: A mis padres, por ser Buenos Agradecimientos Agradezco a mis tutores, los profesores Rhadam√©s Carmona y Miguel Mart√≠n Landrove (y al tutor extraoficial de esta tesis, el profesor Wuilian Torres) por la oportunidad de abordar este tema como trabajo especial de grado, fue la experiencia de aprendizaje que m√°s disfrut√© en mi paso por la UCV. A ustedes tres debo el inicio de mi carrera como investigador. Gracias. 7 CAPITULO 1 - INTRODUCCI√ìN Los tumores cerebrales son una de las formas de c√°ncer que mayor perjuicio generan a la calidad de vida de los pacientes afectados y son la principal causa de muerte por tumor s√≥lido en ni√±os [Russell13]. Resultan necesarios avances que faciliten su detecci√≥n temprana y tratamiento; una tarea cr√≠tica en estos procedimientos es la correcta segmentaci√≥n de las estructuras patol√≥gicas en la imagenolog√≠a radiol√≥gica disponible. En la visi√≥n por computador, la segmentaci√≥n es el proceso de particionar una imagen en m√∫ltiples conjuntos de p√≠xeles o v√≥xeles 1 que compartan alguna caracter√≠stica visual. La segmentaci√≥n facilita el an√°lisis cuantitativo y cualitativo de informaci√≥n visual, por lo que su importancia es alta en aplicaciones de diagn√≥stico y planificaci√≥n de tratamientos. La imagenolog√≠a de resonancia magn√©tica (IRM) es una t√©cnica de visualizaci√≥n de datos que provee informaci√≥n anat√≥mica detallada. Ofrece varias ventajas con respecto a otras t√©cnicas de imagenolog√≠a, como la tomograf√≠a computarizada, debido a su capacidad para proveer datos con alto contraste entre tejidos blandos. Sin embargo, la cantidad de datos que produce la IRM en sus m√∫ltiples modalidades, resulta com√∫nmente excesiva para el an√°lisis y la interpretaci√≥n manual, lo que tradicionalmente ha constituido uno de los grandes obst√°culos para su uso cl√≠nico. La segmentaci√≥n autom√°tica o asistida de diferentes clases de tejidos en IRM es una tarea importante, porque permite analizar estructuras anat√≥micas de una forma sem√°nticamente intuitiva. El estudio de la visi√≥n por computador ha producido variadas t√©cnicas de segmentaci√≥n de im√°genes que pueden ser utilizadas para segmentar estructuras anat√≥micas, permitiendo realizar an√°lisis cuantitativo y cualitativo de los componentes de inter√©s presentes en una imagen. Estas t√©cnicas de segmentaci√≥n constituyen herramientas √∫tiles para diagn√≥stico, seguimiento evolutivo de patolog√≠as y planificaci√≥n quir√∫rgica. Un trabajo de Warfield et al, en el a√±o 2001 [Warfield01], se√±ala como el tiempo requerido para realizar una segmentaci√≥n de tumor cerebral, utilizando un m√©todo de segmentaci√≥n asistida, reduce el tiempo de trabajo del operador a un per√≠odo de 5 a 10 minutos, en lugar de 3 a 5 horas necesarias para realizar la segmentaci√≥n manual sobre cada uno de los cortes del volumen de resonancia magn√©tica analizado. Este trabajo presenta m√©todos de segmentaci√≥n autom√°tica y asistida de tumores cerebrales en IRM, basados en aut√≥matas celulares deterministas, dise√±ados espec√≠ficamente para asistir en la planificaci√≥n de radiocirug√≠a cerebral. Se presentan las siguientes contribuciones originales: 1 As√≠ como un p√≠xel se refiere a un cuadrado unitario m√≠nimo de imagen 2D, un v√≥xel se refiere a un cubo unitario m√≠nimo de volumen 3D, su unidad m√≠nima de muestra discreta. 8 i) Nuevas reglas de evoluci√≥n para aut√≥matas celulares deterministas, dedicados a la segmentaci√≥n de im√°genes que exhiben mejor sensibilidad y mejor precisi√≥n que reglas de evoluci√≥n previas en la literatura. ii) Segmentaci√≥n validada de m√∫ltiples canales de imagenolog√≠a de resonancia magn√©tica cerebral, evaluados de forma individual y combinada. Se compara el desempe√±o de los algoritmos de segmentaci√≥n basados en aut√≥matas celulares en m√∫ltiples modalidades de IRM y los efectos de la combinaci√≥n de canales en la calidad de la segmentaci√≥n. iii) Nuevo m√©todo de segmentaci√≥n multicanal autom√°tica de tumores cerebrales en IRM, basado en una selecci√≥n inteligente de la configuraci√≥n inicial de los aut√≥matas celulares. iv) Un patr√≥n de sincronizaci√≥n de hilos en GPU, que minimiza el n√∫mero de barreras necesarias para lograr segmentaciones con aut√≥matas celulares deterministas en un proceso iterativo. 1.1 Planteamiento del Problema La segmentaci√≥n de tejidos en IRM es una herramienta poderosa para la planificaci√≥n de cirug√≠a cerebral, ya que facilita el an√°lisis cualitativo y cuantitativo de las patolog√≠as presentes. Actualmente, los algoritmos basados en atlas para la segmentaci√≥n autom√°tica de tumores en IRM poseen una alta complejidad, lentitud de ejecuci√≥n, dificultad para ser paralelizados y una tasa de errores (falsos positivos) significativa, que hace necesario un post-procesamiento por parte de un operador experto. Por otra parte, los m√©todos de segmentaci√≥n autom√°tica basados en clusterizaci√≥n de datos, como K-means e Isodata, no poseen la capacidad de incorporar informaci√≥n espacial al proceso de segmentaci√≥n realizado, y toman decisiones √∫nicamente con base en la clusterizaci√≥n de niveles digitales [Ball65]. Adem√°s, el n√∫mero de clases a considerar en el proceso de segmentaci√≥n afecta negativamente el tiempo de c√≥mputo, factor negativo com√∫n con otros m√©todos de segmentaci√≥n multiclase, como Random Walker [Grady04]. Se proponen en este trabajo extensiones y mejoras a GrowCut, un m√©todo de segmentaci√≥n basado en aut√≥matas celulares deterministas, que permite segmentar simult√°neamente m√∫ltiples clases de tejido, sin afectar negativamente el tiempo de c√≥mputo necesario para proporcionar una respuesta al usuario. Los aut√≥matas celulares deterministas propuestos, ofrecen adem√°s las ventajas 9 de realizar segmentaci√≥n incorporando tanto informaci√≥n espacial, como informaci√≥n de nivel digital; son inherentemente paralelizables; pueden manejar informaci√≥n multicanal y tambi√©n pueden ser utilizados como parte de un sistema de segmentaci√≥n autom√°tica, a trav√©s de una selecci√≥n inteligente de su configuraci√≥n inicial. Estas caracter√≠sticas convierten a los aut√≥matas celulares deterministas propuestos, en una herramienta matem√°tica de utilidad en la planificaci√≥n de cirug√≠as y la evaluaci√≥n de patolog√≠as cerebrales. 1.2 Propuesta de Soluci√≥n Se propone la implementaci√≥n de un sistema de segmentaci√≥n de tumores cerebrales, basado en aut√≥matas celulares deterministas, que permita la visualizaci√≥n de las estructuras anat√≥micas segmentadas. 1.3 Objetivo General Implementar un programa de segmentaci√≥n de tumores cerebrales en im√°genes de resonancia magn√©tica, que opere tanto en cortes bidimensionales como en vol√∫menes, validando los resultados obtenidos. 1.4 Objetivos Espec√≠ficos - Implementar un sistema de segmentaci√≥n de tumores cerebrales, basado en aut√≥matas celulares deterministas, que permita al usuario establecer semillas de segmentaci√≥n, tanto de forma manual como de forma autom√°tica. - Validar, a trav√©s de m√©tricas de calidad de segmentaci√≥n, reglas de evoluci√≥n originales y reglas de evoluci√≥n preexistentes en la literatura, en im√°genes de resonancia magn√©tica producidas por TumorSim. - Validar, a trav√©s de m√©tricas de calidad de segmentaci√≥n, los resultados obtenidos a partir de la combinaci√≥n de canales de im√°genes co-registradas de resonancia magn√©tica, producidas por TumorSim. - Implementar un aut√≥mata celular para la segmentaci√≥n de tumores de forma serial para ejecutarse en CPU, y de forma paralelizada para ejecutarse en GPU, realizando comparaci√≥n entre tiempos de respuesta. 10 11 CAP√çTULO 2 - MARCO TE√ìRICO Desde el descubrimiento de los rayos X en 1895, la radiolog√≠a ha sido usada para el diagn√≥stico y tratamiento de una variedad de lesiones neurol√≥gicas. En la d√©cada de los 70, el surgimiento de la imagenolog√≠a por tomograf√≠a computarizada (TC), que realiza m√∫ltiples muestreos con rayos X para producir cortes de √°reas espec√≠ficas del cuerpo, mejor√≥ notablemente la resoluci√≥n de las im√°genes anat√≥micas capturadas. La resoluci√≥n de los tejidos blandos fue posteriormente mejorada con la introducci√≥n de la imagenolog√≠a por resonancia magn√©tica (IRM), que usa la propiedad de resonancia magn√©tica nuclear, para representar el n√∫cleo de los √°tomos de hidr√≥geno que est√°n en los tejidos grasos y el agua del cuerpo humano. La IRM explota la propiedad de spin nuclear de los √°tomos de hidr√≥geno para obtener im√°genes de los tejidos blandos. En IRM, un pulso de radiofrecuencia es aplicado al paciente. Como resultado, los estados de spin nuclear de sus √°tomos de hidr√≥geno, pasan de un estado de equilibrio a un estado de excitaci√≥n. Debido a la ley de conservaci√≥n de la energ√≠a, para retornar a su estado de equilibrio, los √°tomos deben emitir una energ√≠a igual a la energ√≠a absorbida. La liberaci√≥n de energ√≠a entre los estados de transici√≥n de spin puede ser medida y analizada. Debido que el proceso de absorci√≥n y emisi√≥n de energ√≠a es afectado por el ambiente qu√≠mico local, los √°tomos de hidr√≥geno en los tejidos suaves de variadas composiciones qu√≠micas, absorber√°n y emitir√°n energ√≠a diferentemente. Esta informaci√≥n es usada para producir mapas de alta resoluci√≥n de la estructura de los tejidos suaves. Debido a que los tumores y los tejidos sanos a menudo difieren en composici√≥n qu√≠mica, este principio permite una delineaci√≥n distintiva de los tejidos. Debido a la complejidad de las interacciones nucleares involucradas en la IRM, hay m√∫ltiples fuentes de error, que dan como resultado la distorsi√≥n de la imagen obtenida. Una de dichas fuentes de error, es la imperfecci√≥n del campo magn√©tico de entrada. El campo magn√©tico de entrada, en IRM, es producido por corrientes el√©ctricas pasando a trav√©s de bobinas mutuamente ortogonales. Idealmente, el campo magn√©tico generado ser√≠a uniforme, de forma tal que una relaci√≥n lineal entre espacio y frecuencia de resonancia pueda ser establecida. Sin embargo, dichos campos uniformes son dif√≠ciles de lograr en la pr√°ctica. Este fen√≥meno es llamado no-linealidad del campo gradiente y tiende a aumentar con un incremento en distancia a partir del eje central del magneto principal. La no-linealidad del campo gradiente es corregida computacionalmente. Antes de la correcci√≥n, la no-linealidad del campo gradiente puede inducir distorsiones espaciales tan grandes 12 como hasta de 4 mm. Luego de la correcci√≥n computacional, la distorsi√≥n es minimizada a <1 mm. Otro tipo de distorsi√≥n en la resonancia magn√©tica, que es m√°s dif√≠cil de corregir computacionalmente, es el que ocurre debido a las interacciones electromagn√©ticas entre en el tejido del paciente y el campo magn√©tico entrante. Esta distorsi√≥n es a menudo referida como el offset de resonancia. El offset de resonancia ocurre debido que los √°tomos de hidr√≥geno cargan consigo un campo magn√©tico inherente. La colocaci√≥n de tejidos portadores de hidr√≥geno en un campo magn√©tico, necesariamente induce una perturbaci√≥n en el campo magn√©tico de entrada. Esta perturbaci√≥n altera la relaci√≥n lineal entre espacio y frecuencia de resonancia, produciendo as√≠ distorsiones geom√©tricas. La f√≠sica de esta perturbaci√≥n es compleja, debido a que depende de las propiedades magn√©ticas inherentes al tejido del paciente, as√≠ como del volumen y forma de este tejido. Las distorsiones de offset de resonancia, tienden a ser mayores en la interfaz entre materiales que difieren en sus propiedades magn√©ticas, como en la interfaz agua-aire. En la pr√°ctica, esto produce grandes distorsiones en las interfaces aire-hueso o aire-tejido, que pueden ser tan grandes como 2mm. Los artefactos de movimiento, son otro factor que afecta la certeza espacial de la IRM. El lapso prolongado que es requerido para la adquisici√≥n de la imagen, aumenta el potencial de movimiento del paciente. Incluso con un paciente cooperativo ocurren artefactos de movimiento, debido a la respiraci√≥n y otros movimientos provocados por actividad fisiol√≥gica. Esto compromete la precisi√≥n de la resoluci√≥n espacial. Adem√°s de las distorsiones de offset y de campo magn√©tico de entrada, que restan precisi√≥n anat√≥mica a las im√°genes producidas, un inconveniente de usar IRM como herramienta √∫nica de planeaci√≥n radio-quir√∫rgica, es que √©sta no representa informaci√≥n de densidad de electrones, que es usada para guiar la administraci√≥n de radiaci√≥n. Sin la informaci√≥n de densidad de electrones, la dosis de radiaci√≥n administrada puede desviarse de la dosis deseable hasta un 20%, como resultado de las inhomogeneidades visuales de los tejidos. Esta informaci√≥n de densidad de electrones s√≠ se encuentra presente en la tomograf√≠a computarizada, d√≥nde la intensidad de los p√≠xeles refleja la densidad en electrones de los tejidos representados y estas intensidades pueden ser convertidas en mapas de densidad de electrones (electrones por cm 3 ). Otro punto fuerte de la tomograf√≠a computarizada, frente a la imagenolog√≠a de resonancia magn√©tica, es que en cada imagen en tomograf√≠a computarizada se tiene una s√≠ntesis de informaci√≥n anat√≥mica a partir de m√∫ltiples im√°genes de rayos X, ofreciendo una resoluci√≥n anat√≥mica mejorada. Aunque la tomograf√≠a computarizada proporciona una resoluci√≥n anat√≥mica mejorada en 13 comparaci√≥n a la IRM, la delineaci√≥n de las estructuras de tejidos suaves a trav√©s de la TC es sub√≥ptima, incluso con la ayuda de agentes de contraste intravenosos. La delineaci√≥n de las estructuras de tejido suave es mejor lograda a trav√©s del uso de IRM, especialmente para los objetivos en la base craneal. En general, la combinaci√≥n de IRM y tomograf√≠a computarizada, produce planes de radiocirug√≠a superiores a los planes producidos usando s√≥lo una de estas modalidades [Chen08]. Las diferencias entre la tomograf√≠a computarizada e IRM, ilustran la distinci√≥n conceptual entre la certeza geom√©trica y diagn√≥stica. Aunque la imagenolog√≠a de TC es geom√©tricamente precisa, debido a la ausencia de efectos de distorsi√≥n, los tejidos patol√≥gicos son, a menudo, no visualizables en esta modalidad. Por esto, la imagenolog√≠a de TC no es certera para el diagn√≥stico. Por otra parte, debido a su resoluci√≥n superior en los tejidos blandos, la IRM tiene mayor certeza diagn√≥stica, pero menor certeza geom√©trica, debido a los efectos de distorsi√≥n de la resonancia magn√©tica. Sin embargo, es posible introducir artefactos en la imagen resultante de la combinaci√≥n de cortes de CT con MRI, a trav√©s del proceso de co-registro, que busca el m√°ximo solapamiento entre los cortes provistos entre ambas modalidades de imagenolog√≠a. Estos posibles artefactos debidos al proceso de co-registro, tienen el potencial para alterar el diagnostico de patolog√≠as. En el caso particular de la radiocirug√≠a cerebral, se ha estudiado la certeza operatoria de planes que s√≥lo utilicen la IRM y √©stos se consideran cl√≠nicamente aceptables [Prabhakar07]. 2.1 Radiocirug√≠a Estereot√°ctica con Gamma Knife La radiocirug√≠a consiste en la administraci√≥n precisa de una fuerte dosis de radiaci√≥n, guiada con un marco de referencia estereot√°ctico a un objetivo focal, permitiendo una ganancia terap√©utica. Fue introducida por Borje Larsson y Lars Leksell en 1951, usando originalmente un ciclotr√≥n destinado a experimentos acad√©micos de la Universidad de Uppsala, Suecia. Hoy d√≠a, la radiocirug√≠a estereot√°ctica generalmente utiliza rayos gamma o rayos X. El Gamma Knife es un sistema de radiocirug√≠a estereot√°ctica, desarrollado por Lars Leksell en 1968, para el tratamiento de afecciones dentro de la b√≥veda craneal [Prabhakar07]. Entre las patolog√≠as tratables por Gamma Knife se encuentran los tumores cerebrales, malignos y benignos: met√°stasis cerebral, gliomas, meningiomas, tumores pituitarios, neurinomas vestibulares, craneofaringiomas y otros. Tambi√©n es posible realizar tratamientos a una amplia variedad de afecciones vasculares en el cerebro. La radiocirug√≠a con Gamma Knife es un tratamiento libre de incisiones a la b√≥veda craneal, que es no invasivo, indoloro y ambulatorio. En el sistema, rayos gamma son emitidos por 201 fuentes de cobalto-60 (radioactivo) a una baja intensidad. S√≥lo en el punto de concentraci√≥n definido como objetivo, los rayos alcanzan 14 capacidad para destruir tejidos. Para fijar la posici√≥n del objetivo, el Gamma Knife requiere un marco estereot√°ctico (marco de Leskell, que usa coordenadas polares) que debe ser ajustado al cr√°neo del paciente y que no permite que √©ste se mueva durante la aplicaci√≥n del tratamiento. Debido a la opacidad de la b√≥veda craneal, la definici√≥n del volumen objetivo depende enteramente de la precisi√≥n anat√≥mica de la imagenolog√≠a disponible, por lo que hay necesidad de una visualizaci√≥n anat√≥mica fidedigna durante la planificaci√≥n de la radiocirug√≠a [Chen08]. Figura 2.1 - Radiocirug√≠a con Gamma Knife M√∫ltiples fuentes de radiaci√≥n convergen en un objetivo, administran una alta dosis de radiaci√≥n a la zona, evitando la radiaci√≥n destructiva de los tejidos cercanos, con una precisi√≥n de corte de hasta 0.3 mm. Para asegurar el posicionamiento apropiado del paciente y su inmovilidad, se coloca un marco de posicionamiento estereot√°ctico al cr√°neo del paciente. El tratamiento dura de 45 a 60 minutos y puede tratar lesiones de hasta 3,5 cm. 2.1.1 Uso y Colocaci√≥n de Marco Estereot√°ctico (ME) El marco estereot√°ctico inmoviliza al paciente durante el proceso de muestreo de imagenolog√≠a de resonancia magn√©tica y la administraci√≥n del tratamiento de radiocirug√≠a. El hecho que el paciente est√© inmovilizado durante el proceso de toma de im√°genes es significativo, porque facilita el co‚Äìregistro entre m√∫ltiples modalidades de IRM. El procedimiento que com√∫nmente se sigue para la colocaci√≥n del marco estereot√°ctico (ME) sobre el cr√°neo y su excentricidad con respecto a la patolog√≠a, se basa en el nivel de experticia que tenga el m√©dico que lo realiza. Un mal posicionamiento del ME trae como consecuencia inmediata que el tratamiento no se pueda realizar y deba ser postergado. Adicionalmente, la colocaci√≥n incorrecta del marco puede ocasionar colisiones del mismo con los colimadores o piezas de la 15 m√°quina radioquir√∫rgica utilizada, situaci√≥n problem√°tica que puede ser identificada √∫nicamente despu√©s de fijar el ME en el cr√°neo. Por esto, el Centro de Computaci√≥n Gr√°fica de la Universidad Central de Venezuela ha desarrollado un sistema tipo CAD que provee al neurocirujano de una gu√≠a virtual y cuantitativa para la colocaci√≥n √≥ptima del ME en el cr√°neo, haciendo uso de las im√°genes de diagn√≥stico del paciente, obtenidas antes del tratamiento [Mena12]. Figura 2.2 - Marco de Leskell El marco de Leskell inmoviliza al paciente cuando es colocado bajo los colimadores de rayos gamma y permite la calibraci√≥n espacial del tratamiento. 2.1.2 Coregistro de Im√°genes de Resonancia Magn√©tica El registro de im√°genes es el proceso de ajustar distintos conjuntos de datos visuales a un mismo sistema de coordenadas. Los datos pueden constituir im√°genes captadas a trav√©s de diferentes sensores, datos tomados en diferentes intervalos de tiempo, o datos tomados en diferentes profundidades o puntos de vista [Gottesfeld92].El proceso de registro involucra la designaci√≥n de una imagen como referencia (tambi√©n llamada imagen fija o base) y la aplicaci√≥n de transformadas espaciales a las otras im√°genes, de forma que se alineen con la referencia. Las im√°genes pueden estar desalineadas por una gran variedad de razones. Com√∫nmente, las im√°genes son capturadas bajo condiciones variables. Una transformada espacial reasigna las locaciones en una imagen a nuevas locaciones en otra. El paso para determinar los par√°metros correctos de transformaci√≥n espacial, es clave para el 16 proceso de registro de im√°genes. El registro de im√°genes es a menudo usado como un paso preliminar en otras aplicaciones de procesamiento de im√°genes. Por ejemplo, se puede usar para alinear im√°genes de sat√©lite capturadas por distintos sensores o para alinear im√°genes de resonancia magn√©tica capturadas en distintas modalidades (T1, T1Gad, T2, FLAIR, etc.). El registro de im√°genes permite comparar caracter√≠sticas comunes en distintas im√°genes, por ejemplo, puede indicar como un r√≠o ha migrado, como un √°rea se ha inundado o el canal en que con mayor facilidad puede visualizarse un tumor [Mathworks13]. 2.1.3 Est√°ndar DICOM DICOM es un acr√≥nimo para Digital Image Communication in Medicine, es el est√°ndar internacional para el almacenamiento y manejo de im√°genes m√©dicas digitales [Mildenberger02]. Actualmente, DICOM es el formato universal de PACS (picture archiving and communication systems), acr√≥nimo que se refiere a los sistemas de archivamiento y comunicaci√≥n de im√°genes m√©dicas, sin el uso de archivos de film. En 1982, el American College of Radiology (ACR) y la National Electrical Manufacturers Association (NEMA), formaron un comit√© para desarrollar un est√°ndar de interconexi√≥n de equipos digitales de imagenolog√≠a. La versi√≥n 1.0 del est√°ndar (originalmente llamada est√°ndar ARC-NEMA) fue publicada en 1985 y especifica una interfaz para la transmisi√≥n de im√°genes punto-a-punto (no a trav√©s de una red), un conjunto de reglas para codificar la informaci√≥n de imagenolog√≠a, expresado como reglas para la generaci√≥n de un diccionario de datos y un conjunto de comandos para iniciar transacciones. La versi√≥n 2.0 del est√°ndar ARC-NEMA, fue publicada en 1988 a√±adiendo reglas sem√°nticas en las cuales los mensajes (conjuntos de bits representando informaci√≥n en tr√°nsito de un dispositivo a otro) son organizados. La versi√≥n 3.0 del est√°ndar ARC-NEMA fue la primera en ser llamada oficialmente DICOM, e integr√≥ la funcionalidad previa con el protocolo TCP/IP bas√°ndose en el modelo de protocolo de red ISO/OSI, para lograr transmisi√≥n de las im√°genes a trav√©s de redes convencionales. El est√°ndar DICOM incorpora el concepto de dise√±o orientado a objetos, con identificadores √∫nicos para servicios y objetos. Estos objetos incluyen im√°genes, datos de paciente y reportes [Mildenberger02]. En el est√°ndar DICOM, la informaci√≥n de un estudio pertinente a tipo de exploraci√≥n, el equipo utilizado y datos del paciente, se almacena como atributos de un archivo header (cabecera), cuyo tama√±o var√≠a dependiendo de cu√°nta informaci√≥n se registra en un estudio. Estos atributos DICOM se conocen como IODs, Information on Object Definition. DICOM agrupa informaci√≥n en 17 datasets inseparables, siguiendo un esquema entidad-relaci√≥n, de forma que la imagen correspondiente a un caso nunca pueda ser separada por error de los dem√°s campos del estudio, como por ejemplo, identificador de paciente, fecha y condiciones de toma de la imagen. Tambi√©n se especifica en IODs informaci√≥n pertinente al sistema de captura de im√°genes, como la empresa desarrolladora y el serial del equipo. Los IODs son nombrados mediante identificadores √∫nicos, UIDs (Unique Identifiers), para la variedad de dispositivos y clases, evitando coincidencias con equipos de diferentes pa√≠ses, instituciones, etc. Cada UID es creado de forma talque es √∫nico en todo el mundo [Mildenberger02]. Un objeto de datos DICOM, consiste de un n√∫mero de atributos IOD, incluyendo informaci√≥n tal como nombre, ID y tambi√©n un atributo especial conteniendo los datos de pixel de imagen, como se ilustra en la Figura 2.3. Un objeto DICOM puede tener solo un atributo conteniendo datos de pixel, sin informaci√≥n adicional en el encabezado. Los datos de los pixeles pueden ser comprimidos usando una variedad de est√°ndares como JPEG, JPEG Lossless y RLE (Run-length encoding). Los elementos de datos o mensajes de DICOM (usados para ordenar operaciones de registro, env√≠o o copia), est√°n compuestos por cuatro campos acompa√±ando a un nombre, como se ilustra en la Figura 2.3, y aparecen en el encabezado de un archivo de imagen. El primero de √©stos, es una etiqueta compuesta por un par ordenado de dos enteros sin signo de 16 bits, que representan un n√∫mero de grupo y n√∫mero de elemento, respectivamente. El tercer campo, se conoce como VR (Valor de Representaci√≥n) e indica en una cadena de caracteres de dos bytes, el valor de representaci√≥n (binario, entero, hexadecimal, etc., adem√°s de tipos extensibles, definidos en el diccionario) del elemento de datos. El cuarto componente, representa el valor del elemento y puede corresponder a un UID, fecha, especificador de tipo de imagen, modalidad de imagenolog√≠a, etc. El √∫ltimo campo es el nombre del IOD. El VR del Elemento de Datos puede ser determinado con el diccionario de datos. 18 Figura 2.3 - Ejemplo de un header DICOM En el header se muestran diferentes grupos y elementos denotando datos relacionados al paciente, fecha del estudio y modalidad. El diccionario de datos que est√° definido en el est√°ndar, contiene un registro de todos los elementos de datos y todos los identificadores √∫nicos incluidos en DICOM. Cada atributo en un IOD, tiene un significado bien definido. Cada elemento se define con un nombre, id de grupo y elemento, valor de representaci√≥n, multiplicidad, valores permitidos y valor por defecto, como se ilustra en la Figura 2.4. Los datos son divididos en varios grupos. Por ejemplo, el grupo 8 incluye la descripci√≥n de la modalidad de imagenolog√≠a y las caracter√≠sticas del examen o informaci√≥n acerca del m√©dico que refiere al paciente (0008/0090), el grupo 10 est√° reservado para datos del paciente, etc. Como sumario de esta breve descripci√≥n del est√°ndar, se puede decir que DICOM es una serie de reglas que permiten la interoperabilidad entre equipos m√©dicos de imagenolog√≠a y reporte, definiendo protocolos de red, adem√°s de una sintaxis √∫nica para la comunicaci√≥n [Mildenberger02]. Su relevancia y utilidad es alta; DICOM es el est√°ndar de transmisi√≥n digital de informaci√≥n m√©dica m√°s usado en la actualidad. 19 Figura 2.4 - Entrada Ejemplar en un Diccionario DICOM Cada entrada en el diccionario de datos especifica un n√∫mero √∫nico de grupo y elemento, nombre de valor, representaci√≥n de valor, multiplicidad, tipo de elemento, valor por defecto y una definici√≥n para cada entrada. Aqu√≠, BI = binario en 16 bits, HX = cualquier valor hexadecimal, S = valor √∫nico, 1D = elemento requerido con un valor por defecto definido. 2.2 Volume Rendering Un volumen es un conjunto de muestras (x, y, z, w) donde w es un escalar o vector que denota alguna propiedad de los datos en su ubicaci√≥n espacial 3D, como densidad, color, calor, presi√≥n, etc. Los datos del volumen pueden ser variantes con el tiempo, en cuyo caso V se convierte en un conjunto de muestras en 4D (x, y, z, t, w). El volume rendering (VR) es una t√©cnica para visualizar vol√∫menes mediante la proyecci√≥n de sus atributos en una imagen 2D. Para el estudio m√©dico, el VR facilita la comprensi√≥n de la anatom√≠a y los procesos patol√≥gicos, tanto por parte de los radi√≥logos como de los m√©dicos tratantes y cirujanos. Desde el advenimiento de las modalidades de imagenolog√≠a computarizada, como el TC, el IRM y la tomograf√≠a de emisi√≥n de positrones (PET) en las d√©cadas de 1970 y 1980, la visualizaci√≥n de im√°genes m√©dicas ha evolucionado a partir de la proyecci√≥n bidimensional de im√°genes de cortes separados, a la proyecci√≥n de im√°genes en tres (ancho, longitud y profundidad) o cuatro dimensiones (ancho, longitud, profundidad y tiempo). La evoluci√≥n en la tecnolog√≠a de imagenolog√≠a, ha tra√≠do con ella un incremento en el tama√±o de los datasets que constituyen la t√≠pica imagen 3D. Los cortes en las primeras tomograf√≠as computarizadas eran t√≠picamente de 320 2 p√≠xeles. Hoy d√≠a, una imagen t√≠pica de tomograf√≠a computarizada tiene 512 3 p√≠xeles, haci√©ndola aproximadamente 1000 veces m√°s densa. Este incremento de informaci√≥n en la imagen, hace importante el uso de m√©todos eficientes para manipular y visualizar los datasets. Esta es una necesidad del radi√≥logo, que debe navegar los datos para hacer un diagn√≥stico, as√≠ como tambi√©n del cirujano, que necesita una representaci√≥n fidedigna 20 del paciente y su patolog√≠a asociada, para planear un procedimiento terap√©utico. Para apreciar los atributos tridimensionales completos de los datos, los v√≥xeles individuales en el dataset deben ser proyectados en la pantalla de visualizaci√≥n, de forma tal que sus relaciones 3D sean mantenidas, mientras simult√°neamente se hace que su apariencia en la pantalla sea significativa para el observador. El cambio, por parte de los radi√≥logos y cirujanos, de las vistas de cortes axiales tradicionales a la visualizaci√≥n 3D de vol√∫menes, les proporciona una visualizaci√≥n mejorada de las estructuras anat√≥micas y mejora el desempe√±o de los usuarios, al evaluar grandes datasets m√©dicos de forma eficiente y exhaustiva. As√≠, se incrementa la confianza de los radi√≥logos al diagnosticar patolog√≠as y de los cirujanos al planear procedimientos [Zhang10].El incremento de los tama√±os de los datasets usados en el VR, trae consigo el problema de aumentar el tiempo de c√≥mputo necesario para desplegarlos, por lo que el VR se mantiene como un √°rea de investigaci√≥n activa, en la cual se busca mejorar la calidad de la imagen producida y la rapidez de los algoritmos utilizados. 2.2.1 Ray Casting La visualizaci√≥n en el volumen ray casting, est√° guiada por un modelo f√≠sico simplificado del proceso de propagaci√≥n de la luz sobre materiales con √≠ndices variables de color y opacidad. En este modelo simplificado de transporte de luz, se representa como la luz es absorbida y emitida por los elementos del volumen [Ikits04]. Estas muestras son tomadas a lo largo de cada rayo de visi√≥n, acumulando las propiedades √≥pticas de opacidad y color resultantes, para producir el rendering (despliegue) final. La Figura 2.5 ilustra vol√∫menes visualizados a trav√©s de raycasting [Levoy90]. 21 Figura 2.5 - Im√°genes m√©dicas renderizadas por ray casting a) Un cr√°neo de un dataset de tomograf√≠a computarizada (TC). b) Un cerebro de un dataset de resonancia magn√©tica (RM). c) Mand√≠bula de TC. d) Vaso sangu√≠neo cerebral en RM. El ray casting usa un modelo √≥ptico para asignar valores en el dataset original a propiedades √≥pticas, como color y opacidad. Durante el rendering, las propiedades √≥pticas son acumuladas a trav√©s de cada rayo de visi√≥n para formar una imagen de los datos. El papel que cumple el modelo √≥ptico es describir como las part√≠culas en el volumen interact√∫an con la luz. El modelo √≥ptico m√°s com√∫nmente usado asume que el volumen consiste de part√≠culas que simult√°neamente emiten y absorben luz [Ikits04]. Modelos √≥pticos de mayor complejidad, incorporan los efectos de la dispersi√≥n de la luz. Para el modelo de emisi√≥n-absorci√≥n, el color C y la opacidad A, acumulados por cada rayo de muestreo, son computados de acuerdo a las siguientes ecuaciones: ùê∂ = ‚àëùê∂ùëñ ùëõ ùëñ=1 ‚àè(1 ‚àí ùê¥ùëó) ùëñ‚àí1 ùëó=1 ùê¥ = 1 ‚àí‚àè(1 ‚àí ùê¥ùëó) ùëñ‚àí1 ùëó=1 22 La opacidad Ai aproxima la absorci√≥n de luz, y el color Ci, que es ponderado en base a la opacidad, aproxima la emisi√≥n y absorci√≥n de luz en el segmento de rayo entre las muestras i e i+1. Para el componente de color, el producto en la suma representa la cantidad de atenuaci√≥n que afecta a la luz emitida por la muestra i antes de alcanzar el ojo [Ikits04]. Las propiedades √≥pticas de color y opacidad, con las que se visualiza finalmente el volumen, pueden ser manipuladas aplicando una o m√°s Funciones de Transferencia (FT) a los valores escalares del volumen. La meta de la funci√≥n de transferencia, en las aplicaciones de visualizaci√≥n, es enfatizar caracter√≠sticas de inter√©s en los datos. Una Funci√≥n de Transferencia es una funci√≥n capaz de manipular los valores de opacidad y color asignados a los datos originales, afectando las caracter√≠sticas del volumen que son desplegadas [Ikits04]. El proceso de aplicar las FT a los valores escalares de cada v√≥xel, se llama clasificaci√≥n. Aunque el dataset de volumen se interpreta como una funci√≥n continua en el espacio, en la pr√°ctica se trata como una pila de cortes 2D de textura, o un objeto √∫nico de textura 3D. Cada v√≥xeldel objeto corresponde a una ubicaci√≥n en el espacio de datos, y tiene uno o m√°s valores asociados a √©l. Los valores en las locaciones intermedias, son obtenidos interpolando datos con los elementos vecinos del volumen. Este proceso se conoce como reconstrucci√≥n y juega un rol importante en el VR [Ikits04]. El orden en que se lleva a cabo la aplicaci√≥n de la Funci√≥n de Transferencia y la interpolaci√≥n de muestras en el volumen, produce resultados visuales distintos cuando la interpolaci√≥n no es conmutativa con la funci√≥n de transferencia. En el proceso llamado pre- clasificaci√≥n, primero se aplica la funci√≥n de transferencia al volumen y luego se realiza la reconstrucci√≥n. En la post-clasificaci√≥n, primero se realiza la reconstrucci√≥n y luego se aplica la funci√≥n de transferencia al volumen. Al aplicar pre-clasificaci√≥n, las im√°genes tienden a ser m√°s difusas que utilizando post-clasificaci√≥n. 2.2.2 Visualizaci√≥n de Isosuperficies Una isosuperficie es una superficie cuyos puntos representan un valor constante en un volumen, la superficie es el conjunto de valores representativos de un nivel de una funci√≥n continua en el espacio 3D. En IRM, las isosuperficies se usan para representar regiones de una densidad particular de un tejido de √≥rganos, huesos u otras estructuras [Hansen04]. El problema de extracci√≥n de una superficie, a partir de los datos volum√©tricos originales, 23 consiste en la representaci√≥n poligonal del valor impl√≠cito f (x, y, z) = ùúÜ; donde ùúÜ ùúñ ùëÖ es el valor de inter√©s en la funci√≥n escalar ùëì: ùëÖ3 ‚Üí ùëÖ. Los dos m√©todos m√°s com√∫nmente usados para generar isosuperficies de vol√∫menes, son marching cubes [Lorensen87] y marching tetrahedra [Carneiro96]. Ambas t√©cnicas asumen que un contorno puede pasar a trav√©s de un v√≥xel en un n√∫mero finito de formas y generan un mallado de tri√°ngulos, construido en base al nivel que se desee visualizar en la isosuperficie. Ambas construyen tablas de casos, que enumeran los posibles estados topol√≥gicos del v√≥xel, dadas todas las posibles combinaciones de valores escalares en la superficie, relativos a los puntos v√©rtices del v√≥xel. El n√∫mero de estados topol√≥gicos depende del n√∫mero de relaciones dentro/fuera, que los v√©rtices del v√≥xel pueden tener con respecto al valor de contorno. Los v√©rtices con valores escalares inferiores al valor de contorno, se consideran fuera del contorno. Un v√≥xel tiene ocho v√©rtices y cada v√©rtice puede estar dentro o fuera del contorno, existiendo 2 8 = 256 formas posibles en que un contorno dado puede pasar a trav√©s de un v√≥xel. Aprovechando las propiedades de simetr√≠a entre m√∫ltiples casos, las tablas de intersecci√≥n de v√≥xel con superficie, son reducidas a 15 configuraciones distintas de v√≥xel-isosuperficie en el caso de marching cubes, como se muestra en la Figura 2.6. Figura 2.6 - Casos de intersecci√≥n de v√≥xel con isosuperficie en Marching Cubes Se crea un √≠ndice correspondiente a cada uno de los casos, basado en el estado (dentro-fuera) del v√©rtice con respecto a la isosuperficie. Cada v√©rtice es representado por una posici√≥n binaria en este √≠ndice, describiendo el caso tratado. Se usa el √≠ndice para encontrar cu√°l es la arista del cubo que la superficie intercepta y se usa interpolaci√≥n lineal para posiciones el punto de intersecci√≥n superficie-cubo en la arista. Finalmente, una vez que la interpolaci√≥n es realizada, el tri√°ngulo contenido en la superficie es creado conectando todos los puntos de intersecci√≥n dentro del v√≥xel. 24 Esta tarea es repetida, v√≥xel por v√≥xel, para generar la isosuperficie completa. Un problema con marching cubes es la aparici√≥n de casos de interpretaci√≥n ambigua para la intersecci√≥n v√≥xel-superficie, como se muestra en la Figura (2.7a). Para estos casos debe generarse un criterio contingente de interpretaci√≥n uniforme en todo el volumen. Este problema de ambig√ºedad es eliminado al reemplazar la estructura b√°sica de intersecci√≥n, usando un tetraedro en lugar de un cubo, como se muestra en la Figura (2.7b). a) b) Figura 2.7 - Casos de intersecci√≥n de v√≥xel con isosuperficie en Marching Cubes Para marching tetrahedra, el n√∫mero de casos de intersecci√≥n se reduce a 3 (igualmente, aprovechando simetr√≠as), como se ilustra en la Figura 2.8. Cada v√≥xel es dividido en 5 tetraedros, como se ilustra en la Figura 2.9. Los tetraedros se colocan en posiciones alternas ‚Äúnegro-blanco‚Äù, siendo una posici√≥n la rotaci√≥n en 90 grados de la otra, para evitar confusi√≥n de pol√≠gonos al colocar cubos con la misma configuraci√≥n de tetraedros adyacentes. Figura 2.8 - Casos Posibles de Intersecci√≥n Tetraedro-Isosuperficie 25 Figura 2.9 - Configuraci√≥n Negro-Blanco para Tetraedros en V√≥xeles Adyacentes Un factor a considerar en la implementaci√≥n de marching tetrahedra, es que tiende a generar una cantidad de pol√≠gonos superior a la de marching cubes, incrementando el costo del tiempo de c√≥mputo y memoria al realizar el despliegue de la isosuperficie. 2.3 Programaci√≥n de GPU con CUDA Las arquitecturas modernas de procesadores han incorporado m√∫ltiples n√∫cleos de c√≥mputo, capaces de realizar ejecuci√≥n paralela de instrucciones. Las unidades de procesamiento gr√°fico (GPU), que tradicionalmente han incorporado m√∫ltiples n√∫cleos, han evolucionado, a partir de ser dispositivos dedicados exclusivamente a rendering, para convertirse en procesadores paralelos de prop√≥sito general [Khronos11]. Una GPU moderna t√≠picamente contiene cientos de n√∫cleos de procesamiento, en los cuales se pueden ejecutar varios millones de hilos de c√≥mputo simult√°neamente. CUDA, que es un acr√≥nimo para Compute Unified Device Architecture, es una plataforma de c√≥mputo paralelo y modelo de programaci√≥n, creada por Nvidia, e implementada en los GPUs que produce, que permite explotar estas capacidades. 2.3.1 Modelo de Ejecuci√≥n de CUDA Las unidades de c√≥mputo en CUDA permiten que muchas operaciones sean ejecutadas en paralelo, en un amplio conjunto de datos de forma SIMT (Single Instruction Multiple Thread 2 ). Un 2 Un thread (hilo) de ejecuci√≥n es la secuencia m√°s peque√±a de instrucciones programadas que pueden ser manejadas independientemente en un sistema de c√≥mputo. M√∫ltiples threads pueden existir en un grupo (llamado bloque) y compartir recursos de memoria. 26 mismo programa, llamado kernel, es ejecutado de forma paralela por un conjunto de threads, cada thread ejecutando el programa sobre distintos datos. Cada vez que un kernel es ejecutado, un n√∫mero de threads especificado por el programador es creado. Cada thread tiene un identificador, que es accesible a partir del kernel y es usado para distinguir los datos que deben ser procesados por el hilo de ejecuci√≥n. Los kernels son enviados a su unidad de c√≥mputo destino por las aplicaciones host, como se ilustra en Figura 2.10. Una aplicaci√≥n host es una aplicaci√≥n escrita en alg√∫n lenguaje de programaci√≥n de prop√≥sito general (C/C++, Matlab, Python, Java, Haskell, etc.) que se encarga de ordenar la creaci√≥n en memoria de los kernels en los dispositivos compatibles. CUDA divide el espacio de ejecuci√≥n global de threads en conjuntos, llamados bloques, que pueden tener una, dos o tres dimensiones. La especificaci√≥n de CUDA define que un bloque entero puede ejecutarse concurrentemente en un mismo Streaming Multiprocessor 3 . Los bloques permiten que exista sincronizaci√≥n entre los threads que los componen y proh√≠ben la sincronizaci√≥n entre threads pertenecientes a otros bloques, para facilitar la escalabilidad de c√≥mputo en distintos GPUs. La organizaci√≥n en bloques simplifica la planificaci√≥n de ejecuci√≥n de un mismo programa en varios GPUs con distinto n√∫mero de SMs, reduciendo el trabajo del programador, como se ilustra en la Figura 2.11. 3 Streaming Multiprocesors (SMs), es el nombre dado a los procesadores multin√∫cleo de prop√≥sito general, presentes en la arquitectura CUDA. Cada SM contiene miles de registros, varios niveles de memoria cach√© y hardware dedicado a la planificaci√≥n de ejecuci√≥n de warps (un warp es un conjunto de 32 threads) de threads. Cada bloque de threads es ejecutado en un √∫nico SM, aunque un mismo SM com√∫nmente ejecuta varios bloques en sucesi√≥n. 27 Figura 2.10 - Distribuci√≥n de Bloques y Escalabilidad en CUDA Un kernel es un programa multihilo particionado en bloques, de tal forma que una GPU con m√°s SMs autom√°ticamente ejecuta el mismo programa en menos tiempo que una GPU con menos SMs. Los bloques est√°n organizados en un grid con un posible rango de 1, 2 √≥ 3 dimensiones. En la Figura 2.11 se muestra un grid de 2 dimensiones, con un identificador x, y para cada thread. Un aspecto esencial del modelo de ejecuci√≥n de CUDA, es la definici√≥n de un conjunto de identificadores para cada thread en el espacio multidimensional definido en el grid. A trav√©s de estos identificadores √∫nicos el modelo de ejecuci√≥n de CUDA permite al desarrollador identificar de manera exacta donde reside cada instancia paralela de un kernel en el espacio de √≠ndices, para que puedan planificarse las operaciones necesarias para implementar correctamente una aplicaci√≥n. El tama√±o de bloque utilizado es importante porque los threads dentro de un bloque pueden compartir memoria a una tasa de transferencia mucho m√°s r√°pida que la que existe entre hilos de diferentes 28 bloques, lo que hace a la escala de bloque la forma natural de fijar barreras y definir sincronizaci√≥n entre threads. Figura 2.11 - Grid Bidimensional Para identificar a un thread un√≠vocamente, se considera la informaci√≥n respectiva a sus coordenadas x, y dentro del bloque al que pertenece, el n√∫mero de bloque y sus dimensiones, as√≠ como las dimensiones del grid contenedor. 2.3.2 Jerarqu√≠a de Memoria en CUDA CUDA define una jerarqu√≠a de memoria como la que se ilustra en la Figura 2.12, su aprovechamiento apropiado es importante para los desarrolladores de aplicaciones. A continuaci√≥n se describe la organizaci√≥n de esta jerarqu√≠a. 29 Figura 2.12 - Jerarqu√≠a de Memoria en CUDA El espacio de memoria en CUDA est√° dividido en una jerarqu√≠a basada en rapidez de acceso y tama√±o. Ambas m√©tricas para cada nivel de la jerarqu√≠a dependen de la GPU particular. a) Global Memory (Memoria Global): la memoria global es el subsistema de memoria de mayor capacidad en el GPU. Para la mayor parte de los dispositivos actuales, la capacidad de la memoria global ser√° de uno o m√°s gigabytes. Aunque la memoria global es grande y visible para todos los threads en un dispositivo, tambi√©n debe ser considerada como el subsistema de memoria m√°s lento y tiene algunas restricciones de uso. La memoria global es mejor aprovechada cuando se referencia en locaciones contiguas o se usan patrones de acceso a memoria que aprovechen su ancho de banda. Se 30 dice que dichas operaciones en memoria son coalesced, que se traduce como ‚Äúfusionadas‚Äù o ‚Äúunidas‚Äù. Para especificar a la memoria global se usa el modificador __global__. b) Local Memory (Memoria Local): es la memoria dentro de un thread que corresponde a los registros en alguna unidad aritm√©tica-l√≥gica de un GPU. La memoria privada es la m√°s r√°pida y peque√±a en la jerarqu√≠a de memoria y puede ser usada sin necesidad de primitivas de sincronizaci√≥n. c) Shared Memory (Memoria Compartida): La memoria compartida es memoria on-chip, que es mucho m√°s r√°pida que la memoria global en un dispositivo. A diferencia de la memoria global, que puede tener varios gigabytes de tama√±o, la memoria local est√° en el orden de los cientos de kilobytes. Es usada para compartir datos r√°pidamente entre los threads de un mismo bloque y para reducir los accesos a la memoria global, de menor ancho de banda. 2.4 M√©tricas de Calidad de Segmentaci√≥n En el √°mbito m√©dico, es tradicional medir la eficacia de un test seg√∫n las m√©tricas estad√≠sticas binarias de sensibilidad y especificidad. Sensibilidad = VP VP + FN = VP # ùëëùëí ùëÉùëúùë†ùëñùë°ùëñùë£ùëúùë† Especificidad = VN VN + FP = ùëâùëÅ # ùëëùëí ùëÅùëíùëîùëéùë°ùëñùë£ùëúùë† VP = n√∫mero de verdaderos positivos VN = n√∫mero de verdaderos negativos FP = n√∫mero de falsos positivos FN = n√∫mero de falsos negativos En el problema general de clasificaci√≥n binaria, la denominaci√≥n ‚Äúpositivo‚Äù corresponde a ‚Äúidentificado‚Äù y ‚Äúnegativo‚Äù a ‚Äúrechazado‚Äù, as√≠ se da la siguiente correspondencia: ÔÇ∑ Verdadero Positivo: elemento correctamente identificado ÔÇ∑ Falso Positivo: elemento incorrectamente identificado ÔÇ∑ Verdadero Negativo: elemento correctamente rechazado 31 ÔÇ∑ Falso Negativo: elemento incorrectamente rechazado En el problema particular de clasificaci√≥n de v√≥xeles como tumorales o no se definen verdadero positivo, verdadero negativo, falso positivo y falso negativo de la siguiente manera: ÔÇ∑ Verdadero Positivo: v√≥xel tumoral identificado correctamente como tumoral ÔÇ∑ Falso Positivo: v√≥xel no tumoral identificado incorrectamente como tumoral ÔÇ∑ Verdadero Negativo: v√≥xel no tumoral identificado como no tumoral ÔÇ∑ Falso Negativo: v√≥xel tumoral identificado incorrectamente como no tumoral En general, un clasificador binario perfecto ser√≠a uno con sensibilidad = 1 y especificidad = 1. La puntuaci√≥n m√≠nima, para ambas m√©tricas, es 0 [Koller09]. En el caso de la segmentaci√≥n de tumores, un clasificador perfecto ser√≠a aquel que identifique a todo el tejido tumoral presente en un volumen de IRM y no identifique como tumoral al tejido sano. La sensibilidad mide la proporci√≥n de verdaderos positivos que son identificados. Es el n√∫mero de verdaderos positivos entre el n√∫mero total de elementos que aut√©nticamente pertenecen a la clase positiva, corresponde a la probabilidad con que un v√≥xel sea identificado como tumoral, dado que aut√©nticamente represente a un v√≥xel de tumor. La especificidad mide la proporci√≥n de verdaderos negativos, que corresponder√≠a a la probabilidad que un v√≥xel sea identificado como no tumoral, siendo aut√©nticamente no tumoral. La sensibilidad y la especificidad no deben ser evaluadas de manera separada. Un algoritmo clasificador que considere a los v√≥xeles de tumor como clase positiva, puede tener sensibilidad de 1 marcando todos los pixeles de una imagen de resonancia como tumorales, debido a que la sensibilidad no considera falsos positivos, en dicho caso, una sensibilidad "perfecta" corresponder√≠a a una especificidad nula. Si en una segmentaci√≥n se buscan v√≥xeles tumorales y de 100 v√≥xeles aut√©nticamente tumorales se identifican 78, la sensibilidad es 0.78. Si en una segmentaci√≥n se buscan v√≥xeles tumorales y de 100 v√≥xeles aut√©nticamente no tumorales se marcan 49 de estos como no tumorales, la especificidad es 0.49. En el problema de la segmentaci√≥n tumoral, una m√©trica que tiende a ser m√°s representativa de la calidad de la segmentaci√≥n alcanzada que las m√©tricas de sensibilidad o especificidad, evaluadas individualmente, es el coeficiente Dice, [Popovic07] que representa la uni√≥n de 2 32 conjuntos dividida por su tama√±o: Coeficiente Dice = 2 ‚àó |A ‚ãÇB| |A| + |B| En el caso de la segmentaci√≥n de tumor, un coeficiente Dice igual a 1 significa que hay perfecto solapamiento entre el tumor expresado en la verdad fundamental y el tumor identificado por el algoritmo segmentador. En t√©rminos de verdaderos positivos, verdaderos negativos, falsos positivos y falsos negativos, la cardinalidad de los conjuntos A y B y su intersecci√≥n, puede expresarse de la siguiente manera [Loni13]: Coeficiente Dice = 2 ‚àó VP (FP + VP) + (VP + FN) Cuando se desea considerar cuantitativamente la proporci√≥n de v√≥xeles o p√≠xeles que fueron correctamente identificados como pertenecientes a la clase positiva (v√≥xeles tumor, cuando se busca en el caso de la radiocirug√≠a), se utiliza la m√©trica de precisi√≥n [Prince12], definida como Precisi√≥n = VP VP + FP = VP #ùëù√≠ùë•ùëíùëôùëíùë† ùëú ùë£√≥ùë•ùëíùëôùëíùë† ùëíùë£ùëéùëôùë¢ùëéùëëùëúùë† Una m√©trica que es com√∫nmente evaluada contra la precisi√≥n, al usarla para evaluar segmentaciones binarias (por ejemplo, tumor contra background o edema contra background) es la sensibilidad, que en estad√≠sticas es tambi√©n llamada recall o exhaustividad [Koller09]. En la clasificaci√≥n binaria de v√≥xeles como tumorales o no tumorales, una precisi√≥n perfecta de 1.0 significa que cada v√≥xel identificado como tumoral es aut√©nticamente tumoral (aunque esto no representa que todos los v√≥xeles tumorales presentes en el volumen hayan sido identificados como tal) y una sensibilidad de 1.0 significa que todas los v√≥xeles tumorales presentes en el volumen fueron identificados como tal (aunque esto no representa cuantos v√≥xeles no tumorales fueron identificados como tumorales, m√©trica representada por la especificidad). La precisi√≥n y la sensibilidad tienen una relaci√≥n frecuentemente inversa, ya que es posible incrementar una m√©trica al costo de reducir la otra. La radiocirug√≠a cerebral provee un ejemplo de esta relaci√≥n inversa entre la precisi√≥n y la sensibilidad y la importancia del balance de estas m√©tricas para representar resultados deseables. Consid√©rese el resultado deseado en una cirug√≠a planeada para remover c√©lulas tumorales del cerebro de un paciente. Se desea que la cirug√≠a remueva todas las c√©lulas tumorales, debido a que cada c√©lula tumoral remanente despu√©s de la cirug√≠a permite al tumor volver a desarrollarse. Al mismo tiempo, la cirug√≠a debe evitar la 33 destrucci√≥n de c√©lulas cerebrales sanas, debido al perjuicio que esto ocasiona al paciente. El equipo m√©dico dedicado a la planificaci√≥n radioquir√∫rgica puede decidir irradiar un √°rea de extensi√≥n m√°xima, para asegurar la destrucci√≥n de todas las c√©lulas cancerosas, esta irradiaci√≥n extensa incrementa la sensibilidad, pero reduce la precisi√≥n del tratamiento. Por otra parte, el equipo m√©dico podr√≠a decidir irradiar un √°rea de extensi√≥n m√≠nima, tal vez con la intenci√≥n de prevenir alg√∫n da√±o a las facultades cognitivas del paciente. Esta decisi√≥n incrementa la precisi√≥n pero reduce la sensibilidad. Esto significa que una mayor sensibilidad incrementa la probabilidad de remover c√©lulas sanas (un resultado no deseable) e incrementa la probabilidad de remover todas las c√©lulas cancerosas (un resultado deseable). Una alta precisi√≥n reduce las posibilidades de remover c√©lulas saludables (resultado deseable) pero tambi√©n reduce la posibilidad de remover las c√©lulas cancerosas (resultado no deseable). Debido a que com√∫nmente se desea valorar conjuntamente a la precisi√≥n y a la sensibilidad, con igual ponderaci√≥n a ambas medidas, se utiliza la puntuaci√≥n F1, definida de la siguiente manera ùê∂ùëúùëíùëìùëñùëêùëñùëíùëõùë°ùëí ùê∑ùëñùëêùëí ùëú ùëö√©ùë°ùëüùëñùëêùëé ùêπ1 = 2 ‚àó ùëùùëüùëíùëêùëñùë†ùëñ√≥ùëõ ‚àó ùë†ùëíùëõùë†ùëñùëèùëñùëôùëñùëëùëéùëë ùëùùëüùëíùëêùëñùë†ùëñ√≥ùëõ + ùë†ùëíùëõùë†ùëñùëèùëôùëñùëëùëéùëë La puntuaci√≥n F1 es la media harm√≥nica de la precisi√≥n y la sensibilidad; es equivalente al Coeficiente Dice [O‚ÄôConnor12]. 2.4.1 Verdad Fundamental a Trav√©s de TumorSim En im√°genes de resonancia magn√©tica reales, la obtenci√≥n de datos de validaci√≥n y m√©tricas de comparaci√≥n para la segmentaci√≥n es una tarea dif√≠cil, debido a la ausencia de una verdad fundamental. Este problema es evidente en las im√°genes que presentan patolog√≠as, que alteran la apariencia del tejido a trav√©s de infiltraci√≥n y causan distorsiones geom√©tricas. El est√°ndar usual para la validaci√≥n de segmentaciones algor√≠tmicas, es la comparaci√≥n contra los resultados de segmentaci√≥n manual hechos por expertos humanos, pero esto es inconveniente y propenso a introducir errores debido a la com√∫n intervariabilidad e intravariabilidad de la percepci√≥n y el criterio humano. Por esto, para validar el desempe√±o de los distintos segmentadores (humanos o algor√≠tmicos), existe la necesidad de generar im√°genes sint√©ticas partiendo de una verdad fundamental que indique el tipo de tejido que aparece en cada v√≥xel de las im√°genes sint√©ticas producidas. Evidentemente, las im√°genes sint√©ticas deben ser altamente similares a im√°genes reales para que el proceso de segmentaci√≥n validado con ellas pueda resultar √∫til. 34 El software TumorSim combina el modelado f√≠sico y estad√≠stico para generar imagenolog√≠a sint√©tica de resonancia magn√©tica 3D multimodal con tumor y edema, junto con una verdad fundamental anat√≥mica subyacente. Se simula la apariencia de tejido sano y tumoral en IRM, sintetizando las im√°genes de textura en resonancias magn√©ticas reales. TumorSim enfatiza la simulaci√≥n de efectos conocidos de la presencia tumoral, como la distorsi√≥n local del tejido sano, la infiltraci√≥n de edema adyacente al tumor, destrucci√≥n y formaci√≥n de tractos de fibras y contraste multimodal de tejido sano y tejido patol√≥gico [Prastawa09]. a) b) Figura 2.13 - TumorSim a) Corte de resonancia magn√©tica sint√©tico en el canal T2, producido por TumorSim, incluyendo tumor y edema. b) Verdad fundamental producida por TumorSim para el mismo corte, indicando la verdadera presencia de 4 clases de tejido sano, adem√°s de edema y tejido tumoral. Imagen mostrada con el mapa de color jet de Matlab. 35 CAP√çTULO 3 - M√âTODOS DE SEGMENTACI√ìN DE IMAGENOLOG√çA DE RESONANCIA MAGN√âTICA La segmentaci√≥n es el proceso de dividir una imagen en regiones con propiedades similares, tales como nivel de gris, color o textura. En el caso de la segmentaci√≥n de im√°genes m√©dicas, las metas son: ÔÇ∑ Estudiar cualitativamente estructuras anat√≥micas. ÔÇ∑ Identificar regiones de inter√©s. ÔÇ∑ Medir volumen de tejido, por ejemplo para medir crecimiento de tumor, o reducci√≥n del mismo por tratamiento. ÔÇ∑ Ayuda en c√°lculo de dosis de radiaci√≥n en el planeamiento del tratamiento de radioterapia. Dependiendo del grado de interacci√≥n requerido por el usuario, las t√©cnicas de segmentaci√≥n de im√°genes m√©dicas se dividen en las categor√≠as: "autom√°tica" y "asistida''. En la pr√°ctica, todos los sistemas actuales son asistentes al usuario experto en la evaluaci√≥n de im√°genes, los sistemas actuales de inteligencia artificial son incapaces de generar aut√≥nomamente modelos de reducci√≥n y abstracci√≥n de caracter√≠sticas visuales salientes, a√∫n no se ha eliminado la necesidad de operadores humanos expertos para validar la calidad de las segmentaciones y la segmentaci√≥n permanece como uno de los problemas m√°s desafiantes de la visi√≥n por computador. 3.1 Segmentaci√≥n Autom√°tica La segmentaci√≥n autom√°tica de im√°genes m√©dicas de resonancia magn√©tica es una tarea dif√≠cil debido a que estas rara vez poseen caracter√≠sticas lineales simples. Los sistemas actuales de segmentaci√≥n autom√°tica t√≠picamente dependen de alg√∫n par√°metro suministrado por el usuario indicando morfolog√≠a o nivel digital de inter√©s en la imagen. La generaci√≥n de segmentaciones de estructuras anat√≥micas fiables, con m√≠nima interacci√≥n humana es un tema abierto de investigaci√≥n, a continuaci√≥n se presentan algunas de las t√©cnicas relevantes en la literatura actual. 3.1.1 Clustering por K-means Los m√©todos de clustering agrupan muestras de vectores de n dimensiones de forma tal que las 36 caracter√≠sticas de las muestras pertenecientes a un mismo grupo tengan la m√°xima similitud posible entre s√≠. K-means es un m√©todo de clustering que agrupa datos multidimensionales utilizando medidas de semejanza mutua basadas en distancia. Com√∫nmente, est√° basado en la suma del cuadrado de la distancia euclidiana entre las muestras en un cluster (grupo) y el centro del cluster. K-means busca minimizar la suma de estas distancias para obtener clusters compactos. Un k-means para segmentar im√°genes se basa en el siguiente algoritmo: 1. Se crean aleatoriamente k prototipos de centroide ùúáùëñ. 2. Se asigna una etiqueta a los elementos en la muestra correspondiente a su centroide m√°s cercano, utilizando la siguiente relaci√≥n: ùë• ‚àà ùê∂ùëó(ùëò) ùë†ùëñ |ùë• ‚àí ùëßùëó| < |ùë• ‚àí ùëßùëñ|, ‚àÄùëñ = 1,2,‚Ä¶ . , ùêæ; ùëñ ‚â† ùëó; donde ùê∂ùëó(ùëò) representa al grupo de muestras del cluster ùëßùëó 3. Luego de haber asignado todos los p√≠xeles, se recalculan los centroides usando la siguiente ecuaci√≥n: ùëçùëñ = 1 ùëÅùëó ‚àë ùë•, ùëó = 1,2, ‚Ä¶ ,ùêæ ùë•‚ààùê∂ùëó(ùëò) ùëÅùëóes el n√∫mero de muestras en ùê∂ùëó(ùëò). 4. Los pasos 2 y 3 son repetidos hasta que los centroides convergen. 37 Figura 3.1 - K-means aplicado en cortes de PET-CT, usando K=15 Una limitaci√≥n del m√©todo es que el resultado de segmentaci√≥n obtenido es dependiente del n√∫mero de centroides establecidos antes de iniciar el algoritmo (ver Figura 3.1). El n√∫mero de centroides adecuado para lograr una segmentaci√≥n √∫til, debe establecerse a trav√©s de ensayo y error. Otro inconveniente del m√©todo, es que incrementar el n√∫mero de centroides incrementa linealmente el tiempo necesario para obtener la clasificaci√≥n. 3.1.2 Segmentaci√≥n con Modelos Gr√°ficos Probabil√≠sticos En IRM cerebral se puede aprovechar que hay caracter√≠sticas constantes entre los elementos de la imagen y que estos elementos corresponden a un n√∫mero limitado de clases. Adem√°s, se presenta un contraste relativamente alto entre tejidos. Alterando la frecuencia de radio y los pulsos de gradiente en que son registradas las im√°genes, y ajustando cuidadosamente los tiempos de relajaci√≥n, es posible destacar distintos componentes en el objeto siendo examinado y producir im√°genes de alto contraste entre distintos tejidos. Sin embargo, las condiciones ideales de imagenolog√≠a dif√≠cilmente se presentan en la pr√°ctica. La propiedad de caracter√≠sticas constantes para cada elemento en la imagen, se ve degradada considerablemente por el ruido electr√≥nico, el campo de sesgo (que es producto de inhomogeneidades en el campo de frecuencia de radio) y el efecto de volumen parcial (que ocurre cuando m√∫ltiples clases de tejido pueden ocupar un mismo v√≥xel). Estos problemas de medici√≥n causan que las clases se solapen en un histograma de 38 intensidades de gris en la imagen. Adem√°s, las im√°genes de resonancia magn√©tica no siempre proporcionan alto contraste, y distintas modalidades de IRM tienden a resaltar mejor los contornos de determinados tipos de tejido o edema en el cuerpo. [Zhang01]. Esta incertidumbre, propia de la imagenolog√≠a, es manejada a trav√©s del marco matem√°tico de la teor√≠a de la probabilidad. La segmentaci√≥n autom√°tica de tumores cerebrales con modelos gr√°ficos probabil√≠sticos, se realiza en base a an√°lisis estad√≠sticos relacionados a atlas anat√≥micos [Warfield01], [Prastawa04], donde los tumores son considerados outliers 4 , estructuras cuya probabilidad de presencia en una anatom√≠a normal es considerada baja. Los m√©todos de segmentaci√≥n derivados de atlas 5 identifican las estructuras an√≥malas y arrojan resultados positivos de tumor, cuando un tejido se presenta de forma at√≠pica en la anatom√≠a cerebral. Estos m√©todos basados en atlas, pueden ser tanto generativos como discriminativos y requieren ser entrenados a partir de los datos de pacientes con diversas patolog√≠as. Los m√©todos discriminativos de segmentaci√≥n autom√°tica de tumores, est√°n limitados a funcionar en la modalidad de datos del conjunto de entrenamiento y son sensibles a los datos faltantes. Los modelos generativos pueden generalizar directamente a observaciones multi-canal 6 , pero no permiten modelar las diferencias entre los procesos biol√≥gicos observados en varias modalidades. Asumiendo la misma forma y extensi√≥n de patolog√≠a en todas las modalidades, la segmentaci√≥n est√°ndar multi-canal puede ignorar mucha de la informaci√≥n potencialmente disponible en las im√°genes. Ejemplos de esto, incluyen las diferencias de agua en tejidos (T2, FLAIR), uso de agentes de contraste (gadolinio), difusi√≥n (DTI, DCE) o concentraciones relativas de metabolitos selectos (MRSI). Delinear independientemente el √°rea de tumor en cada una de estas modalidades, es com√∫nmente preferido para el subsiguiente an√°lisis cuantitativo de la forma del tumor y su evoluci√≥n [Menze10]. 3.1.2.1 Aprendizaje e Inferencia La segmentaci√≥n y posterior clasificaci√≥n de im√°genes son parte esencial de la visi√≥n por 4 En estad√¨stica, un outlier es una observaci√≥n a una o m√°s desviaciones est√°ndar de la media de la data. 5 En la segmentaci√≥n de im√°genes m√©dicas, un atlas es un mapa probabil√≠stico de regiones encontradas en una anatom√≠a normal. 6 Aunque una especificaci√≥n detallada de las variadas modalidades de IRM se escapa del alcance de este trabajo, es importante se√±alar que cada una de las modalidades ofrece variaciones de contraste entre los tejidos: algunas son m√°s apropiadas para identificar edema, otras para identificar materia blanca, materia gris, etc. Para prop√≥sitos de segmentaci√≥n de im√°genes, cada modalidad ofrece vectores de caracter√≠sticas distintasenla imagen, y es referida como canal. 39 computador. En general, la meta de la visi√≥n por computador es usar datos observados en una imagen para inferir algo acerca del estado del mundo al que corresponden. Por ejemplo, se podr√≠a observar la imagen de una persona y usar los datos en ella para inferir el contorno de su rostro y luego su identidad. Esta labor de inferencia es modelable a trav√©s del marco matem√°tico de la teor√≠a de la probabilidad [Prince12]. La meta de este marco te√≥rico, es describir la metodolog√≠a probabil√≠stica usada para tratar problemas de segmentaci√≥n de im√°genes cerebrales en resonancia magn√©tica. Una amplia variedad de m√©todos estad√≠sticos param√©tricos han sido formulados. Este tipo de m√©todos etiqueta p√≠xeles de acuerdo a valores de probabilidad, los cuales son determinados con base en la distribuci√≥n de intensidad de la imagen. Asumiendo informaci√≥n apropiada para la distribuci√≥n de intensidad de la imagen, los m√©todos estad√≠sticos intentan resolver el problema de estimar la etiqueta de clase asociada a ellos, conociendo s√≥lo la intensidad de cada p√≠xel. Este problema de estimaci√≥n es necesariamente formulado en base a un criterio establecido. Por ejemplo, los principios de maximum a posteriori (MAP) y m√°xima verosimilitud, son dos de estos criterios establecidos para formular la estimaci√≥n de etiquetas de clase de tejido correspondientes a los p√≠xeles de la imagen [Zhang01]. En los problemas de visi√≥n por computador modelados a trav√©s de la teor√≠a de la probabilidad, se toman datos visuales x y estos se utilizan para inferir el estado del mundo w. Este estado del mundo w puede ser continuo o discreto. Cuando el estado del mundo es continuo, se llama al proceso de inferencia regresi√≥n y cuando el estado del mundo es discreto, se llama al proceso de inferencia clasificaci√≥n [Prince12]. En los problemas de clasificaci√≥n de tejidos cerebrales en RM, los datos visuales x corresponden a la intensidad y posici√≥n de los p√≠xeles o v√≥xeles en una imagen, y el estado del mundo w a la etiqueta anat√≥mica (materia blanca, materia gris, l√≠quido cerebroespinal, tumor, edema, etc.) correspondiente a un p√≠xel, v√≥xel o superp√≠xel dado. Existe incertidumbre inherente a los datos del mundo x; una interpretaci√≥n dada puede ser compatible con m√°s de un estado del mundo debido a la ambig√ºedad inherente en la percepci√≥n de los datos visuales; por ejemplo: un pedazo de carb√≥n visto bajo una luz brillante puede producir las mismas medidas de luminancia que un papel blanco en luz tenue; similarmente, un objeto peque√±o visto de cerca puede producir la misma imagen que un objeto grande que se encuentre a una distancia mucho mayor [Prince12]. Para tratar dicha la ambig√ºedad perceptual, propia del proceso de observaci√≥n, se considera la distribuci√≥n de probabilidad a posteriori P(w|x) sobre los estados posibles w. La probabilidad a posteriori de un evento aleatorio es la probabilidad condicional que es asignada luego de que la evidencia es tomada en cuenta [Koller09]. En los problemas de visi√≥n de 40 computador, el evento aleatorio corresponde al estado del mundo, w, y la evidencia a los datos visuales, x, as√≠ que se deben considerar todos los posibles estados del mundo generables con un conjunto de datos visuales y asignar una ponderaci√≥n probabil√≠stica a cada uno de estos posibles estados [Prince12]. 3.1.2.2 Tipos de Modelos Probabil√≠sticos Existen variadas familias de modelos probabil√≠sticos (las redes bayesianas, los campos aleatorios de Markov y los campos aleatorios condicionales, entre otros) y a cada una corresponden algoritmos de aprendizaje e inferencia propios. Los modelos que relacionan los datos x al estado del mundo w, caen en una de dos categor√≠as: ÔÇ∑ Discriminativos: aquellos que modelan la contingencia del estado del mundo, dados los datos, P(w|x). ÔÇ∑ Generativos: aquellos que modelan la contingencia de los datos, dado el estado del mundo, P(x|w). El aprendizaje y la inferencia son profundamente distintos entre el grupo de los modelos generativos y los modelos discriminativos. Cada grupo constituye una familia propia de m√©todos y algoritmos [Prince12]. Para el problema de la segmentaci√≥n autom√°tica de tumores, ambos tipos de modelos enfrentan dificultades de implementaci√≥n. Los modelos generativos ofrecen la facilidad de incorporar informaci√≥n espacial y generalizarse directamente a observaciones multi-canal, pero son incapaces de representar directamente las diferencias biol√≥gicas observadas en los varios canales. Para lograr esto Menze et al. [Menze10], utiliza informaci√≥n adicional incorporada a un atlas oculto, obtenido a trav√©s del algoritmo de Esperanza-Maximizaci√≥n. En cambio, los modelos discriminativos a pesar de ser m√°s sensibles a las diferencias biol√≥gicas presentes en cada canal de visualizaci√≥n MRI, est√°n limitados a ejecutarse en el canal que fue usado para el entrenamiento y tienden a ser sensibles a los datos faltantes [Menze10]. a) Modelos Discriminativos Para modelar la contingencia del mundo a los datos, P(w|x), se elige una forma apropiada para la distribuci√≥n, P(w), sobre los estados del mundo, w, y se hace que los par√°metros de la distribuci√≥n 41 se comporten como una funci√≥n de los datos, x. Por ejemplo, si el estado del mundo es continuo, se puede modelar P(w) con una distribuci√≥n normal y hacer que la media Œº de la distribuci√≥n sea una funci√≥n de los datos x. El valor que esta funci√≥n retorna tambi√©n depende de un conjunto de par√°metros de ajuste, Œ∏. Debido que la distribuci√≥n posterior sobre el estado del mundo depende tanto de los datos como de estos par√°metros de ajuste, la escribimos como P(w|x,Œ∏). La meta del algoritmo de aprendizaje es ajustar los par√°metros, Œ∏ usando data de entrenamiento {xi, wi} I . Esto puede hacerse trav√©s de los m√©todos de m√°xima verosimilitud, maximum a posteriori o por m√©todos bayesianos [Prince12]. La meta del algoritmo de inferencia es encontrar una distribuci√≥n sobre los posibles estados del mundo w para una nueva observaci√≥n x. La inferencia probabil√≠stica tiende a ser un problema NP-completo en la mayor parte de los modelos y se maneja con m√©todos variados de aproximaci√≥n, como el muestreo aleatorio [Koller09]. b) Modelos Generativos Para modelar la contingencia de los datos, dado el mundo, P(x|w), se elige la forma para la distribuci√≥n P(x) sobre los datos y los par√°metros de la distribuci√≥n, Œ∏, son una funci√≥n del estado del mundo w. Por ejemplo, si los datos fueran discretos y multi-valuados se podr√≠a usar una distribuci√≥n multinomial y hacer que el vector de par√°metros (correspondiente al n√∫mero discreto de categor√≠as) Œª sea una funci√≥n del estado del mundo w [Prince12]. El valor que esta funci√≥n retorne, tambi√©n depende de un conjunto de par√°metros Œ∏. Debido a que la distribuci√≥n P(x) depende, tanto del estado del mundo como de estos par√°metros, se le expresa como P(x|w,Œ∏) y se le llama verosimilitud. La meta del aprendizaje es ajustar los par√°metros Œ∏ usando ejemplos de aprendizaje, dados en pares {xi,wi} I . Durante el proceso de inferencia, la meta es calcular la distribuci√≥n posterior P(w|x). Para esto, se especifica una distribuci√≥n a priori P(w) sobre los estados del mundo y se usa luego la regla de Bayes [Prince12]: ÔÉ≤ ÔÄΩ ))()|( )()|( )|( dwwPwxP wPwxP xwP Aqu√≠ se ha modelado de forma conjunta la verosimilitud P(x|w) y la distribuci√≥n a priori 42 P(w) y se multiplican en el numerador de la regla de Bayes. Hay que destacar que tambi√©n se pudo haber modelado, de forma equivalente, la distribuci√≥n conjunta P(x,w) = P(x|w)*P(w),ya que los modelos generativos tambi√©n pueden ser expresados usando la distribuci√≥n conjunta. En la aplicaci√≥n de segmentaci√≥n autom√°tica presentada por Menze et al. [Menze10], se modela la relaci√≥n entre los datos visuales y el estado del mundo (ausencia o presencia de tumor en cada v√≥xel) con un Campo Aleatorio de Markov. Luego se entrena al modelo en base a un conjunto de datos que permiten ajustar par√°metros para estimar la verdadera segmentaci√≥n de tumor entre varios canales de imagen y finalmente, se realiza inferencia a trav√©s de los nuevos datos, para lograr identificar como tumores a los outliers anat√≥micos en datos nuevos. Figura 3.2 - Segmentaciones espec√≠ficas al canal para cuatro modalidades en dos pacientes Los contornos de las regiones con probabilidad de tumor > 0.5 para los par√°metros estimados son mostrados en rojo. Se puede apreciar como las fronteras de tumor var√≠an entre las distintas modalidades. Una desventaja del m√©todo es que produce falsos positivos que deben ser eliminados en un paso de post-procesamiento. 3.2 Segmentaci√≥n Asistida de IRM Aunque las t√©cnicas de segmentaci√≥n autom√°tica est√°n siendo constantemente mejoradas, ninguna t√©cnica automatizada de an√°lisis de im√°genes puede ser aplicada de forma completamente aut√≥noma con resultados garantizados (refiri√©ndose esto a alta sensibilidad y especificidad) en todo caso. Por esto es que las t√©cnicas de segmentaci√≥n asistida, que permiten resolver tareas de segmentaci√≥n de dificultad alta y moderada con un esfuerzo modesto por parte del usuario, han mantenido popularidad [Vezhnevets05]. Varias t√©cnicas poderosas de segmentaci√≥n asistida han sido propuestas, basadas en 43 transformadas watershed, contornos activos [Blake98], graphcuts [Boykov01], [Rother04], y Random Walker [Grady04]. Estas t√©cnicas realizan segmentaciones de alta calidad requiriendo poco esfuerzo por parte del usuario. Las im√°genes m√©dicas tienen propiedades √∫nicas. En muchos casos, como en la imagenolog√≠a de resonancia magn√©tica, est√°n en escala de grises y los objetos que deben ser segmentados son muy diferentes en su estructura y apariencia a los objetos que son comunes en la edici√≥n de fotos, probablemente por esto es que tanto esfuerzo de investigaci√≥n ha sido dedicado a desarrollar m√©todos de segmentaci√≥n espec√≠ficos para el dominio de las im√°genes m√©dicas. Aun as√≠, varias t√©cnicas de segmentaci√≥n gen√©ricas, como GraphCut, pueden ser exitosamente aplicadas a las im√°genes m√©dicas [Vezhnevets05]. Algunas t√©cnicas de segmentaci√≥n asistida ‚Äúm√©dica‚Äù son mencionadas a continuaci√≥n. 3.2.1 Crecimiento de Regi√≥n En esta t√©cnica, inicialmente se considera el p√≠xel semilla dentro del objeto de inter√©s marcado por el usuario. Luego los p√≠xeles vecinos son iterativamente a√±adidos a la regi√≥n de crecimiento, en caso de que se cumpla alg√∫n criterio de homogeneidad de la regi√≥n. Los criterios pueden ser definidos seg√∫n intensidad de v√≥xel o p√≠xel, varianza, color, forma, etc. El principal problema con este m√©todo, es el desbordamiento de la regi√≥n de crecimiento a trav√©s de fronteras ‚Äúd√©biles‚Äù [Heinmann04]; estas son regiones donde el criterio de separaci√≥n falla. Otra limitaci√≥n de este m√©todo, es que s√≥lo funciona con s√≥lo dos etiquetas (K=2), correspondientes a objeto de inter√©s y fondo. Adem√°s, el m√©todo es altamente sensible a las posiciones de las semillas originales y no es robusto frente al ruido, causando con frecuencia que las regiones extra√≠das tengan desconexiones innaturales, por ejemplo, en la Figura 3.3c, se puede apreciar como parte del globo ocular derecho del corte axial de IRM, es incluido en la segmentaci√≥n final como objeto de inter√©s, pero el izquierdo no. 44 Figura 3.3 - Etapas del algoritmo de crecimiento de regiones en el corte axial de una IRM. 3.2.2 Transformada Watershed Basada en Marcadores La transformada watershed es una t√©cnica morfol√≥gica de segmentaci√≥n de im√°genes 2D y 3D basada en regiones. La idea es originaria del campo de la topograf√≠a, donde en un relieve de regi√≥n existen fronteras de separaci√≥n entre las cuencas de deyecci√≥n de r√≠os y lagos. La transformada watershed trata la imagen como una superficie con un relieve especificado por la luminancia de los p√≠xeles o por el valor absoluto del gradiente de la imagen (a mayor luminancia o mayor gradiente mayor elevaci√≥n para el terreno simulado, generando mayor separaci√≥n entre regiones contiguas). En el algoritmo de watershed original, se usan fuentes simuladas de agua en cada uno de los m√≠nimos locales de luminancia o gradiente en la imagen, que representan cuencas. Cada cuenca es llenada con agua hasta que √©sta alcanza el punto m√°s alto del relieve, formando represas (watersheds) en los puntos donde el agua de diversas cuencas se encuentra. Cuando la transformaci√≥n se aplica a una imagen gradiente, se espera que las zonas segmentadas producidas por la imagen se ajusten a regiones homog√©neas en nivel de gris en la imagen. Sin embargo, en una imagen con una alta cantidad de m√≠nimos locales o ruido (situaci√≥n que frecuentemente ocurre en la IRM), es com√∫n que se produzca sobre-segmentaci√≥n de la imagen. Una soluci√≥n a este problema, es utilizar marcadores especificados por el usuario para inundar el mapa de gradiente o luminancia de la imagen, empezando por estos marcadores en lugar de los m√≠nimos regionales [Moga96]. Los marcadores colocados en la imagen especifican las etiquetas iniciales y deben ser segmentados entre s√≠. La Figura 3.4 muestra estos marcadores (a) b) c) 45 originales como segmentos de l√≠nea negra. Los marcadores pueden ser vistos como agujeros en el relieve de la imagen por donde el agua es vaciada mientras el relieve se inunda; cada marcador corresponde a una etiqueta distinta y hace que la imagen sea separada en una regi√≥n propia para √©l. A medida que el relieve de la imagen es llenado con agua, las cuencas de diferentes marcadores pueden encontrarse, pero no mezclarse. Esto representa una soluci√≥n parcial al problema de alta presencia de m√≠nimos, que a√∫n con marcadores, puede generar sobre-segmentaci√≥n en la imagen que debe ser atacada con procesamiento adicional, como filtrado anisotr√≥pico, uso de contornos activos o uni√≥n de regiones adyacentes [Szeliski10]. Figura 3.4 - Transformada Watershed a) Imagen original con marcadores semilla (segmentos de l√≠nea) a√±adidos. b) Imagen segmentada. N√≥tese como las regiones con puntos fueron separadas 3.2.3 M√©todos Basados en Contornos Activos En estos m√©todos hay una curva frontera que se mueve iterativamente para segmentar una regi√≥n de inter√©s, el movimiento de esta curva frontera es determinado usando la combinaci√≥n de fuerzas (tambi√©n llamados potenciales) en la imagen, como presencia de energ√≠a de luminancia, y gu√≠as de segmentaci√≥n provistas por el usuario. Se llama a estos modelos ‚Äúactivos‚Äù debido a su naturaleza iterativa, basada en la minimizaci√≥n de funciones de energ√≠a, lo que les permite exhibir comportamientos din√°micos. El primero de estos m√©todos, originalmente llamado snakes por sus inventores [Blake88], es a) b) 46 una curva spline (curva diferenciable, definida a trozos mediante polinomios) bidimensional, que evoluciona (se mueve) hacia caracter√≠sticas de la imagen como bordes fuertes. El segundo, tijeras inteligentes permite al usuario bosquejar en tiempo real una curva que busca adherirse a las fronteras del objeto [Mortensen95]. Finalmente, las t√©cnicas levelset [Levelsets96], hacen que la curva evolucione como un conjunto derivado a partir de una funci√≥n caracter√≠stica, lo que les permite cambiar topolog√≠a e incorporar estad√≠sticas basadas en cada regi√≥n. 3.2.3.1 Snakes El m√©todo snakes es una spline 7 deformable, minimizadora de energ√≠a, influenciada por restricciones impuestas por el usuario y fuerzas en la imagen, que mueven la curva hacia los contornos del objeto. Como se muestra en la Figura 3.3, evoluciona hacia contornos cerrados. Un snake est√° definido por: ÔÇ∑ Un conjunto de n puntos ÔÇ∑ Un t√©rmino de energ√≠a el√°stica interna ÔÇ∑ Un t√©rmino de energ√≠a basado en bordes externos Se puede visualizar el snake como una banda de goma que se deforma en el tiempo, tratando de adaptarse al contorno del objeto. Las snakes no resuelven por s√≠ mismas el problema de encontrar contornos en im√°genes. Dependen de informaci√≥n suministrada por el usuario y son sensibles a una ‚Äúmala‚Äù inicializaci√≥n por parte del mismo durante toda su evoluci√≥n. El contorno de la snake est√° definido por un conjunto de n puntos vi = (xi,yi), donde i = 0‚Ä¶n-1. Se busca minimizar la funci√≥n de energ√≠a total de una snake que se define como ùê∏ùë†ùëõùëéùëòùëíùë£(ùë†)ùëëùë† = ‚à´ (ùê∏ùëñùëõùë°ùëíùëüùëõùëé(ùë£(ùë†)) + ùê∏ùëñùëöùëéùëîùëíùëõ(ùë£(ùë†)) + ùê∏ùëüùëíùë†ùë°ùëüùëñùëêùëêùëñùëúùëõùëíùë†ùë£(ùë†))ùëëùë† 1 0 , donde s representa el espacio que el snake ocupa. ùê∏ùëüùëíùë†ùë°ùëüùëñùëêùëêùëñùëúùëõùëíùë† representa las fuerzas de energ√≠a introducidas por el usuario al bosquejar la curva. La suma de los t√©rminos de imagen y restricciones denota la energ√≠a externa actuando en el spline. Einterna representa la energ√≠a interna del spline (snake) debida a su doblamiento, es la suma de la energ√≠a del contorno de la snake y la energ√≠a de la 7 Un spline es una curva derivable definida a trozos mediante polinomios. 47 curvatura del spline, ùê∏ùëêùë¢ùëüùë£ = ùê∏ùëêùëúùëõùë° + ùê∏ùëêùë¢ùëüùë£. ùê∏ùëñùëöùëéùëîùëíùëõ, denota las fuerzas de la imagen actuando en el spline; tiene tres componentes: l√≠neas, bordes y terminaciones, que pueden ser representados como ùê∏ùëñùëöùëéùëîùëíùëõ = ùë§ùëôùëñùëõùëíùëéùê∏ùëôùëñùëõùëíùëé +ùë§ùëèùëúùëüùëëùëíùê∏ùëèùëúùëüùëëùëí+ùë§ùë°ùëíùëüùëöùê∏ùë°ùëíùëüùëö. Los coeficientes w ajustan los pesos que se le dar√°n a cada una de las caracter√≠sticas salientes en la imagen. ùê∏ùëôùëñùëõùëíùëé es la intensidad de la imagen, que puede ser representada por ùê∏ùëôùëñùëõùëíùëé = ùêº(ùë•, ùë¶). Dependiendo del signo del coeficiente ùë§ùëôùëñùëõùëíùëé, la l√≠nea se ver√° atra√≠da por l√≠neas oscuras o claras. ùê∏ùëèùëúùëüùëëùëí, con un alto coeficiente de peso, har√° que el snake se vea atra√≠do por contornos con grandes gradientes de imagen. ùê∏ùë°ùëíùëüùëö considera las esquinas y terminaciones en una imagen. Las Figura 3.5 muestra un ejemplo de snakes segmentando efectivamente labios en distintas posiciones para hacer lip tracking. Las limitaciones de snakes son: ÔÇ∑ Dificultad para ajustar la curva sobre m√≠nimos locales de energ√≠a. ÔÇ∑ A menudo obvian caracter√≠sticas de peque√±o tama√±o en la figura original, debido a que la minimizaci√≥n ocurre sobre todo el recorrido del contorno. ÔÇ∑ Su precisi√≥n est√° gobernada por los criterios de convergencia usados en la t√©cnica de minimizaci√≥n de energ√≠a; mayor precisi√≥n requiere criterios de convergencia ajustados a la figura particular. Figura 3.5 - Contornos activos de snakes 3.2.3.2 Tijeras Inteligentes Los contornos activos permiten al usuario bosquejar de forma tosca una frontera de inter√©s y 48 hacer que el sistema evolucione el contorno hacia una locaci√≥n m√°s certera. Sin embargo, los resultados de esta evoluci√≥n pueden ser impredecibles y requerir gu√≠as adicionales por parte del usuario para lograr el resultado deseado. Un enfoque alternativo, es hacer que el sistema optimice el contorno en tiempo real a medida que el usuario dibuja, como el sistema de tijeras inteligentes [Mortensen95]. A medida que el usuario dibuja un bosquejo tosco (que corresponde a la curva blanca en la Figura 3.6) el sistema computa y dibuja una mejor curva que se adhiere a los bordes de alto contraste (la curva amarilla en la Figura 3.6). Figura 3.6 - Tijeras Inteligentes El usuario traza el contorno blanco. El sistema de tijeras inteligentes dibuja el contorno amarillo alrededor del objeto. Las curvas verdes muestran posiciones intermedias de evoluci√≥n del live-wire. Para computar el camino √≥ptimo de la curva (llamado live-wire), la imagen es primero pre- procesada para asociar bajos costos con bordes que tengan probabilidad de ser elementos de frontera. El sistema propuesto por Mortensen y Barrett, computa estos costos evaluando magnitudes y orientaciones de gradientes, as√≠ como puntos donde √©ste se cruza con cero. Luego, a medida que el usuario traza una curva tosca, el sistema continuamente recomputa el camino de costo m√≠nimo entre el punto de semilla inicial y la ubicaci√≥n actual del cursor que traza la curva, utilizando el algoritmo de Dijkstra [Dijkstra59]. Para prevenir que la curva salte de forma impredecible, el sistema ‚Äúcongelar√°‚Äù la curva, reiniciando el punto de semilla, luego de un per√≠odo de inactividad. Para prevenir que el live-wire salte a regiones adyacentes de alto contraste, el sistema tambi√©n ‚Äúaprende‚Äù la intensidad de la curva actual y la usa para mantener al live-wire movi√©ndose a lo largo de una frontera similar. 49 3.2.3.3 Level-Sets Una limitaci√≥n de las t√©cnicas de tijeras inteligentes y snakes, es que es dif√≠cil cambiar la topolog√≠a de la curva a medida que evoluciona a trav√©s de un contorno cerrado. Para enfrentar este problema, los m√©todos level-set consideran el(los) cruzamiento(s) de una funci√≥n caracter√≠stica que define a la curva. Los level sets evolucionan para ajustar y registrar objetos de inter√©s modificando una funci√≥n de incrustaci√≥n (que es otro nombre dado a la funci√≥n caracter√≠stica) en lugar de la curva f(s) que considera snakes. Un ejemplo de funci√≥n de incrustaci√≥n, es la de contorno activo geod√©sico propuesto por Caselles et al. [Casselles97]: ùëëŒ¶ ùëëùë° = |‚àáŒ¶|ùëëùëñùë£ (ùëî(ùêº) ‚àáŒ¶ |‚àáŒ¶| ) = ùëî(ùêº)|‚àáŒ¶|ùëëùëñùë£ ( ‚àáŒ¶ |‚àáŒ¶| ) + ‚àág(I) ‚àô ‚àáŒ¶, Ec. 3.1 donde ùëî(ùêº) es una versi√≥n generalizada del potencial de bordes de snakes. Un entendimiento intuitivo acerca del comportamiento de esta curva, es que la funci√≥n de incrustaci√≥n es una funci√≥n de distancia con signo, que cuando se encuentra alejada de la curva, | Œ¶ |=1, como se ilustra en la Figura 3.7. El primer t√©rmino en la Ecuaci√≥n 3.1 mueve la curva en la direcci√≥n de su curvatura, lo que la ‚Äúendereza‚Äù, bajo la influencia de la funci√≥n de modulaci√≥n ùëî(ùêº). El segundo t√©rmino mueve la curva a lo largo del gradiente de ùëî(ùêº), influenciando a la curva para que se mueva hacia los m√≠nimos de ùëî(ùêº). El primer t√©rmino de la ecuaci√≥n evita que la curva se quede atascada en m√≠nimos locales, como com√∫nmente ocurre en snakes, y el segundo t√©rmino hace que √©stos no sean ignorados. Aun as√≠, esto no solventa el problema de atascamiento en m√≠nimos, debido a que depende de los gradientes de imagen, que son medidas locales, por lo que el m√©todo level-set es com√∫nmente parte de frameworks de segmentaci√≥n en donde primero se usan m√©todos de medici√≥n de energ√≠a en la imagen, como el graph-cut. 50 Figura 3.7 - Evoluci√≥n level-set para un contorno activo geod√©sico La funci√≥n de incrustaci√≥n Œ¶ es actualizada en base a la superficie subyacente modulada por la funci√≥n de bordes g(I) y su gradiente, haciendo que la curva sea atra√≠da a bordes fuertes. 3.3 Cortes en Grafos Es una t√©cnica de optimizaci√≥n combinatoria (flujo en redes), aplicada a la segmentaci√≥n de im√°genes [Boykov04]. La imagen es tratada como un grafo, donde cada p√≠xel representa un nodo y las aristas entre ellos tienen un peso relativo a una funci√≥n de energ√≠a. Para el caso de dos etiquetas (por ejemplo, objeto de inter√©s y fondo), el etiquetado √≥ptimo global (con respecto a la funci√≥n de costo definida) puede ser eficientemente computado por algoritmos de max-flow/min-cut. Esta t√©cnica puede ser aplicada a im√°genes de N dimensiones. Dados algunos p√≠xeles identificados por el usuario como objeto de inter√©s y fondo, el resto de los p√≠xeles pueden ser etiquetados autom√°ticamente. Este grafo, que representa a la imagen, es modelado como una red de flujo. Todas sus aristas tienen un valor positivo (referenciando una capacidad de flujo) y existe una fuente S y un destino T. Un corte m√≠nimo (min-cut) en una red de flujo, es una partici√≥n del grafo original en sub-conjuntos disjuntos, uno con el origen y otro con la fuente donde la capacidad de flujo (suma de valores de diferencia entre entrada y salida de flujo entre los nodos) sea la menor sobre todos los cortes posibles en la red. Como se ilustra en la Figura 3.8, cada v√©rtice del grafo es conectado con sus 8-vecinos (para el caso de im√°genes en 2D) a trav√©s de aristas no dirigidas llamadas N-links. As√≠, el peso de cada 51 arista corresponde a un costo por discontinuidad entre los p√≠xeles. Adicionalmente, se agregan dos v√©rtices especiales llamados la fuente s y el destino t. La fuente representa el objeto de inter√©s a segmentar en la imagen, y el destino representa el fondo. Todos los v√©rtices del grafo est√°n conectados por una arista con la fuente y otra al destino, estas aristas son llamadas T-links y su valor corresponde al costo para etiquetar al v√©rtice como parte de la fuente o el destino. A partir del grafo de flujo se calcula el corte m√≠nimo que divide al grafo original en dos grafos disconexos, uno conectado al v√©rtice fuente (objeto de inter√©s) y otro al destino (fondo). Los otros v√©rtices del grafo original se encuentran conectados a uno de estos dos grafos. Una limitaci√≥n de este m√©todo es que s√≥lo puede segmentar una imagen en dos conjuntos (K=2), objeto de inter√©s y fondo. Adem√°s debe considerarse el costo considerable de almacenar en memoria el grafo y su informaci√≥n de conectividad, lo que limita el tama√±o de las im√°genes o vol√∫menes que pueden ser segmentados. Figura 3.8 - Graph-Cut (A) P√≠xeles modelados con flujo a fuente y destino en el grafo original. (B) Grafo separado por el corte m√≠nimo. 3.3.1 GrabCut GrabCut es un m√©todo que extiende la usabilidad y poder de segmentaci√≥n del algoritmo GraphCut, mediante el uso de modelos de mezclas gaussianas. Como se ilustra en la Figura 3.9, el usuario dibuja un rect√°ngulo alrededor del objeto de inter√©s, dando la primera aproximaci√≥n del etiquetado final [Rother04]. Luego, cada paso de iteraci√≥n colecta estad√≠sticas de color, de acuerdo a 52 la segmentaci√≥n actual, usando modelos de mezclas gaussianas (GMM, gaussian mixture model) para darle valor a los T-links que conectan los p√≠xeles (o v√≥xeles, en el caso de vol√∫menes [Temoche11]), re-ponderando el grafo de la imagen, y aplica GraphCut para computar una nueva segmentaci√≥n refinada. Figura 3.9 ‚Äì Comparaci√≥n entre GraphCut (izquierda) y GrabCut (derecha) En GraphCut, el usuario dibuja semillas denotando objeto de inter√©s y fondo sobre la imagen. En GrabCut, se dibuja un rect√°ngulo alrededor del objeto de inter√©s para especificar la clase foreground en la segmentaci√≥n. En GrabCut se tiene un valor de intensidad, llamado matte, que indica si el p√≠xel/v√≥xel pertenece al objeto de inter√©s o al fondo. Este valor var√≠a a lo largo de la ejecuci√≥n del algoritmo e indica si el p√≠xel/v√≥xel pertenece al modelo de mezcla gaussiana del objeto de inter√©s (foreground) o del fondo (background). Para cada p√≠xel/v√≥xel,se almacena un n√∫mero de componente gaussiano al que pertenece; este n√∫mero, en conjunto con el matte, permite conocer a cual componente de los 10 creados ( 5 para el GMM foreground y 5 para el GMM background) pertenece el v√≥xel. Finalmente, se usan 3 marcas temporales para los p√≠xeles/v√≥xeles llamadas trimaps. Dichas marcas pueden ser de un p√≠xel/v√≥xel perteneciente al conjunto de fondo (background), objeto de inter√©s (foreground) o desconocido (unknown) y son colocadas por el usuario. Los trimaps no var√≠an a trav√©s de la ejecuci√≥n del algoritmo, al menos que el usuario modifique su posici√≥n para corregir la segmentaci√≥n. El algoritmo, paso a paso, puede describirse as√≠ [Temoche11]: a) El usuario sit√∫a un rect√°ngulo (en el caso 2D) o un cubo (bounding box, para el caso 3D) que contenga el objeto a segmentar. Los p√≠xeles/v√≥xeles fuera del √°rea son marcados como trimap background y los v√≥xeles dentro del cubo son marcados como trimap unknown. 53 b) Los p√≠xeles/v√≥xeles con trimap background son inicializados al valor de matte background, los p√≠xeles/v√≥xeles con valor trimap unknown se inicializan al valor de matte foreground. c) Se crean dos GMMs, uno para foreground y otro para el background, cada uno con 5 componentes gaussianos. El GMM foreground se inicializa con p√≠xeles/v√≥xeles de valor matte foreground, mientras que el GMM background se inicializa con los v√≥xeles de valor matte background. d) Cada p√≠xel/v√≥xel en el GMM foreground, es asignado al componente gaussiano al que tenga mayor probabilidad de pertenencia. De igual manera, cada p√≠xel/v√≥xel del GMM background es asignado al componente gaussiano al que tenga mayor probabilidad de pertenencia. e) Los GMMs son eliminados, y se crean unos nuevos a partir de la informaci√≥n obtenida anteriormente. Cada p√≠xel/v√≥xel es asignado a su GMM respectivo (GMM foreground o GMM background) y al componente de ese GMM que fue asignado en el paso 4. f) Se construye el grafo y se consigue el min-cut. En base al resultado obtenido, se modifica el valor matte de algunos p√≠xeles/v√≥xeles. Aquellos resulten conectados a la fuente quedan como matte foreground y los que resulten conectados al destino, como matte background. Al igual que GraphCut, GrabCut solo puede segmentar la imagen en dos conjuntos (K=2), objeto de inter√©s y fondo. El almacenamiento en memoria del grafo con T-links es incluso m√°s costoso que en el caso de GraphCut, debido al uso de los modelos de mezclas gaussianas. 3.4 Random Walker Este m√©todo de segmentaci√≥n es aplicable para K ‚â• 2 etiquetas en 2 √≥ 3 dimensiones, y determina la probabilidad de que un recorrido aleatorio, empezando en cada uno de los p√≠xeles no etiquetados por el usuario, termine en uno de los p√≠xeles etiquetados, asignando a cada p√≠xel la etiqueta a la cual se le calcula mayor probabilidad de llegar al terminar el recorrido aleatorio. Un random walk es un proceso estoc√°stico, en donde una part√≠cula posicionada inicialmente en un nodo de un grafo se mueve hacia alguno de sus nodos adyacentes al paso de un intervalo de tiempo con igual probabilidad. Random Walker explota los paralelos entre la teor√≠a de circuitos el√©ctricos y los recorridos aleatorios en grafos [Doyle84], modelando los recorridos aleatorios como el flujo de 54 electricidad a trav√©s de un circuito con resistencias pasivas lineales entre nodos correspondientes a pixeles, con la conectividad entre los nodos del grafo dada por la vecindad entre ellos, como se muestra en la Figura 3.10. Random Walker ofrece la ventaja de proporcionar segmentaciones que respetan las fronteras d√©biles (moteadas) entre objetos (ver Fig. 3.11). Otra de sus ventajas es, que a diferencia de GrabCut, permite m√°s de 2 clases de segmentaci√≥n (K=2) [Grady04]. Se representa la imagen como un grafo G = (V, E) con v√©rtices ùë£ ‚àà ùëâ, correspondientes a pixeles/v√≥xeles y aristas ùëí ‚àà ùê∏ ‚äÜ ùëâùë•ùëâ, correspondientes a sus adyacencias. Una arista, ùëí, que une dos v√©rtices vi y vj es denotada por eij. La ponderaci√≥n de una arista se denota por w(eij) o wij. El grado de un v√©rtice es ùëëùëñ = ‚àëùë§(ùëíùëñùëó) para todas las aristas eij incidentes en vi. Para interpretar wij como el sesgo/resistencia que afecta la elecci√≥n de un camino aleatorio, se requiere que wij> 0. Para poder representar la estructura de la imagen con sesgos de camino aleatorio, es necesario definir una funci√≥n que mapee los cambios en las intensidades de la imagen a pesos de sesgo/resistencia. El sesgo/resistencia entre nodos se deriva a partir de caracter√≠sticas de gradiente, color o textura. Por ejemplo, usando la intensidad de imagen gi en el nodo vi, es posible usar la siguiente funci√≥n de ponderaci√≥n de aristas [Grady04]: ùë§ùëñùëó = exp (‚àíùõΩ(ùëîùëñ ‚àí ùëîùëó) 2) donde gi indica la intensidad de la imagen en el pixel i. El valor de ùõΩ representa el √∫nico par√°metro libre del algoritmo e indica el peso que se le dar√° a la diferencia de intensidades entre dos pixeles adyacentes. El sistema de ecuaciones se plantea en base a una matriz laplaciana 8 como ùêøùë£ùëñùë£ùëó { ùëëùë£ùëñ ùë†ùëñ ùëñ = ùëó ‚àíùë§ùëñùëó ùë†ùëñ ùë£ùëñ ùë¶ ùë£ùëó ùë†ùëúùëõ ùëõùëúùëëùëúùë† ùëéùëëùë¶ùëéùëêùëíùëõùë°ùëíùë† 0 ùëíùëõ ùëêùëéùë†ùëú ùëêùëúùëõùë°ùëüùëéùëüùëñùëú Donde ùêøùë£ùëñùë£ùëó es usado para indicar que a matriz L es indexada por los v√©rtices vi y vj. Los v√©rtices son particionados en dos conjuntos, VM (nodos semilla/marcados) y VU (nodos no marcados) LM contiene todos los puntos semilla, sin importar su etiqueta. Luego la matriz L es reordenada para reflejar los subconjuntos 8 Tambi√©n llamada matriz de Kirchoff y matriz de admitancia, es una representaci√≥n matricial de la conectividad y ponderaci√≥n de un grafo. Se define como la diferencia entre la matriz de grados y la matriz de adyacencia L = D ‚Äì A, siendo la matriz de grados la matriz diagonal que contiene el grado de cada v√©rtice y la matriz de adyacencia la matriz que indica la conectividad mutua en los v√©rtices del grafo. 55 ùêø = [ ùêøùëÄ ùêµ ùêµùëá ùêøùëà ] Se denota como ùë•ùëñ ùë† la probabilidad (potencial) asumido por cada nodo, vi para cada etiqueta s. Se define el conjunto de etiquetas para los nodos semilla como una funci√≥n Q(vj)=s,‚àÄùë£ùëó ‚àà ùëâùëÄ donde s ‚àà ùëç, 0 < ùë† ‚â§ ùêæ. Se define el vector de marcado |VM| x 1 (donde VM corresponde a la cardinalidad) para cada etiqueta, s, en el nodo vj‚àà ùëâùëÄ como ùëöùëó ùë† { 1 ùë†ùëñ ùëÑ(ùë£ùëó) = ùë† 0 ùë†ùëñ ùëÑ(ùë£ùëó) ‚â† ùë† El sistema se considera un problema de Dirichlet combinatorio, cuya soluci√≥n puede encontrarse resolviendo ùêøùëàùë• ùë† = ‚àíùêµùëöùë† que es un sistema de ecuaciones lineales sim√©trico, definido positivamente con numero |VU| de ecuaciones y un n√∫mero de t√©rminos distintos a cero igual a 2|E|. Debido que LU est√° garantizada a ser no singular para un grafo no conectado, la soluci√≥n x s est√° garantizada a existir y ser √∫nica, as√≠ que los potenciales el√©ctricos para todas las etiquetas en el sistema pueden ser encontrados resolviendo el sistema ùêøùëàùëã = ‚àíùêµùëÄ donde X tiene columnas tomadas por cada x s y M tiene columnas dadas por cada m s , as√≠ que hay K- 1sistemas de ecuaciones lineales a resolver, donde K es el n√∫mero total de etiquetas definidas por el usuario. 56 (a) b) c) d) Figura 3.10 - Random Walker a) Pixeles originales en una imagen, representados como nodos en un grafo con secciones de segmentaci√≥n deseada indicada por fronteras curvas y etiquetas semilla L1, L2 y L3 suministradas por el usuario. Las resistencias entre nodos corresponden al m√≥dulo de gradiente entre ellos. La fuente de poder est√° en el nodo semilla siendo evaluado. b) Probabilidad de que un recorrido aleatorio empezando desde cada nodo alcance primero la semilla L1. c) Probabilidad de que un recorrido aleatorio empezando desde cada nodo alcance primero la semilla L2 d) Probabilidad de que un recorrido aleatorio empezando desde cada nodo alcance primero la semilla L3. 57 Figura 3.11 - Random Walker respeta las fronteras d√©biles (punteadas) Consid√©rese esta imagen de 16x7 consistiendo de una frontera dura, representada por la l√≠nea negra gruesa, con un agujero y los dos puntos semilla en los c√≠rculos blanco y negro en los extremos de la imagen. Un recorrido aleatorio que inicie en un pixel cercano a la debilidad en la frontera (el centro de las cuatro flechas), tiene 3 de 4 posibilidades en su paso inicial de entrar a la regi√≥n que ser√° etiquetada como perteneciente al c√≠rculo negro. Debido a que lo mismo se mantiene v√°lido para el otro lado de la frontera d√©bil, la segmentaci√≥n respetar√° la frontera, a pesar de que es d√©bil. Un estudio comparativo por Rother et al. [Rother04], muestra que el m√©todo que se desempe√±a mejor en IRM es random walker, dejando atr√°s a la segmentaci√≥n watershed y crecimiento de regi√≥n por amplio margen, al evaluar m√©tricas de calidad y robustez de la segmentaci√≥n. La calidad de la segmentaci√≥n obtenida con random walker es similar a la de graphcuts, pero el random walker es capaz de encontrar la soluci√≥n de segmentaci√≥n para un n√∫mero de etiquetas >2. Sin embargo, el random walker se hace m√°s lento en ejecuci√≥n a medida que se aumenta el n√∫mero de etiquetas por incluir, para cada nueva etiqueta, un nuevo sistema de ecuaciones a resolver para toda la imagen. 58 CAP√çTULO 4 - AUT√ìMATAS CELULARES DETERMINISTAS PARA SEGMENTACI√ìN DE IM√ÅGENES Un aut√≥mata celular es un modelo din√°mico discreto, representado en un arreglo regular de celdas. Cada una de estas celdas se encuentra en uno de un n√∫mero finito de estados posibles en un paso de evoluci√≥n t. El arreglo de celdas puede tener cualquier n√∫mero de dimensiones. Por cada celda del aut√≥mata, se define un conjunto de celdas adyacentes llamado vecindad. Un estado inicial para el aut√≥mata, es seleccionado asignando un valor escalar o una tupla de valores para cada celda. Se actualiza el estado del aut√≥mata generando una nueva generaci√≥n de celdas en cada paso de evoluci√≥n t, de acuerdo a alguna regla fija de evoluci√≥n. Esta regla de evoluci√≥n es una funci√≥n matem√°tica, que es evaluada en cada celda y determina su nuevo estado en t√©rminos de su estado actual y los estados de sus celdas vecinas. T√≠picamente, la regla de evoluci√≥n se aplica simult√°neamente en todo el arreglo de celdas y es invariable a lo largo del tiempo, aunque tambi√©n pueden considerarse variaciones probabil√≠sticas a las reglas y existen adem√°s los aut√≥matas celulares as√≠ncronos, con secciones de independencia temporal [Wolfram04]. Los aut√≥matas celulares fueron primero estudiados por John von Neumann en 1947, cuando desarrollaba modelos de m√°quinas capaces de duplicarse a s√≠ mismas, a trav√©s de una sucesi√≥n de pasos discretos. Los primeros aut√≥matas de Von Neumann fueron modelados en dos dimensiones, con reglas complejas derivadas de la interpretaci√≥n finita de ecuaciones diferenciales; pose√≠an 29 estados posibles para cada celda. En la d√©cada de 1960, Stanislaw Ulam, antiguo colaborador de von Neumann, que hab√≠a hecho numerosas sugerencias a sus estudios originales, implement√≥ simulaciones basadas en aut√≥matas celulares y observ√≥ que el uso de reglas simples de evoluci√≥n era capaz de producir comportamientos complejos. Este fen√≥meno es conocido en las ciencias f√≠sicas como emergencia: la aparici√≥n de comportamientos complejos a partir de la interacci√≥n de agentes con comportamiento individual simple. Ulam argument√≥ la relevancia de este comportamiento en los aut√≥matas celulares para el estudio de las ciencias naturales, particularmente la biolog√≠a, se√±alando la variedad de procesos que operan en base a unidades elementales con estados dependientes del estado de otros elementos que se encuentren en su vecindad [vonNeumann66]. A partir de la d√©cada de 1980, Stephen Wolfram populariz√≥ el estudio de los aut√≥matas celulares como elementos para el modelado de sistemas complejos, a trav√©s del journal Complex Systems, y son famosos sus estudios postulando que ‚Äúcualquier sistema que satisfaga ecuaciones diferenciales puede ser aproximado como un aut√≥mata celular introduciendo diferencias finitas y variables discretas‚Äù [Wolfram83]. 59 En el 2004, Matthew Cooke, investigador de Wolfram Research, public√≥ una demostraci√≥n de la conjetura original de Wolfram acerca de la capacidad de una regla de aut√≥mata celular 1D para funcionar como m√°quina de c√≥mputo universal, haciendo al aut√≥mata programable y capaz de calcular cualquier funci√≥n computable [Cook04]. Un compendio de las investigaciones de Wolfram y otros autores, acerca de los aut√≥matas celulares llamado ‚ÄúA New Kind of Science‚Äù fue publicado en el a√±o 2002. Los aut√≥matas han sido utilizados para modelar una amplia gama de sistemas din√°micos en variados dominios de aplicaciones. En tareas de procesamiento de im√°genes, han sido usados para realzar bordes y eliminar ruido [Hern√°ndez96], [Popovici00] y segmentar y etiquetar im√°genes [Vezhnevets05], [Kauffmann09], [Kim10]. El presente trabajo contin√∫a la l√≠nea de investigaci√≥n en aut√≥matas celulares deterministas para segmentaci√≥n de im√°genes, iniciada por Vezhnevets et al [Vezhnevets05] y continuada por Kim et al [Kim10]. 4.1 Definici√≥n Formal y Entendimiento Intuitivo de Evoluci√≥n Formalmente, un aut√≥mata celular determinista es una tripleta A = (S, N, Œ¥), d√≥nde S es un conjunto de estados no vac√≠o que puede ser asignado a cada celda, N es el sistema de vecindad que afecta a todas las celdas y Œ¥: S n ‚Üí S es la regla de transici√≥n usada para generar una nueva generaci√≥n de celdas en cada paso t. La funci√≥n Œ¥ es usada para calcular la transici√≥n de estado de una celda p en un paso de evoluci√≥n t hacia el paso de evoluci√≥n t+ 1 en base a los estados de las celdas en la vecindad de p. Los sistemas de vecindad N usados para la segmentaci√≥n de im√°genes son la Vecindad Von Neumann (Figura 4.1a) y la Vecindad Moore (Figura 4.1b). En ambos casos, las figuras muestran la celda p a actualizar en rojo, y las celdas azules corresponden a la vecindad. Para tareas de segmentaci√≥n de im√°genes en 2D, el aut√≥mata tiene el mismo tama√±o en dimensiones x, y que la imagen, y en 3D, la misma dimensi√≥n x, y, z que el volumen. La √∫nica variaci√≥n formal en las reglas de evoluci√≥n para los aut√≥matas entre el caso 2D y el caso 3D, son los sistemas de vecindad considerados. La Figuras 4.2 y 4.3 muestran los sistemas de vecindad Von Neumann y Moore utilizados en vol√∫menes. 60 (a) b) Figura 4.1 ‚Äì Vecindad de Celdas a) Vecindad Von-Neumann 2D (‚ÄúVecindad 4‚Äù). b) Vecindad Moore 2D ("Vecindad 8") Figura 4.2 - Vecindad Von Neumann 3D ‚Äúdoble cruz‚Äù La figura a la derecha muestra en verde a la celda actual p. Figura 4.3 - Vecindad Moore 3D, ‚Äúcubo‚Äù La figura a la derecha muestra en verde a la celda actual p. 4.2 Regla GrowCut El trabajo de Vezhnevets [Vezhnevets05], propuso la siguiente regla de evoluci√≥n para un aut√≥mata celular determinista dise√±ado para la segmentaci√≥n de im√°genes: 61 // para cada celda for ‚àÄùëù ‚àà ùëÉ // Copiar estado previo ; 1 t p t p EE ÔÄΩ ÔÄ´ ; 1 t p t p ÔÅ±ÔÅ± ÔÄΩ ÔÄ´ // los vecinos atacan a la celda actual for ‚àÄùëû ‚àà ùëÅ(ùëù) if t p t qqp IIg ÔÅ±ÔÅ± ÔÄæÔÉóÔÄ≠ )||(|| 2 t q t p EE ÔÄΩ ÔÄ´1 ÔÄΩ ÔÄ´1t p ÔÅ± t qqp IIg ÔÅ±ÔÉóÔÄ≠ )||(|| 2 end if end for end for Algoritmo 4.1 - ‚ÄúGrowCut‚Äù Aqu√≠, q es el √≠ndice que representa al vecino de la celda p que est√° siendo evaluado. En esta regla, g es una funci√≥n mon√≥tona decreciente acotada a [0,1] y representada por 2 ||||max 1)( I x xg ÔÄ≠ÔÄΩ El estado de cada celda p del aut√≥mata, es una tupla (Ep, Œ∏p, ùêºp), donde Ep representa la etiqueta de la celda, Œ∏p representa la fuerza que posee esta etiqueta en la celda e ùêºp representa un vector de caracter√≠sticas propias de cada p√≠xel, como su intensidad en nivel de gris, su vector RGB, o una combinaci√≥n de niveles digitales [Vezhnevets05], [Kim11]. Se puede utilizar una met√°fora biol√≥gica como explicaci√≥n intuitiva al comportamiento de la regla de evoluci√≥n del aut√≥mata. Es v√°lido interpretar el proceso de evoluci√≥n de celdas como el crecimiento competitivo, en busca de dominaci√≥n espacial, de K tipos de bacterias. Las bacterias intentan reproducirse a partir de su posici√≥n original en las celdas semilla y ocupar el resto del espacio de la imagen. En cada intervalo discreto de tiempo, cada celda es atacada por sus vecinas. 62 La fuerza de los ataques realizados est√° definida por el par√°metro Œ∏q en la celda atacante q y la distancia entre los vectores de niveles digitales de la imagen ùêºp e ùêºq. A mayor cercan√≠a de caracter√≠sticas en la imagen entre celdas vecinas, mayor es la fuerza de ataque de una celda qa su vecina defensora p. Si la fuerza de ataque es mayor que la fuerza de la celda defensora, la celda defensora p es conquistada y su estado para el paso de evoluci√≥n t + 1 se actualiza con la etiqueta de la celda atacante q. La nueva fortaleza de p es la fuerza del ataque con que fue conquistada. Para lograr segmentar la imagen, deben haber al menos 2 celdas con etiquetas E distintas, y fuerzas Œ∏ asignadas antes que el aut√≥mata empiece su evoluci√≥n. Estas celdas iniciales con etiqueta y fuerza asignadas, reciben el nombre de semillas y la calidad de la segmentaci√≥n obtenida depende del criterio usado para seleccionarlas. Las semillas pueden ser seleccionadas tanto de forma manual [Vezhnevets05], [Kim10], como autom√°tica [Torres13]. La Figura 4.4 muestra una segmentaci√≥n obtenida usando un aut√≥mata celular determinista lograda utilizando semillas seleccionadas manualmente (Figura 4.4b) sobre una foto de canales RGB con la intenci√≥n de dividirla en foreground (puntos de inter√©s, en azul) y background (fondo, en rojo). La Figura 4.4c muestra el estado de las etiquetas del aut√≥mata al terminar su evoluci√≥n, y la Figura 4.4d muestra la aplicaci√≥n de la m√°scara de la Figura 4.4c para segmentar la foto original, marcando el background en gris. a) b) c) d) Figura 4.4: Segmentaci√≥n Asistida con GrowCut a) Imagen Original. b) Semillas para foreground / background. c) M√°scara de Segmentaci√≥n. d) Resultado La Figura 4.5 muestra el proceso de evoluci√≥n de las celdas en el aut√≥mata a trav√©s de t = 90 pasos para el mismo caso de segmentaci√≥n. Se usan distintas semillas a las presentadas en la Figura 4.4b, demostrando la robustez del m√©todo al arrojar un resultado de segmentaci√≥n consistente y una alta sensibilidad y precisi√≥n en la clasificaci√≥n. 63 a) t = 0 b) t = 30 c) t = 50 d) t = 90 e) Resultado Figura 4.5: Evoluci√≥n del Aut√≥mata GrowCut 4.3 Ventajas de Implementaci√≥n y Capacidades de Paralelismo de los Aut√≥matas Celulares Deterministas A diferencia de otros m√©todos de segmentaci√≥n de im√°genes multietiqueta, como random walker [Grady04], en los aut√≥matas celulares deterministas, el uso de m√°s de 2 clases de segmentaci√≥n no incrementa el tiempo el tiempo de c√≥mputo necesario para obtener un resultado. Una ventaja importante del paralelismo inherente a los aut√≥matas, es que en ellos la evoluci√≥n de cada celda puede ser modelada como un hilo de c√≥mputo independiente. Esta caracter√≠stica de paralelismo inherente es ampliamente explotable en las arquitecturas de GPUs programables modernas. La evoluci√≥n determinista de los aut√≥matas, garantiza que los resultados obtenidos en una implementaci√≥n serial en un programa convencional de CPU ser√°n iguales a los obtenidos en un GPU, caracter√≠stica que no se cumple en m√©todos como GrabCut implementado en GPU [Temoche11]. Otra fortaleza del m√©todo basado en aut√≥matas celulares deterministas, es que al generar las clasificaciones a nivel de p√≠xel para K clases, se generan simult√°neamente K mapas de fuerza. Estos mapas de fuerza indican el nivel calculado de pertenencia de cada celda de la imagen a su etiqueta asignada l. Resulta de particular inter√©s en los mapas fuerza, resaltar aquellas regiones con menor nivel de fuerza al terminar la evoluci√≥n del aut√≥mata, ya que estas naturalmente corresponden a las fronteras entre elementos de distintas clases, como se muestra en la imagen satelital en la Figura 4.6. 64 Figura 4.6 ‚Äì Fronteras En este caso el aut√≥mata evolucion√≥ para generar clasificaciones a nivel de p√≠xel para 45 clases de terreno. Aqu√≠, las celdas con menor probabilidad de ser los terrenos clasificados, se convierten en fronteras. Las celdas marcadas en rojo son aquellas con fuerza final inferior a 0.9 para la etiqueta de terreno asignado. 4.3 Contribuciones En este trabajo se proponen modificaciones al algoritmo GrowCut que afectan cualitativamente y cuantitativamente a las segmentaciones obtenidas. Estas son presentadas a continuaci√≥n. 4.3.1 Correcci√≥n a GrowCut Con una apropiada selecci√≥n de las semillas, la regla GrowCut produce buenas segmentaciones, a pesar de que posee un error en la condici√≥n t p t qqp IIg ÔÅ±ÔÅ± ÔÄæÔÉóÔÄ≠ )||(|| 2 , que afecta numerosos casos de borde. Esta condici√≥n hace que la celda p tome la etiqueta de la √∫ltima celda vecina q que logre vencerla. Esto debe cambiarse a 1 2 )||(|| ÔÄ´ ÔÄæÔÉóÔÄ≠ t p t qqp IIg ÔÅ±ÔÅ± para que la celda p tome la etiqueta de la celda m√°s fuerte que logre vencerla, sin importar el orden en que fue evaluada como vencedora. Adem√°s, la funci√≥n g(x) puede considerar una distancia entre niveles digitales distinta a la euclidiana. Una regla de evoluci√≥n de aut√≥mata celular, que corrige el error de evaluaci√≥n e incluye un criterio de parada se presenta como el Algoritmo 2. 65 A = true while(A) A = false // para cada celda for PpÔÉéÔÄ¢ // Copiar estado previo t p t p EE ÔÄΩ ÔÄ´1 t p t p ÔÅ±ÔÅ± ÔÄΩ ÔÄ´1 // los vecinos atacan a la celda actual for )( pNqÔÉéÔÄ¢ if 1 2 )||(|| ÔÄ´ ÔÄæÔÉóÔÄ≠ t p t qqp IIg ÔÅ±ÔÅ± t q t p EE ÔÄΩ ÔÄ´1 ÔÄΩ ÔÄ´1t p ÔÅ± t qqp IIg ÔÅ±ÔÉóÔÄ≠ )||(|| 2 A = true end if end for end for end while Algoritmo 2 ‚Äì Regla 2 ‚ÄúGrowCut Corregido‚Äù Aut√≥mata celular que determina evoluci√≥n a partir de mejores vencedores y garantiza convergencia. La distancia entre niveles digitales x, definida aqu√≠ en forma euclidiana como 2 |||| qp II ÔÄ≠ , puede interpretarse de forma generalizada como cualquier medida de distancia entre vectores. 4.3.2 Criterio de Convergencia El criterio de parada en la Regla 2 est√° representado por la variable A, que se inicializa a falso en cada paso t de la evoluci√≥n del aut√≥mata, antes de empezar la evaluaci√≥n de celdas. Esto se cambia a verdadero, si al menos una celda cambia de estado durante el paso t. Un criterio de parada distinto, consiste en detener la evoluci√≥n del aut√≥mata cuando todas las celdas han recibido una etiqueta. Este criterio puede producir segmentaciones iguales a las descritas en el Algoritmo 2, pero esto no est√° garantizado y depende del posicionamiento de las semillas. Este segundo criterio resulta √∫til para detener el algoritmo r√°pidamente y su diferencia con la evoluci√≥n completa, descrita en el Algoritmo 2, tiende a ser marginal. Este criterio se presenta en el Algoritmo 3. 66 celdas_sin_etiqueta = celdas_del_volumen ‚Äì celdas_semilla while(celdas_sin_etiqueta>0) // para cada celda for PpÔÉéÔÄ¢ // Copiar estado previo // los vecinos atacan a la celda actual for if 1)( ÔÄ´ÔÄæÔÉó t p t q xg ÔÅ±ÔÅ± if nullE t p ÔÄΩÔÄΩ ÔÄ´1 celdas_sin_etiqueta = celdas_sin_etiqueta -1; end if t q t p EE ÔÄΩ ÔÄ´1 t q xg ÔÅ±ÔÉó)( end for end for end while Algoritmo 3 - ‚ÄúGrowCut Corregido‚Äù con convergencia por criterio de todas las celdas etiquetadas Un tercer criterio de parada, es detener la evoluci√≥n del aut√≥mata una vez que todas las celdas han recibido una etiqueta y el n√∫mero de celdas que permanecen sin cambio entre los pasos de evoluci√≥n est√° por encima de un umbral deseado (por ejemplo, si 95% √≥ 99% de las celdas permanecen sin cambio en dos t consecutivos). Estas condiciones de parada, distintas a la que aparecen en el Algoritmo 2, son heur√≠sticas √∫tiles para reducir el tiempo de c√≥mputo. 4.3.3 Variaciones en la Fuerza de Ataque Debido a que el t√©rmino de fortaleza en las celdas del aut√≥mata es actualizado con base en la fuerza de los ataques de las celdas vecinas, resulta de inter√©s la operaci√≥n num√©rica que es realizada para determinar c√≥mo se calcula la fuerza de los ataques. A continuaci√≥n se presentan opciones a los ; 1 t p t p EE ÔÄΩ ÔÄ´ ; 1 t p t p ÔÅ±ÔÅ± ÔÄΩ ÔÄ´ )( pNqÔÉéÔÄ¢ ÔÄΩ ÔÄ´1t p ÔÅ± 67 criterios para determinar fuerzas de ataque entre celdas. 4.3.3.1 Distancias entre Niveles Digitales En la regla de evoluci√≥n GrowCut, propuesta en el trabajo de Vezhnevets et al. [Vezhnevets05], se utiliza la distancia euclidiana de la intensidad de celdas vecinas para calcular la fortaleza de los ataques entre celdas vecinas. Otras medidas de distancia pueden ser utilizadas para calcular fortaleza de ataques. Figura 4.7 - Medidas de Distancia Aplicables a los Niveles Digitales en la Imagen La distancia entre los niveles de intensidad de celdas vecinas es un factor invariante durante la evoluci√≥n del aut√≥mata, por lo que las distancias pueden ser pre - calculadas antes del primer paso de evoluci√≥n. Esto resulta √∫til para reducir el tiempo de c√≥mputo de evoluci√≥n, especialmente al utilizar medidas de distancias que involucren mayor n√∫mero de operaciones aritm√©ticas. 4.3.2.2 Consideraci√≥n de Nivel Digital en la Celda de la Imagen Multicanal como Escalar o Vector En los datos multicanal, se puede elegir reducir la dimensionalidad del vector representativo de los niveles digitales a un escalar, usando una operaci√≥n de norma o combinando los canales a 68 trav√©s de an√°lisis de componentes principales. 4.3.2.3 Penalizaci√≥n de Fuerza de Ataque en Base a Distancia a la Media de Nivel Digital para una Etiqueta El trabajo de Kim et al [Kim10], presenta una regla de evoluci√≥n con penalizaci√≥n de fuerza de ataque, basada en estad√≠sticas de nivel digital medio y desviaci√≥n est√°ndar de las celdas semilla. La penalizaci√≥n exponencial al ataque, ocurre cuando la celda invasora tiene un nivel digital que se aleja (seg√∫n distancia euclidiana) en m√°s de una desviaci√≥n est√°ndar a la media de nivel digital de las semillas correspondientes a su etiqueta. Esto se expresa en los siguientes modificadores condicionales a la funci√≥n de fuerza de ataque g(x), que aqu√≠ tiene como par√°metros adicionales a la distancia euclidiana entre los niveles digitales de p y q, (expresado por x), ŒºEq y œÉEq denotan la media y la desviaci√≥n est√°ndar de la etiqueta E en el v√≥xel q, respectivamente. ùëî(ùë•, ùúáùê∏ùëû , ùúéùê∏ùëû) = { 1 ‚àí ( ùë• ùë§1 ‚àó max|ùêº| ) ùë†ùëñ |ùêºùëû ‚àí ùúáùê∏ùëû| < ùúéùê∏ùëû 1 ‚àí ( ùë• ùë§1 ‚àó max|ùêº| ) (ùëí(‚àíùë§2‚àó (|ùêºùëû‚àíùúáùê∏ùëû|)‚àíùúéùê∏ùëû)) ùë†ùëñ |ùêºùëû ‚àí ùúáùê∏ùëû| ‚â• ùúéùê∏ùëû Ec. 4.1 - Criterio de penalizaci√≥n exponencial de fuerza de ataque Si se cumple la desigualdad |Iq ‚Äì ŒºEq| < œÉEq, la celda vecina que ataca a la celda actual tiene un valor de nivel digital que est√° dentro de una desviaci√≥n est√°ndar del nivel digital de la etiqueta, asign√°ndose entonces una fortaleza de ataque a q sin penalizaci√≥n. Si ocurre el caso contrario, que |Iq ‚Äì ŒºEq| ‚â• œÉEq, la distancia euclidiana entre los niveles digitales de p y q es superiora œÉEq, haciendo que la fortaleza de un ataque vecino baje exponencialmente con penalizaci√≥n (ùë§2 ‚àó (|ùêºùëû ‚àí ùúáùê∏ùëû|) ‚àí ùúéùê∏ùëû). Esta penalizaci√≥n de ataque puede resultar extremadamente violenta, por ser exponencial y tener un efecto acumulativo entre celdas espacialmente pr√≥ximas, que se alejen de la desviaci√≥n est√°ndar (estas celdas representan una proporci√≥n del 31.8% de la poblaci√≥n total de celdas, como se muestra en la Figura 4.9 ) y con datos no escalados es capaz de introducir errores num√©ricos por underflow, ya que los valores producidos tienen alta probabilidad de estar por debajo del rango de valores soportados en el est√°ndar IEEE 754, como se ilustra en la segmentaci√≥n obtenida en la Figura 4.8b. 69 a) b) Figura 4.8 ‚Äì Problema de Evoluci√≥n en la Penalizaci√≥n Exponencial a) Imagen de resonancia magn√©tica producida por TumorSim en modalidad FLAIR. b) Segmentaci√≥n obtenida utilizando la regla de evoluci√≥n propuesta por Kim et al. para 2 clases: tumor y background; las secciones en negro indican celdas sin etiqueta, en donde los ataques se anularon, impidiendo la convergencia del aut√≥mata. Los pesos w1 y w2, usados en la funci√≥n ùëî ‚àó(ùë•, ùúáùê∏ùëû, ùúéùê∏ùëû) son definidos por el usuario. En el trabajo de Kim et al. [Kim10], se menciona que fijar w1 > 1hace disminuir el efecto de las diferencias de intensidad, mientras que colocar w2 > 1 incrementa exponencialmente el efecto de las diferencias de intensidad. Estos efectos no est√°n relacionados de forma proporcional, debido a que w2 afecta s√≥lo los casos de ataque en donde ocurre penalizaci√≥n de forma exponencial y w1 afecta a todos los casos de ataque de forma lineal. En las pruebas realizadas durante este trabajo, se encontr√≥ que controlar los efectos de manipulaci√≥n de w1 y w2 en las segmentaciones obtenidas es dif√≠cil, poco significativo y poco pr√°ctico. El trabajo de Kim et al., no presenta un estudio comparativo de los efectos en la calidad de segmentaci√≥n al variar los valores de w1 y w2 y solo presenta resultados de segmentaci√≥n cuando ambos valores han sido fijados en 2.0. 70 Figura 4.9 - Distribuci√≥n de la poblaci√≥n de etiquetas seg√∫n el teorema central del l√≠mite. Al menos 31.8% de los datos aut√©nticamente correspondientes a una misma etiqueta se encuentran a m√°s de una desviaci√≥n est√°ndar de la media de intensidad presente en las semillas y este porcentaje aumenta en una clase de segmentaci√≥n ‚Äúbackground‚Äù, que es t√≠picamente heterog√©nea. Debido a que las intensidades entre v√≥xeles vecinos tienden a ser num√©ricamente cercanas, la penalizaci√≥n exponencial propuesta por Kim et al. para determinar la fortaleza de las celdas debe considerarse excesiva. Este trabajo propone una regla alterna de evoluci√≥n que elimina los errores num√©ricos durante la evoluci√≥n del aut√≥mata celular y que incrementa la sensibilidad y especificidad en las segmentaciones obtenidas, manteniendo el elemento de informaci√≥n estad√≠stica en las semillas. Esta regla de evoluci√≥n se basa en la penalizaci√≥n lineal de fuerza de ataque y se presenta en la Ecuaci√≥n 4.2: ùëî‚àó(ùë•, ùúáùê∏ùëû , ùúéùê∏ùëû) = { 1 ‚àí ( ùë• max|ùêº| ) ùë†ùëñ |ùêºùëû ‚àí ùúáùê∏ùëû| < ùëõ ‚àó ùúéùê∏ùëû 1 ‚àí ( ùë• max|ùêº| ) ‚àó ( ùúéùê∏ùëû |ùêºùëû ‚àí ùúáùê∏ùëû| ) ùë†ùëñ |ùêºùëû ‚àí ùúáùê∏ùëû| ‚â• ùëõ ‚àó ùúéùê∏ùëû Ecuaci√≥n 4.2 -Penalizaci√≥n lineal a la fuerza de ataque de la celda enemiga cuya intensidad est√° a m√°s de n desviaciones est√°ndar de la media de intensidad en las semillas de su etiqueta correspondiente 71 ùëî‚àó(ùë•, ùúáùê∏ùëû , ùúéùê∏ùëû) = { 1 ‚àí ( ùë• max|ùêº| ) ùë†ùëñ |ùêºùëû ‚àí ùúáùê∏ùëû| < ùëõ ‚àó ùúéùê∏ùëû 1 ‚àí ( ùë• max|ùêº| ) ‚àó ùëê1 ùë†ùëñ (|ùêºùëû ‚àí ùúáùê∏ùëû | ‚â• ùëõ ‚àó ùúéùê∏ùëû) ùë¶ (|ùêºùëû ‚àí ùúáùê∏ùëû| < (ùëõ + 1) ‚àó ùúéùê∏ùëû) 1 ‚àí ( ùë• max|ùêº| ) ‚àó ùëê2 ùë†ùëñ |ùêºùëû ‚àí ùúáùê∏ùëû| ‚â• (ùëõ + 1) ‚àó ùúéùê∏ùëû Ecuaci√≥n 4.3 -Penalizaciones constantes a la fuerza de ataque de la celda enemiga cuya intensidad est√° a m√°s de n desviaciones est√°ndar y a m√°s n + 1 desviaciones est√°ndar de la media de intensidad en las semillas de su etiqueta correspondiente. Ck est√° en el intervalo (0,1) y C2 > C1. Esta regla resulta de utilidad para segmentar conjuntos con elementos que comparten una etiqueta a pesar de poseer niveles digitales heterog√©neos que est√©n sobrerepresentados en el espacio de la imagen. Kim et al. [Kim10] propuso que el an√°lisis estad√≠stico de la media y desviaci√≥n de los niveles digitales correspondientes a una etiqueta fuera realizado √∫nicamente a partir de las celdas semilla, esto resulta inconveniente con una distribuci√≥n sesgada de las celdas semilla. Las reglas de evoluci√≥n basadas en informaci√≥n estad√≠stica presentes en este trabajo actualizan la media y desviaci√≥n est√°ndar de los niveles digitales correspondientes a una etiqueta en cada paso de evoluci√≥n del aut√≥mata para atacar este problema. 4.3.3 AutomaClass, Configuraci√≥n No Supervisada del Estado Inicial del Aut√≥mata Una importante fortaleza de los aut√≥matas celulares deterministas, es su capacidad para segmentar una imagen 2D o volumen en K >= 2 clases (pudiendo ser K >> 2) sin que esto afecte negativamente el tiempo de c√≥mputo requerido para obtener una segmentaci√≥n. Adem√°s, por an√°lisis espectral, puede fijarse autom√°ticamente la posici√≥n espacial de las semillas de segmentaci√≥n [Torres13]. En general, al seleccionar las semillas para un aut√≥mata celular determinista, de forma autom√°tica o supervisada, se busca satisfacer 2 criterios: 1) Que las semillas seleccionadas sean representativas de la distribuci√≥n espacial de los elementos salientes de la imagen 2) Que las semillas seleccionadas sean representativas de la diversidad de niveles digitales presentes en la imagen La Figuras 4.11 muestran semillas seleccionadas de forma autom√°tica, obtenidas mediante el algoritmo de selecci√≥n no supervisada de semillas, descrito a continuaci√≥n, en una tarea de clasificaci√≥n de uso del suelo, con semillas correspondientes a 45 clases en una imagen satelital multiespectral capturada por el sat√©lite Miranda y el resultado final de segmentaci√≥n. 72 a) b) Figura 4.10- Im√°genes Satelitales a) Imagen de entrada, terrenos en Acarigua, Estado Portuguesa. Imagen multiespectral, capturada por el sat√©lite Miranda en color verdadero (R, G, B). b) Muestra la imagen multiespectral en falso color infrarrojo, canales G, B, Infrarrojo Cercano. Figura 4.11 ‚Äì Semillas correspondientes a 45 clases de terreno, generadas autom√°ticamente por AutomaClass [Torres13] 73 a) b) Figura 4.12 ‚Äì Modificaci√≥n de Granularidad de Segmentaci√≥n a) Segmentaci√≥n de grano fino correspondiente a 45 clases de firmas espectrales, clasificaci√≥n realizada con las cuatro bandas disponibles en imagen multiespectral, incluyendo infrarrojo cercano. b) Segmentaci√≥n de grano grueso, correspondiente a las mismas 45 clases, obtenida reiniciando la evoluci√≥n del aut√≥mata celular en aquellos segmentos con menos de 150 p√≠xeles. El m√©todo AutomaClass propuesto originalmente en Segmentaci√≥n No Supervisada de Im√°genes Multiespectrales Utilizando Aut√≥matas Celulares [Torres13], subdivide el espacio de niveles digitales correspondiente a N canales de imagen, de acuerdo al siguiente procedimiento: 1) Para cada p√≠xel/v√≥xel multicanal se determina la suma de los niveles digitales en sus canales y se establece un n√∫mero de rangos representativos de las caracter√≠sticas de la imagen, como se muestra en la Figura 4.13, que presenta un histograma de la suma de canales. La Figura 4.14 muestra un ejemplo que considera 2 canales, B1 y B2. La recta azul representa la localizaci√≥n en B1 y B2 de los p√≠xeles cuyos valores suman P1 y la recta roja representa la localizaci√≥n de los p√≠xeles cuyos valores suman P2. En dimensiones superiores (usando 3 o m√°s canales) estas rectas ser√≠an reemplazadas por planos o hiperplanos. 2) Los p√≠xeles / v√≥xeles multicanal que poseen la misma suma de niveles digitales en sus canales componentes, son discriminados de acuerdo al nivel digital predominante en cada canal de la imagen. En el caso bidimensional mostrado en la Figura 4.14, la regi√≥n R2 corresponde a p√≠xeles/v√≥xeles con valores semejantes en los dos canales considerados. Las regiones R3 y R1 agrupan p√≠xeles donde predomina el canal 1 √≥ 2, respectivamente. 74 Figura 4.13 ‚Äì Selecci√≥n de Semillas a Trav√©s de Firma Espectral Histograma umbralizado con los rangos de selecci√≥n de las semillas (barras negras, correspondientes a los percentiles de valores en este caso). El eje X representa el valor de la suma de los 4 canales considerados en el ejemplo, el eje Y representa el n√∫mero de p√≠xeles en la imagen que comparten un valor X de suma. Los p√≠xeles que comparten un mismo valor de suma de canales son divididos en distintas regiones de acuerdo al criterio expresado en la Figura 4.14 Figura 4.14 - Regiones de semillas (R1, R2, R3) seleccionadas al utilizar 2 canales (B1, B2) en 2 secciones de p√≠xeles con niveles digitales que comparten suma (P1, P2) 75 La Figura 4.15 ilustra el procedimiento para un corte de IRM co-registrado. (a) b) c) Figura 4.15 - AutomaClass para IRM a) Visualizaci√≥n de la suma de los canales FLAIR, T1, T1Gad y T2 en un corte producido por TumorSim. b) Semillas obtenidas a partir de la divisi√≥n umbralizada de niveles digitales. c) Segmentaci√≥n obtenida. 76 CAP√çTULO 5 ‚Äì DETALLES DE IMPLEMENTACI√ìN Para el desarrollo de este trabajo especial de grado se utilizaron las siguientes herramientas: Matlab 2013a: Matlab es un ambiente de c√≥mputo num√©rico y un lenguaje de programaci√≥n desarrollado por Mathworks. Las prestaciones de c√≥mputo de matrices que posee son de alta utilidad para el an√°lisis de im√°genes. Matlab incluye una amplia variedad de toolboxes y permite la interfaz directa con C, C++ y CUDA. CUDA 5: Plataforma de c√≥mputo heterog√©neo, desarrollada por Nvidia, la cual permite programar funciones (kernels) que se ejecuten de forma paralela en GPU. TumorSim: Simulador de tumores que produce una verdad fundamental acerca de la extensi√≥n y posici√≥n de un tumor simulado en IRM, con materia blanca, materia gris, fluido cerebroespinal, tumor y edema. TumorSim genera im√°genes sint√©ticas en los canales T1, T1Gad, T2 y FLAIR. TumorSim genera sus simulaciones en archivos .mha que pueden ser convertidos a formato DICOM. La aplicaci√≥n fue desarrollada para Windows 7, en arquitectura Intel y tarjetas gr√°ficas Nvidia con Compute Capability superior a 1.3. 5.1 Implementaci√≥n de Aut√≥matas Celulares Deterministas en Matlab Se aprovecharon las siguientes capacidades de Matlab 2013a: ÔÇ∑ Carga y escritura de archivos en formato DICOM. ÔÇ∑ M√∫ltiples funcionalidades del Image Processing Toolbox fueron aprovechadas durante las fases de implementaci√≥n y pruebas: aplicaci√≥n y edici√≥n de mapas de color, filtros de realce de bordes, m√©tricas de √°rea de segmentos, estad√≠sticas de p√≠xeles en la imagen y visualizaci√≥n detallada de regiones ampliadas. ÔÇ∑ Uso de las librer√≠as de an√°lisis de componentes principales. ÔÇ∑ Vol√∫menes desplegados usando las librer√≠as de isosuperficies integradas. ÔÇ∑ Creaci√≥n de interfaz de usuario a trav√©s del m√≥dulo GUIDE. 77 ÔÇ∑ Llamada a kernels de c√≥mputo CUDA, a trav√©s de la interfaz CUDAKernel. 5.2 Implementaci√≥n de Aut√≥matas Celulares Deterministas en CUDA Para eliminar condiciones de carrera que generen indeterminismo en la evoluci√≥n del aut√≥mata, se hace que el kernel CUDA, encargado de la evoluci√≥n de las celdas, compute un solo de paso de evoluci√≥n a la vez. Adem√°s, cada thread de ejecuci√≥n representa a una celda defensora, encargada de evaluar los ataques realizados contra ella en su vecindad. En memoria global, se almacenan los estados de las celdas en los pasos de evoluci√≥n t y t+1. En las implementaciones de reglas de evoluci√≥n realizadas, se aprovech√≥ la capacidad de Matlab 2013a para llamar a los kernels CUDA desde un programa host, usando la interfaz CUDAKernel. En el c√≥digo de kernel CUDA que se presenta a continuaci√≥n, se implementa la Regla ‚ÄúGrowcut Corregido‚Äù de la secci√≥n 4.5.1, utilizando el sistema de vecindad Von Neumann 3D. Cada thread (celda defensora p) eval√∫a el estado de celdas en su vecindad en el paso t, leyendo los estados de su vecindad en los arreglos d_strength y d_label. La celda defensora calcula la fuerza del ataque generado por sus vecinas y actualiza su propio estado en d_new_strength y d_new_label(correspondientes al estado de la celda para t+1). Con este patr√≥n de acceso a memoria, s√≥lo un thread a la vez escribe en una misma posici√≥n de los arreglos d_new_strength y d_new_label. Las lecturas para calcular ataques son realizadas en los arreglos del paso anterior, eliminando cualquier posibilidad de indeterminismo en la ejecuci√≥n. __global__ void evol_cells(const float *d_imdata, const float *d_strength, const unsigned char *d_label, float *d_new_strength, unsigned char *d_new_label, unsigned char *still_updating, const int xDim, const int yDim, const int zDim, const float max_I) { unsigned int x = blockDim.x * blockIdx.x + threadIdx.x; unsigned int y = blockDim.y * blockIdx.y + threadIdx.y; unsigned int z = blockDim.z * blockIdx.z + threadIdx.z; 78 if ( (x >= xDim) || (y >= yDim) || (z >= zDim) ) return; unsigned int offset = x + xDim*y + (xDim*yDim*z); /* c√°lculo de coordenadas offset de la vecindad Von Neumann 3D */ int left = (x-1) + xDim*y + (xDim*yDim*z); int right = (x+1) + xDim*y + (xDim*yDim*z); int top = x + xDim* (y-1) + (xDim*yDim*z); int bottom = x + xDim*(y+1) + (xDim*yDim*z); int front = x + xDim*y + (xDim*yDim*(z-1)); int back = x + xDim*y + (xDim*yDim*(z+1)); /*Inicializaci√≥n de valores locales*/ int neigh = -1; float gfunc = -1.0f; float eval_product = -1.0f; /*inicializa marcador de convergencia local*/ still_updating[offset]=0; /*chequear vecino izquierdo, las operaciones marcadas como regi√≥n eval se repiten en los otros vecinos*/ if (x!=0){ neigh = left; /*empieza regi√≥n de evaluaci√≥n de ataque*/ gfunc = 1.0f - (abs(d_imdata[offset] - d_imdata[neigh]) / max_I); eval_product = gfunc * d_strength[neigh]; /*evaluar si la celda p es vencida por la mayor fuerza de ataque evaluada hasta el momento*/ if( ( eval_product > d_strength[offset]) && ( eval_product > d_new_strength[offset] ) ){ d_new_strength[offset] = eval_product; d_new_label[offset] = d_label[neigh]; /*actualizar marcador de convergencia*/ still_updating[offset]=1; } /*fin regi√≥n eval*/ } /*termina evaluaci√≥n de ataque de celda vecina*/ /*repetir evaluaci√≥n de ataque en las celdas vecinas restantes*/ } } C√≥digo 5.1 ‚Äì Kernel de Evoluci√≥n de Celdas Para continuar la evoluci√≥n del aut√≥mata garantizando ejecuci√≥n determinista, se aprovecha 79 la caracter√≠stica de barrera impl√≠cita entre kernels del modelo de ejecuci√≥n CUDA. Todos los threads del kernel anterior deben haber terminado su ejecuci√≥n, antes de que se empiece la ejecuci√≥n de este kernel de transici√≥n, que se encarga de asignar el estado t + 1 calculado en el paso anterior a los arreglos del estado t, como aparece en el C√≥digo 5.1 __global__ void transition_step(const float *d_new_strength, const unsigned char *d_new_label, float *d_strength, unsigned char *d_label, const int xDim, const int yDim, const int zDim ) { unsigned int x = blockDim.x * blockIdx.x + threadIdx.x; unsigned int y = blockDim.y * blockIdx.y + threadIdx.y; unsigned int z = blockDim.z * blockIdx.z + threadIdx.z; if ( (x >= xDim) || (y >=yDim) || (z >= zDim) ) return; unsigned int offset = x + xDim*y + (xDim*yDim*z); /*actualizar paso anterior*/ d_strength[offset] = d_new_strength[offset]; d_label[offset] = d_new_label[offset]; } C√≥digo 5.2 ‚Äì Kernel de Transici√≥n Estos dos kernels son llamados en sucesi√≥n alternada por el programa host, hasta que el aut√≥mata converge y los cambios evolutivos desaparecen. La convergencia del aut√≥mata celular se determina a trav√©s del arreglo still_updating. Cada thread en evol_cells() fija su posici√≥n en still_updating a 0 antes de evaluar los ataques de las celdas en su vecindad y s√≥lo cambia el valor de esta posici√≥n a 1 si alguna de las celdas atacantes logra vencer a la celda defensora. En el programa host de Matlab, se aprovecha la funci√≥n nnz() integrada a las capacidades de gpuArray, para detener condicionalmente la llamada a los kernels evol_cells() y transition_step(); nnz(still_updating) retorna 0 en caso de que ninguna celda del aut√≥mata haya cambiado su estado entre pasos de evoluci√≥n. 80 5.3 Interfaz Gr√°fica para Segmentaci√≥n Asistida Se implement√≥ una interface gr√°fica en Matlab para visualizar cortes de resonancia magn√©tica y definir semillas de segmentaci√≥n manualmente. Se us√≥ el programa ReadData3D, obtenido a trav√©s del FileExchange de Mathworks, para realizar la carga de datos. Este programa permite cargar y guardar archivos en formato DICOM e Insight Meta-Image (.mha, producido por TumorSim), adem√°s permite re - escalar los datos, para llevarlos a unidades Hounsfield, como aparece en la Figura 5.1. Figura 5.1 - Interface gr√°fica de ReadData3D para la carga de vol√∫menes 81 Figura 5.2 - Interfaz gr√°fica para definir semillas de segmentaci√≥n Se permite al usuario definir niveles de certidumbre en las semillas como un par√°metro de fuerza inicial acotado entre 0.1 y 1. 82 CAP√çTULO 6 - PRUEBAS Y RESULTADOS En este cap√≠tulo se presentan pruebas de calidad de segmentaci√≥n, con un dataset de prueba real, etiquetado por un operador humano experto, y dos datasets sint√©ticos obtenidos mediante TumorSim. Los computadores utilizados en las pruebas fueron los siguientes: a) C1: Procesador Intel Core I7 con 8 Gb de RAM y 3.40 GHz, GPU Nvidia GTX 650. b) C2: Procesador Intel Core 2 Duo con Gb de RAM, GPU Nvidia GT 520. Se utiliza una metodolog√≠a de comparaci√≥n enfrentando la calidad de las segmentaciones obtenidas en base a la comparaci√≥n de par√°metros que afectan la evoluci√≥n del aut√≥mata. La calidad de las segmentaciones obtenidas se eval√∫a en base a las m√©tricas presentadas en la Secci√≥n 2.5. Formalmente, cada variaci√≥n de par√°metros corresponde a una regla distinta de evoluci√≥n de aut√≥mata celular. Se realizan las siguientes comparaciones: ÔÇ∑ Segmentaciones obtenidas mediante 3 criterios distintos de dispersi√≥n de semillas en el volumen: posicionamiento contiguo en un mismo corte, posicionamiento aleatorio en un mismo corte, posicionamiento aleatorio en todo el volumen. ÔÇ∑ Segmentaci√≥n obtenida mediante convergencia completa del aut√≥mata frente a convergencia por criterio de celdas etiquetadas. ÔÇ∑ Calidad de las segmentaciones obtenidas al suministrar distintos porcentajes de semillas correctas. ÔÇ∑ Segmentaci√≥n obtenida mediante vecindad Von Neumann frente a segmentaci√≥n obtenida mediante vecindad Moore. ÔÇ∑ Segmentaciones obtenidas mediante las reglas de evoluci√≥n GrowCut, ‚ÄúGrowCut corregido‚Äù, la regla de evoluci√≥n propuesta por Kim et al. [Kim10] y las reglas de evoluci√≥n con penalizaci√≥n lineal de fuerza de ataque y penalizaci√≥n constante de fuerza de ataque. ÔÇ∑ Segmentaciones obtenidas mediante distintas combinaciones de canales de IRM. ÔÇ∑ Segmentaci√≥n obtenida mediante distintos rangos de selecci√≥n de semillas utilizando el 83 algoritmo AutomaClass, detallado en la Secci√≥n 4.5.3. 6.1 Bounding Box de Validaci√≥n En todos los casos de comparaci√≥n de calidad de segmentaci√≥n, se han calculado las m√©tricas en base a un bounding box generado a partir de los l√≠mites de presencia de celdas de tumor y edema en la verdad fundamental de los cortes evaluados y la segmentaci√≥n que da el algoritmo, se utiliza una ‚Äúcaja de validaci√≥n‚Äù que contiene a ambas. El bounding box es determinado a partir de los menores l√≠mites inferiores y los mayores l√≠mites superiores en cada uno de los ejes x, y, z. Se utiliza este bounding box debido que las celdas background (espacio vac√≠o y tejido sano) t√≠picamente sesgan las m√©tricas de calidad de segmentaci√≥n, por constituir un porcentaje ampliamente dominante del volumen total. Por ejemplo, para el dataset HG0022, del BRATS 2012, el n√∫mero total de celdas identificadas como tumorales en la verdad fundamental es 34973 (0.40% de las celdas totales) y el n√∫mero de celdas identificadas como edema es 496333 (0.57 % de las celdas totales), mientras que las celdas identificadas como background son 8643864 (99.03% de las celdas totales). Esta metodolog√≠a basada en el uso de un bounding box con l√≠mites definidos por la presencia de celdas de edema y tumor en la verdad fundamental, se propone como una validaci√≥n de calidad de segmentaci√≥n m√°s justa a la que aparece en el trabajo de Kim et al. [Kim10], en el cual se presentan m√©tricas de calidad de segmentaci√≥n calculadas en base a cortes √∫nicos de vol√∫menes de resonancia magn√©tica, sin tomar en cuenta como la alta cantidad de celdas background afecta enga√±osamente las m√©tricas de especificidad y precisi√≥n total en el problema de segmentaci√≥n tumoral. La deficiencia de esa metodolog√≠a de evaluaci√≥n es que un m√©todo de segmentaci√≥n que falle en la identificaci√≥n de las celdas tumorales y de edema puede obtener altas puntuaciones de especificidad identificando correctamente a las celdas background como no tumorales. Las im√°genes de resonancia magn√©tica de tumores cerebrales son conjuntos de datos desbalanceados, las celdas background est√°n representadas de forma abrumadoramente mayoritaria en todos los cortes de la IRM; si no se considera a los cortes de resonancia magn√©tica como un conjunto de datos desbalanceado, se perjudica la evaluaci√≥n justa del algoritmo segmentador. La segmentaci√≥n de celdas background constituye t√≠picamente una tarea de segmentaci√≥n de dificultad menor a la segmentaci√≥n de celdas de tumor y celdas de edema, que puede incrementar las puntuaciones de precisi√≥n y especificidad de forma enga√±osa. En la metodolog√≠a de validaci√≥n propuesta, se realiza la evoluci√≥n del aut√≥mata en el volumen 84 completo, y el bounding box es solo empleado para obtener m√©tricas de calidad; no constituye una simplificaci√≥n del problema de segmentaci√≥n o una reducci√≥n del espacio de evoluci√≥n del aut√≥mata. Los l√≠mites del bounding box utilizados para validar la calidad de la segmentaci√≥n son determinados a partir de los l√≠mites del bounding box de la verdad fundamental para los v√≥xeles de tumor y edema y los l√≠mites del bounding box de la segmentaci√≥n, tambi√©n para los v√≥xeles de tumor y edema. Se toman los l√≠mites inferiores y superiores en cada dimensi√≥n de los vol√∫menes de verdad fundamental y segmentaci√≥n para generar los l√≠mites inferiores y superiores de este bounding box de validaci√≥n. En la primera comparaci√≥n en esta secci√≥n se presentan, adem√°s de las m√©tricas de calidad de segmentaci√≥n obtenidas utilizando el bounding box de validaci√≥n, las m√©tricas de calidad de segmentaci√≥n obtenidas con el volumen completo. Se hace esto para ejemplificar como amplias variaciones cuantitativas y cualitativas en la calidad de las segmentaciones obtenidas son ocultadas en las m√©tricas cuando se omite el bounding box. 6.2 Comparaci√≥n entre Criterios de Dispersi√≥n de Semillas Se compara la calidad de las segmentaciones obtenidas usando 3 criterios correctos de dispersi√≥n de semillas de segmentaci√≥n. En el primer criterio se definen semillas contiguas en un √∫nico corte del volumen; en el segundo criterio se definen en posici√≥n aleatoria en el mismo corte y en el tercer criterio se definen de forma aleatoria a trav√©s del volumen. En los 3 casos se definen las semillas a partir de la verdad fundamental del volumen. El n√∫mero de semillas utilizado en los 3 casos corresponde a: ÔÇ∑ la mitad de celdas tumorales en el corte n√∫mero 55 del volumen HG0022, 666 celdas ÔÇ∑ la mitad de celdas de edema en el corte n√∫mero 55 del volumen HG0022, 279 celdas ÔÇ∑ las tres cuartas partes de las celdas background (tejido sano y espacio vac√≠o) en el corte n√∫mero 55 del volumen HG0022, 38256 celdas Se eligi√≥ este dataset debido a su alta dificultad de segmentaci√≥n. La dimensi√≥n del volumen es 230x230x165 y se encuentra coregistrado en los canales T1, T1Gad, T2 y FLAIR. Su verdad fundamental fue provista por un operador humano experto, que clasific√≥ al volumen en v√≥xeles de tumor, edema y background. [BRATS12] El prop√≥sito de la prueba es determinar el efecto de diversos criterios de posicionamiento correcto de semillas en la calidad de las segmentaciones obtenidas y el tiempo de convergencia necesario para el algoritmo. Se eligi√≥ al corte 55 del volumen 85 como aquel en donde se fijar√≠an las semillas de forma contigua, debido que es el corte con mayor n√∫mero de celdas de tumor, de acuerdo a la verdad fundamental. Se presenta el contraste entre las m√©tricas de calidad de segmentaci√≥n obtenidas utilizando un bounding box de validaci√≥n contra las m√©tricas de calidad de segmentaci√≥n obtenidas sin utilizarlo para ilustrar el sesgo que genera esta omisi√≥n. En esta prueba se utilizaron los siguientes par√°metros: ÔÇ∑ Canal de RM evaluado: T2 ÔÇ∑ Regla de evoluci√≥n del aut√≥mata: ‚ÄúGrowcut Corregido‚Äù ÔÇ∑ Medida de distancia utilizada para calcular fuerzas de ataque: euclidiana ÔÇ∑ Sistema de Vecindad Usado: Von Neumann 3D ÔÇ∑ Ejecutado en: GPU a) b) Figura 6.1 - Dataset BRATS HG0022, Glioma Activo de Alto Grado a) Corte 55, vista coronal, canal T2. b) Volumen de verdad fundamental, clases tumor y edema visualizadas con isosuperficies y transparencia sobre tejido cerebral sano. b.box Clase Posicionamiento Contiguo de Semilla Posiciones aleatorias, mismo corte Posiciones aleatorias, todo el volumen Dice Sens. Prec. Esp. Dice Sens. Prec. Esp. Dice Sens. Prec. Esp. Con Tumor 0.2425 0.7382 0.1451 0.8771 0.2754 0.8390 0.1647 0.8797 0.8708 0.9441 0.8081 0.9739 Edema 0.4608 0.4206 0.5096 0.9836 0.5295 0.5893 0.4807 0.9741 0.7886 0.7698 0.8042 0.9674 Sin Tumor 0.2425 0.7382 0.1451 0.9825 0.2754 0.8390 0.1647 0.9829 0.8708 0.9441 0.8081 0.9991 Edema 0.4608 0.4206 0.5096 0.9977 0.5295 0.5893 0.4807 0.9964 0.7866 0.7698 0.8042 0.9989 Tabla 6.1: M√©tricas de calidad de segmentaci√≥n para distintos criterios de posicionamiento de semillas 86 Figura 6.2 - Coeficiente Dice, Sensibilidad y Precisi√≥n de la clase tumor para 3 criterios de posicionamiento de semillas correctas Figura 6.3 - Efecto del bounding box de validaci√≥n en la m√©trica de especificidad 0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1 Contiguo, mismo corte Aleatorio, mismo corte Aleatorio, todo el volumen Dice - Tumor Sensiblidad - Tumor Precisi√≥n - Tumor 0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1 Contiguo, mismo corte Aleatorio, mismo corte Aleatorio, todo el volumen Especificidad, con bounding box Especificidad, sin bounding box 87 Posicionamiento contiguo Posiciones aleatorias, mismo corte Posiciones aleatorias, todo el volumen Tiempo GeForce GT 520 68.1 segundos 68 segundos 18.93 segundos Tiempo GeForce GTX 650 7.99 segundos 7.23 segundos 1.7 segundos Pasos de Evoluci√≥n 201 199 42 Tabla 6.2: Rendimiento para distintos criterios de posicionamiento de semillas Figura 6.4 - Pasos de evoluci√≥n para lograr convergencia con distintos criterios de posicionamiento de semillas correctas El criterio de selecci√≥n de semillas de forma aleatoria en todos los cortes del volumen genera una segmentaci√≥n de calidad notablemente superior en precisi√≥n, sensibilidad y coeficiente Dice (un factor de 3) para las clases de tumor y edema que la selecci√≥n de semillas de forma aleatoria en un mismo corte o la selecci√≥n de semillas de forma contigua en un mismo corte (ver Tabla 6.1). Esto puede deberse a una mejor representatividad de los niveles de digitales que aut√©nticamente corresponden a una etiqueta en el caso de la dispersi√≥n aleatoria en todos los cortes del volumen. El corte 55, que fue utilizado para asignar semillas en 2 de los 3 casos, presenta una segmentaci√≥n de baja calidad cualitativa (en su mismo corte) en el caso de asignaci√≥n contigua de semillas, como se puede observar en la Figura 6.5. La calidad de segmentaci√≥n en el corte 55 en los dos casos de asignaci√≥n aleatoria es cualitativamente comparable y cercana a la verdad fundamental en el mismo corte, pero la segmentaci√≥n obtenida con asignaci√≥n de semillas de forma aleatoria el mismo corte, 0 50 100 150 200 250 Contiguo, mismo corte Aleatorio, mismo corte Aleatorio, todo el volumen Pasos de evoluci√≥n 88 tiene un bajo coeficiente Dice para la clase tumor, que corresponde a una baja calidad de segmentaci√≥n de tumor en el volumen total. El n√∫mero de pasos necesarios para alcanzar la convergencia completa en la segmentaci√≥n se reduce significativamente (un factor de 5), como se puede observar en la Tabla 6.2 y la Figura 6.4, al asignar las semillas en todos los cortes del volumen. Las diferencias en las m√©tricas de calidad de segmentaci√≥n, en precisi√≥n de tres clases y especificidad al omitir el bounding box de validaci√≥n quedan evidenciadas en la Tabla 6.2 de esta prueba. Tambi√©n existen diferencias de una d√©cima o m√°s en las especificidades registradas con y sin bounding box en la Tabla 6.1 y la Figura 6.3. La omisi√≥n del bounding box hace que la especificidad sea m√°s alta al considerar una regi√≥n de volumen (background), que est√° sobrerepresentada en la poblaci√≥n de v√≥xeles y no resulta de relevancia sem√°ntica en la planificaci√≥n de radiocirug√≠a. Como se mencion√≥ en la secci√≥n 6.1 y queda evidenciado en la Tabla 6.2 las m√©tricas de coeficiente Dice, sensibilidad y precisi√≥n son invariantes al bounding box. En las siguientes pruebas, se mostrar√°n solo resultados utilizando el bounding box de validaci√≥n para calcular m√©tricas de calidad. a) b) c) d) Figura 6.5 - Comparaci√≥n Cualitativa de Segmentaciones a) Verdad Fundamental, HG0022, corte 55 b) Segmentaci√≥n en el corte 55 por semillas contiguas (en este mismo corte) c) Segmentaci√≥n en el corte 55 por semillas aleatorias (colocadas √∫nicamente en el mismo corte) d) Segmentaci√≥n en el corte 55 por semillas aleatorias colocadas aleatoriamente en todo el volumen. 6.3 Comparaci√≥n de Convergencia Completa Frente a Convergencia por Criterio de Celdas Etiquetadas Se define convergencia completa como el estado en el cual todas las celdas del aut√≥mata permanecen con la misma etiqueta luego de evaluar los ataques de sus celdas vecinas. Al existir 89 convergencia completa no existe variabilidad entre las etiquetas de las celdas del aut√≥mata entre los pasos t y t + 1. El criterio de convergencia completa aparece en el pseudoc√≥digo de ‚ÄúGrowcut Corregido‚Äù en el algoritmo de la Secci√≥n 4.5.1 y en el kernel modelo especificado en la Secci√≥n 5.1.2. El criterio de convergencia por celdas etiquetadas detiene la evoluci√≥n del aut√≥mata cuando todas las celdas que lo constituyen han recibido una etiqueta de clase, aunque el aut√≥mata podr√≠a continuar evolucionando a partir de ese estado. Este criterio aparece en el pseudoc√≥digo del algoritmo de convergencia temprana en la Secci√≥n 4.5.1.1. El criterio de convergencia por celdas etiquetadas resulta de inter√©s pr√°ctico porque ofrece un tiempo de respuesta significativamente inferior al necesario para obtener una segmentaci√≥n utilizando el criterio de convergencia completa. Los par√°metros para esta prueba son los siguientes: ÔÇ∑ Regla de evoluci√≥n del aut√≥mata: ‚ÄúGrowcut Corregido‚Äù ÔÇ∑ Canal Evaluado: T2 ÔÇ∑ Medida de distancia utilizada para calcular fuerzas de ataque: euclidiana ÔÇ∑ Posicionamiento de las semillas: Las semillas fueron fijadas de forma aleatoria en todo el volumen. Se usaron 666 semillas de tumor, 279 semillas de edema y 38256 semillas de background, igual que en el 3er caso de posicionamiento de Semillas en la Secci√≥n 6.2. Clase Convergencia por Criterio de Celdas Etiquetadas Convergencia Completa Dice Sensibilidad Precisi√≥n Especificidad Dice Sensibilidad Precisi√≥n Especificidad Tumor 0.8767 0.9442 0.8071 0.9737 0.8708 0.9441 0.8081 0.9739 Edema 0.7864 0.7684 0.8052 0.9677 0.7886 0.7698 0.8042 0.9674 Tabla 6.3: M√©tricas de calidad de segmentaci√≥n para distintos criterios de convergencia Convergencia por Criterio de Celdas Etiquetadas Convergencia Completa Tiempo, GeForce GT 520 (segundos) 7.42 18.93 Tiempo, GeForce GTX 650 (segundos) 0.3 0.95 N√∫mero de pasos en los que se completa la evoluci√≥n 16 42 Tabla 6.4: Tiempos de respuesta para distintos criterios de convergencia 90 Figura 6.6 - M√©tricas de calidad de segmentaci√≥n de la clase tumor por convergencia completa y convergencia por celdas etiquetadas Figura 6.7 - Pasos de evoluci√≥n para 2 criterios de convergencia La Tabla 6.3 y la Figura 6.6 evidencian en este caso que la convergencia por criterio de celdas con etiquetas asignadas tiene un coeficiente Dice, sensibilidad y precisi√≥n cercano, en el 0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1 Convergencia completa Convergencia por celdas etiquetadas Dice - Tumor Sensiblidad - Tumor Precisi√≥n - Tumor Especificidad - Tumor 0 5 10 15 20 25 30 35 40 45 Completa Celdas etiquetadas Pasos de evoluci√≥n 91 orden de las cent√©simas, a la convergencia completa, a pesar que termina en un n√∫mero significativamente inferior de pasos de evoluci√≥n, como indican la Tabla 6.4 y la Figura 6.7. Un factor a tomar en cuenta para el resultado de esta prueba es el posicionamiento aleatorio de semillas correctas en todo el volumen. Para el caso de la convergencia con todas las celdas etiquetadas, el aut√≥mata termina su evoluci√≥n en 16 pasos. En el caso de la convergencia completa, el aut√≥mata termina su evoluci√≥n en 42 pasos. El uso de la funci√≥n isequal()de Matlab, visualizado en un corte de la segmentaci√≥n en la Figura 6.8, muestra que las segmentaciones tienen posicionamiento distinto de las etiquetas y son cualitativamente distintas; las diferencias son dif√≠ciles de percibir en isosuperficies como las que aparecen en la Figura 6.9. A pesar que las segmentaciones son cualitativamente distintas, la diferencia no resulta significativa visualmente. 92 a) b) c) d) Figura 6.8 - Diferencias Cualitativas por Criterio de Convergencia en Cortes a) Verdad fundamental determinada por operador humano corte 59 del dataset HG002. Se resalta que la locaci√≥n x = 138, y = 152 tiene etiqueta 2 (edema). El corte fue rotado 90 grados a la izquierda para centrar y facilitar la visualizaci√≥n de la etiqueta de clase correspondiente a la celda con locaci√≥n (138, 152). b) Resultado de comparaci√≥n de diferencias entre las segmentaciones; el punto blanco indica la √∫nica diferencia de etiquetado encontrada entre ambas segmentaciones. c) Segmentaci√≥n obtenida por criterio de convergencia de celdas etiquetadas. d) Segmentaci√≥n obtenida por criterio de convergencia completa. 93 (a) b) Figura 6.9 - Isosuperficies de Segmentaciones a) Segmentaci√≥n obtenida por Criterio de Convergencia Completa. b) Segmentaci√≥n obtenida por Criterio de Celdas Etiquetadas 6.4 Estudio del Efecto de N√∫mero de Semillas Correctas Suministradas por el Usuario en la Calidad de Segmentaci√≥n En GrowCut, existe una correlaci√≥n positiva entre n√∫mero de semillas aut√©nticamente correspondientes a una clase de segmentaci√≥n y calidad de segmentaci√≥n obtenida. El prop√≥sito de un m√©todo de segmentaci√≥n asistida para IRM de radiocirug√≠a es reducir el tiempo de trabajo de un operador humano al segmentar estructuras anat√≥micas. Debido que un menor n√∫mero de semillas suministradas por el operador corresponde con un menor tiempo de trabajo, resulta de inter√©s estudiar el efecto cuantitativo que tiene el n√∫mero de semillas suministradas por el usuario en la segmentaci√≥n. En la Tabla 6.5 y la Figura 6.10 se presentan √∫nicamente el coeficiente Dice de cada segmentaci√≥n por resultar la m√©trica m√°s representativa de la calidad de la segmentaci√≥n para la aplicaci√≥n. ÔÇ∑ Regla de evoluci√≥n del aut√≥mata: ‚ÄúGrowcut Corregido‚Äù ÔÇ∑ Canal Evaluado: T1Gad ÔÇ∑ Medida de distancia utilizada para calcular fuerzas de ataque: euclidiana ÔÇ∑ Sistema de vecindad: von Neumann Clase 5% de las Semilas de Clase 10% de las Semillas de Clase 15% de las Semillas de Clase 20% de las Semillas de Clase 25% de las Semillas de Clase 30% de las Semillas de Clase Dice Dice Dice Dice Dice Dice Tumor 0.9403 0.9519 0.9593 0.9634 0.9681 0.9713 Edema 0.8675 0.8942 0.9100 0.9208 0.9290 0.9361 Tabla 6.5: Coeficientes Dice de Tumor y Edema para distintas cantidades de semillas correctas. 94 Figura 6.10 - Visualizaciones de coeficientes Dice de Tumor y Edema para distintas cantidades de semillas correctas. 5% de las semillas de cada clase (para tumor, edema y background) corresponde al n√∫mero de etiquetas que un operador humano experto puede asignar al volumen de IRM tras pocos minutos de inspecci√≥n visual. La Tabla 6.5 muestra una diferencia √≠nfima (3 cent√©simas) en la calidad de segmentaci√≥n de tumor obtenida suministrando el 5% de las celdas correspondientes a la clase tumor como semilla y la obtenida suministrando el 30%; la diferencia en coeficiente Dice para la clase edema, entre los dos casos, es de apenas 8 cent√©simas. 5% de las celdas tumorales, 5% de las celdas de edema y 5% de las celdas de background es el n√∫mero de semillas de clase usado en las siguientes pruebas, por resultar representativo del uso expedito del algoritmo segmentador por parte de un usuario experto. 6.5 Comparaci√≥n de Fuerza de Ataque Determinada por Distancia Manhattan contra Fuerza de Ataque Determinada por Distancia Euclidiana La distancia Manhattan representa una medida de distancia m√°s num√©ricamente estable que la distancia euclidiana, debido a que no involucra el uso de potencias o ra√≠ces cuadradas. Resulta de inter√©s comprobar si existe diferencia en la calidad de segmentaci√≥n obtenida utilizando la distancia 0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1 5% 10% 15% 20% 25% 30% Dice - Tumor Dice - Edema 95 Manhattan, en lugar de la distancia euclidiana, para determinar fuerzas de ataque entre celdas vecinas. ÔÇ∑ Regla de evoluci√≥n del aut√≥mata: ‚ÄúGrowcut Corregido‚Äù ÔÇ∑ Canales Evaluados : T1, T1Gad, T2 y FLAIR ÔÇ∑ Dataset: HG0022, evaluado de forma conjunta en los canales T1, T1Gad, T2 y FLAIR. Cada celda del aut√≥mata tiene un vector con 4 niveles digitales de la imagen. ÔÇ∑ Fijadas aleatoriamente en todo el volumen, corresponden al 5% de las celdas de la clase tumor, 5% de las celdas de la clase edema y 5% de las celdas de la clase background ÔÇ∑ Criterio de Convergencia: Convergencia Completa Clase Distancia Manhattan Distancia Euclidiana Dice Sensibilidad Precisi√≥n Especificidad Dice Sensibilidad Precisi√≥n Especificidad Tumor 0.9390 0.9310 0.9470 0.9927 0.9396 0.9326 0.9647 0.9928 Edema 0.8943 0.8933 0.8953 0.9778 0.8926 0.8921 0.8931 0.9776 Tabla 6.6: M√©tricas de calidad de segmentaci√≥n para fuerza de ataque determinada por distancia Manhattan, frente a fuerza de ataque determinada por distancia euclidiana Figura 6.11 - Visualizaciones de m√©tricas de calidad de segmentaci√≥n para fuerza de ataque determinada por distancia Manhattan, frente a fuerza de ataque determinada por distancia euclidiana. 0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1 Distancia Manhattan Distancia Euclidiana Dice - Tumor Sensiblidad - Tumor Precisi√≥n - Tumor Especificidad - Tumor 96 Tiempo de Ejecuci√≥n Distancia Manhattan Distancia Euclidiana GeForce GT 520 18.91 seg. 18.93 seg. GeForce GTX 650 0.6584 seg. 0.6586 seg. N√∫mero de pasos en los que se completa la evoluci√≥n 42 42 Tabla 6.7: M√©tricas de Tiempo de respuesta Figura 6.12 - N√∫mero de pasos de evoluci√≥n invariante, distancia Manhattan frente a distancia euclidiana En este caso, existe una √≠nfima variabilidad en la calidad de segmentaci√≥n, evidenciada en las m√©tricas de la Tabla 6.6 y en la Figura.11, al cambiar la distancia Euclidiana por la distancia Manhattan como medida para determinar la fuerza de los ataques entre celdas vecinas. La variabilidad est√° en el orden de las mil√©simas, en cuanto a Coeficiente Dice, para las clases tumor y edema. La mayor estabilidad num√©rica de la distancia Manhattan puede hacer que resulte atractiva al implementar un aut√≥mata celular segmentador de datasets grandes o en aquellas reglas de evoluci√≥n para el aut√≥mata celular que consideran penalizaciones a la fuerza de ataque. El n√∫mero de pasos de evoluci√≥n, que se muestra en la Figura 6.12 y la Tabla 6.7, resulta invariante. 6.6 Introducci√≥n de Error e Incertidumbre en la Configuraci√≥n Inicial del Aut√≥mata La intervariabilidad (variabilidad en las segmentaciones producidas por distintos expertos) y 0 5 10 15 20 25 30 35 40 45 Distancia Manhattan Distancia Euclidiana Pasos de evoluci√≥n 97 la intravariabilidad (variabilidad en las segmentaciones producidas por un mismo experto) est√°n ampliamente documentadas en la literatura de m√©todos de segmentaci√≥n de im√°genes m√©dicas [Warfield02], [Prastawa04], [Warfield04], [Warfield08]. En un proceso de segmentaci√≥n asistida deben esperarse errores por parte de un operador humano en la definici√≥n de las etiquetas de clase. En esta prueba, las celdas asignadas err√≥neamente durante la etapa de selecci√≥n de semillas simulan el uso real, por parte de un operador experto, del m√©todo propuesto en un proceso de segmentaci√≥n asistida. Se cuantifica el efecto del error en la calidad de la segmentaci√≥n obtenida. Adem√°s se eval√∫a si existe un efecto correctivo del error de asignaci√≥n de semillas al agregar incertidumbre a las semillas erradas. ÔÇ∑ Se compara la calidad de segmentaci√≥n obtenida con semillas correctas contra las calidades de las segmentaciones obtenidas introduciendo error sin incertidumbre e introduciendo error con incertidumbre. A continuaci√≥n se especifican los par√°metros de la prueba.Dataset: HG0022 del MICCAI BRATS 2012, evaluado en el canal T2. ÔÇ∑ Posicionamiento y N√∫mero de las Semillas: Las semillas fueron colocadas aleatoriamente en todo el volumen representando el 5% de las celdas totales de la clase tumor, 5% de las celdas totales de la clase edema y 5% de las celdas totales de la clase background. ÔÇ∑ Error introducido: Utilizando la verdad fundamental, se fijaron err√≥neamente 174 semillas, representando el 10% de las celdas semilla asignadas a la clase tumor. 87 celdas tumorales fueron asignadas a la clase background y 87 celdas tumorales fueron asignadas a la clase edema. ÔÇ∑ Incertidumbre introducida: las semillas err√≥neamente definidas recibieron una fuerza inicial de 0.5. Al resto de las semillas se le asign√≥ fuerza inicial de 1.0. ÔÇ∑ Criterio de convergencia utilizado: Convergencia completa. 98 a) b) c) Figura 6.13 - Introducci√≥n de Error e Incertidumbre a) Segmentaci√≥n obtenida sin introducci√≥n de error. b) Segmentaci√≥n obtenida al asignar err√≥neamente el 10% de las semillas de segmentaci√≥n para la clase tumor, la mitad de estas semillas fue asignada a la clase edema y la otra mitad a background con una certidumbre de pertenencia (fuerza) de 1.0. c) Segmentaci√≥n obtenida al asignar err√≥neamente el 10% de las semillas de segmentaci√≥n para la clase tumor, la mitad de estas semillas fue asignada a la clase edema y la otra mitad a background con una certidumbre de pertenencia (fuerza) de 0.5. Clase Caso Libre de Error Error sin Incertidumbre Error con Incertidumbre Dice Sens. Prec. Esp. Dice Sens. Prec. Esp. Dice Sens. Prec. Esp. Tumor 0.9270 0.9197 0.9345 0.9915 0.8796 0.8328 0.9321 0.9920 0.9250 0.9139 0.9363 0.9918 Edema 0.8723 0.8665 0.8782 0.9763 0.8601 0.8676 0.8527 0.9704 0.8718 0.8675 0.8762 0.9758 Tabla 6.8: M√©tricas de calidad de segmentaci√≥n para semillas libre de error, semillas con error del 10%, semillas con error del 10% e incertidumbre Figura 6.14 - Visualizaciones de m√©tricas de calidad de segmentaci√≥n para semillas libre de error, semillas con error del 10% y semillas con error del 10% e incertidumbre 0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1 Caso Libre de Error Error sin Incertidumbre Error con incertidumbre Dice - Tumor Sensiblidad - Tumor Precisi√≥n - Tumor Especificidad - Tumor 99 Tiempo de Ejecuci√≥n Caso Libre de Error Error sin Incertidumbre Error con Incertidumbre GeForce GT 520 (segundos) 18.1 18.6 19 GeForce GTX 650 (segundos) 0.6585 0.6587 0.7103 N√∫mero de pasos en los que se completa la evoluci√≥n 42 43 45 Tabla 6.9: M√©tricas de tiempo de respuesta para segmentaciones con semillas libres de error, semillas con error sin incertidumbre y semillas con error e incertidumbre. Figura 6.15 - Pasos de evoluci√≥n de segmentaci√≥n con semillas libre de error, segmentaci√≥n con semillas con error del 10% y semillas con error del 10% e incertidumbre Las semillas de segmentaci√≥n asignadas err√≥neamente, con incertidumbre de pertenencia a clase (ùúé < 1), pueden recuperar su aut√©ntica etiqueta de clase durante la evoluci√≥n del aut√≥mata, como se puede apreciar en la Figura 6.13c; esto no ocurre si las semillas asignadas err√≥neamente tienen ùúé = 1, asumiendo que ùúé = 1 corresponde a la fuerza m√°xima de celda en el aut√≥mata, como en la Figura 6.13b. La introducci√≥n de error e incertidumbre aumentan el tiempo de respuesta, como se puede apreciar en la Figura 6.15 y la Tabla 6.9. Es importante aclarar que, debido a la naturaleza monot√≥nica decreciente de las funciones utilizadas para calcular la fuerza de ataque entre celdas vecinas, la mayor fuerza relativa en la configuraci√≥n inicial del aut√≥mata corresponder√° a celdas que no tendr√°n capacidad de cambiar de etiqueta. Las celdas con etiqueta err√≥neamente asignada, con fortaleza igual a 1, no pueden corregir su etiqueta durante a la evoluci√≥n del aut√≥mata, debido que 1 corresponde a la fortaleza m√°xima 40 41 42 43 44 45 Libre de error Error sin incertidumbre Error con incertidumbre Pasos de evoluci√≥n 100 utilizada en la configuraci√≥n inicial del aut√≥mata. 6.7 Comparaci√≥n entre Vecindad Moore 3D y Vecindad Von Neumann 3D Las vecindades Moore 3D y Von Neumann 3D forman parte de la literatura cl√°sica de aut√≥matas celulares [Wolfram02]; sin embargo, los efectos de cada una en la calidad de segmentaci√≥n a trav√©s de reglas derivadas de GrowCut no est√° presente en la literatura del m√©todo [Vezhnevets05], [Kim10]. Durante el procesamiento de im√°genes utilizadas en los prototipos y demostraciones (como los presentes en las Figuras 4.4 y 4.12) se observ√≥ la aparici√≥n de artefactos de segmentaci√≥n notables al utilizar la vecindad Moore, ausentes de las segmentaciones (utilizando las mismas configuraciones iniciales) obtenidas al utilizar la vecindad Von Neumann. Se realiz√≥ esta prueba en b√∫squeda de la aparici√≥n de este comportamiento en las m√©tricas de calidad de segmentaci√≥n. En este caso, como se aprecia en la Tabla 6.10 y la Figura 6.16, la diferencia entre la calidad de las segmentaciones, tanto para la clase tumor como para la clase edema no result√≥ significativa y est√° en cent√©simas. La Tabla 6.11 y la Figura 6.17 evidencian una ligera reducci√≥n (3 pasos de evoluci√≥n) en tiempo de respuesta en la Vecindad Von Neumann. Clase Vecindad Moore Vecindad Von Neumann Dice Sensibilidad Precisi√≥n Especificidad Dice Sensibilidad Precisi√≥n Especifidad Tumor 0.9213 0.9172 0.9255 0.9883 0.9253 0.9203 0.9303 0.9891 Edema 0.8615 0.8662 0.8568 0.9651 0.8715 0.8704 0.8726 0.9693 Tabla 6.10: M√©tricas de calidad de segmentaci√≥n comparando sistemas de vecindad 101 Figura 6.16 - Visualizaciones de m√©tricas de calidad de segmentaci√≥n comparando sistemas de vecindad Tiempo de Ejecuci√≥n Vecindad Moore Vecindad Von Neumann GeForce GT 520 7.74 segundos 6.52 segundos GeForce GTX 650 1.10 segundos 1.07 segundos N√∫mero de pasos en los que se completa la evoluci√≥n 25 22 Tabla 6.11: M√©tricas de tiempo de respuesta para vecindad Moore y Von Neumann 0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1 Vecindad Moore Vecindad Von Neumann Dice - Tumor Sensiblidad - Tumor Precisi√≥n - Tumor Especificidad - Tumor 102 Figura 6.17 - Histograma de pasos de evoluci√≥n para vecindades Moore y Von Neumann Durante el desarrollo de este trabajo y otros afines [Rueda13], [Torres13], se observ√≥ que el uso de la vecindad Moore, en lugar de la vecindad Von Neumann, ocasion√≥ reducciones cualitativas notables en la calidad de las segmentaciones obtenidas. El prop√≥sito de esta prueba es dar un ejemplo de este comportamiento, que supone un cambio m√≠nimo en la implementaci√≥n del algoritmo, pero provee posible una mejora en la calidad de segmentaci√≥n y reduce el n√∫mero de pasos de evoluci√≥n requeridos para alcanzar convergencia. Se sugiere extender esta prueba, comparando vecindades, a otros datasets. Otras pruebas en este documento son realizadas con la vecindad Von Neumann 3D. 6.8 Comparaci√≥n entre Calidad de Segmentaci√≥n Obtenida con M√∫ltiples Versiones de GrowCut En esta secci√≥n se compara la calidad de la segmentaciones obtenidas con variantes a la regla GrowCut original. 1 6 11 16 21 26 Moore Von Neumann Pasos de evoluci√≥n 103 6.8.1 GrowCut Corregido Clase ‚ÄúGrowcut Original‚Äù ‚ÄúGrowcut Corregido‚Äù Dice Sensibilidad Precisi√≥n Especificidad Dice Sensibilidad Precisi√≥n Especifidad Tumor 0.9240 0.9209 0.9271 0.9905 0.9244 0.9203 0.9284 0.9908 Edema 0.8706 0.8694 0.8719 0.9749 0.8704 0.8704 0.8718 0.9752 Tabla 6.12: M√©tricas de calidad de segmentaci√≥n para "Growcut Original" y "GrowCut Corregido" Figura 6.18 - Visualizaciones de m√©tricas de calidad de segmentaci√≥n para "GrowCut Original" y "GrowCut Corregido" Tiempo de Ejecuci√≥n ‚ÄúGrowcut Original‚Äù ‚ÄúGrowcut Corregido‚Äù GeForce GT 520 5.36 segundos 3.5 segundos GeForce GTX 650 0.67 segundos 0.48 segundos N√∫mero de pasos en los que se completa la evoluci√≥n 32 22 Tabla 6.13: M√©tricas de tiempo de respuesta para "GrowCut Original" y "GrowCut Corregido" 0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1 GrowCut Original GrowCut Corregido Dice - Tumor Sensiblidad - Tumor Precisi√≥n - Tumor Especificidad - Tumor 104 Figura 6.19 - Visualizaciones de pasos de evoluci√≥n para "GrowCut Original" y "GrowCut Corregido" A pesar que la regla GrowCut original [Vezhnevets05] tiene un error en el criterio para determinar cu√°l es la celda vecina que debe ser evaluada como vencedora, este error frecuentemente afecta solo a un reducido n√∫mero de casos de borde y su efecto en la calidad de la segmentaci√≥n puede resultar despreciable, como se aprecia en la Tabla 6.12 y la Figura 6.18. Una diferencia notable entre ambas reglas es el n√∫mero de pasos requeridos para alcanzar convergencia en este caso de prueba, como se evidencia en la Figura 6.19 y la Tabla 6.13 en este caso de prueba, completa su convergencia en 60% de los pasos que requiere GrowCut original para alcanzar un resultado cuantitativamente comparable. Esto sugiere que una heur√≠stica de convergencia como la que se indica en la Secci√≥n 4.5.1.1 es inapropiada para la regla GrowCut original. 6.8.2 GrowCut con Penalizaci√≥n a Fuerza de Ataque La penalizaci√≥n de ataque tiene el prop√≥sito de hacer que las celdas cuyo nivel digital sea poco representativo de su etiqueta tengan menor probabilidad de colonizar el espacio de la imagen. En esta prueba la penalizaci√≥n lineal fue aplicada cuando la celda tiene nivel digital con m√°s de 2 desviaciones est√°ndar con respecto a la media. Para la regla de evoluci√≥n que emplea penalizaciones constantes a las fuerzas de ataque entre 0 5 10 15 20 25 30 35 GrowCut Original GrowCut Corregido Pasos de evoluci√≥n 105 celdas vecinas, se utiliz√≥ c1 = 0.99 (penalizaci√≥n de 1%) y c2 = 0.95 (penalizaci√≥n de 5%). En el trabajo de Kim et al. [Kim10], se mostraron ejemplos de segmentaci√≥n de cortes √∫nicos de IRM (no vol√∫menes), con semillas foreground / background provistas manualmente. En estos casos, se report√≥ que la penalizaci√≥n exponencial superaba a la regla GrowCut original en calidad de segmentaci√≥n, evaluada seg√∫n coeficiente Dice. En el caso aqu√≠ mostrado, segmentando el volumen HG0022 con semillas fijadas de forma aleatoria, a trav√©s de una distribuci√≥n probabil√≠stica uniforme, la calidad de segmentaci√≥n, evaluada seg√∫n coeficiente Dice, resulta abrumadoramente inferior a la obtenida utilizando la regla GrowCut original para el mismo caso, esto se puede verificar en las tablas 6.12 y 6.14, el bajo coeficiente Dice se debe a la sensibilidad pr√°cticamente nula de esta segmentaci√≥n. Cualitativamente, la segmentaci√≥n producida en este caso por la regla de evoluci√≥n con penalizaci√≥n exponencial es deficiente, es una nube de puntos, no identificable como una masa tumor o edema, como se aprecia en la Figura 6.23a. Las reglas de evoluci√≥n que emplean penalizaci√≥n lineal y penalizaci√≥n constante a las fuerza de ataque exhiben puntuaciones de coeficiente Dice cercanas a las de las reglas regulares (GrowCut original y corregido), como se puede verificar en la tabla 6.12. La penalizaci√≥n constante presenta el menor tiempo de respuesta, como se puede ver en la Tabla 6.15 y la Figura 6.21. Clase Penalizaci√≥n Exponencial Penalizaci√≥n Lineal Penalizaci√≥n Constante Dice Sens. Prec. Esp. Dice Sens. Prec. Esp. Dice Sens. Prec. Esp. Tumor 0.0952 0.05 1 1 0.9021 0.8594 0.9492 0.9958 0.9242 0.9223 0.9262 0.9905 Edema 0.0952 0.0500 1 1 0.7018 0.8745 0.5484 0.8912 0.8714 0.8837 0.8595 0.9720 Tabla 6.14: M√©tricas de calidad de segmentaci√≥n para reglas de evoluci√≥n con fuerzas de ataque afectadas por penalizaci√≥n exponencial, penalizaci√≥n lineal y penalizaci√≥n constante 106 Figura 6.20 - Visualizaciones de calidad de segmentaci√≥n para reglas de evoluci√≥n con fuerzas de ataque afectadas por penalizaci√≥n exponencial, penalizaci√≥n lineal y penalizaci√≥n constante Tiempo de Ejecuci√≥n Penalizaci√≥n Exponencial Penalizaci√≥n Lineal Penalizaci√≥n Constante GeForce GT 520 38.17 segundos 15.16 segundos 7.56 segundos GeForce GTX 650 3.51 segundos 1.26 segundos 0.81 segundos N√∫mero de pasos en los que se completa la evoluci√≥n 79 43 22 Tabla 6.15: M√©tricas de tiempo de respuesta para reglas de evoluci√≥n con fuerzas de ataque afectadas por penalizaci√≥n exponencial, penalizaci√≥n lineal y penalizaci√≥n constante 0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1 Penalizaci√≥n Exponencial Penalizaci√≥n Lineal Penalizaci√≥n Constante Dice - Tumor Sensiblidad - Tumor Precisi√≥n - Tumor Especificidad - Tumor 107 Figura 6.21 - Visualizaciones de pasos de evoluci√≥n para reglas de evoluci√≥n con fuerzas de ataque afectadas por penalizaci√≥n exponencial, penalizaci√≥n lineal y penalizaci√≥n constante a) b) c) d) Figura 6.22 - Comparaci√≥n cualitativa de segmentaciones afectadas por penalizaci√≥n, corte 55, dataset HG0022 a) Penalizaci√≥n Exponencial b) Penalizaci√≥n Lineal c) Penalizaci√≥n Constante d) Verdad Fundamental. 0 10 20 30 40 50 60 70 80 Exponencial Lineal Constante Pasos de evoluci√≥n 108 a) b) c) d) Figura 6.23 - Comparaci√≥n cualitativa de segmentaciones afectadas por penalizaci√≥n a) Penalizaci√≥n Exponencial. b) Penalizaci√≥n Lineal. c) Penalizaci√≥n Constante. d) Verdad Fundamental 6.9 Comparaci√≥n de Calidad de Segmentaci√≥n entre Canales Individuales Frecuentemente se realizan estudios multicanal a un mismo paciente debido a que las intensidades de se√±al en cada canal de resonancia magn√©tica corresponden a distinta materia. En el canal T1 las intensidades altas de se√±al, t√≠picamente asociadas con el espectro "blanco", corresponden a grasa, prote√≠nas, hemorragia, melanina y gadolinio. Las intensidades altas de se√±al en el canal T2 corresponden a materia acuosa. Las intensidades altas del canal FLAIR corresponden a materia acuosa y gliosis, un cambio reactivo en las c√©lulas gliales que indica da√±o al sistema nervioso. En estas pruebas se desea evaluar el efecto de la elecci√≥n de un canal particular en la calidad 109 de la segmentaci√≥n obtenida, as√≠ como el efecto de la combinaci√≥n de canales en un dataset sint√©tico generado por TumorSim, TS05, con igual sesgo y ruido en los 4 canales simulados. El dataset tiene dimensiones 256 x 256 x 181. ÔÇ∑ Regla de evoluci√≥n: GrowCut corregido ÔÇ∑ Sistema de vecindad: Von Neumann 3D ÔÇ∑ Medida de distancia vectorial: euclidiana ÔÇ∑ Criterio de convergencia: completa ÔÇ∑ Semillas: fijadas aleatoriamente, a partir de una distribuci√≥n uniforme, corresponden al 5% de las celdas aut√©nticamente correspondientes a cada clase. Clase Canal T1 Canal T1Gad Canal T2 Canal FLAIR Dice Sens Prec Esp Dice Sens Prec Esp Dice Sens Prec Esp Dice Sens Prec Esp Tumor 0.7856 0.7887 0.7825 0.9976 0.8586 0.8513 0.8661 0.9985 0.7958 0.7747 0.8181 0.9981 0.7915 0.7841 0.7990 0.9975 Edema 0.9334 0.9355 0.9355 0.9738 0.9273 0.9290 0.9256 0.9697 0.9364 0.9436 0.9294 0.9734 0.9463 0.9490 0.9436 0.9742 Tabla 6.16: M√©tricas de calidad de segmentaci√≥n para canales individuales T1, T1Gad, T2 y FLAIR Figura 6.24 - M√©tricas de calidad de segmentaci√≥n para canales individuales T1, T1Gad, T2 y FLAIR 0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1 T1 T1Gad T2 FLAIR Dice - Tumor Sensiblidad - Tumor Precisi√≥n - Tumor Especificidad - Tumor 110 Tiempo de Ejecuci√≥n Canal T1 Canal T1Gad Canal T2 Canal FLAIR GeForce GT 520 7.14 segundos 6.61 segundos 7.01 segundos 9.5 segundos GeForce GTX 650 0.8403 segundos 0.78 segundos 0.86 segundos 1.06 segundos Pasos de Evoluci√≥n 30 27 28 35 Tabla 6.17: Tiempos de respuesta para segmentaciones realizadas empleando las mismas semillas, en distintos individuales canales de IRM (T1, T1Gad, T2, FLAIR) Figura 6.25 - Tiempos de respuesta para segmentaciones realizadas empleando las mismas semillas, en distintos canales individuales de IRM (T1, T1Gad, T2, FLAIR) Esta prueba expres√≥ un resultado de diferencia de calidad de segmentaci√≥n favoreciendo al canal T1Gad en el orden de unas 7 u 8 cent√©simas de coeficiente Dice para clase tumor, como se muestra en la Tabla 6.16 y en la Figura 6.24. El canal T2 ofrece la calidad de segmentaci√≥n m√°s cercana al T1Gad en esta prueba. En la prueba realizada, el canal T1Gad converge m√°s r√°pidamente que los otros, como se aprecia en la Figura 6.25 y la Tabla 6.17. 0 5 10 15 20 25 30 35 T1 T1Gad T2 FLAIR Pasos de evoluci√≥n 111 6.10 Comparaci√≥n de Calidad de Segmentaci√≥n al Realizar Combinaci√≥n de Canales A continuaci√≥n se presentan las combinaciones de canales posibles para el dataset TS05. 6.10.1 Combinaci√≥n de 4 Canales Clase Canales T1 + T1Gad + T2 + FLAIR Dice Sens Prec Esp Tumor 0.8663 0.8539 0.8790 0.9985 Edema 0.9481 0.9492 0.9470 0.9764 Tabla 6.18: M√©tricas de calidad de segmentaci√≥n para combinaci√≥n de los canales T1, T1Gad, T2 y FLAIR Figura 6.26 - M√©tricas de calidad de segmentaci√≥n para combinaci√≥n de los canales T1, T1Gad, T2 y FLAIR La calidad de segmentaci√≥n de tumor y edema, seg√∫n coeficiente Dice al combinar los 4 canales de segmentaci√≥n (Tabla 6.18) es superior en tan s√≥lo unas cent√©simas a la calidad de segmentaci√≥n al utilizar √∫nicamente el canal T1Gad (Tabla 6.14). Esto puede deberse al aumento de informaci√≥n al combinar los canales. El n√∫mero de pasos para alcanzar la convergencia tambi√©n se reduce con respecto al mejor caso unicanal, T1Gad (Tabla 6.17 y Figura 6.25). 0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1 T1 + T1Gad + T2+ FLAIR Dice - Tumor Sensiblidad - Tumor Precisi√≥n - Tumor Especificidad - Tumor 112 GeForce GT 520 (segundos) 10.5 GeForce GTX 650 (segundos) 1.16 N√∫mero de Pasos de Evoluci√≥n 16 Tabla 6.19: M√©tricas de tiempo de respuesta para combinaci√≥n de los canales T1, T1Gad, T2 y FLAIR 6.10.2 Combinaciones de 3 Canales En la Tabla 6.20 y la Figura 6.27 se muestran las m√©tricas de calidad de segmentaci√≥n para las combinaciones de 3 canales. Se evidencia que las combinaciones de canales que incluyen al canal T1Gad ofrecen una calidad de segmentaci√≥n cercana a nivel de mil√©simas la que se obtiene combinando los 4 canales. En todos estos casos de combinaci√≥n tricanal, se observa una reducci√≥n de los pasos requeridos para alcanzar convergencia con respecto a las segmentaciones unicanal en la Tabla 6.24, esto se aprecia en la Tabla 6.21 y la Figura 6.27. Clase Canales FLAIR+T1+T1Gad Canales T1+T1Gad+T2 Canales FLAIR + T1+ T2 Canales FLAIR + T1Gad +T2 Dice Sens Prec Esp Dice Sens Prec Esp Dice Sens Prec Esp Dice Sens Prec Esp Tumor 0.8651 0.8539 0.8766 0.9985 0.8651 0.8452 0.8859 0.9987 0.7990 0.7910 0.8072 0.9977 0.8649 0.8498 0.8805 0.9985 Edema 0.9488 0.9489 0.9486 0.9771 0.9414 0.9421 0.9407 0.9749 0.9484 0.9492 0.9477 0.9767 0.9470 0.9508 0.9433 0.9740 Tabla 6.20: M√©tricas de calidad de segmentaci√≥n con combinaciones tricanal Tiempo de Ejecuci√≥n Canales FLAIR + T1 + T1Gad Canales T1+T1Gad+T2 Canales FLAIR + T1+ T2 Canales FLAIR + T1Gad + T2 GeForce GT 520 (segundos) 7.57 7.74 8.27 8.16 GeForce GTX 650 (segundos) 0.87 0.91 0.97 0.96 Pasos de Evoluci√≥n 17 18 19 19 Tabla 6.21: M√©tricas de tiempo de respuesta para combinaciones tricanal 113 Figura 6.27 - M√©tricas de calidad de segmentaci√≥n con combinaciones tricanal Figura 6.28 - M√©tricas de tiempo de respuesta para combinaciones tricanal 6.10.3 Combinaciones de 2 Canales A continuaci√≥n se presentan las combinaciones de dos canales posibles con el dataset 0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1 FLAIR + T1 + T1Gad T1 + T1Gad + T2 FLAIR + T1 + T2 FLAIR + T1Gad + T2 Dice - Tumor Sensiblidad - Tumor Precisi√≥n - Tumor Especificidad - Tumor 1 3 5 7 9 11 13 15 17 19 FLAIR + T1 + T1Gad T1 + T1Gad + T2 FLAIR + T1 + T2 FLAIR + T1Gad + T2 Pasos de evoluci√≥n 114 sint√©tico TS05. Clase Canales FLAIR + T1 Canales FLAIR + T1Gad Canales FLAIR + T2 Dice Sens Prec Esp Dice Sens Prec Esp Dice Sens Prec Esp Tumor 0.7973 0.7936 0.8009 0.9976 0.8619 0.8486 0.8755 0.9985 0.7992 0.7868 0.8121 0.9977 Edema 0.9489 0.9484 0.9494 0.9775 0.9479 0.9503 0.9455 0.9756 0.9459 0.9499 0.9420 0.9734 Tabla 6.22: M√©tricas de calidad de segmentaci√≥n para combinaciones de dos canales. Clase Canales T1 + T1 Gad Canales T1 + T2 Canales T1Gad + T2 Dice Sens Prec Esp Dice Sens Prec Esp Dice Sens Prec Esp Tumor 0.8537 0.8354 0.8728 0.9986 0.7958 0.7838 0.8083 0.9978 0.8689 0.8562 0.8820 0.9986 Edema 0.9354 0.9380 0.9329 0.9738 0.9420 0.9416 0.9423 0.9756 0.9401 0.9422 0.9380 0.9736 Tabla 6.23: M√©tricas de calidad de segmentaci√≥n para combinaciones de dos canales. Figura 6.29 - M√©tricas de calidad de segmentaci√≥n para combinaciones de dos canales. Tiempo de Ejecuci√≥n FLAIR + T1 FLAIR + T1Gad FLAIR + T2 T1 + T1 Gad T1 + T2 T1Gad + T2 GeForce GT 520 (segundos) 9.1 6.52 19.1 7.07 9.2 6.61 GeForce GTX 650 (segundos) 1.04 0.75 2.21 0.81 1.04 0.79 Pasos de Evoluci√≥n 27 19 54 21 27 20 Tabla 6.24: M√©tricas de tiempo de respuesta, combinaci√≥n de dos canales 0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1 flair + t1 flair + t1Gad flair + t2 t1 + t1Gad t1 + t2 t1Gad + t2 Dice - Tumor Sensiblidad - Tumor Precisi√≥n - Tumor Especificidad - Tumor 115 Figura 6.30 - M√©tricas de tiempo de respuesta, combinaciones de dos canales Las tablas 6.22- 6.23 y la Figura 6.29 evidencian que las mejoras en las m√©tricas de calidad de segmentaci√≥n est√°n en el orden de las cent√©simas, con respecto al uso de canales individuales (ver Tabla 6.16). En este dataset, la combinaci√≥n FLAIR + T2 ofrece el menor beneficio y requiere el mayor n√∫mero de pasos de evoluci√≥n para alcanzar convergencia, posiblemente debido a la cercan√≠a espectral entre ambos canales. El uso de la combinaci√≥n FLAIR + T2 aumenta tambi√©n el tiempo de respuesta con respecto al uso de estos canales indivualmente, como se puede apreciar al comparar la Figura 6.30 con la Figura 6.25. En este caso de prueba se muestra que la combinaci√≥n de canales al menos no perjudica la calidad de las segmentaciones obtenidas. Como trabajo futuro, se requiere un estudio exhaustivo en un n√∫mero considerable de datasets, incluyendo los efectos de deformaci√≥n por coregistro y ruido variable, del efecto de combinaci√≥n de canales en la calidad de las segmentaciones obtenidas. 6.11 Pruebas con Algoritmo de Selecci√≥n de Semillas ‚ÄúAutomaClass‚Äù En las siguientes pruebas se utiliz√≥ un dataset sint√©tico, con niveles distintos y conocidos de ruido en cada canal de IRM. Se considera a los 4 canales de la imagen (T1, T1Gad, T2 y FLAIR) al momento de seleccionar las semillas, que corresponden a particiones de m√°ximos locales en la imagen. El n√∫mero de rangos (nrang) es significativo porque corresponde al √∫nico par√°metro que 1 11 21 31 41 51 61 FLAIR + T1 FLAIR + T1Gad FLAIR + T2 T1 + T1Gad T1 + T2 T1Gad + T2 Pasos de evoluci√≥n 116 debe suministrar el usuario para guiar la segmentaci√≥n. Nrang determina el n√∫mero de clases presentes en la segmentaci√≥n. Un mayor nrang corresponde a un mayor n√∫mero de particiones, como las que aparecen en el histograma de la Figura 4.13 y la Figura 4.14 como P1, P2 (para 2 particiones). La Figura 6.32 muestra las segmentaciones obtenidas con distinto valor de nrang. Dataset: TSO2, producido por TumorSim, dimensi√≥n: 256 x 256 x 181. . Sistema de Vecindad Usado: Von Neumann 3D Regla de Evoluci√≥n: "GrowCut Corregido" Criterio de Convergencia: completa a) b) Figura 6.31 - Semillas de AutomaClass a) Dataset TSO2, corte 90, canal T1. b) Semillas seleccionada para el corte por AutomaClass, nrang=7 117 a) b) c) d) Figura 6.32 - Segmentaciones Producidas con Semillas de AutomaClass a) Segmentaci√≥n producida al utilizar nrang = 7, generando 28 clases. b) Segmentaci√≥n producida al utilizar nrang = 8, generando 37 clases. c) Segmentaci√≥n producida al utilizar nrang = 9, generando 41 clases. d) Verdad Fundamental producida por TumorSim, para 7 clases. Clase Nrang = 7 Nrang = 8 Nrang = 9 Dice Sens. Prec. Esp. Dice Sens. Prec. Esp. Dice Sens. Prec. Esp. Tumor 0.8249 0.7024 0.9993 0.9999 0.8226 0.6988 0.9996 1 0.8211 0.6968 0.995 1 Edema 0.7546 0.6974 0.8221 0.9664 0.7373 0.6676 0.8234 0.9681 0.7256 0.6496 0.8217 0.9686 Tabla 6.25: M√©tricas de calidad de segmentaci√≥n para 3 n√∫meros distintos de rangos de selecci√≥n de semillas a partir de m√°ximos locales en la imagen 118 Tiempo de Ejecuci√≥n Nrang = 7 Nrang = 8 Nrang = 9 GeForce GT 520 (segundos) 140.9 143.8 133.6 GeForce GTX 650 (segundos) 16.5195 16.54 16.72 N√∫mero de pasos en los que se completa la evoluci√≥n 297 298 300 Tabla 6.26 M√©tricas de tiempo de respuesta para 3 n√∫meros de rangos de selecci√≥n de semillas a partir de m√°ximos locales en la imagen Figura 6.33 - M√©tricas de Calidad de Segmentaci√≥n para 3 n√∫meros de rangos distintos de selecci√≥n de semillas a partir de m√°ximos locales en la imagen 0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1 nrang = 7 nrang = 8 nrang = 9 Dice - Tumor Sensiblidad - Tumor Precisi√≥n - Tumor Especificidad - Tumor 119 Figura 6.34 - Pasos de evoluci√≥n para 3 n√∫meros de rangos distintos de selecci√≥n de semillas a partir de m√°ximos locales en la imagen Las segmentaciones producidas por el algoritmo AutomaClass exhiben una muy alta precisi√≥n en todos los casos considerados, como aparece en la Tabla 6.25 y la Figura 6.33. El n√∫mero de pasos de evoluci√≥n necesario para alcanzar la convergencia resultan cercanos, a pesar de ser realizadas con amplia variabilidad del n√∫mero de clases. La firma espectral de tumor tiende a ser captada como un m√°ximo local en la imagen en un n√∫mero de rangos de 7, 8 y 9 particiones de m√°ximos locales. El n√∫mero m√°ximo de clases identificadas en el caso de 7 particiones es 35, en el caso de 8 particiones es 40 y el n√∫mero m√°ximo de clases en el caso de 9 particiones es 45. A pesar que se generan m√°s clases basadas en firma espectral que las que provee la verdad fundamental del TumorSim (7 clases, representadas en la Figura 6.32d) el AutomaClass tiende a detectar el tumor como un elemento correspondiente a un m√°ximo local de la imagen. 1 51 101 151 201 251 301 nrang = 7 nrang = 8 nrang = 9 Pasos de evoluci√≥n 120 CONCLUSIONES Los aut√≥matas celulares deterministas son presentados como una herramienta de alta relevancia para realizar segmentaciones y clasificaciones, para N clases, en vol√∫menes de resonancia magn√©tica cerebral, tanto de manera supervisada como no supervisada. El uso de GrowCut como m√©todo efectivo de segmentaci√≥n autom√°tica o asistida depende de la selecci√≥n espacial correcta de semillas. Entre los resultados a destacar en las pruebas presentadas est√° la alta influencia de la dispersi√≥n espacial de las semillas en la calidad de las segmentaciones obtenidas y la poca influencia en la calidad de segmentaci√≥n que tiene el n√∫mero de semillas suministrado. Con un posicionamiento altamente disperso de las semillas, el m√©todo ha exhibido robustez y capacidad de manejar incertidumbre de pertenencia de un v√≥xel a determinada clase. Estos resultados constituyen criterios de usabilidad relevantes para la planificaci√≥n de radiocirug√≠a cuando se utiliza a GrowCut como m√©todo de segmentaci√≥n asistido. En los casos probados, la regla "GrowCut Corregido" provee una reducci√≥n significativa del tiempo de c√≥mputo necesario para alcanzar la convergencia completa del aut√≥mata, junto con una mejora marginal de la calidad de la segmentaci√≥n obtenida, por lo que debe considerarse una mejora al m√©todo original. Se ha mostrado un caso de uso en que el criterio de penalizaci√≥n exponencial a la fuerza de ataque propuesto por Kim et al. [Kim10] para la segmentaci√≥n de im√°genes tumorales en resonancia magn√©tica cerebral provee segmentaciones anat√≥micas de sensibilidad pr√°cticamente nula. Se propone el uso de criterios de penalizaci√≥n lineal o penalizaci√≥n constante para mejorar la calidad de segmentaci√≥n y evitar errores num√©ricos. El uso de un bounding box de validaci√≥n para reducir el n√∫mero de v√≥xeles background contados aumenta la representatividad de la m√©trica de especificidad y se propone aqu√≠ como parte de una nueva metodolog√≠a de validaci√≥n de segmentaci√≥n de tumores cerebrales que incluya a las m√©tricas de sensibilidad y precisi√≥n. Esta metodolog√≠a es amena a la validaci√≥n de segmentaciones para la planificaci√≥n de radiocirug√≠a y difiere de la presentada en el BRATS 2012. El algoritmo de selecci√≥n de semillas, AutomaClass, es presentado como una herramienta poderosa para identificar masas tumorales de forma inmediata con una m√≠nima interacci√≥n por parte del usuario. 121 TRABAJOS FUTUROS Debido a la alta variabilidad morfol√≥gica de la IRM cerebral, es necesario un estudio exhaustivo de la calidad de las segmentaciones obtenidas con datos cl√≠nicos obtenidos de varias fuentes, con variados niveles de ruido y m√°s de 3 etiquetas en la verdad fundamental, para validar la metodolog√≠a de selecci√≥n de semillas con el AutomaClass y los par√°metros de combinaci√≥n de canales de GrowCut. 3DSlicer es una herramienta de c√≥digo abierto utilizada para el an√°lisis de IRM que provee un m√≥dulo GrowCut no paralelizado [Egger13]. Implementaciones CUDA de las variaciones del algoritmo propuestas en este documento resultar√≠an de utilidad para sus usuarios. Para aumentar en el mayor n√∫mero de casos de estudio posible la precisi√≥n, sensibilidad y autonom√≠a del procedimiento de segmentaci√≥n de tumores cerebrales para la aplicaci√≥n de radiocirug√≠a, un estudio de la compatibilidad de GrowCut y AutomaClass con otros m√©todos de segmentaci√≥n de im√°genes, como los contornos activos [Hamamci12] y los campos aleatorios de Markov [Behera12] puede resultar de relevancia. 122 BIBLIOGRAF√çA [Aponte12] Aponte, J. Clasificaci√≥n de Tejidos en Im√°genes Oncol√≥gicas de PET/CT Mediante el Algoritmo K-means. Trabajo Especial de Grado, Facultad de Ciencias, Escuela de F√≠sica, UCV, Biblioteca Alonso Gamero, 2012. [Blake98] Blake, A; M, Isard. Active Contours: The Application of Techniques from Graphics, Vision, Control Theory and Statistics to Visual Tracking of Shapes in Motion. Springer Verlag, 1998 [Boykov04] Boykov, Y.; Jolly, M. Interactive Graph Cuts for Optimal Boundary and Region Segmentation of Objects in N-D Images. Proceedings of the International Conference on Computer Vision, vol. 1, pp. 105-112, 2004 [BRATS12] Resultados de competencia de segmentaci√≥n de tumores cerebrales, BRATS, Multimodal Brain Tumor Segmentation Challenge, en la International Conference on Medical Image Computing and Computer Assisted Intervention. http://www2.imm.dtu.dk/projects/BRATS2012/FinalResults_RevisedPostMiccaiAllMetrics.xlsx [Carneiro96] Carneiro, B.; Silva, C.; Kaufman, A. Tetra-Cubes: An Algorithm to Generate Isosurfaces based upon Tetrahedra. Anais do IX SIBGRAPI, pp. 205 -210, 1996 [Chen08] Chen, C; Chapman; Kooy, H.; Loeffer, J. Neuroimaging in Radiosurgery Treatment Planning and Follow-up Evaluation. Principles and Practice of Stereotactic Radiosurgery, Springer- Verlag, pp. 9-23, 2008 [Cook04] Cook, Mathew. Universality in Elementary Cellular Automata. Complex Systems, vol 15(1), pp. 1-40 [Dijkstra59] Dijkstra; E.W. A Note on Two Problems in Connexion with Graphs. Numerische Mathematik 1, pp. 269-271, 1959 http://www2.imm.dtu.dk/projects/BRATS2012/FinalResults_RevisedPostMiccaiAllMetrics.xlsx 123 [Doyle84] Doyle, P.; Snell, L.: Random walks and electric networks. Carus Mathematical Monographs. Mathematical Association of America, no. 22, 1984 [Egger13] Egger, J.; Kappur, T; Fedorov A.; Pieper S.; Miller J.; et al. GBM Volumetry Using the 3D Slicer Medical Image Computing Platform. Scientific Reports, vol 3, 2013 [Gaster11] Gaster, Benedict; Howes, Lee; Kaeli, David; Mistry, Perhad; Schaa, Dana: Heterogenous Computing with OpenCL. Morgan Kaufmann, ISBN-13: 978-0123877666, 2011 [Gindi93] Gindi, Gene; Rangarajan Anand; Zubal George: Atlas Guided Segmentation of Brain Images via Optimizing Neural Networks, Proceedings SPIE Biomedical Image Processing IV- Biomedical Image Processing and Biomedical Visualization, vol. 1905, pp 566-575, 1993 [Gottesfeld92] Gottesfeld, Lisa. A Survey of Image Registration Techniques, ACM Computing Surveys (CSUR), vol. 24, Issue 4. Pp 325 ‚Äì 376, 1992 [Grady04] Grady, L; Funka-Lea G. Multi-label Image Segmentation for Medical Applications Based on Graph-Theoretic Electrical Potentials. ECCV Workshops CVAMIA and MMBIA, pp. 230-245, 2004 [Hansen04] Hansen, Charles; Johnson, Chris.Visualization Handbook. Academic Press, pp 7-11. [Ikits04] Ikits, Milan; Kniss, Joe; Lefohn, Aaron; Hansen, Charles. Volume Rendering Techniques. GPUGems, Addison Wesley, 2004 [Ball65] Ball, Geoffrey H.; Hall, David J.Isodata,A Novel Method of Data Analysis and Pattern Classification. Stanford Research Institute Technical Report, 1965 [Kaster11] Kaster, Frederik O.; Menze, Bjoern; Weber Marc-Andr√©; Hamprecht Fred A. Comparative Validation of Graphical Models for Learning Tumor Segmentations from Noisy Manual Annotation, International MICCAI Workshop, Revised Selected Papers, Springer, 2011 124 [Ken99] Kent, Beck: Extreme Programming Explained. Addison Wesley Professional, ISBN- 13:978-0201616415, 1999 [Khronos11] OpenCL 1.2 Specification.Khronos Group, 2011 [Lorensen87] Lorensen, W.; Cline, H. Marching Cubes: A high resolution 3D surface construction algorithm. In: Computer Graphics, Vol. 21, Nr. 4, 1987 [Zhao98] Zhao, Hong-Kai; Osher, Stanley; Merriman, Barry; Kang Myungjoo. Implicit, Nonparametric Shape Reconstruction from Unorganized Points Using a Variational Level Set Method. Computer Vision and Image Understanding, vol. 80, pp. 295-319, 1998 [Kauffmann09] Kauffmann, C; Piche, N. Seeded ND Medical Image Segmentation by Cellular Automaton on GPU. International Journal of Computer Assisted Radiology and Surgery, vol. 5, Issue 3, pp. 251-262, 2009 [Kass88] Kass, M; Witkin, A; Terzopoulos, D. Snakes: Active Contour Models. International Journal of Computer Vision, vol. 1, No. 4, pp. 321-331, 1988 [Kim10] Kim, Edward; Shen, Tian; Huang, Xiaolei. A Parallel Cellular Automata with Label Priors for Interactive Brain Tumor Segmentation. IEEE 23rd International Symposium on Computer-Based Medical Systems Conference Publications, pp. 232-237, 2010 [Koller09] Koller, Daphne; Friedman, Nir. Probabilistic Graphical Models, Principles and Techniques.MIT Press, ISBN-13: 978-0262013192, 2009 [Levoy90] Levoy, Marc. Efficient Ray Tracing of Volume Data. ACM Transactions on Graphics, vol. 9, No. 3, pp. 245-261, 1990 [Mathworks13] Image Registration Techniques, documentaci√≥n oficial de Matlab 2013a, Mathworks, 2013 http://www.mathworks.com/help/images/registering-an-image.html http://www.mathworks.com/help/images/registering-an-image.html 125 [Mena12] Mena, Christiam. Colocaci√≥n de Marco Estereot√°ctico para Radiocirug√≠a. Tesis de Pregrado, Escuela de Computacion, Universidad Central de Venezuela, Biblioteca Alonso Gamero, 2012 [Menze10] Menze, Bjoern; Leemput Va, Koen; Lashkari, Danial; Weber, Marc-Andr√©; Ayache, Nicholas; Golland, Polina.A Generative Model for Brain Tumor Segmentation in Multi-Modal Images.15th International Conference Medical Image Computing and Computer-Assisted Intervention. MICCAI 2010, vol. 13, pp. 151-159, 2010 [Mildenberger02] Mildenberger, Peter; Eichelberg, Marco; Martin, Eric.Introduction to the DICOM Standard. European Radiology, vol. 12, Issue 4, pp. 920-927, 2002 [Moga96] Moga, A; Gabbouj, M. A Parallel Marker Based Watershed Transformation. International Conference on Image Processing ICIP96, No. II, pp. 137-140, 1996 [Nvidia12] OpenCL Programming Guide for the CUDA Architecture, version 4.2, Nvidia, 2012 [O‚ÄôConnor12] O‚Äô Connor, B. F-scores, Dice, and Jaccard set similarity. http://brenocon.com/blog/2012/04/f-scores-dice-and-jaccard-set-similarity/ [Pearl09] Pearl, Judea. Causality: Models, Reasoning and Inference. Cambridge University Press, ISBN-13: 978-0521895606, 2009 [Popovici02] Popovici, A; Popovici, D. Cellular Automata in Image Processing. Department of Computer Science and Mathematics, University of West Timisoara, 2002 [Prastawa04] Prastawa, Marcel; Bullit, Elizabeth; Ho, Sean; Gerig, Guido. A Brain Tumor Segmentation Framework Based on Outlier Detection. Medical Image Analysis, vol. 8, pp. 275-283, 2004 [Prince12] Prince, Simon. Computer Vision: Models Learning and Inference. Cambridge University Press, ISBN-13: 978-1107011793, 2012 http://brenocon.com/blog/2012/04/f-scores-dice-and-jaccard-set-similarity/ 126 [Prabhakar07] Prabhakar, R.; Julka, P.K.; Ganesh, T.; Munshi,A.; Joshi, R.C.; Rath, G.K. Feasibility of Using MRI Alone for 3D Radiation Treatment Planning in Brain Tumors. Japanese Journal of Clinical Oncology, vol. 37, No. 6, pp. 405-411, 2007 [Prastawa09] Prastawa, M.; Bullitt, E.; Gerig, G. Simulation of Brain Tumors in MR Images for Evaluation of Segmentation Efficacy.Medical Image Analysis vol. 13, No. 2, pp. 297‚Äì311, 2009 [Popovic07] Popovic, A.; de la Fuente, M; Engelhardt, M.; Radermacher, K. Statistical Validation Metric for Accuracy Assessment in Medical Image Segmentation.International Journal of Computer Assisted Radiology and Surgery, pp. 169 - 181, 2007 [Reese99] Reese, L. Intelligent Paint: Region-Based Interactive Image Segmentation. Master's Thesis. Department of Computer Science, Brigham Young University, 1999 [Rother04] Rother, C; Kolmogorov, V; Blake, A. Grabcut ‚Äì Interactive Foreground Extraction Using Iterated Graph Cuts. ACM SIGGRAPH 2004 Conference Proceedings, pp. 309-314, 2004 [Russell13] Russell, Mark; Young, Adam; Karri, Surya. Biomarkers of Pediatric Brain Tumors. Frontiers in Pediatrics, Frontiers in Pediatrics, 2013 [Mortensen95] Mortensen, E. N.; Barrett, W. A. Intelligent scissors for image composition. ACM SIGGRAPH 1995 Conference Proceedings, pp. 191‚Äì198, 1995 [Mortensen99] Mortensen, E. N.; Barrett, W. A. Toboggan-Based Intelligent Scissors with a Four- Parameter Edge Model. IEEE Conference on Computer Vision and Pattern Recognition 1999, vol. 2, pp. 2452-2458, 1999 [Loni13] Laboratory of Neuro Imaging, UCLA, Segmentation Validation Engine, 2013 http://sve.bmap.ucla.edu/instructions/metrics/dice/ [Shlens03] Shlens, Jon. A Tutorial on Principal Component Analysis, 2003 http://sve.bmap.ucla.edu/instructions/metrics/dice/ 127 http://www.cs.princeton.edu/picasso/mats/PCA-Tutorial-Intuition_jp.pdf [Smith02] Smith, Lindsay. A Tutorial on Principal Component Analysis, 2002 http://www.cs.otago.ac.nz/cosc453/student_tutorials/principal_components.pdf [Kass88]Kass, M.; Witkin, A.;Terzopoulos, D. Snakes: Active contour models. International Journal of Computer Vision, vol. 1, No. 4, pp. 321‚Äì331, 1988 [Sylvain11] Sylvain, Henry. Functional Programming for High-Performance Computing on Heterogeneous Architectures.University of Bordeaux, preprint paper. [Szeliski10] Szeliski, Richard. Computer Vision: Algorithms and Applications. Springer, ISBN-13: 978-1848829343, 2010 [Temoche11] Temoche, Pablo. 3D-GRABCUT: GrabCut en Vol√∫menes empleando programaci√≥n paralela en el GPU con CUDA. Tesis de Pregrado, Escuela de Computaci√≥n, Universidad Central de Venezuela, Biblioteca Alonso Gamero 2011 [Torres13] Torres, Wuilian; Rueda Toicen, Antonio. Segmentaci√≥n No Supervisada de Im√°genes Multiespectrales Utilizando Aut√≥matas Celulares. Memorias de las V Jornadas Nacionales de Geom√°tica, Fundaci√≥n Instituto Ingenier√≠a, 2013 [Vezhnevets05] Vezhnevets, Vladimir; Konouchine, Vadim. GrowCut ‚Äì Interactive Multi-Label N-D Image Segmentation by Cellular Automata. Proceedings of Graphicon, pp. 150‚Äì156, 2005 [vonNeumann66] von Neumann, John.Theory of Self-Reproducing Automata. University of Illinois Press, 1966 [Warfield01] Warfield, S; Kauss, M, Nabavi, A. Automated Segmentation of MRI of Brain Tumors, Radiology 2001; vol. 218, No. 2, pp. 586-591, 2001 [Warfield02] Warfield, S.; K., Zou, K. H. ; Wells, W. M. Validation of Image Segmentation and http://www.cs.princeton.edu/picasso/mats/PCA-Tutorial-Intuition_jp.pdf http://www.cs.otago.ac.nz/cosc453/student_tutorials/principal_components.pdf 128 Expert Quality with an Expectation-Maximization Algorithm. Medical Image Computing and Computer-Assisted Intervention MICCAI 2002, pp. 298-206, 2002 [Warfield04] Warfield, S.; K., Zou, K. H.; Wells, W. M. Simultaneous truth and performance level estimation (STAPLE): an algorithm for the validation of image segmentation. IEEE Transactions on Medical Imaging, vol. 23, no. 7, pp. 903‚Äì921, 2004 [Warfield08] Warfield, Simon; Zou, Kelly; Wells, William. Validation of Image Segmentation by Estimating Rater Bias and Variance. Philosophical Transactions of the Royal Society, vol. 366, no. 1874, pp-2361-2375, 2008 [Williams92] Williams, Peter; Nelson, Max. A Volume Density Optical Model. Proceedings of the 1992 Workshop on Volume visualization, pp. 61-68, 1992 [Wolfram83] Wolfram, Stephen. Statistical Mechanics of Cellular Automata. Reviews of Modern Physics, The Institute for Advanced Study, Princeton, vol. 55, issue 3, 1983 [Wright10] Wright, Richard; Haemel, Nicholas; Sellers, Graham; Lipchak, Benjamin. OpenGL Superbible: Comprehensive Tutorial and Reference, 5th Edition, Addison Wesley, ISBN-13: 978- 0321712615, 2010 [Zhang01] Zhang, Yongyue; Brady, Michael; Smith, Stephen: Segmentation of Brain MR Images Through a Hidden Markov Random Field Model and the Expectation-Maximization Algorithm. IEEE Transactions on Medical Imaging, vol. 20, no. 1, 2001 [Zhang10] Zhang, Qi; Eagleson, Roy; Peters, Terry. Volume Visualization: A Technical Overview with a Focus on Medical Applications. Journal of Digital Imaging, issue 24, pp. 640-664, 2010 129 130