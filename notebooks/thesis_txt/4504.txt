Microsoft Word - Trabajo_de_Grado_Wendell_Cruz_Escaner_Lego_Rollos_de_Pianola_final_corregido UNIVERSIDAD CENTRAL DE VENEZUELA FACULTAD DE CIENCIAS ESCUELA DE COMPUTACIÓN Diseño e implementación de una nueva tecnología de digitalización de rollos de pianola con Lego Mindstorms Trabajo especial de grado presentado ante la Ilustre Universidad Central de Venezuela Por el Bachiller Wendell W. Cruz R. Para optar al título de Licenciado en Computación Tutores: Dra. Rina Surós MSc. Gustavo Colmenares Caracas, Agosto de 2015 ii iii Dedicatoria A Nuestro Padre Celestial porque sencillamente jamás me ha abandonado y porque cada día coloca en mi mente la sabiduría necesaria para llegar a ser el hombre que Él desea que yo sea. A mis Padres por ser tan excepcionales en todo sentido, por su amor, comprensión, humildad y ayuda incondicional. Es increíble como todos los principios morales fueron aprendidos por mí a través del solo ejemplo de ellos. A mi eterna amada esposa Dubraska Cruz quien siempre ha representado un verdadero ejemplo de humildad y sincero compañerismo en todos los sentidos. A mi tía Norma Rodríguez por brindarme su hogar, su apoyo y ayudarme a salir adelante. A todas aquellas personas que han entrado aunque sea por un instante en el camino de mi vida para aconsejarme, prestarme su ayuda o sencillamente brindarme su amistad. Wendell Warren Cruz Rodríguez . iv Agradecimientos A Dios por su misericordia y amor para cada uno de nosotros, por escuchar nuestras oraciones y estar a nuestro lado en los momentos difíciles, ayudándonos y fortaleciéndonos. A la Dra. Rina Surós, por darme la oportunidad de trabajar en esta tesis de grado y por su gran disposición, paciencia y colaboración manifestada al facilitarme todo lo que necesitaba. Al MSc. Gustavo Colmenares, por su colaboración, sugerencias y paciencia en la parte técnica del desarrollo de este trabajo. A Juan Sans y Rene Escalante quienes forman parte de este proyecto Pianola y cuya colaboración permitió su desarrollo. A todas aquellas personas que de alguna u otra manera estuvieron apoyando y orando para que este trabajo de tesis llegara a feliz término. Wendell Warren Cruz Rodríguez v Resumen La pianola fue uno de los inventos técnico-musicales más importantes del siglo XIX; consistía en un piano automático que ejecutaba música de acuerdo a las instrucciones de un rollo de papel perforado. Esta tecnología fue utilizada aproximadamente entre 1890 y 1930 cuando fue sustituida por otros medios de grabación. En la actualidad sólo se conservan algunos archivos con rollos que han sobrevivido el paso del tiempo y que contienen la música grabada por grandes pianistas de esa época. En el año 2006 el MSc. Gustavo Colmenares y el Proyecto Pianola de la Universidad Central de Venezuela se plantearon rescatar la información contenida en los rollos y producto de este trabajo surgió la aplicación RollToMid para procesar rollos previamente digitalizados. Debido a la falta de una tecnología propia de digitalización de rollos, el proyecto se valió de un diseño externo que proporcionó los archivos de datos que la aplicación procesaba. En este trabajo se expone el diseño, construcción e implementación de un escáner capaz de producir los archivos de datos que la aplicación RollToMid necesita. Para ello se utilizó los recursos de robótica proporcionados por el kit de Lego Mindstorms. vi Tabla de Contenidos Capítulo 1: El proceso de la investigación 1.1 Antecedentes del problema .................................................................................................. 3 1.2 Planteamiento del problema de investigación ...................................................................... 4 1.3 Objetivos ............................................................................................................................. 4 1.3.1 Objetivo general ......................................................................................................... 4 1.3.2 Objetivos específicos ................................................................................................. 4 1.4 Justificación de la propuesta ................................................................................................ 4 1.5 Alcance ............................................................................................................................. 6 1.6 Hardware utilizado ............................................................................................................... 6 1.7 Software utilizado ................................................................................................................ 6 Capítulo 2: Marco teórico 2.1 La Pianola ............................................................................................................................ 7 2.2 Rollo de Pianola .................................................................................................................. 8 2.2.1 Análisis de datos ........................................................................................................ 9 2.3 Lego Mindstorms NXT ...................................................................................................... 10 2.3.1 Bloque NXT ............................................................................................................. 11 2.3.2 Motores .................................................................................................................... 12 2.3.3 Sensores ................................................................................................................... 13 2.3.4 Programación ........................................................................................................... 16 2.4 Estado del Arte ................................................................................................................... 17 Capítulo 3: Solución implementada 3.1 Hardware y software ........................................................................................................... 22 3.1.1 Descripción general de solución implementada ...................................................... 22 3.1.2 El hardware .............................................................................................................. 23 3.1.3 El software de operación del escáner ....................................................................... 29 3.1.4 El software de procesamiento de los datos obtenidos .............................................. 29 3.2 Ajustes y calibración .......................................................................................................... 30 3.2.1 Ajustes del desplazamiento vertical ......................................................................... 31 3.2.2 Ajustes del desplazamiento horizontal ..................................................................... 31 3.2.3 Ajustes del sensor de luz .......................................................................................... 32 3.2.4 Ajustes del software ................................................................................................. 34 Capítulo 4: Resultados y Validaciones 4.1 Evaluación de funcionamiento del hardware ..................................................................... 37 4.1.1 Operatividad del hardware ....................................................................................... 37 4.1.2 Creación del archivo de datos en el bloque NXT .................................................... 37 4.2 Evaluación del software de procesamiento de los datos obtenidos ................................... 38 4.3 Validación de resultados .................................................................................................... 41 4.3.1 Comparación visual de resultados ........................................................................... 41 4.3.2 Comparación de ondas de sonido ............................................................................ 42 Conclusiones ................................................................................................................................. 47 Recomendaciones y trabajos futuros ............................................................................................ 48 Lista de referencias ....................................................................................................................... 49 vii Lista de tablas Tabla 1: Valores del sensor de luz. ............................................................................................... 14 Tabla 2: Valores del sensor de contacto. ...................................................................................... 15 Tabla 3: Valores de almacenamiento dentro del bloque de Lego. ................................................ 35 Tabla 4: Cualidades del sonido. .................................................................................................... 43 Lista de figuras ñ Figura 1.1: Diseño del proyecto Pianola. Esquema de la Propuesta. .............................................. 5 Figura 2.1: Pianola. ......................................................................................................................... 8 Figura 2.2: Rollo de pianola............................................................................................................ 8 Figura 2.3: Tracker bar. .................................................................................................................. 9 Figura 2.4. Bloques programables de Lego Mindstorms. ............................................................. 11 Figura 2.5: Bloque de Lego Mindstorms NXT. ............................................................................ 12 Figura 2.6: Servomotor de Lego Mindstorms NXT. Vista interna. .............................................. 13 Figura 2.7: Sensor de luz para Mindstorms NXT. ........................................................................ 14 Figura 2.8: Sensor de contacto para Mindstorms NXT. ............................................................... 15 Figura 2.9: Lenguaje de Programación NXT-G. Extracto de código fuente utilizado. ................ 16 Figura 2.10: Lenguaje de Programación NXT-G. Configuración de motores. ............................. 16 Figura 2.11: Escáner construido por Warren Trachtman .............................................................. 17 Figura 2.12: Escáner construido por Julian Dyer.......................................................................... 18 Figura 2.13: Escáner construido por Terry Smythe ...................................................................... 18 Figura 2.14: Software desarrollado Giles Darling ........................................................................ 19 Figura 2.15: Escáner construido por Simen Svale Skogsrud con el Lego RCX. 1999 ................. 20 Figura 2.16: Escáner construido por Anders y Johannes con el Lego RCX ................................. 20 Figura 2.17: Escáner construido por Anders y Johannes con el Lego NXT ................................. 20 Figura 2.18: Escáner construido por Yoshiaki Banno con el Lego NXT ..................................... 21 Figura 3.1: ScanWF. Escáner de rollos de pianola. ...................................................................... 23 Figura 3.2: Desplazamientos del sensor de luz sobre el rollo ....................................................... 24 Figura 3.3: Sensor de Luz debajo del carro lector de ScanWF ..................................................... 25 Figura 3.4: Carro lector de ScanWF ............................................................................................. 25 Figura 3.5: Motor y engranaje de desplazamiento del rollo de ScanWF ...................................... 26 Figura 3.6: Cauchos que desplazan verticalmente el rollo ........................................................... 26 Figura 3.7: Sensor de contacto de ScanWF .................................................................................. 27 Figura 3.8: Riel de desplazamiento de ScanWF ........................................................................... 28 Figura 3.9: Riel de desplazamiento de ScanWF ........................................................................... 28 Figura 3.10: Imagen 3D de ScanWF hecho con Lego Digital Designer. ..................................... 29 Figura 3.11: Extracto de archivo de datos generado por LegoToRollToMid ................................ 30 Figura 3.12: Iluminación con Led. ................................................................................................ 34 Figura 4.1: Rollo de Teresa Carreño. ............................................................................................ 36 Figura 4.2: Extracto de archivo de datos en bruto de ScanWF ..................................................... 38 Figura 4.3: Extracto de archivo de datos generado por LegoToRollToMid .................................. 39 Figura 4.4: Representación de una ruptura por LegoToRollToMid .............................................. 40 Figura 4.5: Comparación de una nota registrada en el rollo con LegoToRollToMid .................... 40 Figura 4.6: Comparación de extracto de Partitura y el MIDI generado por RollToMid (abajo) ... 42 Figura 4.7: Histograma de frecuencia de notas musicales de Nadia Reisenberg .......................... 44 viii Figura 4.8: Histograma de frecuencia de notas musicales, MIDI generado por RollToMid ... 44 Figura 4.9: Comparación de las ondas de sonido Nadia Reisenberg vs. MIDI ............................ 45 1 Introducción La pianola fue uno de los grandes inventos mecánico-musicales más populares en la industria de la grabación de sonido de finales del siglo XIX y comienzos del XX. La aparición de nuevas tecnologías de grabación más económicas y versátiles como el disco de vinil ocasionó el desuso progresivo de estos pianos automáticos. Los rollos, que resguardaban en sus perforaciones las interpretaciones de muchos pianistas de este periodo pasaron a formar parte de archivos históricos que al día de hoy tienen más de 100 años de antigüedad, y que por tanto corren grave peligro de desaparecer debido a los hongos, roturas y en general el desgaste ocasionado por el paso del tiempo. Surge entonces la necesidad urgente de crear una tecnología que digitalice y almacene la información musical resguardada en las perforaciones de estos rollos, que a los ojos de la musicología moderna representan obras inéditas de repertorio pianístico nacional e internacional. En el año 2006 el MSc. Gustavo colmenares y el proyecto Pianola de la Universidad Central de Venezuela se plantearon rescatar la información contenida en los rollos y producto de este trabajo surgió la aplicación RollToMid para procesar rollos previamente digitalizados. Debido a la falta de una tecnología propia de digitalización de rollos, el proyecto se valió de un diseño externo que proporcionó los archivos de datos que la aplicación procesaba. El presente trabajo de investigación intenta proponer una tecnología de digitalización de los archivos históricos, subsanando la deficiencia que tenía el proyecto del 2006, mediante la creación de un escáner propio, dando continuidad al proceso de recuperación musical que por años la Universidad Central de Venezuela ha venido desarrollando. Se propone un equipo innovador que recupere junto con la aplicación RollToMid la información musical de los rollos de pianolas que hasta ahora han sido recopilados y de esta forma vivir la experiencia de escuchar una pieza inédita, como si el propio pianista estuviese sentado frente al piano ejecutándola. La investigación que a continuación se ofrece está estructurada en cuatro capítulos. En el primer capítulo se expondrán los antecedentes, objetivos, alcances y hardware utilizado en la propuesta. El capítulo 2 contiene el marco teórico, el cual explica todo lo 2 que se necesita saber acerca de la pianola y el Lego Mindstorms, tecnología escogida para el diseño que se propone en este trabajo. El capítulo 3muestra todos lo relacionado al diseño y construcción del escáner de Lego, su funcionamiento, piezas que lo conforman y los métodos de calibración que se tuvieron que implementar para su correcto funcionamiento. Finalmente, en el capítulo 4 se muestran los resultados obtenidos por el equipo a través de evaluaciones que certifican y validan su funcionamiento y el cumplimiento de los objetivos. 3 1 CAPÍTULO 1 EL PROCESO DE LA INVESTIGACIÓN 1.1 Antecedentes del problema Entre los siglos XIX y XX la música grabada era escuchada por medio de pianos automáticos o pianolas, estos instrumentos producían sonidos como un piano normal, siguiendo las instrucciones musicales contenidas en las perforaciones una larga tira de papel o rollo que se escogía a gusto del operador. Con la aparición del disco de vinil, las pianolas pasaron progresivamente a desuso y los registros sonoros grabados en papel perforado pasaron a formar parte de archivos históricos. En la actualidad las pianolas son piezas de museos que involucran altos costos de mantenimiento y que debido al paso del tiempo no se encuentran en la capacidad de operar o reproducir un rollo satisfactoriamente. De igual forma el papel se encuentra quemado, estirado, dañado, lleno de hongos y si tuviésemos la oportunidad de colocarlo en un instrumento de época, éste se deterioraría aún más o incluso se rompería. Por lo tanto surge la urgente necesidad de recuperar los rollos que aún se conservan para evitar la pérdida irreversible de este legado. El proyecto Pianola de la Universidad Central de Venezuela, auspiciado por la Facultad de Ciencias y la Facultad de Humanidades y Educación se centró en la recuperación de la información contenida en los rollos y su conversión a un formato moderno. En este sentido, la tesis de Maestría. Emulación Digital de Pianos Neumáticos [GC01] planteó una aplicación, denominada RollToMid, que cumplía esta finalidad produciendo como salida un archivo en el estándar MIDI1reproducible en pianos de última tecnología. Para ese entonces, la aplicación utilizó archivos de datos, creados y suministrados por el Ingeniero Wayne Stahnke, quien desarrolló un escáner hacia 1990. A la culminación de ese trabajo, fue evidente la falta de una tecnología propia de digitalización de rollos. 1MIDI es un acrónimo que significa Musical Instrument Digital Interface. [MI01]. 4 Por tal motivo en este trabajo se propone el diseño y la construcción de un escáner que digitalice los rollos de pianola produciendo un archivo de entrada para la aplicación RollToMid con los datos musicales y de expresión pianística contenidos en el rollo. 1.2 Planteamiento del problema de investigación ¿Cómo diseñar y construir un escáner de rollos de pianola y generar un archivo digital con la información del rollo? 1.3 Objetivos 1.3.1 Objetivo general Diseñar y construir un escáner de rollos de pianola que permita digitalizar la información del papel y generar como salida un archivo de datos tipo matriz con la información binaria del rollo. 1.3.2 Objetivos específicos  Diseñar y construir un escáner utilizando el kit de Lego Mindstorms.  Desarrollar una aplicación para controlar los motores y sensores del escáner utilizando el software proporcionado por el kit de Lego Mindstorms.  Desarrollar una aplicación que convierta la información registrada por los sensores del escáner, en un archivo de datos que almacene la información del rollo como una matriz. 1.4 Justificación de la propuesta El escáner proporciona una tecnología propia de digitalización que se acopla al proyecto base desarrollado por [GC01], que anteriormente no disponía de tecnología de digitalización. Por tal motivo, se crea un escáner que permita la obtención de la información contenida en los rollos de pianola pertenecientes a archivos históricos venezolanos. La propuesta se basa en proporcionar un mecanismo que digitalice el rollo de pianola de forma rápida y eficaz, diseñando un escáner con el kit de Lego Mindstorms. Los motores proporcionados por el kit serán utilizados para generar movimiento, el sensor de 5 luz capturará la información de las perforaciones del papel hacia un bloque programable central y finalmente a través de programación, se generará un archivo datos binarios con toda la información del rollo. Es importante resaltar que se escoge Lego Mindstorms porque permite amplias posibilidades en el diseño del hardware y proporciona un software amigable que puede ser utilizado fácilmente para el tema que nos atañe. Ver Figura 1.1. Figura 1.1: Diseño del proyecto Pianola. Esquema de la Propuesta. 6 1.5 Alcance La aplicación propuesta abarca las siguientes funcionalidades:  Digitalizar el rollo de pianola.  Generar un archivo de datos con la información contenida en el rollo. 1.6 Hardware utilizado  1 Bloque NXT.  2 Motores.  2 sensores de tacto.  1 sensor de luz.  826 piezas de Lego.  PC Core2Duo 1.86GHz . 1.7 Software utilizado  Lenguaje NXT-G incluido en el kit de Lego Mindstorms [LM01].  Lenguaje Java para el procesamiento de datos [JK01].  MatLab para convertir onda sonora a frecuencia [ML02].  Lego Digital Designer v4.3.5 para el diseño digital del escáner [LD01].  RollToMid para generar el MIDI a partir del archivo matricial [GC01].  Adobe Audition v2.0 para generar la onda sonora [AA01].  Midi2Wav v4.1 para convertir archivos MIDI a WAV [MW01]. 7 2 CAPÍTULO 2 MARCO TEÓRICO 2.1 La Pianola La pianola es un piano acústico automático, equipado con elementos mecánicos y neumáticos2 de operación manual o eléctrica, que permite interpretar música sin la presencia del pianista, siguiendo las instrucciones u órdenes codificadas en un rollo de papel con perforaciones. El mecanismo neumático es abastecido por un grupo de fuelles3, movidos generalmente por pedales, accionados por una persona. Estos fuelles también pueden ser accionados mediante un motor eléctrico. En la Figura 2.1 puede verse una pianola y en la parte inferior los pedales de bombeo del aire o mecanismo de fuelle. La pianola fue diseñada para ser una verdadera experiencia musical interactiva, en vez de meramente un instrumento automático. Esta permitía tanto a los pianistas estudiados como a los aficionados a la música con carencias de destreza técnica, aprender la ejecución que las teclas producían al subir y bajar mecánicamente e incluso interactuar con la expresión de la obra. La pianola se convirtió inmediatamente en la máxima expresión de la difusión de intérpretes automatizadas grabadas previamente, permitiendo por primera vez en la historia, el registro y divulgación comercial a gran escala de un vasto repertorio de música. Cuando el gramófono y la radio empezaron a ser populares y accesibles para el bolsillo de la gente, los pianos de autoejecución cayeron en desuso. 2El término se refiere a un equipo o instrumento que funciona mediante la acción del aire. 3 Fuelle es el mecanismo encargado de atrapar aire del exterior y dirigirlo con fuerza en una sola dirección. Consiste en una especie de caja que cuando se llena de aire, sus paredes plegables o flexibles se abren y cierran ocasionando la expulsión del mismo. 8 Figura 2.1: Pianola. 2.2 Rollo de Pianola Es una tira de papel enrollado en un cilindro metálico con medidas de entre 5 a 30 metros de longitud y con un ancho 28 cm aproximadamente, como la que se muestra en la Figura 2.2. En la parte central se encuentra la información musical de la obra correspondiente a notas, alturas y duración. De igual manera, en los bordes del papel, a ambos lados, se halla la expresión o carga dinámica del sonido, es decir, su intensidad, pedalización y en general toda la expresividad que el pianista aplicó a las teclas al momento de grabar el rollo. Figura 2.2: Rollo de pianola. 9 El rollo se instalaba dentro un lector llamado tracker bar, el cual en una especie de regla metálica, ubicada en la parte frontal de la pianola como la que se muestra en la Figura 2.3. En los sistemas más avanzados, esta regla contenía aproximadamente 98 orificios al vacío que coincidían linealmente con las perforaciones del rollo. Debido al vacío creado por el mecanismo neumático de la pianola, el papel se mantenía pegado a la regla mientras el rollo se desplazaba. En un rollo estándar, el tracker bar tenía un ancho máximo de 11,25 pulgadas para todo el rollo y 9 puertos o perforaciones por pulgada. Los orificios en el rollo tienen una separación de un milímetro como mínimo entre ellos. Si en un momento dado, una de las perforaciones del papel coincidía con la posición de alguno de los 98 puertos del tracker bar, el vacío se llenaba súbitamente de aire y generaba una fuerza mecánica capaz de mover las teclas o los pedales de la pianola. Figura 2.3: Tracker bar. 2.2.1 Análisis de datos Al examinar un rollo de pianola, se observan dos grupos de orificios, unos que se agrupan formando una franja central y otros ubicados en los bordes de ambos lados. Los orificios agrupados en la franja central ofrecen dos tipos de información, la primera es la altura (frecuencia) y la segunda es la duración del sonido. En la franja central, la variación de la frecuencia viene dada por el cambio de los orificios de izquierda a derecha o viceversa, los cuales activan a su vez, los puertos del 9 al 90, mientras más a la derecha esté el orificio, más aguda será la nota y mientras más a la izquierda, ésta será más grave. Los orificios que se prolongan verticalmente a lo largo del rollo, indican la duración de las notas. 10 Los orificios ubicados en ambos bordes del papel activan la expresión de los sonidos de las teclas o control de fuerza4 y otras funciones que dependen de la marca del rollo, tales como, uso de los pedales y retorno automático del rollo una vez finalizada la pieza. 2.3 Lego Mindstorms NXT Lego Mindstorms es un kit de robótica5 educativo fabricado por la empresa Lego, el cual permite construir modelos con una estructura electromecánica, operados por un software de control. Ofrece gran versatilidad de diseño debido al concepto de construcción con ladrillos de Lego. Aunque el kit es un juguete educativo para el entretenimiento de niños y jóvenes, es a la vez una poderosa herramienta de diseño, exploración y construcción ampliamente utilizada en laboratorios científicos y proyectos de investigación alrededor del mundo. El principal diseñador fue Fred G. Martin, quien entre los años 1987 y 1998 había desarrollado diferentes versiones de un bloque programable bajo el patrocinio de la compañía LEGO. La versión final resultó en un ladrillo rojo con cuatro puertos de salida para motores y seis puertos de entrada para sensores. En la Figura 2.4 se muestran varios modelos de bloques programables de Lego Mindstorms. 4 Nos referimos a control de fuerza a la velocidad con la que bajan las teclas, ocasionando un sonido más fuerte si se bajan rápidamente, o un sonido más suave, si se bajan lentamente. Esto es el principio básico que permite guardar la expresividad del pianista que ejecutaba el rollo. 5 Se puede referir indistintamente como: el “kit” o Lego Mindstorms. [LM01]. 11 Figura 2.4. Bloques programables de Lego Mindstorms. En el año 1998 fue el lanzamiento del RCX, un bloque amarillo que utilizaba un procesador de 8 bits a 16 MHz y poseía una memoria de 32 Kb. Entre los años 1998 y 2006, el grupo de desarrolladores del proyecto de Lego liderado por Soren Lund trabajaron en lo que sería el sucesor del RCX, que finalmente salió para agosto de 2006 con el nombre de Lego Mindstorms NXT, base tecnológica utilizada en el presente proyecto. Cabe destacar que en 2013 salió al mercado la versión Evolution 3 con mejoras en el bloque, motores y sensores. Para este proyecto se seleccionaron algunos componentes contenidos en el kit NXT: el bloque programable, los motores, el sensor de luz y el sensor de contacto, los cuales explicamos a continuación. 2.3.1 Bloque NXT Es el controlador inteligente o cerebro del robot Mindstorms. En él se almacenan los programas que posteriormente permitirán al modelo construido ejecutar las tareas. Posee un microprocesador ARM7 de 32 bits a 48MHz, cuatro puertos de entrada para los sensores con los que captura información del ambiente, tres puertos RJ-12 de salida utilizados para interactuar con los motores y un puerto de comunicación USB para conectarse a un computador. Internamente posee 64Kb de memoria RAM y 256 Kb de memoria Flash, esta última se utiliza para el almacenamiento de programas creados por los 12 usuarios y datos capturados en la ejecución. En la Figura 2.5 se muestra un esquema donde se especifica las partes del bloque. Figura 2.5: Bloque de Lego Mindstorms NXT. 2.3.2 Motores El modelo NXT usa servomotores6 para todo aquello que requiera movilidad del robot. Los giros del motor pueden ser ajustados en grados desde 0° hasta 360° con una exactitud de un grado, de esta forma se puede obtener y guardar información de la posición de sus partes y controlar sus movimientos de manera precisa, por ende es ideal para el diseño de modelos de navegación y brazos robóticos. El kit contiene tres servomotores que corren a una velocidad de 170 rpm y generan 60mA de corriente, en la Figura 2.6 puede verse un gráfico de un servomotor con sus partes y engranajes. 6Un servomotor es un dispositivo similar a un motor de corriente continua que tiene la capacidad de ubicarse en cualquier posición dentro de su rango de operación y mantenerse estable en dicha posición. Es un motor eléctrico que puede ser controlado tanto en velocidad como en posición. 13 Figura 2.6: Servomotor de Lego Mindstorms NXT. Vista interna. 2.3.3 Sensores Los sensores son utilizados para obtener información del ambiente que lo rodea, y constituyen el sistema de percepción del bloque NXT. Un sensor registra características del ambiente (temperatura, luz, sonido y proximidad) en valores medidos en RAW7 y luego los convierte en una señal eléctrica.  Sensor de Luz: se encarga de tomar una muestra de luz que llega a una celda fotoeléctrica. Cuando detecta algún cambio en la intensidad de luz entre los rangos de 0,6 a 760 lux se crea una señal eléctrica que es registrada en el bloque NXT; de esta forma se obtiene el porcentaje de luminosidad captada. El sensor de luz se puede utilizar para hacer que el robot se mueva por el ambiente, siguiendo una señal lumínica, una línea negra o detectando un orificio en el papel. El bloque determina el porcentaje obtenido por el sensor de luz tomando una muestra cada 2,9 ms de acuerdo a la fórmula: 146 RAW 7 7 Valor en bruto capturado por los sensores. El voltaje en la entrada es convertido a un valor interno en el intervalo 0 (0V) a 1023 (5V). [LM01]. 14 El sensor de luz del NXT solo distingue grados de luminosidad, es decir, claridad (blanco), oscuridad (negro), por tanto debido a limitaciones técnicas del sensor no es posible capturar colores. En la Figura 2.7 puede verse en detalle como es este sensor y en la Tabla 1 se muestra el rango de valores que se puede obtener con el sensor de luz. Figura 2.7: Sensor de luz para Mindstorms NXT. Tabla 1. Valores del sensor de luz.  Sensor de Contacto: permite que el robot se desplace detectando si ha colisionado con algún objeto encontrado en su trayectoria inmediata. Su principio básico de funcionamiento es “circuito abierto” o “circuito cerrado”; cuando el sensor está liberado de presión se considera como 15 “circuito abierto” y en caso contrario, “circuito cerrado”, es decir, cuando hace contacto con algún objeto. Este sensor también es capaz de medir presiones únicas o múltiples. Si la presión supera una medida estándar de 450 RAW se estima que está siendo presionado, de lo contrario, se considera que está sin presión. En la Tabla 2 se muestra el rango de valores que se puede obtener y en la Figura 2.8 puede verse en detalle éste sensor. [LM01][MO01][MS01]. Figura 2.8: Sensor de contacto para Mindstorms NXT. Tabla 2. Valores del sensor de contacto. 16 2.3.4 Programación La programación del Lego Mindstorms se realiza mediante el software proporcionado por la marca, llamado NXT-G, el cual contiene un firmware y una interfaz que permite al usuario programar las acciones a seguir por el robot. Una de las principales características del software de programación es su entorno visual, en el cual se lleva a cabo la construcción por funciones, dando la posibilidad a cualquier usuario de acostumbrarse rápidamente a la programación en bloques. Este lenguaje permite programar instrucciones secuenciales, cíclicas y de decisiones, basadas en los datos reportados por los sensores. En la Figura 2.9 puede verse en detalle la interfaz mencionada. Figura 2.9: Lenguaje de Programación NXT-G. Extracto de código fuente utilizado. En la Figura 2.10, se puede ver la interfaz de configuración de los motores, permitiendo así regular potencia, duración y movimiento del motor hacia adelante, hacia atrás o bien sea detenerlo. [LM01][MO01][MS01]. Figura 2.10: Lenguaje de Programación NXT-G. Configuración de motores. 17 2.4 Estado del Arte Los intentos por recuperar la información de rollos de pianola no son nuevos, durante las décadas del setenta y ochenta del siglo pasado grupos de coleccionistas de pianolas en Estados Unidos, Canadá, Francia, Australia, Japón y otros países, se dedicaron a crear dispositivos y mecanismos para extraer la información de los rollos. Sin embargo no todos los intentos fueron satisfactorios, y los que lo fueron, se convirtieron en patentes no disponibles para investigaciones como la nuestra. A continuación mencionamos algunos de estos trabajos: 1. El Ingeniero Wayne Stahnke en los Estados Unidos construyó un escáner para digitalizar rollos de pianola y creó el hardware para reproducirlos. El principio de su trabajo fue visualizar el rollo como una matriz de datos, en la cual sólo guardaba la posición de las perforaciones y sus repeticiones. 2. Un escáner para rollos de pianola, en versión electrónica, fue construido por Warren Trachtman, el cual tuvo un microcontrolador con una interfaz entre el dispositivo y un computador portátil, que puede verse en la Figura 2.11. Trachtman, creó un sensor de lectura óptica para rollos de pianola que extraía una imagen escaneada del rollo y la guardada en un formato propio. [WT01]. Figura 2.11: Escáner construido por Warren Trachtman 18 3. Julian Dyer en el año 2003, desarrolló un escáner que tenía como función copiar los rollos deteriorados a un nuevo papel, para ser reproducidos en una antigua pianola restaurada [JD01], que puede verse en la Figura 2.12. Figura 2.12: Escáner construido por Julian Dyer 4. Terry Smythe, en Canadá también construyó una solución mecánica para digitalizar rollos de pianola basada en un escáner por filas [TS01], que puede verse en la Figura 2.13. Figura 2.13: Escáner construido por Terry Smythe 19 5. Giles Darling, desarrolló el software “Pianola To MIDI”, basado en fotografías concatenadas del rollo de pianola, que posteriormente son escaneadas para generar un archivo MIDI. En la Figura 2.14 se muestra la captura de un rollo ya escaneado y procesado por Darling [GD01]. Figura 2.14: Software desarrollado Giles Darling En relación al estado del arte con Lego Mindstorms podemos mencionar los siguientes trabajos: 1. Simen Svale Skogsrud en el año 1999 construyó un escáner con Lego RCX basado en un carro portador del sensor de luz el cual se movía a lo largo de una hoja para así digitalizar y guardar la información capturada dentro del bloque RCX. Skogsrud se le considera pionero en el uso de sensores de luz y su trabajo puede verse en la Figura 2.15 [SS01][SS02]. 20 Figura 2.15: Escáner construido por Simen Svale Skogsrud con el Lego RCX. 1999 2. Anders y Johannes, construyeron un escáner con Lego, el cual tenía una calidad de 25 a 50 dpi. Usaba un sensor de luz para obtener la imagen y dos motores para movilizar los engranajes, desplazando la hoja y el lente a fin de digitalizar solo imágenes tamaño carta. Inicialmente usaron el Lego Mindstorms RCX (Figura 2.16), luego al salir la versión NXT crearon también su escáner con esta versión (Figura 2.17) [AM01]. Figura 2.16: Escáner construido por Anders y Johannes con el Lego RCX Figura 2.17: Escáner construido por Anders y Johannes con el Lego NXT 21 3. Andy Clapham en el año 2002 en su escrito “Algunas ideas para el futuro”, menciona la posibilidad de digitalizar la música de un rollo de pianola usando el RCX: “usando un rollo de papel y un escáner simple, se podría codificar canciones en sistema binario y con el Lego RCX interpretarlas de acuerdo al rollo”. [AL01]. 4. En su libro Building Robots with Lego Mindstorms, los hermanos Mario y Giulio Ferrari, hacen mención del escáner hecho por Simen Svale Skogsrud al explicar los sensores de luz. [MF01]. 5. En el libro The Lego Mindstorms NXT Idea Book de Martinj Boogaarts, se muestra el escáner “ScanBot” diseñado con Lego NXT, basándose en el mismo principio que usaron Anders y Johannes. La diferencia fundamental con el proyecto inicial fue la posibilidad de enviar una imagen capturada por bluetooth [MJ01]. 6. En marzo de 2009, el Ingeniero japonés Yoshiaki Banno [ML01], desarrolló un escáner con el NXT para digitalizar imágenes y transferirlas a la computadora usando una conexión USB. El software usado para el procesamiento de la data fue programado con MATLAB/Simulink y Stateflow [ML02]. Este escáner puede verse en la Figura 2.18. Figura 2.18: Escáner construido por Yoshiaki Banno con el Lego NXT 22 3 CAPÍTULO 3 SOLUCIÓN IMPLEMENTADA 3.1 Hardware y software 3.1.1 Descripción general de solución implementada De acuerdo a los que hemos explicado a lo largo de este escrito, la solución implementada en este trabajo de tesis se centró en el desarrollo de un escáner construido con los recursos de robótica y ensamblaje proporcionados por el kit de Lego Mindstorms. En este capítulo expondremos todo lo relacionado con el hardware y software creado para este proyecto e igualmente todos los ajustes que fueron necesarios para su puesta en operación. El escáner lo bautizamos con el nombre de ScanWF y el software de procesamiento de los datos obtenidos en la digitalización de un rollo de pianola lo bautizamos como LegoToRollToMid. En lo sucesivo nos referiremos a ellos con estas dos denominaciones. ScanWF, construido con 826 piezas de Lego, fue diseñado para escanear exclusivamente rollos de pianola, es decir, su diseño es acorde a las dimensiones de estos documentos históricos y por tanto está optimizado para que al producirse la digitalización, el papel no sufra daños o maltratos. Una vez instalado el rollo en el carril del equipo, ScanWF desplaza el papel milímetro a milímetro buscando exclusivamente las perforaciones de cada línea. Recordemos que en el rollo de pianola la distancia entre líneas de perforaciones es de 1 milímetro. Por su parte, LegoToRollToMid es un software creado con la finalidad de procesar los datos en bruto obtenidos por la digitalización. Su función principal es la creación de un archivo de datos matricial del rollo con las especificaciones necesarias para ser archivo de entrada de la aplicación RollToMid [GC01], que como ya hemos mencionado a lo largo de este escrito, es el trabajo inicial del Proyecto Pianola que dio pie a esta investigación. 23 3.1.2 El hardware Básicamente, ScanWF funciona con un carro en donde está instalado el sensor de luz, que se desplaza de izquierda a derecha sobre un riel el cual se adapta al tamaño del rollo. El sensor recorre a todo lo largo y milímetro a milímetro el papel, digitalizando las perforaciones. La idea fundamental con la cual visualizamos el rollo como objeto de escaneo es concebirlo como una malla binaria. Cuando se consigue una perforación, ésta se registra con un “1” y el caso contrario con un “0” y se procede a almacenar las posiciones de esta matriz sparce en la memoria flash del bloque NXT. Manejar esta estructura en forma de matriz de unos y ceros, es la mejor manera de ahorrar memoria y procesador, sobre todo porque si hablamos de un largo estándar de 25 metros por rollo, la matriz que el bloque NXT tendría que procesar sería de hasta 25.000 filas. Cabe destacar que en los extremos del riel por donde se desplaza el carro, hemos instalado un sensor de contacto a cada lado coincidiendo con los bordes del papel, de esta forma el carro se detiene al chocar contra el sensor e inmediatamente inicia el recorrido de vuelta en sentido opuesto. Cada vez que el carro lector hace un recorrido completo (de extremo a extremo del papel) un motor desplaza el rollo verticalmente 1 milímetro para iniciar una nueva lectura en la línea siguiente. En la Figura 3.1 se puede apreciar una fotografía de ScanWF. Figura 3.1: ScanWF. Escáner de rollos de pianola. 24 Para una mejor comprensión de cómo funciona ScanWF, explicaremos a continuación sus partes y funciones principales:  Carro lector: es un pequeño vehículo equipado con un motor que se desplaza por el riel gracias a cuatro cauchos grandes. En su parte inferior, está instalado el sensor de luz en posición de 90° con respecto al rollo, de forma que, a medida que el carro se desplaza el sensor va tomando sus registros. El carro recorre de extremo a extremo el rollo, de izquierda a derecha, desplazándose 1 milímetro por registro, esta función la denominamos “Desplazamiento horizontal”. Para ilustrar, mostramos en la figura 3.2 un extracto aumentado del rollo diagramando el movimiento descrito y en las figuras 3.3 y 3.4 pueden verse fotografías del carro lector. Figura 3.2: Desplazamientos del sensor de luz sobre el rollo 25 Figura 3.3: Sensor de Luz debajo del carro lector de ScanWF Figura 3.4: Carro lector de ScanWF  Motor para el desplazamiento del rollo: Este motor mueve un sistema de engranajes que hacen girar cuatro cauchos pequeños ubicados en la parte inferior del riel y que están colocados trasversalmente sobre el rollo. El 26 recorrido sobre la superficie del papel hace que el rollo se desplace en dirección vertical 1 mm. Esta función la denominamos “Desplazamiento vertical”. En la Figura 3.2 (página anterior) está diagramado este movimiento. El motor, los engranajes y cauchos que hacen mover el rollo pueden apreciarse en las Figuras 3.5 y 3.6. Figura 3.5: Motor y engranaje de desplazamiento del rollo de ScanWF Figura 3.6: Cauchos que desplazan verticalmente el rollo 27  Sensor de contacto: hemos instalado un sensor de contacto a cada lado de ScanWF, coincidiendo con los bordes del papel. Cuando el carro lector choca con el sensor del lado izquierdo, se activa una señal eléctrica que permite al bloque NXT cambiar el sentido de desplazamiento del vehículo. Por otro parte, cuando el carro choca con el sensor de contacto derecho, se activan dos señales: la primera, indica al bloque “fin de recorrido” y activa el motor de desplazamiento vertical del rollo haciendo mover el papel para digitalizar la próxima línea; y la segunda, es interpretada por el bloque como “retorno de carro”, es decir, el carro lector se ubicará en el borde izquierdo para comenzar una nueva lectura de línea. En la figura 3.7 puede verse la imagen de uno de los sensores de contacto. Figura 3.7: Sensor de contacto de ScanWF  Rieles de desplazamiento: Tienen como propósito guiar el desplazamiento horizontal del carro lector. Recordamos al lector, que los desplazamientos horizontal y vertical están descritos en la figura 3.2 de la página 25. En las Figuras 3.8 y 3.9 puede apreciarse el riel por donde se conduce el carro lector. 28 Figura 3.8: Riel de desplazamiento de ScanWF Figura 3.9: Riel de desplazamiento de ScanWF Para la creación del mapa de ensamblaje de las piezas escogimos la aplicación Lego Digital Designer [LD01], mediante la cual construimos un diseño digital de ScanWF. Con esta herramienta podemos generar una vista 3D y apreciar paso a paso la construcción del mismo (Ver la Figura 3.10). 29 Figura 3.10: Imagen 3D de ScanWF hecho con Lego Digital Designer. 3.1.3 El software de operación del escáner El software desarrollado para accionar los motores del escáner y recibir información de los sensores de ScanWF fue escrito en el lenguaje NXT-G, que como dijimos anteriormente es suministrado con el kit. El algoritmo pseudoformal tiene la siguiente estructura: inicio mientras ejecutar mientras sensor de toque izquierdo no se oprima motor A retroceso para mover el carro al inicio fin mientras sensor de toque derecho no se oprima motor A adelante 8° y detener para mover el carro sensor de luz lee información si existe información guarda posición X,Y en un archivo de datos fsi fin motor B adelante 165° para mover la hoja fin fin 3.1.4 El software de procesamiento de los datos obtenidos Para el procesamiento de los datos en bruto que registró el sensor de luz durante la digitalización de ScanWF, se programó en Java la aplicación LegoToRollToMid, la cual procesa los datos recogidos (guardados en la memoria flash del bloque) generando un 30 archivo de datos con estructura matricial. El archivo de salida de LegoToRollToMid es una imagen fiel del rollo de pianola en forma binaria, en la cual las perforaciones están registradas con un “1” y el caso contrario con un “0”. En la Figura 3.11 se aprecia un extracto de este archivo de datos. Figura 3.11: Extracto de archivo de datos generado por LegoToRollToMid 3.2 Ajustes y calibración La etapa de ajustes y pruebas tomó un largo tiempo en la culminación de este proyecto, sobre todo por algunos factores operativos que requirieron una calibración minuciosa para afinar su funcionamiento. Cabe destacar que para evitar que ScanWF dañara o maltratara el rollo de pianola histórico con el que contábamos, optamos por usar fotocopias del mismo. Después de arduas pruebas y ajustes, fue que finalmente procedimos a colocar el rollo real en el equipo. Explicamos a continuación los problemas encontrados y los ajustes realizados: 31 3.2.1 Ajustes del desplazamiento vertical  Problema: Necesitamos que ScanWF desplace el rollo de pianola 1 milímetro a la siguiente línea de perforaciones, para ello es necesario encontrar el giro exacto que debe hacer el motor encargado desplazamiento vertical. Solución: En la configuración del motor se estableció un ángulo de rotación de 165° para que el sistema de engranajes mueva el rollo a la siguiente línea. Consecuencias: Se solucionó el problema. 3.2.2 Ajustes del desplazamiento horizontal  Problema: La velocidad con que se mueve el carro lector a lo largo del rollo de pianola es muy rápido y constante, haciendo que la lectura del rollo sea deficiente al no identificar exactamente la posición en la que está capturando la información. Solución: Se escogió un desplazamiento con paradas en el punto de lectura. Para ello se ajustó la rotación del motor en 8° acompañado de una pausa o detención del mismo, momento en el cual el sensor de luz lee la información del rollo. Esto se convierte en un ciclo de tres pasos: giro – parada – lectura. Consecuencias: Se solucionó el problema. Este movimiento en un ciclo de tres pasos permite saber exactamente en qué columna fue ubicada la captura de la información y garantiza la recopilación fidedigna de ésta. Sin embargo, el procesamiento del rollo se hace mucho más lento.  Problema: Los cauchos derraparan sobre el riel durante la lectura, por lo que los datos capturados se ven repetidos y desfasados de su posición. Solución: para evitar el derrape, se utilizó la fórmula física: Fuerza Roce = coeficiente Fricción x Normal 32 Donde: Normal = masa x gravedad La fuerza de roce será: Fr = coeficiente fricción x masa x gravedad Debido a que el coeficiente de fricción y la gravedad son constantes, la única variable para esta fórmula, es la masa, [FI01]. Así que para aumentar la fuerza de roce y evitar el derrape, se incrementó la masa del carro, colocándole piezas adicionales de Lego a fin de aumentar su peso. Consecuencias: Se solucionó el problema. Se evitó que los cauchos se deslizaran, pero debido a que ahora el carro lector es más pesado se tuvo que incrementar la potencia de los motores, por ende, aumentó la energía requerida. Antes de este cambio, un juego de 6 baterías alcalinas AA (que es lo que requiere el bloque NTX) duraba aproximadamente 5 metros del rollo, ahora con el nuevo ajuste, las baterías tienen una duración de aproximadamente 1 metro de rollo de pianola ante agostarse. 3.2.3 Ajustes del sensor de luz  Problema: Reconocer la presencia de los orificios de 1 milímetro en el rollo. Solución: Se ajustó la distancia entre el sensor y el papel a fin de reconocer cada perforación de 1 milímetro de diámetro. La altura ideal después de muchas pruebas fue de 12 milímetros. 33 Consecuencia: Se solucionó el problema.  Problema: Configuración del umbral de luz para diferenciar un agujero en el papel de una mancha. Solución: En la configuración del sensor de luz el lenguaje NXT-G tiene un límite de captura para distinguir lo claro de lo oscuro, el cual está medido en un porcentaje, siendo un 0% más oscuro o negro y un 100% más claro o blanco. Este valor se fijó en 46% como el punto medio ideal. Consecuencias: Se solucionó el problema. El sensor distingue fielmente una perforación en el rollo.  Problema: Reconocer la presencia de los orificios sin que afecte la luz del ambiente. Solución: Se agregaron bombillos Led al escáner con un voltaje de 9V y a una distancia de 5 cm del rollo. Igualmente se utilizaron 15 hojas de papel cebolla colocadas debajo del rollo con la finalidad de difuminar la luz y evitar que se focalizara en una zona específica. Ver Figura 3.12. Consecuencias: Se solucionó el problema logrando mejorar la calidad de lectura del sensor con cada perforación. 34 Figura 3.12: Iluminación con Led. 3.2.4 Ajustes del software  Problema: Conseguir un almacenamiento eficiente que maneje el alto volumen de datos en poco espacio. Utilizar un formato de imagen como bmp o jpeg resulta en un archivo de datos muy grande para ser manejado por el bloque NXT. Solución: Como necesitamos guardar la existencia o no de la perforación (un “1” si hay perforación o un “0” en caso contrario), creamos un formato de archivo binario dentro del bloque NXT para almacenar los datos, el cual 35 consiste en guardar el “1” o el “0” en un bit. La posición queda guardada automáticamente por el orden de escritura en el archivo de datos. En la Tabla 3 colocamos como caso extremo un rollo de 30 metros de largo, con todas sus columnas y filas perforadas, para el cual el tamaño de archivo que se necesitaría en el bloque es de 210.000 bytes (205 KB), tamaño totalmente factible sabiendo que el bloque NXT tiene capacidad máxima de almacenamiento de 256 KB. Tabla 3. Valores de almacenamiento dentro del bloque de Lego. Consecuencia: Se solucionó el problema, el formato de un archivo binario como almacenamiento funciona para guardar la información contenida en un rollo de pianola. 36 4 CAPÍTULO 4 RESULTADOS Y VALIDACIONES Para la fase de pruebas finales del equipo que desarrollamos, escogimos un rollo de pianola histórico que tuviera condiciones aceptables de conservación, esto es, que el hongo presente en estos documentos no haya causado daños profundos, igualmente se consideró que las rupturas entre filas y columnas no hayan ocasionado pérdida de información.8 En este sentido, seleccionamos un rollo de la Marca Ampico9, datado aproximadamente entre 1910 y 1915 interpretado por la pianista venezolana Teresa Carreño (1853-1917). La obra registrada en el mismo es el Nocturno Op.10 en Fa mayor de Piotr Ilich Tchaikovsky [WW01]. En la Figura 4.1 puede verse una fotografía del rollo escogido. Figura 4.1: Rollo de Teresa Carreño. 8 Recuérdese que debido al diseño del mecanismo de la pianola, la distancia entre perforaciones del rollo es de 1 milímetro, por lo tanto con el deterioro de más de 100 años del papel aumenta la fragilidad del mismo al manipularlo y las perforaciones muy cercanas tienden a romperse unas con otras. 9 Ampico o American Piano Company fue una productora de rollos de alta calidad establecida en 1908 en East Rochester, New York. En 1913 fue uno de los líderes en esta materia, junto a Duo-Art (1913) y Welte- Mignon (1905). El mecanismo fue diseñado por Charles Fuller Stoddard (1876-1958). Grandes pianistas grabaron para Ampico y los rollos que se conservan en la actualidad contienen interpretaciones de alta calidad musical, consideradas grabaciones históricas. Ampico cerró oficialmente en 1941. 37 La fase de pruebas de ScanWF y LegotoRolltoMid tuvo en promedio unas cincuenta digitalizaciones del rollo de Teresa Carreño, y se generaron una serie de resultados que evaluamos y sometemos a validación a continuación. 4.1 Evaluación de funcionamiento del hardware 4.1.1 Operatividad del hardware Las digitalizaciones realizadas con ScanWF demostraron que el equipo quedó correctamente calibrado para evitar daños o deterioros del papel. De acuerdo al procedimiento estipulado en el ajuste de los motores que se comentó en el capítulo anterior, el desplazamiento horizontal del carro lector se detuvo en cada columna y fila para que el sensor de luz tomara el registro; igualmente los ajustes del motor encargado del movimiento del rollo a lo largo del escáner (desplazamiento vertical) funcionó de acuerdo a lo estipulado en los ajustes preliminares. 4.1.2 Creación del archivo de datos en el bloque NXT ScanWF generó un archivo de datos con la posición de las perforaciones del rollo, capturadas por el sensor de luz. En el caso del rollo de Teresa Carreño con el que hicimos las pruebas, el archivo obtenido puede verse en la Figura 4.2. Nótese que el archivo está conformado por valores enteros que son las lecturas del sensor de luz, sin embargo, el bloque NXT realiza una conversión de entero a binario para fines de procesamiento. 38 Figura 4.2: Extracto de archivo de datos en bruto de ScanWF 4.2 Evaluación del software de procesamiento de los datos obtenidos El archivo obtenido en el paso anterior es la entrada del software LegotoRolltoMid, que se encarga de decodificarlo y transformar las lecturas en “1” y “0”, generando un nuevo archivo de datos que tiene la estructura matricial de columnas y filas del rollo y que puede verse a continuación en la figura 4.3. 39 Figura 4.3: Extracto de archivo de datos generado por LegoToRollToMid El archivo anterior es la imagen del rollo digitalizada, obtenida con nuestro desarrollo de hardware y software, que se convertirá en archivo de entrada de la aplicación principal del Proyecto Pianola [GC01] para la generación del archivo MIDI. Para validar qué tan fiel es el archivo obtenido, podemos seleccionar algunos casos particulares que debido a su complejidad podrían originar confusión en la digitalización de ScanWF. La idea es comparar el rollo original en estos sitios particulares contra el archivo procesado por LegotoRolltoMid:  Caso 1: Sitios con imperfecciones, tales como hongos, rupturas y manchas. La imagen comparativa puede verse en la Figura 4.4. 40 Figura 4.4: Representación de una ruptura por LegoToRollToMid  Caso 2: Patrón de una tecla accionada ejecutando una nota musical (Figura 4.5). Figura 4.5: Comparación de una nota registrada en el rollo con la misma nota en la captura obtenida por LegoToRollToMid 41 4.3 Validación de resultados Recordemos que el archivo generado por LegoToRollToMid es el archivo de datos de entrada para la aplicación RollToMid que como se ha dicho en reiteradas oportunidades a lo largo de este trabajo, es el proyecto base de conversión de los escaneos de los rollos a un archivo MIDI, el cual representa un conjunto de instrucciones o acciones que se ejecutan en un piano moderno. Por lo tanto, una vez obtenido el MIDI de un rollo de pianola dado, se puede escuchar el sonido real de la grabación original como si la estuviéramos reproduciendo en una pianola de comienzos del siglo pasado. En concreto, para validar el resultado sonoro del archivo generado por nuestra aplicación LegoToRollToMid, lo lógico sería procesarlo con RollToMid para generar el archivo MIDI correspondiente, transformarlo en una partitura utilizando la herramienta de software llamada Finale [FI01] y luego comparar el resultado sonoro obtenido con una grabación actual en piano de la misma obra de Tchaikovsky. Para ello, se seleccionó la grabación analógica de la misma obra interpretada por la pianista Nadia Reisenberg (1904- 1983). Igualmente obtuvimos la partitura correspondiente editada por la compañía “Op.111” en el año 2005 [OP01]. 4.3.1 Comparación visual de resultados Ambas partituras se sometieron a una exhaustiva comparación nota por nota, así como las posiciones, duración y tiempos. En la Figura 4.6 se muestra en la parte superior un extracto de la partitura [OP01] y en la parte inferior el extracto correspondiente de la partitura generada por la aplicación. Se observan las semejanzas de ambas partituras en cuanto a la melodía básica, sin embargo sus diferencias provienen de la escritura musical y se destacan en el caso de la partitura proveniente del MIDI, en la que no se encuentran ligaduras musicales en la misma. 42 Figura 4.6: Comparación de extracto de Partitura (arriba) y el MIDI generado por RollToMid (abajo) Un análisis detallado realizado por un músico profesional, da como resultado la conclusión de que la melodía representada en ambas, es la misma. Por lo que se puede decir que en la partitura generada por ScanWF, a través del archivo MIDI, así como en la partitura [OP01], las notas musicales coinciden exactamente. 4.3.2 Comparación de ondas de sonido Para validar la calidad de las ondas generadas por el software RollToMid en comparación con las de la pianista Nadia Reisenberg (1904-1983) [NR01], se han capturado las ondas sonoras de ambas interpretaciones. Por un lado, el formato CDA se convirtió a WAV a través del software Adobe Audition [AA01], y por el otro, el archivo generado con RollToMid fue convertido a su vez a un archivo WAV a través del software Midi2Wav Recorder [MW01]. Ambos archivos WAV fueron analizados con la herramienta de Adobe Audition [AA01], la cual mostró la forma de la onda e información de la misma que sirvieron para comparar la similitud entre ellas. 43 En el primer caso, el archivo WAV fue abierto y analizado por la misma herramienta de Adobe Audition [AA01]. Este tipo de archivos, mostró la música en forma de ondas e información, las cuales sirvieron para comparar la similitud entre ellas. Los sonidos pueden distinguirse entre sí por una serie de cualidades que permiten su caracterización. Esta percepción es subjetiva, pero puede hacerse objetiva encontrando la relación de estas cualidades con magnitudes físicas características del sonido, lo cual puede verse en la Tabla 4. Cualidad Propiedad física relacionada Rango Intensidad Tono Timbre Amplitud de la onda (dB) Frecuencia de la onda (Hz) Forma de la onda Fuerte a débil Agudo a grave Fuente emisora del sonido Tabla 4. Cualidades del sonido. La intensidad de la onda (altura o amplitud), medida en decibeles (dB), corresponde al volumen de la grabación, el cual no es un valor relevante en este caso de estudio. El tono de una onda indica si el sonido es grave, agudo o medio, y viene determinada por la frecuencia fundamental de las ondas sonoras, medida en ciclos por segundo o hercios (Hz). Para que un sonido resulte audible debe estar dentro del rango de audición (20 - 20000 Hz). Este rango va reduciéndose en ambos extremos conforme envejecemos. Cuantas más vibraciones por segundo, el sonido es más agudo y cuantas menos vibraciones por segundo, el sonido es más grave. Cuanto más corta, fina y tensa esté una cuerda, más agudo será el sonido que produzca y viceversa. Cada nota musical está caracterizada por la frecuencia de la misma medida en Hertz, al escuchar una frecuencia de 440 Hz, por ejemplo, ésta representa la nota “La” en la primera escala. El histograma frecuencial de las notas musicales observado en la Figura 4.7, corresponde a la grabación de [NR01]. En la Figura 4.8, se muestra el histograma frecuencial de las notas musicales de la onda generada a partir del archivo MIDI. Estos fueron generados usando MatLAb [ML02]. 44 Figura 4.7: Histograma de frecuencia de notas musicales (Hz) de la grabación de Nadia Reisenberg Figura 4.8: Histograma de frecuencia de notas musicales (Hz), obtenido a partir del archivo MIDI generado por RollToMid Comparando ambos histogramas se encuentran diferencias en el intervalo [554, 622] Hz, sin embargo, estas diferencias no son significativas porque en la partitura de la pianista Nadia Reisenberg [NR01] aparecen notas musicales (Re y Do#) que no corresponden a la melodía básica y se pueden interpretar como un arreglo de la pianista. Estas notas son conocidas como adornos a la melodía básica la cual, evidentemente no aparecen registrados en el rollo y por lo tanto no aparecen en la partitura correspondiente al MIDI. La música básica de ambas representaciones es la misma. 45 El timbre es la cualidad del sonido por la cual se distinguen dos sonidos con la misma sonoridad y el mismo tono, debido a la superposición de distintos armónicos que dan su forma característica a la onda sonora. Si se toca el La situado sobre el Do central en un violín, un piano y un diapasón, con la misma intensidad en los tres casos, los sonidos son idénticos en amplitud y frecuencia, pero muy diferentes en timbre. La forma de la onda o su composición armónica del sonido capturado se puede apreciar en la Figura 4.9, se muestra una selección de notas musicales las cuales nos permiten reconocer el mismo patrón de la forma de la onda en ambas interpretaciones, notando una diferencia en el tiempo de ejecución. En la onda correspondiente a la pianista hay un retardo en comparación con la onda generada por el MIDI, esto es porque la pianista interpreta la pieza a una velocidad menor y la forma de la onda es semejante con ciertas diferencias en la amplitud (volumen). Figura 4.9: Comparación de las ondas de sonido de ambas interpretaciones por notas o grupo] de notas musicales. Grabación de Nadia Reisenberg (arriba) vs. Grabación generada por MIDI (abajo). Se puede observar la gran similitud que presentan ambas ondas, por lo que esto permite corroborar la proximidad de las muestras de sonido al menos en el comportamiento global. No obstante persisten diferencias referidas al modo y las circunstancias en que han sido grabadas. La interpretación de la pianista Nadia Reisenberg se registró utilizando un micrófono, lo que introduce variables subjetivas en el proceso de grabación como, precisión y características técnicas del micrófono, lejanía y cercanía del micrófono con 46 respecto al piano, marca y calidad del piano, pedalización, reverberación de la sala y filtros utilizados en el registro. Estos son elementos que interfieren en la conformación de la onda definitiva. Esto se debe a que los sonidos que escuchamos son complejos, están compuestos por varias ondas simultáneas superpuestas, pero que nosotros percibimos como un sonido único. Así, el timbre (volumen) depende de la cantidad de armónicos que tenga un sonido y de la intensidad (frecuencia) de cada uno de ellos y está directamente relacionado con la forma de la onda. Lo mismo ocurre con la onda generada a partir de RollToMid. El archivo WAV obtenido mediante el proceso de conversión no posee ruido, ya que fue creado electrónicamente sin que interviniera ningún otro elemento extraño a la música contenida en el rollo. En síntesis, las propiedades físicas de las ondas sonoras que pueden ser medibles y relevantemente objetivas en este caso de estudio, son la frecuencia así como la forma de la onda, aun cuando existen variables que se acercan de un modo razonable a la grabación de Nadia Reisenberg [NR02] y el archivo MIDI generado por RollToMid. Tras evaluar la calidad del escáner y obtener la información del rollo sin ser dañado, se obtuvo un archivo de calidad para ser utilizado por RollToMid, de manera que el estado del sonido fuese aceptable al comparar el rollo con la matriz binaria generada por LegoToRollToMid, la partitura con el archivo MIDI generado por RollToMid, y las propiedades físicas de la onda en la interpretación de la pianista junto con el archivo MIDI. Con tales resultados, se puede afirmar que la solución propuesta de implementar un nuevo escáner como mecanismo digitalizador de rollos de pianola, es correcta. Ésta permite extraer las notas de interpretaciones hechas por pianistas de la época tal como si ellos estuviesen sentados frente al piano tocando nuevamente. 47 5 CONCLUSIONES La solución propuesta en este Trabajo de Grado permite desarrollar un escáner que satisface las expectativas al reconocer las perforaciones de un rollo de pianola y convertir la información capturada en una estructura matricial de datos que sirve de entrada a RollToMid quien genera un archivo MIDI el cual podemos escuchar. El uso de Lego para escanear es factible, sin embargo, obtener la calidad de datos necesaria para una buena interpretación musical tiene un alto costo en tiempo e inversión de piezas, además de una alta curva de aprendizaje. Las pruebas mostraron que el escáner ScanWF no daña el rollo, obtiene la información del mismo, genera un archivo de calidad para ser utilizado por RollToMid, la calidad del sonido generado es aceptable al comparar el rollo con la matriz binaria generada por LegoToRollToMid, la partitura con el archivo MIDI generado por RollToMid y las propiedades físicas de la onda de la interpretación de la pianista y el archivo MIDI, lo cual demuestra la factibilidad de digitalizar un rollo de pianola y convertir la información de este en un archivo MIDI, con un grado de fidelidad satisfactoria. Mucha información que se consideraba perdida en el tiempo porque la tecnología fue superada, es posible ahora recuperarla con esta técnica original e innovadora. Cientos de intérpretes ya fallecidos que no pueden ser escuchados porque ya no existe la pianola podrán serlo en un piano acústico o en un computador con esta tecnología desarrollada. Pianistas como Teresa Carreño ahora pueden ser escuchados 100 años después conociendo su estilo y su arte. 48 6 RECOMENDACIONES Y TRABAJOS FUTUROS Al usar piezas de Lego, se puede dar cualquier forma al escáner que se utilice para digitalizar los rollos. Algunas propuestas interesantes que se tienen son: • Optimizar la velocidad sin perder calidad. Si se utilizan engranajes será posible hacer más rápido el escáner llevando un control de la ubicación de los datos. • Mejorar la captura de los datos. En lugar de hacerlo punto a punto, capturar por sectores. • Usar un lente diferente para la captura de los datos. Se podría adaptar el lente de un escáner comercial para mejorar la captura. • El uso de engranajes en lugar de cauchos para controlar las ubicaciones. • Usar ingeniería inversa, dado el MIDI generar una hoja impresa con las marcas de los agujeros, si se tuviese una pianola en donde reproducirlos. • Usar técnicas de reconocimiento de patrones y redes neuronales para calcular la expresividad del MIDI. • Utilizar la nueva tecnología de Lego EV3 con sensores de color, motores mejorados y mayor capacidad de almacenamiento. 49 7 LISTA DE REFERENCIAS [AA01] Adobe Audition [Documento online] Disponible: http://www.adobe.com/la/products/audition.html [Consulta: 2015, Mayo] [AL01] Andy’s Lego Mindstorms Page [Documento online] Disponible: http://www.artilect.co.uk/lego/default.asp?page=Ideas [Consulta: 2015, Mayo] [AM01] Anders & Johannes Mindstorms Page [Documento online] Disponible: http://www.norgesgade14.dk/nxt_scanner.php [Consulta: 2015, Mayo] [DC01] Scientific Volumen Imaging [Documento online] Disponible: http://www.svi.nl/DeconvolucionHuygens [Consulta: 2015, Mayo] [FI01] Fórmulas físicas [Documento online] Disponible: http://www.rena.edu.ve/cuartaEtapa/fisica/Tema6b.html [Consulta: 2015, Mayo] [GC01] Colmenares, Gustavo. 2006. “Emulación Digital de Pianos Neumáticos” (Trabajo de Grado de Maestría). Universidad Central de Venezuela. Caracas, Venezuela [GC02] ValeTV. 2006, “Teresa Carreño vuelve a tocar”. Caracas, Venezuela [GC03] Televen. 2008, Ciencia Contigo: “Proyecto Pianola UCV”. Caracas, Venezuela [GD01] Giles Darling. Una solución concatenando [Documento online] Disponible: www.gilesdarling.me.uk/pianola/PianolaToMIDI2UserGuide. [Consulta: 2015, Mayo] [JD01] Julian Dyer. Copiadora de rollos [Documento online] Disponible: http://www.pianorolls.co.uk/rollcopying.htm [Consulta: 2015, Mayo] [JK01] Java Develoment Kit. JDK 8 update 45 [Documento online] Disponible: http://java.sun.com/javase/downloads/index.jsp [Consulta: 2015, Junio] [LD01] Lego Digital Designer [Documento online] Disponible: http://ldd.lego.com [Consulta: 2015, Mayo] 50 [LJ01] LejOS. Java para Lego Mindstorms [Documento online] Disponible: http://lejos.sourceforge.net/ [Consulta: 2015, Mayo] [LM01] Lego Mindstorms [Documento online] Disponible: http://www.lego.com/mindstorms/ [Consulta: 2015, Mayo] [MF01] Mario Ferrari y Giulio Ferrari. Building Robots with Lego Mindstorms. 2002 [MI01] MIDI [Documento online] Disponible: http://www.midi.org/ [Consulta: 2015, Mayo] [MJ01] Martijn Boogaarts. 2002. The LEGO MINDSTORMS NXT Idea Book: Design, Invent, and Build. [ML01] Escáner con MatLab [Documento online] Disponible: http://www.mathworks.com/matlabcentral/fileexchange/23153 [Consulta: 2015, Mayo] [ML02] MATLAB [Documento online] Disponible: http://www.mathworks.com/products/matlab/ [Consulta: 2015, Mayo] [MO01] Mark Overmars. Oct 1999. Programando Robots Lego usando NQC. Department of Computer Science Ultrecht University. Netherlands. [MS01] Martha N. Cyr. 2002. Lego Mindstorms for schools using Robolab. Lego System. Denmark. [MW01] Midi To Wav Recorder [Documento online] Disponible: http://www.midi2wav.com/ [Consulta: 2015, Mayo] [NR01] Wikipedia – Nadia Reisenberg [Documento online] Disponible: http://en.wikipedia.org/wiki/Nadia_Reisenberg [Consulta: 2015, Mayo] [NR02] Amazon – Nadia Reisenberg [Documento online] Disponible: http://www.amazon.com/Nocturne-Op-10-No-1/dp/B0038NIHSI [Consulta: 2015, Mayo] [SS01] Simen Svale Skogsrud [Documento online] Disponible: http://news.lugnet.com/robotics/?n=3032 [Consulta: 2015, Mayo] 51 [SS02] Simen Svale Skogsrud. [Documento online] Disponible: http://web.archive.org/web/20030416235254/http://www.mop.no/~simen/l egoscan.htm [Consulta: 2015, Mayo] [TS01] Terry Smythe. Una solución electrónica [Documento online] Disponible: http://members.shaw.ca/smythe/smythe.htm [Consulta: 2015, Mayo] [WT01] Warren Trachtman. Una solución electrónica [Documento online] Disponible: http://www.trachtman.org/rollscans/scannerhardware.htm [Consulta: 2015, Mayo] [WW01] Tchaikovsky. Opertura 10. [Documento online] Disponible: http://imslp.org/wiki/2_Pieces,_Op.10_%28Tchaikovsky,_Pyotr%29 [Consulta: 2015, Mayo]