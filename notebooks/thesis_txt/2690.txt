CLASIFICACIN DE LA MORFOLOGA DE ESPERMATOZOIDES HUMANOS Universidad Central de Venezuela Facultad de Ciencias Escuela de Computación Centro de Ingeniería de Software y Sistemas Laboratorio de Inteligencia Artificial Opción Profesional: Inteligencia Artificial Herramienta para la extracción automática de características morfológicas de espermatozoides humanos a partir de imágenes Trabajo Especial de Grado Presentado ante la ilustre Universidad Central de Venezuela, por el Magíster Scientiarum Hendry Ferreira Chame, para optar al Título de Licenciado en Computación Tutores: Haydemar Núñez y Roberto Casañas Caracas, octubre de 2008 ACTA Quienes suscriben, miembros del jurado designado por el Consejo de la Escuela de Computación, para dictaminar sobre el Trabajo Especial de Grado titulado: “Herramienta para la extracción automática de características morfológicas de espermatozoides humanos a partir de imágenes” y presentado por el Magíster Scientiarum Hendry Ferreira Chame, de cédula de identidad E – 82.063.290, para optar al título de Licenciado en Computación, dejan constancia de lo estipulado a continuación: Leído como fue dicho trabajo por cada uno de los miembros del jurado, se fijó el día 30 de Octubre de 2008 a las 10:00 a.m., para que su autor lo defendiera en forma pública, lo que hizo en la Sala 1 de la Escuela de Computación, mediante una presentación oral del contenido del Trabajo Especial de Grado, luego de lo cual respondió a las preguntas formuladas. Finalizada la defensa pública del Trabajo Especial de Grado, el jurado decidió APROBARLO. En fé de lo cual se levanta la presente Acta, en la Ciudad Universitaria de Caracas a los treinta días del mes de octubre del año dos mil ocho dejándose también constancia de que actúo como Coordinadora del Jurado la Profesora Esmeralda Ramos. Jurado Principal _______________________ _______________________ Profesor Ernesto Coto Profesora Esmeralda Ramos _______________________ _______________________ Profesor Roberto Casañas Profesora Haydemar Nuñez (Tutor) (Tutora) 2 . DEDICATORIA Dedico este trabajo a la humanidad, que a pesar de haberse empeñado algunas veces en crear y ejecutar algoritmos de destrucción, en otras, ha intentado reducir la entropía de la vida. 3 AGRADECIMIENTOS Agradezco a: Laboratorio de Inteligencia Artificial de la Universidad Central de Venezuela, especialmente a la profesora Esmeralda Ramos por la franca y sincera disposición para ayudar. Los tutores Haydemar Núñez y Roberto Casaña por la amabilidad, sinceridad, dedicación, disposición de trabajo y calidad docente. Los profesores Robinson Rivas, Rhadamés Carmona, Esmitt Ramírez y Ernesto Coto por las precisas y oportunas observaciones hechas al trabajo. Karina Gómez por la dulce compañía a lo largo de la investigación. Especialmente por tolerar que llevara el computador a la playa e invitarme a trabajar con amor. Mi familia. A Fuad Aziz Chame, Glória de Fátima Chame, Fuad Aziz Chame Filho, Danya Ferreira Chame y Daniela Ferreira Chame, por haberme brindado a través de la convivencia las contingencias necesarias para llegar a este punto. La vida, por permitirme realizar mis sueños. 4 RESUMEN El Análisis de Líquido Seminal (ALS) o Espermograma es un procedimiento diagnóstico importante para la salud ya que se constituye en un medio de evaluación de la fertilidad masculina. Por otra parte, permite estimar el funcionamiento de diferentes estructuras del aparato reproductivo, lo que resulta conveniente para dar seguimiento a intervenciones médicas como la vasectomía, así como otros chequeos pre y post operatorios. En el ALS se realizan dos grupos de pruebas (macroscópicas y microscópicas). La evaluación morfológica es una subprueba microscópica que demanda altos costes en términos de pericia, tiempo y esfuerzo, además de ser un procedimiento vulnerable a varias fuentes de error. A partir de la vigencia, utilidad e importancia de la evaluación morfológica así como de las dificultades asociadas a este examen, el propósito de esta investigación fue construir una herramienta que apoye al experto en la prueba. Para tal fin, se definió un modelo de procesamiento de imágenes digitales microscópicas del líquido seminal, que identifica y extrae las características a los espermatozoides presentes en la escena. Luego del desarrollo y definición del modelo, se realizaron pruebas con una muestra de 89 imágenes tomadas en condiciones similares al ambiente de trabajo del experto. Los resultados indican una tasa de error de segmentación de 7,69% confundiendo elementos de las imágenes con espermatozoides, 6,69% de omisiones de espermatozoides presentes y 7,53% de error en la extracción de características producto de la identificación errónea de las estructuras del espermatozoide. El desarrollo del proyecto constituye un aporte que demuestra la factibilidad de desarrollar este tipo de tecnologías en el país. Sin embargo, mostró ser una actividad compleja, que debe ser llevada a cabo con precaución, controlando las fuentes de error. Requiere de creatividad e innovación así como del dominio de los aspectos técnicos relacionados a la eficiencia en la ejecución de programas en el computador. Palabras claves: Morfología Espermática, Inteligencia Artificial, Procesamiento Digital de Imágenes. 5 TABLA DE CONTENIDOS INTRODUCCIÓN 8 CAPITULO I: MARCO TEÓRICO 10 1.1 ANÁLISIS DE LÍQUIDO SEMINAL 10 1.1.1 MORFOLOGÍA ESPERMÁTICA 10 1.2 INTELIGENCIA ARTIFICIAL 12 1.2.1 ÁREAS DE LA INTELIGENCIA ARTIFICIAL 13 1.2.1.1 APRENDIZAJE AUTOMÁTICO 14 1.2.1.1.1 REDES NEURONALES 14 1.2.3. SISTEMAS MULTIAGENTES 16 1.3 IMÁGEN DIGITAL 16 1.3.1 ESPACIOS DE COLOR EN IMÁGENES DIGITALES 16 1.4 PROCESAMIENTO DIGITAL DE IMÁGENES 18 1.4.1 CONVOLUCIÓN 18 1.4.2 ANÁLISIS DE HISTOGRAMA 19 1.4.3 OPERACIONES ARITMÉTICAS 20 1.4.4 SEGMENTACIÓN 20 1.4.4.1 UMBRALIZACIÓN 21 1.4.4.2 OPERADORES DE TEXTURA 21 1.4.5. OPERADORES LÓGICOS 22 1.4.6. OPERADORES MORFOLÓGICOS 23 CAPITULO II: MARCO APLICATIVO 25 2.1 PLANTEAMIENTO DEL PROBLEMA 25 2.1.1 ANTECEDENTES 26 2.1.2 PROPUESTA DE SOLUCIÓN 28 2.2. OBJETIVOS 29 2.3.1 GENERAL 29 2.3.2 ESPECÍFICOS 29 2.3 PROCESAMIENTO DE IMÁGENES DE ESPERMATOZOIDES HUMANOS 30 2.3.1 ADQUISICIÓN DE IMÁGENES 30 2.3.2 PRE-PROCESAMIENTO DE IMÁGENES 30 2.3.3 SEGMENTACIÓN DE IMÁGENES 31 2.3.3.1 CONSTRUCCIÓN DE LA MÁSCARA DE CABEZAS DE ESPERMATOZOIDES (MCE) 32 2.3.3.2 PROPUESTA DE OPERADOR DE TEXTURA NÚCLEO DE CÍRCULO Y ANILLO (NCA) 33 2.3.3.3 CONSTRUCCIÓN DE LA MÁSCARA DE NÚCLEO DE CÍRCULO Y ANILLO (MNCA) 23 2.3.3.4 CONSTRUCCIÓN DE LA MÁSCARA DE CONTORNOS DE ESPERMATOZOIDES (MCOE) 34 2.3.3.5 EXTRACCIÓN DE CAJAS CONTENEDORAS ORIENTADAS 35 6 2.3.3.6 SEPARACIÓN DE ESTRUCTURAS DEL ESPERMATOZOIDE 36 2.3.4 EXTRACCIÓN DE CARACTERÍSTICAS 39 2.3.5 ANÁLISIS DE RESULTADOS 42 2.4 DESARROLLO DE LA APLICACIÓN 46 2.4.1 ANÁLISIS DE REQUERIMIENTOS Y MODELOS DE CASO DE USO 46 2.4.2 PLATAFORMA TECNOLÓGICA 50 2.4.3 DISEÑO DE LA INTERFAZ 51 CONCLUSIONES Y RECOMENDACIONES 56 REFERENCIAS 59 7 INTRODUCCIÓN El Análisis de Líquido Seminal (ALS) o Espermograma es un procedimiento diagnóstico que por varias razones resulta importante en el ámbito de las ciencias de la salud. Se constituye en un medio de evaluación de la fertilidad masculina así como un medio para estimar el funcionamiento de diferentes estructuras del aparato reproductivo. En efecto, a través del ALS se evalúa la función secretora de las glándulas anexas, procesos infecciosos- inflamatorios del tracto urogenital, procesos obstructivos, mal funcionamiento de las vesículas seminales o próstata y anormalidades motrices y morfológicas de los espermatozoides [RAM07A]. Este examen se constituye además en un medio para dar seguimiento a intervenciones médico-quirúrgicas como la vasectomía, en el chequeo pre y post operatorio. En el ALS se realizan dos grupos de pruebas [OMS01]. La evaluación macroscópica analiza características físico-químicas del semen como aspecto, licuefacción, volumen, color, viscosidad y pH. Las pruebas microscópicas evalúan concentración, aglutinación, motilidad, viabilidad y morfología espermática, así como otros elementos celulares presentes (células epiteliales e inmaduras, leucocitos, eritrocitos, bacterias y otros residuos) [PAD88] [CER06]. La evaluación morfológica resulta ser, en la práctica, una actividad con altos costes en términos de pericia, tiempo y esfuerzo. Se trata de una tarea repetitiva donde el experto debe contar manualmente 200 espermatozoides y clasificarlos según sus características morfológicas, diferenciándolos apropiadamente de otras estructuras presentes en el semen. Se trata de un método vulnerable a la subjetividad y experticia de los profesionales resultando ser un procedimiento difícil de enseñar, con gran variabilidad, inexactitud y dificultad de replicación de sus resultados [KAT86]. Conciente de la vigencia, utilidad e importancia del ALS, así como de las dificultades asociadas a este examen, el proyecto ANALISE busca construir un sistema multi-agente cuya finalidad sea apoyar a los profesionales de las ciencias de la salud en el análisis de la calidad del semen humano [RAM07B]. En este marco de desarrollo, uno de los módulos o agentes se encargará de la clasificación morfológica de espermatozoides presentes en una muestra a través de imágenes digitalizadas de las escenas que analiza el experto. Específicamente, y de acuerdo a los objetivos propuestos por el proyecto ANALISE, el diseño del módulo de clasificación morfológica contempla el funcionamiento automático (o desasistido) definido en un algoritmo que opera en tres pasos lógicamente diferenciables: a) identificar espermatozoides, b) extraer las características presentes y c) a través de un paradigma o modelo de clasificación, asignar un rótulo o categoría morfológica a cada uno de estos espermatozoides. El propósito de esta investigación fue construir una herramienta, que partiendo de la definición de un modelo de procesamiento de imágenes digitales microscópicas del líquido seminal, identifique y extraiga desasistidamente características a los espermatozoides presentes en la escena. Los productos de esta investigación operan, en consecuencia, en dos vertientes: Por una parte, integran el módulo de clasificación morfológica del proyecto 8 ANALISE llevando a cabo los pasos a y b. Por otra parte, se constituye en una herramienta de soporte que, a través de una interfaz gráfica, permite la construcción de vectores que incorporan tanto las características automáticamente extraídas como las categorías morfológicas asignadas a tales espermatozoides por los expertos, lo que permitirá la estimación del modelo que finalmente clasificará desasistidamente los espermatozoides presentes. Este documento se encuentra estructurado en dos capítulos. En el Capítulo I se presenta la teoría relacionada al proceso de análisis de semen humano, una revisión de algunos conceptos básicos en el área de Inteligencia Artificial, así como una revisión de las técnicas de procesamiento digital de imágenes (PDI) comúnmente utilizadas para la segmentación y extracción de características. En el Capítulo II se analizan los antecedentes al problema y se propone una solución utilizando PDI describiendo detalladamente la combinación de técnicas utilizadas, además se presentan y analizan los resultados obtenidos. Por último, se presentan las conclusiones alcanzadas, se realizan recomendaciones para trabajos futuros y se señalan las limitaciones de la investigación. 9 CAPITULO I: MARCO TEÓRICO 1.1 ANÁLISIS DE LÍQUIDO SEMINAL Actualmente, el examen más utilizado para evaluar la infertilidad en el hombre, entendida como la incapacidad de procrear luego de un año de intentos sin usar métodos anticonceptivos, es el Espermograma [SPE04]. La Organización mundial de la Salud (OMS) define un protocolo de prueba que consta de dos partes: la evaluación macroscópica y la evaluación microscópica [OMS01]. En la Tabla 1 se muestran los aspectos evaluados en el ALS. Tabla 1: Características evaluadas en el ALS Prueba Característica Descripción Macroscópica Aspecto Homogeneidad o heterogeneidad de la muestra, color, presencia de cuerpos mucosos y fibrinas, opacidad/transparencia. Macroscópica Licuefacción Análisis de consistencia (líquida o con coágulos). Macroscópica pH Medido con papel especial de rango de 2 a 9, al cabo de 30 segundos se observa el color de la zona impregnada y se compara con la cartilla de calibración. Valor de referencia: mayor de 7.2. Macroscópica Viscosidad Propiedad de resistencia al movimiento uniforme de su masa. Normal en caso de observar un pequeño filamento, aumentada con filamento mayor a los 2 cm. de longitud. Macroscópica Volumen Medido con pipeta volumétrica tiene valor normal entre 2 y 6 ml. Microscópica Aglutinación Unión entre espermatozoides móviles por cualquiera de sus partes. Microscópica Concentración Cantidad de espermatozoides presentes en la muestra por unidad de volumen. Microscópica Otros elementos Presencia de células epiteliales e inmaduras, leucocitos, eritrocitos, bacterias y otros residuos. Microscópica Motilidad Espermatozoides móviles e inmóviles en la muestra, se clasifican en: Móviles progresivos rápidos, Móviles progresivos moderados, Móviles no progresivos e Inmóviles. Microscópica Morfología Evaluación de morfología de partes del espermatozoide: Cabeza, Cuello o Pieza Intermedia y Cola. Microscópica Viabilidad Proporción entre los espermatozoides inmóviles vivos y los espermatozoides inmóviles muertos. 1.1.1 MORFOLOGÍA ESPERMÁTICA Las subpruebas morfológicas llevadas a cabo en el ALS son de gran utilidad para la identificación de la infertilidad masculina, proveen una valiosa información que contribuye 10 al éxito de procedimientos de reproducción asistida como la fertilización in vitro y la inyección intransitoplasmática [KRU99]. Para llevar a cabo el análisis morfológico se recomienda usar el reactivo químico hematoxilina-eosina con el objetivo de diferenciar los espermatozoides a través de la coloración [OMS01]. Como resultado de este procedimiento, los espermatozoides y demás células adquieren tonos oscuros (cercanos al negro) sobre un fondo rojizo-naranja. La Figura 1 ilustra las partes que constituyen al espermatozoide humano: Cabeza (compuesta por Acrosoma y Post-Acrosoma), Pieza Intermedia (PI) y Cola. Los criterios de normalidad para un espermatozoide [OMS01] se enumeran en la Tabla 2. Si cualquiera de los valores obtenidos para estos parámetros está fuera del intervalo definido como aceptable, el espermatozoide es clasificado como anormal. Las malformaciones son clasificadas por regiones, en la Figura 2 se observan algunas de éstas. Tabla 2: Aspectos morfológicos evaluados Estructura Características Cabeza Ovalada, única, lisa, Acrosoma ocupa entre 40% y 70% del área. Longitud de 4-5 µm. Ancho 2.5-3.5 µm. Si existen vacuolas, no deberán ocupar más de la mitad del área. Pieza Intermedia Estrecha, unida axialmente, alineada con la Cabeza, sin restos citoplasmáticos, no debe exceder 1/3 del área de la Cabeza. Longitud 6-10 µm. Cola Uniforme, única, desenrollada, 45 µm de longitud, ligeramente más estrecha que la Pieza Intermedia, sin residuos citoplasmáticos. Figura 1: Partes del espermatozoide humano 11 Figura 2: Algunas anormalidades morfológicas del espermatozoide humano 1.2 INTELIGENCIA ARTIFICIAL La Inteligencia Artificial (IA) es un área de investigación compleja que ha sido definida en base a dos dimensiones [RUS02]. La primera hace referencia a la diferenciación entre el pensamiento y la acción, mientras que la segunda establece diferencias entre las capacidades inteligentes humanas y el concepto de inteligencia desincorporado de lo humano. En conjunto se generan 4 categorías de definiciones, en la Tabla 3 se muestran ejemplos de cada una de éstas. Las definiciones de las celdas superiores consideran los procesos de pensamiento y razonamiento, mientras que las definiciones de las celdas inferiores incluyen, además de estos, el comportamiento. En la columna izquierda se define a la IA mediante comparaciones entre el desempeño de los seres humanos y el sistema automático, mientras que las definiciones de la columna derecha realizan comparaciones con respecto al concepto ideal de inteligencia. 12 Tabla 3: Cuatro categorías de definiciones de IA [RUS02] "El excitante nuevo esfuerzo de hacer que las computadoras piensen… máquinas con mentes, en el completo y literal sentido " (Haugeland, 1985) "[La automatización de] actividades que asociamos con el pensamiento humano, actividades como la toma de decisiones, la resolución de problemas, el aprendizaje…" (Bellman, 1978) "El estudio de las facultades mentales a través del uso de modelos computacionales" (Charniak and McDermott, 1985) "El estudio de los cómputos que hacen posible percibir, razonar y actuar " (Winston, 1992) "El arte de crear máquinas que lleven a cabo funciones que requieren inteligencia cuando son ejecutadas por las personas " (Kurzweil, 1990) "El estudio del cómo hacer que las computadoras realicen cosas, que para el momento, las personas son mejores" (Rich and Knight, 1991) "Un campo de estudio que busca explicar y emular el comportamiento inteligente en términos de procesos computacionales" (Schalkoff, 1990) "La rama de la ciencia de la computación dedicada a la automatización del comportamiento inteligente" (Luger and Stubblefield, 1993) Dependiendo de la definición de IA adoptada, se plantean distintos tipos de investigaciones para resolver problemas en áreas igualmente diversas. Por ejemplo, la consideración al componente conductual caracteriza trabajos en el área de la robótica, a diferencia de investigaciones, como la presente, que buscan la automatización de actividades asociadas al pensamiento como la toma de decisiones. En cuanto a la segunda dimensión, las investigaciones que consideran el concepto ideal de inteligencia se orientan, por ejemplo, hacia la estimación de modelos cognitivos, a diferencia de trabajos (como el presente) que buscan emular pericias humanas específicas (por ejemplo, la detección de células microscópicas). Por consiguiente, de los conceptos expuestos el que mejor se ajusta a las características de esta investigación es el propuesto por Bellman (1978). 1.2.1 ÁREAS DE LA INTELIGENCIA ARTIFICIAL Con el objetivo de proporcionar una definición operacional satisfactoria del concepto de inteligencia, Alan Turing (1950) diseñó una prueba para medir el comportamiento inteligente de una máquina. Específicamente, lo define como la habilidad de lograr el desempeño humano en todas las actividades cognitivas, de manera suficiente como para lograr que el evaluador se confunda y no pueda diferenciar entre las respuestas humanas y las respuestas automáticas [RUS02]. Las capacidades requeridas a un sistema automático para realizar la prueba de Turing son: 1) Procesamiento de lenguaje natural para establecer la comunicación con el evaluador, 2) Representación del conocimiento para almacenar la información provista antes o durante la evaluación, 3) Razonamiento automático para utilizar la información almacenada y responder las preguntas elaborando conclusiones, 4) Aprendizaje automático para adaptar 13 el sistema a nuevas circunstancias, detectar y explorar patrones, 5) Visión automática para percibir objetos y 6) Robótica para mover objetos. A pesar de que la prueba no haya sido hasta el momento completada con éxito1, ha servido como punto de partida para un gran número de investigaciones en cada una de las áreas que define. La presente investigación, dadas sus características, se encuentra enmarcada en el área de aprendizaje automático. 1.2.1.1 APRENDIZAJE AUTOMÁTICO El área de aprendizaje automático se dedica a la adquisición automática del conocimiento. Es un campo relativamente amplio y ha dado lugar a distintas estrategias de abordaje como, por ejemplo, el aprendizaje inductivo, deductivo, genético y conexionista [HAG02]. El aprendizaje inductivo pretende definir modelos de conceptos a partir de la generalización de conjuntos de ejemplos, se buscan descripciones simples que expliquen las características comunes a estos. El aprendizaje analítico o deductivo obtiene descripciones generales a partir de un ejemplo de concepto y su explicación, esta generalización puede ser memorizada para ser utilizada en situaciones similares al ejemplo. El aprendizaje genético utiliza algoritmos inspirados en la teoría de la evolución para encontrar descripciones generales a conjuntos de ejemplos, la exploración que realizan estos algoritmos permiten encontrar la descripción más ajustada a dicho conjunto. Finalmente, el aprendizaje conexionista busca descripciones generales mediante el uso de la capacidad de adaptación de redes de neuronas artificiales, que tras un proceso de entrenamiento, registran el estado correspondiente al concepto aprendido [HAG02]. 1.2.1.1.1 REDES NEURONALES Las redes neuronales artificiales son un paradigma de aprendizaje y procesamiento automático inspirado en estudios realizados sobre el funcionamiento del sistema nervioso. Se trata de un sistema de interconexión de neuronas en una red que recibe un patrón de estímulo como entrada y produce una salida [RUS02]. Siguiendo la analogía entre el funcionamiento de las neuronas como unidades básicas del tejido nervioso, incluyendo el cerebro; una red neuronal se define como un conjunto de nodos conectados entre si a través de enlaces. Cada enlace contiene un peso numérico que se constituye en el medio de almacenamiento a largo plazo de la red neuronal. El modo de funcionamiento de cada neurona es el siguiente: la neurona recibe un patrón de señal como entrada, se realiza una suma ponderada aplicando los pesos a dicho patrón, y en función del resultado evaluado a partir de la función de activación, se emite una salida. [HAG02]. 1 El Premio Loebner es una competición que concede premios a un sistema automático de acuerdo a su rendimiento en la prueba de Turing. Hasta el año 2008, la mayor distinción se otorgó al programa alemán Elbot que recibió 3.000,00$ y una medalla de bronce, tras haber sido capaz de engañar al 25% de los jueces, que creían estar conversando con un humano. [dirección Web: http://www.loebner.net/Prizef/loebner- prize.html] 14 Las redes neuronales, por lo general, están compuestas por capas de neuronas (redes multi- capas) de modo que las salidas de una capa están completamente conectadas a las entradas de la capa siguiente, aunque es posible definir redes que no cumplan con esta condición como las que se encuentren parcialmente conectadas y las que presentan realimentación de neuronas hacia sí misma (redes recurrentes). Las redes mono-capa, por el contrario, son aquellas compuestas por una única capa de neuronas [HAG02]. El Perceptron en una red neuronal compuesta por una capa de entrada y otra de salida, lo que equivale en la práctica a una capacidad de representación limitada ya que sólo permite la discriminación de patrones linealmente separables. El Perceptron Multicapa, en cambio, es un tipo de red neuronal utilizada para clasificar conjuntos no separables linealmente pudiendo ser total o localmente conexa [FRE93]. En la Figura 3 se muestra un ejemplo de arquitectura Perceptron Multicapa. Figura 3: Ejemplo de arquitectura Perceptron Multicapa El proceso de entrenamiento de una red neuronal consiste en la adaptación progresiva de los valores de las conexiones sinápticas (pesos) con el propósito de lograr el aprendizaje deseado. Dependiendo del tipo de red, este procedimiento puede clasificarse en supervisado y no supervisado [FRE93]. El entrenamiento supervisado requiere conocer los valores de salida esperados para todas las entradas, a diferencia del entrenamiento no-supervisado. Para llevar a cabo el algoritmo se debe proporcionar a la red entradas con los datos de entrenamiento, las salidas obtenidas se comparan con las salidas esperadas y se calcula la diferencia estimando el error de la respuesta de la red [RUS]. Existen algoritmos de aprendizaje supervisado como el de retro-propagación del error (backpropagation) que actualizan los pesos de la red utilizando el método de descenso por el gradiente [FRE93]. Específicamente, se divide el cálculo entre las distintas unidades de manera que el cambio en cada peso pueda calcularse utilizando información local. El peso de cada conexión a una unidad de salida se ajusta en la dirección adecuada (excitadora o inhibidora) y en la proporción adecuada para reducir el error. Se sigue este procedimiento para ajustar los errores de cada una de las capas. Los pasos anteriores se repiten a través de un número de ciclos para diferentes patrones de entrada-salida hasta que el sistema converja y se obtengan los pesos adecuados 15 1.2.3. SISTEMAS MULTIAGENTES Un agente es cualquier entidad que percibe su entorno a través de sensores y actúa sobre este mediante efectores. El agente es considerado racional cuando realiza la mejor acción posible a partir de los datos percibidos [RUS02]. Los Sistemas Multi-agentes colaboran para resolver problemas, donde cada agente cumple una función específica y coopera con los otros a los fines de alcanzar los objetivos planteados. Los SMA son especialmente adecuados, en lugar de soluciones de software tradicionales, en aquellas situaciones en las que el grado de complejidad del problema es tal que la solución difícilmente puede ser alcanzada por un solo agente, el conocimiento se encuentra distribuido o el problema puede ser descompuesto en sub-problemas [RAM07B]. 1.3 IMAGEN DIGITAL Una imagen (del latín imago) es una representación visual de un objeto mediante distintas técnicas como pintura, fotografía, tomografía, video y otras [GAR91]. Las imágenes digitales son aquellas que se almacenan y representan en el computador a través de secuencias de valores binarios. En general, pueden identificarse dos tipos o categorías de imágenes digitales: mapas de bits e imágenes vectoriales [UMB05]. El mapa de bits es el mecanismo comúnmente utilizado por los dispositivos de registro de imágenes. Consiste en un conjunto de puntos o píxeles con valores de color y luminancia propios; almacena por lo tanto todos los puntos visibles de la imagen. La imagen vectorial, en cambio, consiste en un formato que recurre al uso de métodos para representar líneas, curvas y formas almacenando únicamente puntos claves. 1.3.1 ESPACIOS DE COLOR EN IMÁGENES DIGITALES En la naturaleza, los colores obtenidos por descomposición de la luz a partir de tres longitudes de onda se denominan colores aditivos [PRA07]. Reciben este nombre ya que la mezcla de intensidades de sólo tres de ellos: rojo, verde y azul (Red, Green, Blue, RGB) permite obtener todos los colores del espectro visible. Matemáticamente, el espacio de color es un modelo que se define a partir de una base de N vectores, cuya combinación lineal genera todo el espacio de color. El propósito de estos modelos de composición es facilitar una conveniente especificación de un color dentro del espectro de colores [FOL93]. Existen espacios que intentan englobar la mayor cantidad posible de los colores visibles por el ojo humano, aunque otros aíslan tan solo un subconjunto de ellos. Los espacios de color se definen en base a una o más dimensiones. Por ejemplo, como puede verse en la Figura 4, un espacio bastante útil definido en una dimensión es la Escala de Grises. En ésta, las imágenes están conformadas por variaciones de intensidades de gris siendo la menor intensidad el color negro y la mayor intensidad el color blanco [RUS07]. 16 Figura 4: Imagen en Escala de Grises Los espacios de color bidimensionales generalmente se construyen a partir de subespacios de dimensiones superiores. Por ejemplo, el subespacio RG se construye en base al espacio RGB. También pueden definirse subespacios de color basados en otros espacios tridimensionales (como el modelo Hue Saturation Value, HSV) y tetradimensionales (como el modelo Cyan Magenta Yellow and Key, CMYK). Los espacios de color de tres dimensiones son ampliamente utilizados. En ellos, los colores se representan mediante tres coordenadas o atributos. Existen varios tipos y la utilidad de cada uno se determina según las características de la aplicación que lo requiera [TIN05]. Para la presente investigación, un espacio de color tridimensional que resultó de gran utilidad fue el modelo RGB. En el modelo de color RGB se le asigna un valor entre 0 y 255 a cada uno de los componentes (rojo, verde y azul) que forman el color [RUS07]. Los valores más altos de RGB corresponden a una cantidad mayor de luz blanca, mientras que los más bajos definen los colores más oscuros. En la Figura 5 se muestra una forma de visualizar este modelo normalizando las coordenadas de color. Figura 5: Modelo de color RGB 17 1.4 PROCESAMIENTO DIGITAL DE IMÁGENES El procesamiento digital de imágenes es el conjunto de técnicas que se aplican a las imágenes digitales con el objetivo de mejorar su calidad o facilitar la búsqueda de información resaltando ciertas características de interés. El análisis y procesamiento de imágenes digitales sigue uno de dos enfoques existentes: considerar la imagen en el dominio espacial o considerarla en el dominio frecuencial [RUS07]. En el dominio espacial, la imagen puede verse como una señal con saltos discretos que se representa mediante la variación de intensidades de color por unidad de tiempo. En el dominio frecuencial, la imagen se representa por los componentes de la señal según la frecuencia y el desplazamiento de fase. Existen numerosas técnicas de procesamiento de imágenes que pueden aplicarse desde el dominio espacial o desde el dominio frecuencial, en última instancia, su valor dependerá en gran medida de las características del problema que se desee abordar. Considerando heurísticamente el problema (localizar espermatozoides en la escena), algunas técnicas que mostraron gran valor fueron: Convolución (filtros y detección de bordes), Análisis de Histograma, Operaciones Aritméticas, Segmentación (Umbralización, Operadores de Textura), Operaciones Lógicas y Operaciones Morfológicas (Erosión y Dilatación), 1.4.1 CONVOLUCIÓN La Convolución es una operación llevada a cabo en el dominio espacial. Consiste en la suma de los productos entre los valores de un núcleo (de tamaño NxM, con N y M impar) y los valores de los píxeles de una región equivalente en la imagen. El resultado se le asigna al píxel de la imagen que equivalga a la posición central del núcleo para un instante dado. En la Convolución, el núcleo se desplaza sobre los píxeles de la imagen modificando sus valores a través de un mecanismo de ventana deslizante [CRA97]. La operación puede representarse de la siguiente forma: g(x,y) = f(x,y) a(x,y) Donde a(x,y) es la función respuesta al impulso del filtro a aplicar (también denominado núcleo o máscara de Convolución), f(x,y) es la imagen de entrada y g(x,y) es la imagen filtrada. La expresión matemática para el caso bidimensional es la siguiente: Existen muchas aplicaciones de núcleos de Convolución. En general se utilizan para suavizado y reducción de ruidos (ej. filtro Gaussiano), al tomar la primera derivada se detectan bordes en la imagen (filtros de Prewitt, Sobel y Roberts, etc.), la segunda derivada permite lograr el efecto de operadores no direccionales que actúan como filtros pasa-alto para aumentar el contraste [CRA97], además de una serie de efectos visuales con fines 18 artísticos. En la Tabla 4 se muestran los principales filtros de detección de bordes bajo una acción de Convolución. Tabla 4: Algunos filtros usados para la detección de bordes [PRA07] Operador de gradiente Dirección Horizontal Dirección Vertical Roberts 0 0 -1 0 1 0 0 0 0 -1 0 0 0 1 0 0 0 0 Prewitt -1 0 1 -1 0 1 -1 0 1 -1 -1 -1 0 0 0 1 1 1 Sobel -1 0 1 -2 0 2 -1 0 1 -1 -2 -1 0 0 0 1 2 1 Isotrópico -1 0 1 -√2 0 √2 -1 0 1 -1 -√2 -1 0 0 0 1 √2 1 1.4.2 ANÁLISIS DE HISTOGRAMA El Histograma de una imagen digital cuyos valores de píxel estén en el rango (0, L-1) es una función discreta f(rk) = nk, donde rk es el k-ésimo nivel de intensidad del canal y nk es el número de píxeles en la imagen que tienen el nivel rk. Es una práctica común normalizar el Histograma dividiendo cada uno de sus valores entre el número total de píxeles en la imagen denotado por n. Así la versión normalizada del Histograma permite estimar la distribución de probabilidad de ocurrencia del nivel rk [GON02]. Los Histogramas proveen estadísticas útiles que resultan de gran importancia para operaciones de segmentación y compresión de imágenes [GON02]. Son además la base de numerosas técnicas de procesamiento en el dominio espacial. En la Figura 6, se muestra una representación gráfica del Histograma de una imagen en escala de grises. Figura 6: Representación gráfica del Histograma de una imagen 19 1.4.3 OPERACIONES ARITMÉTICAS Las Operaciones Aritméticas entre imágenes digitales son herramientas de gran utilidad para mejorar la calidad de la imagen, así como para facilitar la extracción de características. Existen muchos ejemplos de su aplicabilidad, siendo uno de ellos el campo de la Visión Artificial, donde la identificación de diferencias entre cuadros temporales de una escena hace posible la identificación de cambios en el estado de los objetos presentes [RUS07]. En general, las operaciones aritméticas básicas con imágenes digitales son: suma, resta, multiplicación y división entre píxeles homólogos. Dado que los mapas de bits se definen mediante arreglos de números, estas operaciones deben efectuarse con precaución para evitar desbordamientos en el rango de los valores permitidos [BOV00]. Por lo tanto, no resulta, en este contexto, una función lineal. Supóngase n imágenes de dimensión NxM (todas deben tener el mismo tamaño) la suma entre ellas se define como: La resta de dos imágenes f1, f2 se define como: fr = f2 - f1 El producto de n imágenes se define como: La división de dos imágenes f1, f2 se define como: fr = f2 / f1 Donde f1 debe ser distinto de cero. 1.4.4 SEGMENTACIÓN La Segmentación de una imagen consiste en la aplicación de una serie de pasos (o algoritmo) que la particionan en un conjunto de regiones homogéneas y significativas, de modo que los píxeles en cada región posean una cantidad idéntica de propiedades o atributos (como por ejemplo, niveles de gris, contraste, valores espectrales o propiedades de textura). El resultado de la Segmentación es la identificación de regiones conectadas entre sí y no superpuestas [TIN05]. Matemáticamente la operación de Segmentación de una imagen R se define como: R = R1 U R2 U R3 U …Rn Donde Ri son las regiones resultantes para 0< i < n. 20 Dos técnicas ampliamente utilizadas en la Segmentación de imágenes son la Umbralización y los Operadores de Textura. 1.4.4.1 UMBRALIZACIÓN La técnica de Umbralización es un procedimiento que requiere de pocos recursos computacionales. Permite separar una imagen digital en regiones de interés mutuamente excluyentes a partir de un valor umbral definido por algún método [TIN05]. Para aplicarla, basta asignar a los píxeles de la imagen resultante una intensidad de color en función al conjunto de pertenencia definido para la imagen de entrada. Por ejemplo, supóngase que para una imagen en escala de grises se ha definido el umbral u=100 (0<= u<=255), los píxeles cuya intensidad i sea menor a u tendrán el valor v1, caso contrario tendrán el valor v2. Este algoritmo puede extenderse a múltiples umbrales diferenciando varias regiones, la función para n umbrales se define de la siguiente forma: Los umbrales pueden determinarse manual o automáticamente [RUS07]. El algoritmo de cálculo de umbral automático de Otsu se basa en el supuesto de que en la distribución de probabilidades del Histograma existen dos clases. En este sentido, el umbral óptimo debe maximizar la varianza de separación entre las clases y minimizar la varianza interna a cada clase [OTS79]. 1.4.4.2 OPERADORES DE TEXTURA Existen ocasiones en las que las regiones características no se definen a partir de intensidades de color, se constituyen por el contrario en base a patrones en la variación entre intensidades, lo que a menudo se conoce como texturas [RUS07]. En estos casos, no resulta conveniente considerar aisladamente la intensidad de color de un píxel para decidir la región a la que pertenece. Una estrategia que comúnmente se utiliza consiste en clasificar el píxel en función de la variación de la intensidad de color de la vecindad que lo incluye. Los operadores de textura se aplican siguiendo el mecanismo de ventana deslizante descrito para la convolución. Utilizan criterios estadísticos de dispersión como la varianza o el rango de variación en la vecindad para asignar al píxel central un valor. Se pueden aplicar varios criterios estadísticos para construir operadores de textura, utilizando igualmente diversos tamaños y formas de núcleos (cuadriláteros y circulares). Por ejemplo, en el operador Varianza se asigna al píxel central el valor de la varianza calculada para todos los píxeles que pertenecen en un instante dado al núcleo. El operador Rango, por su parte, asigna al píxel central la diferencia entre la intensidad máxima y la 21 intensidad mínima. En la Figura 7 se muestra el resultado de estos operadores al ser aplicados sobre la imagen del cuadro izquierdo. Figura 7: Operadores de Textura (tomado de [RUS07]) 1.4.5 OPERADORES LÓGICOS Las imágenes binarias separan los píxeles asignándolos a uno de dos conjuntos en base a alguna propiedad. La selección puede realizarse mediante umbralización de intensidades de brillo en escalas de grises o color RGB, también puede resultar del procesamiento de la textura u otra información. La meta de la binarización es separar las características del fondo, de modo que se pueda aplicar operaciones de conteo, medición y ajuste [RUS07]. Por lo general, a los píxeles de las regiones características se les asigna el valor 1 y al fondo el valor 0. En ocasiones, el resultado de la operación de segmentación no resulta correcto, sobre todo para imágenes realistas y complejas donde se clasifica erróneamente algunos píxeles de fondo como región de interés. Estos errores suelen ocurrir en los bordes de las regiones o dentro de éstas debido a la presencia de ruido en la captura de la imagen [RUS07]. Un grupo de herramientas bastante útil para solucionar este problema son los operadores lógicos o booleanos. Los operadores lógicos son cuatro: AND, OR, XOR y NOT. Los tres primeros combinan dos imágenes de entrada para producir una imagen de salida, mientras que el último solo requiere de una imagen de entrada. La Figura 8 ilustra cada una de estas operaciones. En la operación AND un píxel tendrá valor 1 en la imagen de salida si su valor para las dos imágenes de entrada es 1. En la operación OR un píxel tendrá valor 1 en la imagen de salida si su valor para al menos una imagen de entrada es 1. En la operación XOR un píxel tendrá valor 1 en la imagen de salida si tiene valor 1 para una sola imagen de entrada. Finalmente, el operador NOT invierte el valor del píxel para la imagen de entrada en la imagen de salida. 22 Figura 8: Operadores Lógicos (modificado de [RUS07]) 1.4.6 OPERADORES MORFOLÓGICOS Otra alternativa para corregir los errores resultantes del procedimiento de segmentación son los Operadores Morfológicos. El procesamiento morfológico de una imagen binaria es una operación que se realiza en el dominio espacial con el objetivo de modificar la estructura de las regiones características [PRA07]. Las propiedades geométricas más importantes de las imágenes binarias son: conectividad, área y perímetro [TIN05]. El análisis de cada una de ellas arroja información de gran utilidad para el procesamiento de la imagen. Por ejemplo, una región característica podría definirse en base a la conectividad entre los píxeles de una parte de la imagen; el área, puede servir como indicador de la proporción de una región con respecto al tamaño de la imagen mientras que el perímetro puede informar acerca de la forma de una región. Formalmente, la conectividad entre píxeles de una imagen binaria se define como: Un píxel P0 en la posición (i0,j0) está conectado a otro píxel Pn en la posición (in,jn) si y solo si existe un camino desde P0 a Pn entendido como una secuencia de puntos (i0, j0), (i1, j1) , … , (in, jn), tal que el píxel en la posición (ik,jk) es un vecino del píxel en la posición (ik+l, jk+l) y Pk=Pk+1 para todo k, 0<k<n-1 [TIN05]. Como puede verse en la Figura 9, en función a las características del problema es posible definir varios tipos de conectividad, lo que permite identificar regiones en la imagen (cuadro de la derecha). 23 Figura 9: Propiedad de conectividad en imágenes binarias La Dilatación y Erosión son operaciones morfológicas fundamentales que se basan en la propiedad de conectividad entre un píxel y sus vecinos. A grandes rasgos podría decirse que la Dilatación es una operación que permite que una región crezca uniformemente, mientras que con la Erosión, la región se reduce uniformemente [PRA07]. Para llevar a cabo estas operaciones se define un patrón de comparación (o elemento estructurante), que al igual que en la operación de convolución, consiste en un núcleo situado sobre la región que rodea al píxel de interés. Si los píxeles cumplen lógicamente con la conectividad del elemento estructurante, al píxel central se le asignará el valor 1 para la Dilatación y el valor 0 para la Erosión. Si no se cumple con la conectividad del elemento estructurante, el píxel central conservará su valor tanto para la Erosión como para la Dilatación. En la Figura 10 puede verse el efecto de estas operaciones sobre una imagen binaria. Figura 10: Operaciones morfológicas de Dilatación y Erosión. 24 CAPITULO II: MARCO APLICATIVO 2.1 PLANTEAMIENTO DEL PROBLEMA Las dificultades inherentes a las subpruebas morfológicas, llevadas a cabo como parte del Espermograma, hacen que en la práctica sea deseable lograr una automatización de este proceso. En efecto, se trata de una actividad que por sus características resulta vulnerable a la subjetividad y fatiga del examinador, lo que cuestiona la confiabilidad de los resultados que arroja (en ocasiones muestra baja correlación entre juicios de expertos) [KAT86]. La clasificación morfología y el conteo espermático son actividades de naturaleza iterativa. Inicialmente, el experto prepara las muestras y las sitúa en el microscopio. Luego, para realizar la prueba, utiliza una técnica de desplazamiento en la escena en forma de “S” que busca evitar considerar varias veces al mismo elemento. A medida que se posiciona en la escena, registra en uno de cuatro contadores asignados a los dedos de la mano (índice, medio, anular y meñique) el resultado de la clasificación del elemento. Las cuatro categorías que registra incluyen: espermatozoide normal, defecto de cabeza, defecto de pieza intermedia y defecto de cola. Este procedimiento se repite hasta completar un total de 200 espermatozoides [OMS01] El procedimiento descrito puede ser objeto de varias fuentes de error. En este sentido, podría ocurrir que el examinador se equivoque estimando la morfología del espermatozoide, o que clasifique correctamente al espermatozoide, pero, debido al cansancio, lo registre erróneamente en otro contador. Finalmente, por distracción o fatiga, podría perderse la secuencia de desplazamiento en la escena y considerarse por duplicado algún elemento. Además de las fuentes de error presentes, otro aspecto que merece ser señalado se relaciona con la precisión del reporte morfológico que genera el experto. Específicamente, y como sólo dispone de cuatro categorías de clasificación mutuamente excluyentes, se pierde información cuando ocurren defectos en más de una categoría. Por otra parte, dentro de un mismo grupo existen varios tipos de defectos que el experto no registra para agilizar el procedimiento. Si fuera posible mantener el registro específico de los defectos encontrados, probablemente se logre un análisis cualitativo más preciso y detallado. Por los factores antes señalados, resulta útil proveer a estos profesionales de mecanismos auxiliares que les permitan realizar el trabajo con mayor eficiencia, mayor precisión y menor esfuerzo. En consecuencia, el proyecto ANALISE desarrollado en el Laboratorio de Inteligencia Artificial conjuntamente con la Escuela de Bioanálisis de la Universidad Central de Venezuela, se plantea como objetivo construir un sistema multi-agente cuya finalidad sea apoyar a los profesionales de las ciencias de la salud en el análisis de la calidad del semen humano [RAM07B]. Este proyecto incorpora como uno de sus módulos o agente constituyente uno de clasificación morfológica automática de espermatozoides presentes en imágenes digitalizadas de las escenas que analiza el experto. 25 2.1.1 ANTECEDENTES La automatización de procedimientos que tengan que ver con la salud (diagnóstico y clasificación) ha tenido, afortunadamente, un interés generalizado en la computación emergente. En particular el estudio y clasificación morfológica automática de estructuras microscópicas ha sido un campo de intensa investigación. Los trabajos en el área reflejan diversas estrategias de abordaje. En este sentido, una primera corriente de investigación ha consistido en aplicar técnicas de procesamiento digital de imágenes para segmentar regiones de interés. El objetivo de este procedimiento es eliminar ruido así como objetos no deseados. Las estructuras resultantes se codifican posteriormente en vectores de características y se propagan a través de una red neuronal, que en última instancia los clasificará morfológicamente. Siguiendo esta estrategia, se ha abordado, por ejemplo, la clasificación de glóbulos blancos basada en operaciones morfológicas (básicamente erosión y dilatación) [THE03]. También se ha automatizado la identificación de la composición botánica de la dieta del ganado caprino recurriendo a técnicas de procesamiento de imágenes como conversión de color RGB a escala de grises, ecualización de histograma y umbralización a tres niveles, utilizando para la clasificación una red neuronal con retropropagación del error [LAR04]. En ocasiones, la calidad de la imagen a procesar es baja debido a la presencia de ruido. Para estos casos el conocimiento heurístico de la morfología en análisis resulta muy importante, ya que permite economizar el procesamiento destinado a mejorar la calidad y centrarse en las regiones de interés. De hecho, algunas estrategias incorporan la probabilidad de pertenencia de los píxeles a una región característica en función de su localidad espacial, por ejemplo, para la detección de células [BAK04]. La simple identificación inicial de las características en la imagen que se desea procesar, sin embargo, se convierte en un problema objeto de estudio. En efecto, existen investigaciones que se dedican principalmente a estimar los atributos que mejor representan al objeto que se desea segmentar. Por ejemplo, en un estudio destinado al reconocimiento de células en la sangre de pacientes leucémicos [MAR06], se identifican cuatro fuentes de atributos para los objetos: geométricos (radio, perímetro, área, simetría, etc.), de textura (interrelaciones entre arreglos espaciales de los píxeles de la imagen), de distribución de intensidades de color (análisis de histograma) y morfológicos (operaciones morfológicas). En vista de esta complejidad han surgido otras estrategias. Se ha intentado integrar técnicas de inteligencia artificial al proceso de segmentación entrenando una red neuronal para reconocer los objetos de interés. El procedimiento consiste en: 1) extraer de la imagen todos los posibles rectángulos de píxeles (cuyo tamaño se determina mediante el conocimiento heurístico de las dimensiones de los objetos buscados) siguiendo un mecanismo de ventana deslizante, y, 2) las sub-imágenes resultantes se codifican en vectores y se pasan a la red que identificará las regiones características presentes [LON05]. Este procedimiento tiene la ventaja de simplificar el diseño de la investigación ya que prescinde del uso de técnicas de procesamiento de imágenes, pero requiere que los objetos a segmentar tengan dimensiones y aspecto uniforme. 26 Sin embargo, existen casos como el de los espermatozoides, en los que las características a clasificar presentan forma, dimensiones y estructura variante lo que dificulta la aplicación de conocimiento heurístico para diferenciarlas desasistidamente. De hecho, algunos trabajos proponen soluciones semi-automatizadas donde se pide al usuario, o bien definir los contornos de las estructuras [KAT86], o marcar los que detecte la aplicación erróneamente [BUE02]. Esta estrategia tiene como ventaja la minimización de los errores cometidos por falsos reconocimientos, pero resulta muy incómoda y poco eficiente cuando la tarea debe repetirse un gran número de veces. Las dificultades asociadas al problema de la automatización, han dirigido el foco de interés de algunas investigaciones hacia el análisis de un subconjunto de la morfología espermática. En efecto, en un estudio que se propuso estimar la calidad del semen de verraco a partir de la caracterización de las cabezas de espermatozoides, se utilizó dos tipos de descriptores de imagen basados en momentos estadísticos (momentos de Hu y Zernike), y una red neuronal Perceptron multicapa con función de activación sigmoidal [ALE04]. Los resultados indican que los momentos Hu constituyen características más relevantes para clasificar estas estructuras, pero no se reporta el error cometido durante el proceso de clasificación automática. En otro estudio, cuyo propósito fue la clasificación de cabezas de espermatozoides humanos, se procesaron imágenes en el dominio frecuencial construyendo un vector característico a partir de los coeficientes de Fourier [LIN94]. Esta información se ingresaba a una red neuronal con retropropagación del error, que en última instancia los clasificaba en normales y anormales. La investigación reporta resultados con un margen de error del 25%, afirmando que se trata de una proporción equivalente a los errores cometidos por humanos. Una investigación destinada a comparar el uso de descriptores de textura (estadísticos de segundo orden sobre matriz de coocurrencia), con descriptores geométricos de cabezas de espermatozoides de verracos a través de un clasificador k-vecinos, reporta una tasa de aciertos “no muy alta” a pesar de no especificarla [SAN05]. No obstante, los resultados indican que los descriptores de textura resultaron más efectivos que los descriptores geométricos. En la Universidad Central de Venezuela, se llevo a cabo un estudio donde se propuso desarrollar un modelo de clasificación automático de la morfología de cabezas de espermatozoides, basado en una red neuronal Perceptron multicapa y el procesamiento digital de imágenes [CAL07]. La investigación reporta la tasa de 28% de identificación errónea de células espermáticas, resultando considerablemente mayor el error que se comete al distinguir entre cabezas normales y anormales (entre 40% y 57%). Dado que la complejidad de estas operaciones no es equivalente (se presentan mayores discrepancias entre los juicios de expertos al momento de clasificar el espermatozoide como normal o anormal, en comparación a la identificación de este), es posible que los resultados se vean afectados, aparte de los errores cometidos durante el procesamiento de las imágenes, por errores introducidos por el experto durante la fase de entrenamiento del modelo de clasificación, ya que recurre a un paradigma de aprendizaje de tipo supervisado. 27 Tal vez la investigación que mejores resultados reporta considera el estudio morfológico de la cabeza y pieza intermedia del espermatozoide [CAR07]. Para lograr la automatización, se recurrió al uso de procesamiento digital de imágenes prescindiendo de técnicas de inteligencia artificial. La clasificación de las estructuras resultantes se realizó mediante la conversión entre distancias de píxeles y micrómetros comparando los valores con los rangos descritos como normales por la OMS. Los resultados indican una tasa de acierto de 95,78% para los espermatozoides presentes, 89,5% para cabezas; 88,9% para acrosoma; 88,9% para post-acrosoma y 85% para pieza intermedia. Sin embargo, el procedimiento requiere de ciertas condiciones como alta resolución de las imágenes (3072x2304) y factor de magnificación microscópica (Zoom) de 600X (por lo general los expertos utilizan 100X). Por otra parte, las imágenes utilizadas en las pruebas correspondieron a escenas que en promedio contenían 1,34 espermatozoides (216 imágenes con 285 espermatozoides), lo que en la práctica convierte a este procedimiento en semi-automático ya que la captura de las imágenes funciona como una segmentación inicial. Como puede verse, el debate en torno a la automatización de la clasificación morfológica de espermatozoides y células en general no resulta concluyente. Evidencia un área de investigación activa y compleja cuyos productos se sitúan en varios niveles de análisis. En este sentido, una primera vertiente analítica tiene que ver con la estimación del mejor método para identificar las células presentes, lo que resulta determinado en gran medida por consideraciones heurísticas. En general se observan tres tipos de aproximaciones: a) usar técnicas de Inteligencia Artificial, b) usar técnicas de procesamiento digital de imágenes y c) recurrir a un enfoque intermedio entre las dos anteriores. La segunda categoría de análisis tiene que ver con la determinación del tipo de características que mejor representan las células espermáticas y microscópicas en general. Algunos trabajos sugieren descriptores de tipo estadísticos, otros sugieren criterios morfológicos y así sucesivamente hasta incluir por extensión a los criterios de textura, intensidad de color y geométricos. Finalmente, la determinación del modelo de clasificación se constituye en la tercera categoría de análisis. Las investigaciones revisadas reportan una gran variedad de enfoques y paradigmas de clasificación para la simulación del conocimiento humano. 2.1.2 PROPUESTA DE SOLUCIÓN Los trabajos revisados en el campo de la automatización de procesos diagnósticos de estructuras microscópicas, sugieren un área compleja, que para su abordaje requiere ser prudentemente dividida en al menos tres sub-problemas o pasos lógicos, a saber: a) Identificación de espermatozoides presentes, b) Extracción de características y c) Clasificación morfológica. Como aporte a la solución del problema, la presente investigación aborda los dos primeros estadios del procesamiento. El tercer estadio, dada la gran cantidad de modelos de clasificación y representación artificial de pericias humanas existentes, además de las 28 características específicas al conocimiento que se desea simular se constituye por su complejidad en un tópico que merece ser abordado independientemente. Para lograr la identificación y extracción de características automáticas de las células espermáticas, el presente trabajo se propone emprender la construcción de una aplicación o programa, que basado en una combinación de técnicas de procesamiento digital de imágenes, reciba como entrada imágenes microscópicas del líquido seminal humano, produciendo como salida un vector de características morfológicas automático de los espermatozoides presentes en la escena. Específicamente, y de acuerdo a los objetivos propuestos por el proyecto ANALISE, los productos de esta investigación operan en dos vertientes: Por una parte, integran el módulo de clasificación morfológica del proyecto llevando a cabo los pasos a y b (ver introducción). Por otra parte, se consiste en una herramienta de soporte que, a través de una interfaz gráfica, permite la construcción de vectores que incorporan tanto las características automáticamente extraídas como las categorías morfológicas asignadas a tales espermatozoides por los expertos, lo que permitirá la estimación del modelo que finalmente clasificará desasistidamente los espermatozoides presentes. 2.2 OBJETIVOS El objetivo de la presente investigación consiste en: 2.2.1 GENERAL Desarrollar una herramienta para la identificación y extracción automática de características de células espermáticas humanas, que funcione a partir de la definición de un modelo basado en técnicas de procesamiento digital de imágenes. 2.2.2 ESPECÍFICOS - Diseñar un algoritmo de segmentación que aplicado a imágenes de escenas microscópicas del líquido seminal humano, permita identificar, con el menor margen de error posible, los espermatozoides presentes. - Diseñar un algoritmo de extracción de características que permita medir y codificar las distintas estructuras presentes en las regiones resultantes del procedimiento de segmentación, que opere con el menor margen de error posible. - Desarrollar una librería de procesamiento que codifique los algoritmos de segmentación y extracción de características, que pueda ser fácilmente incorporada a la plataforma multi- agente ANALISE. - Desarrollar una aplicación interactiva que facilite a los expertos procesar las imágenes de las escenas de espermatozoides, así como introducir etiquetas de clasificación con el objetivo de construir vectores de características para estimar modelos de clasificación. 29 2.3 PROCESAMIENTO DE IMÁGENES DE ESPERMATOZOIDES HUMANOS A continuación se describen las fases de adquisición, pre-procesamiento, segmentación y extracción de características de las imágenes analizadas. 2.3.1 ADQUISICIÓN DE IMÁGENES Siguiendo las características del entorno de trabajo del experto, se utilizó un banco de 294 imágenes capturadas desde un microscopio Leica modelo DM LS2. El procedimiento consistió en explorar cada lámina con el objetivo de aumento 10x posicionando la muestra en las regiones con menor densidad de espermatozoides para evitar agrupamientos. Una vez ubicadas las regiones poco congestionadas, se utiliza el objetivo de aumento 100x. Siguiendo la técnica de recorrido de escena en forma de “S”, se capturan las imágenes con la ayuda de una cámara Cannon modelo PowerShot S50 de 5.0 mega píxeles. Este procedimiento se repite hasta lograr al menos 200 espermatozoides, por lo tanto, el número de escenas para cada lámina dependerá de la concentración espermática de la muestra. En esta investigación se disponía de láminas en las que esta condición se obtenía con un grupo de 6 a 44 imágenes por lámina. Finalmente, la resolución de las imágenes fue 1600x1200 píxeles, tomadas en las mismas condiciones de iluminación que utiliza el experto al momento de analizar las muestras. 2.3.2 PRE-PROCESAMIENTO DE IMÁGENES En general, los trabajos de investigación en el área sugieren que para facilitar y optimizar la aplicación de técnicas de segmentación, así como con la mayoría de las técnicas de procesamiento disponibles, resulta conveniente operar sobre la imagen en un espacio de color unidimensional, y las imágenes de los espermatozoides se registraron en el espacio de color RGB. La primera decisión que se debía tomar era determinar la mejor estrategia a seguir para convertir de color RGB a escala de grises con la menor pérdida de información posible. En las referencias revisadas se señalan varias estrategias para realizar la conversión, siendo las más comunes las dos siguientes: a) tomar el promedio de los tres componentes RGB, o b) tomar proporciones distintas de cada componente basado en estudios médicos sobre los receptores de color en la visión humana. Estas estrategias se probaron y arrojaron resultados similares. No obstante, un abordaje menos común, que dio mejores resultados, consistió en analizar el histograma de cada canal y determinar los canales que aportaban mayor información de contraste a la escena. De acuerdo a este análisis, los canales rojo y verde aportaban de manera natural gran cantidad de información de contraste, a diferencia del canal azul. La Figura 11 muestra una imagen de la escena microscópica vista desde cada canal RGB. Los algoritmos de segmentación, por consiguiente, operan utilizando como entrada la imagen en escala de grises replicando el canal rojo o el canal verde; se decidió prescindir del canal azul. 30 Figura 11: Comparación entre canales RGB Una vez convertida la imagen original a dos imágenes en escala de grises, se aplicó la técnica de umbralización a dos niveles (binarización) sobre la imagen del canal rojo (por ser este el que presentaba la mayor dispersión en la distribución de frecuencias del histograma) utilizando un umbral global calculado a partir del método de Otsu [OTS79]. La imagen binarizada resultante permitió construir dos estructuras matriciales: la Máscara del Área de Procesamiento (MAP) y la Máscara de cabezas de Espermatozoides (MCE). La MAP cumple la función de delimitar la región a procesar, excluyendo los bordes negros que caracterizan las imágenes microscópicas. Se trata de una matriz de valores binarios que indica si el píxel i,j debe o no ser procesado por los algoritmos de segmentación. Adicionalmente, al calcular esta matriz se tuvo especial cuidado en guardar las posiciones limítrofes horizontales que restringen el área de procesamiento. La idea es evitar que los algoritmos de segmentación desperdicien iteraciones en los píxeles muy cercanos a los bordes horizontales. En la Figura 12 se muestra un ejemplo de esta estructura. Figura 12: Máscara del Área de Procesamiento 2.3.3 SEGMENTACIÓN DE IMÁGENES El algoritmo de segmentación resultó complejo y requirió de la combinación de varias técnicas de procesamiento digital de imágenes, así como de la definición de algunas estructuras de datos matriciales que se enumeran en la Tabla 5. A continuación se describe la secuencia de pasos necesaria para llevar a cabo este procedimiento. 31 Tabla 5: Estructuras matriciales para realizar la segmentación Identificador Descripción MAP Máscara del Área de Procesamiento. Define la región a procesar MCE Máscara de Cabezas de Espermatozoides. Almacena las posibles regiones que corresponden a cabezas de espermatozoides MNCA Máscara de Núcleo de Círculo y Anillo. Almacena las regiones que corresponden a posibles espermatozoides incluyendo cabeza, PI y cola MCOE Máscara de Contornos de Espermatozoides. Guarda los contornos de las regiones presentes en la MNCA 2.3.3.1 CONSTRUCCIÓN DE LA MÁSCARA DE CABEZAS DE ESPERMATOZOIDES (MCE) La Máscara de Cabezas de Espermatozoides (MCE) almacena las regiones de la imagen que corresponden a posibles cabezas de espermatozoides. Para construir esta estructura, se aplicó el algoritmo de Búsqueda en Profundidad o DFS (por sus siglas en inglés Depth- First Search) sobre la imagen binarizada del canal rojo. Este algoritmo permite recorrer todos los nodos de un grafo de forma ordenada mas no uniforme. La adaptación del DFS al problema se logra considerando la imagen como un grafo g(v,e) donde |v| es el conjunto de píxeles que la conforman y |e| se define en base a la conectividad de los 8 píxeles vecinos a cada píxel (exceptuando el caso de los píxeles ubicados hacia los bordes de la imagen). A medida que se recorren los nodos del grafo que comparten el valor 1, se guardan tanto los límites (izquierdo, derecho, inferior y superior) de cada región, como el área en términos de número de píxeles recorridos. Para construir la MCE, se descartan las regiones con dimensiones inferiores a 18x18 píxeles o superiores a 55x55 píxeles (heurísticamente calculado), al ser recorridas nuevamente por DFS cambiando en tales posiciones el valor a 0. En la Figura 13 se muestra un ejemplo de MCE, puede observarse que la pequeña mancha presente en el cuadro intermedio se remueve a través de este mecanismo en el cuadro derecho. Figura 13: Máscara de Cabezas de Espermatozoides (MCE) 32 http://www.cs.mcgill.ca/%7Ecs251/OldCourses/1997/topic26/ http://www.cs.mcgill.ca/%7Ecs251/OldCourses/1997/topic26/ 2.3.3.2 PROPUESTA DE OPERADOR DE TEXTURA NÚCLEO DE CIRCULO Y ANILLO (NCA) En ocasiones, como se observa en la Figura 13, la construcción de la MCE presenta algunos problemas dado que las cabezas de los espermatozoides próximos entre sí suelen fusionarse en una misma región. Este artefacto resulta inconveniente ya que dificulta la segmentación correcta de las estructuras; por esta razón, se hizo necesario diseñar un mecanismo para separarlos que además de clasificar las regiones mediante la intensidad del píxel actual, considerase la vecindad en la que éste se inserta. Las técnicas de segmentación por operadores de textura asignan un valor al píxel central en función del análisis de la vecindad que lo incorpora. Sin embargo, los operadores del tipo rango, varianza y media, entre otros, no arrojaban los resultados esperados, por lo que se propuso un nuevo operador de textura que permitiera separar los espermatozoides en su totalidad del fondo. La estructura del operador diseñado se define a partir de dos regiones. La región A está conformada por un círculo centrado en el píxel de interés y radio R. La región B consiste en un anillo con radio interno R y radio externo S. Dada la forma del operador resultante, se le denominó Operador de Círculo y Anillo. La idea consistió en comparar el promedio de intensidades de gris de la región A, con el promedio de intensidades de gris de la región B. La segmentación se logra mediante el conocimiento heurístico de que los espermatozoides son más oscuros que el fondo, de modo que si el promedio de A es menor al promedio de B, al píxel central se le asigna el valor 1, caso contrario se le asigna el valor 0. La Figura 14 muestra una representación del NCA. Figura 14: Núcleo de Círculo y Anillo 2.3.3.3 CONSTRUCCIÓN DE LA MÁSCARA DE NÚCLEO DE CÍRCULO Y ANILLO (MNCA) La aplicación de la técnica de segmentación por NCA hizo posible separar con mayor precisión los espermatozoides cercanos entre si, al procesar la imagen en escala de grises correspondiente al canal verde (la imagen del canal rojo presentaba transiciones suaves y 33 menor contraste). Como resultado, se construyó una nueva estructura matricial a la que se denominó Máscara de Núcleo de Círculo y Anillo (MNCA). Para construir la MNCA se deben realizar dos operaciones. El primer paso consiste en binarizar utilizando NCA con radio R y S de 3 y 5 píxeles respectivamente. Se decidió utilizar estos valores ya que se observó que a mayor tamaño de R y S menor precisión en la segmentación, dado que los espermatozoides cercanos se unían producto del desbordamiento de sus contornos. En el caso de valores R y S muy pequeños, por el contrario, los contornos de los espermatozoides no cerraban adecuadamente. El segundo paso consiste en remover mediante DFS las regiones cuya dimensión sea inferior a 25x25 píxeles (calculado heurísticamente). El propósito de la MNCA es almacenar las estructuras de los espermatozoides como un conjunto, es decir, incluyendo cabeza, pieza intermedia y cola (en el caso de estar presentes). La Figura 15 muestra un ejemplo de MNCA. Puede observarse en el cuadro intermedio que la segmentación por NCA resalta algunas regiones del fondo producto de pequeñas variaciones uniformes en la intensidad de gris. Estas regiones no corresponden a espermatozoides. Como puede verse en el cuadro de la derecha, se intenta corregir este error aplicando el algoritmo DFS. Figura 15: Máscara de Núcleo de Círculo y Anillo (MNCA) 2.3.3.4 CONSTRUCCIÓN DE LA MÁSCARA DE CONTORNOS DE ESPERMATOZOIDES (MCOE) Las estructuras MCE y MNCA, almacenan información complementaria acerca de la ubicación y forma de los espermatozoides respectivamente. No obstante, como ya se ha mencionado, la MCE presenta errores típicos del algoritmo de umbralización a dos niveles que pueden ser corregidos con la información que guarda la MNCA. Para ello, se debe construir una cuarta estructura matricial a la que se denominó Máscara de Contornos de Espermatozoides (MCOE). El procedimiento se lleva a cabo en tres pasos. Primero, se debe aplicar la operación de convolución sobre la MNCA utilizando el núcleo horizontal, vertical y diagonal de Prewitt de 3x3 (en ambos sentidos) para detectar contornos. A la imagen resultante, se le aplica dos veces la operación morfológica de erosión. En la primera aplicación se erosiona el píxel central si el píxel a la izquierda tiene valor 1, mientras que para la segunda aplicación se erosiona el píxel central si el píxel superior tiene valor 1. Finalmente, se aplica DFS para 34 eliminar las regiones de la imagen cuyas dimensiones sean inferiores a 25x25 píxeles (heurísticamente determinado) ya que corresponden a algunos contornos internos de la cabeza del espermatozoide. En la Figura 16 se muestra de izquierda a derecha los pasos descritos para construir la estructura MCOE. Figura 16: Máscara de Contornos de Espermatozoides (MCOE) 2.3.3.5 EXTRACCIÓN DE CAJAS CONTENEDORAS ORIENTADAS Una vez que se dispone de las estructuras MCE y MCOE se aplica el operador morfológico XOR entre ambas. A la imagen resultante, se remueven tanto las regiones cuya área sea inferior a 200 píxeles (heurísticamente calculado) utilizando DFS, como aquellas que no sean intersecadas por la MNCA (ya que posiblemente corresponden a manchas u otro tipo de células). Como puede verse en la Figura 17, este procedimiento facilita la depuración y separación de las cabezas de los espermatozoides que se hallan en contacto. A pesar de que las cabezas resultantes pierdan algunos píxeles de contorno (que serán repuestos en estadios posteriores del procesamiento), se facilita la estimación de las Cajas Contenedoras Orientadas (CCO), así como una primera aproximación al cálculo de los ejes de orientación del espermatozoide. . Figura 17: Separación de cabezas fusionadas Durante la aplicación de DFS para la remoción de las regiones pequeñas, se debe tomar la precaución de guardar los límites (izquierdo, derecho, superior e inferior) de cada región. Estas coordenadas definen un rectángulo de procesamiento que restringe el área de cálculo para la recta de mayor longitud que pase por la cabeza e incluya el centro del rectángulo. Las CCOs se construyen a partir del ángulo formado entre esta diagonal mayor provisional y el eje de las abscisas. Una vez calculado el ángulo de inclinación, al rotar las regiones en 35 sentido de las agujas del reloj, se facilita el cálculo de las dimensiones ajustadas del objeto incluyendo la diagonal menor parcial. La estructura resultante se define, por consiguiente, mediante las coordenadas del menor rectángulo que contenga al objeto. Sin embargo, debido al hecho de que se calcula a partir de la MCE, y ésta solo almacena las posibles cabezas de los espermatozoides; se amplían las coordenadas 10 píxeles hacia ambos límites de la diagonal mayor parcial para intentar incorporar heurísticamente la pieza intermedia del espermatozoide. Finalmente, se deben rotar las coordenadas limítrofes del objeto en el sentido contrario a las agujas del reloj. En la Figura 18 se ilustra este procedimiento. Figura 18: Cálculo de Cajas Contenedoras Orientadas Una vez calculadas las diagonales parciales, se pueden realizar nuevos descartes o filtrado de las estructuras. En efecto, se eliminan las CCOs que cumplan con alguno de los siguientes criterios: 1) Las diagonales no se cruzan en un punto común, 2) La diagonal parcial menor, luego del procesamiento, presenta mayor longitud que la diagonal parcial mayor en una proporción de 1.1, y 3) Dos o más vértices de los cuatro que definen las diagonales resultan contenidos en otra CCO de mayores dimensiones. En el cuadro de la derecha de la Figura 19 se observan ejemplos de estos 3 casos. Figura 19: Criterios de descarte de regiones de acuerdo a las diagonales parciales 2.3.3.6 SEPARACIÓN DE ESTRUCTURAS DEL ESPERMATOZOIDE Luego de la construcción de las CCOs, el siguiente paso consiste en identificar las estructuras de los espermatozoides contenidos en las regiones delimitadas. Este procedimiento se logra aplicando nuevamente la técnica de umbralización, pero esta vez utilizando dos umbrales locales calculados para cada CCO. Para el cálculo de estos 36 umbrales se toma la intensidad de gris promedio en la región delimitada por la CCO y se multiplica, siguiendo un criterio heurístico, por 0,6 para obtener el umbral 1 y 1,15 para obtener el umbral 2. Estas proporciones se obtuvieron luego de realizar varias pruebas y en general ofrecieron mejores resultados para diferenciar las estructuras presentes. Como resultado del procedimiento descrito, se obtienen regiones definidas a tres niveles de intensidad de gris donde el color negro corresponde a la Región post-acrosómica, el color gris identifica tanto al acrosoma como a la pieza intermedia y el color blanco representa el fondo. Como puede observarse en la Figura 20, se requiere corregir el efecto de desbordamiento de las regiones, lo que se logra en tres pasos lógicos: 1) Aplicar el operador lógico XOR entre la MCOE y la imagen trinarizada, 2) Remover las regiones pequeñas hacia los bordes de las estructuras y 3) Aplicar el operador lógico OR entre la imagen resultante y la MNCA para volver a agregar los píxeles del borde. Figura 20: Umbralización de CCO a tres niveles No obstante, y a pesar de haber corregido el problema de desbordamiento de la umbralización a tres niveles, los resultados de la operación no resultan satisfactorios ya que la pieza intermedia y la región acrosómica de la cabeza comparten la misma categoría, como consecuencia de presentar intensidades de gris semejantes en la imagen original. Para solucionar este problema, se hizo necesario definir un conjunto de reglas heurísticas (descritas en la Tabla 6) que al ser aplicadas pudieran diferenciar entre estas estructuras. En la Figura 21 se muestra de izquierda a derecha ejemplos de la aplicación de cada una de las cuadro reglas. Tabla 6: Heurísticas de decisión para diferenciar entre PI y acrosoma Nro. Regla Decisión 1 El contorno definido en la MCOE corta alguno de los bordes de la CCO en dirección a la diagonal mayor. El lado de corte corresponde a la PI. 2 El contorno definido en la MCOE no corta los bordes de la CCO en dirección a la diagonal mayor y sobra considerable espacio hacia alguno de los lados. El lado sobrante corresponde al acrosoma. 3 El contorno definido en la MCOE corta ambos o ningún borde en dirección a la diagonal mayor de la CCO. El lado más ancho corresponde al acrosoma. 37 (Continuación de Tabla 6) 4 Hay una única región gris. Si es más ancha que la región post-acrosómica se trata del acrosoma, caso contrario de la PI Figura 21: Ejemplos de heurísticas para diferenciar entre PI y acrosoma Como puede verse en los cuadros 1 y 2 de la Figura 21, para la aplicación de las dos primeras reglas, dado que la imagen segmentada se procesa rotada hasta alinear con el eje de las abscisas, se recorre la matriz de píxeles en sentido horizontal ubicando las posiciones de los límites laterales del contorno. En el caso de las dos últimas reglas (cuadros 3 y 4), se recorre la matriz en sentido vertical, ubicando el ancho máximo de la mitad izquierda y derecha. Las posiciones y medidas obtenidas permiten, en última instancia, la aplicación de las reglas heurísticas. Las estructuras de datos descritas anteriormente permiten, en conjunto, lograr la segmentación de los espermatozoides presentes en las imágenes. En general, y a modo de síntesis, los pasos necesarios para realizar este procedimiento son los siguientes: 1) Calcular un umbral global según el método de Otsu. 2) Binarizar la imagen del canal rojo. 3) Construir la MAP. 4) Construir la MCE. 5) Construir la MNCA. 6) Construir la MCOE. 7) Remover las regiones de la MCE que no intersequen la MNCA. 8) Separar las cabezas muy cercanas aplicando XOR entre la MCE y la MCOE removiendo las regiones pequeñas. 9) Calcular las diagonales mayores y menores parciales. 10) Calcular las Cajas Contenedoras Orientadas. 11) Filtrar las CCO analizando el cruce de las diagonales. 12) Umbralizar a tres niveles las áreas definidas por las CCOs. 13) Corregir el efecto de desbordamiento aplicando XOR entre la imagen umbralizada y la MCOE removiendo las regiones pequeñas. 14) Aplicar las cuatro reglas heurísticas para identificar el acrosoma y la PI. 38 2.3.4 EXTRACCIÓN DE CARACTERÍSTICAS Como resultado del procedimiento de segmentación, se guardan por separado las imágenes rotadas (alineadas con el eje de las abscisas) de las posibles estructuras a ser consideradas como espermatozoides. El siguiente paso consiste, por lo tanto, en extraer las características de cada una de estas regiones. Siguiendo los criterios de la OMS para clasificar morfológicamente cabezas de espermatozoides humanos, se decidió tomar como variables el área de la región acrosómica, post-acrosómica, así como el área total de la cabeza, calculadas utilizando DFS. Se cree que estos criterios permiten determinar la presencia de defectos de tamaño (macrocéfalo o microcéfalo). Adicionalmente, facilitan la detección de defectos relacionados a la proporción entre el área de las regiones (se considera una cabeza normal si la región acrosómica ocupa entre el 40% y el 70% del tamaño total [OMS01]). Otro grupo de defectos relacionado a la cabeza tiene que ver con la forma. Para estimar qué tan ovalada resulta la cabeza, se registra el tamaño de sus ejes de orientación (horizontal y vertical), donde la relación entre éstos ofrece una idea acerca de la elipticidad de la estructura. Para el cálculo de los ejes, se recorre la imagen horizontal y verticalmente guardando la máxima cantidad de píxeles contiguos en cada sentido que pertenezcan a la región de la cabeza. En la Figura 22 se ilustra la forma de calcular estos ejes, se observa que para el cálculo del eje horizontal se trazan rectas paralelas a las abscisas por cada fila de la matriz, mientras que para el cálculo del eje vertical se trazan rectas paralelas a las ordenadas por cada columna de la matriz. Figura 22: Cálculo de eje horizontal y vertical de la cabeza Sin embargo, esta relación no registra la presencia de deformaciones o anormalidades. Para estimar este tipo de defectos, se calcula el perímetro de la cabeza contando los píxeles del borde y se compara esta medida con el perímetro de la elipse definida a partir de los ejes. La Figura 23 ilustra este procedimiento. Se cree que mientras mayor sea la diferencia entre ambas medidas, mayor será la deformación de la cabeza ya que el contorno será más irregular. 39 Figura 23: Cálculo de perímetro de la cabeza y perímetro de elipse ideal Otra medida del grado de deformación se logra a través del cálculo de la diferencia en píxeles entre la elipse ideal y el contorno real. Esta diferencia se calcula dibujando la elipse en una matriz auxiliar y contando en valor absoluto la distancia de un píxel de la elipse con respeto a su homólogo en el contorno de la cabeza. Se cree que a menor ajuste del contorno a la elipse ideal, más irregular resulta la forma de la cabeza. En la Figura 24 se ilustra este procedimiento, se observa en el cuadro de la derecha que la diferencia calculada corresponde al área localizada entre la cabeza y la elipse ideal. Figura 24: Diferencia entre contorno real y elipse ideal Para analizar el defecto de inserción asimétrica de la pieza intermedia, se decidió calcular el ángulo de inserción (en grados) entre el eje horizontal de la cabeza y la PI. Una vez obtenido el eje horizontal, el procedimiento consiste en trazar una recta que pase por el punto de inicio de esta diagonal y la ordenada media de la abscisa limítrofe de la pieza intermedia. En la Figura 25 se ilustra el algoritmo, el ángulo calculado puede observarse en la ampliación del cuadro de la derecha. Figura 25: Cálculo de ángulo de inserción de PI 40 El ancho máximo de la PI, permite, por su parte, estimar defectos como la presencia de gota citoplasmática y Cuello engrosado. Esta medida se calcula recorriendo la imagen verticalmente guardando la máxima cantidad de píxeles contiguos que pertenezcan a la PI. Como puede verse en el ejemplo del cuadro de la derecha de la Figura 26, la recta más cercana a la región post-acrosómica corresponde a la máxima anchura de la PI. Figura 26: Cálculo de ancho máximo PI Finalmente, para el caso de cabezas sueltas en la escena, se creyó conveniente representar en una variable la presencia o ausencia de la PI cuando la región correspondiente resultaba despreciable en término de área (menor a 5 píxeles). En total se definió un conjunto de 13 variables para construir el vector de características. En la Tabla 7 se enumeran y definen estos parámetros morfológicos. Tal como se ha señalado, algunas de estas características no guardan relación directa con los criterios formales de clasificación de la OMS, no obstante, operan como variables auxiliares, que combinadas de la manera apropiada, hacen factible su clasificación. La Figura 27 ilustra los parámetros considerados. Tabla 7: Aspectos morfológicos evaluados Parámetro Descripción Área cabeza Número de píxeles contenidos en la región de la cabeza. Área acrosoma Número de píxeles contenidos en la región acrosómica. Área post-acrosoma Número de píxeles contenidos en la región post-acrosómica. Eje horizontal cabeza Longitud en píxeles del eje horizontal de la cabeza. Eje vertical cabeza Longitud en píxeles del eje vertical de la cabeza. Diferencia Ei-Cr Diferencia en píxeles entre contorno real y contorno de elipse ideal calculada a partir de los ejes de la cabeza. Elipticidad División entre eje horizontal y eje vertical de la cabeza. Perímetro real Número de píxeles que conforman el borde de la cabeza. Perímetro ideal Perímetro elíptico definido por: p = 2π√((a²+b²)/ 2). Diferencia Pi - Pr Diferencia entre perímetro elíptico ideal y perímetro real. Presencia PI Indica si la pieza intermedia está o no presente. Ángulo inserción PI Ángulo en grados entre eje Horizontal de la cabeza y eje PI– cabeza. Ancho máximo PI Ancho máximo en píxeles de PI. 41 Figura 27: Extracción de Características 2.3.5 ANÁLISIS DE RESULTADOS Con el objetivo de estimar la confiabilidad y calidad de los resultados arrojados por el módulo de procesamiento, se diseñó un protocolo de prueba que consistía en seleccionar aleatoriamente 89 imágenes de las 294 disponibles, lo que equivale aproximadamente al 30,27% de la población. Para cada una de las imágenes se contó la cantidad de espermatozoides presentes, la cantidad de reconocimientos exitosos, el número de espermatozoides no reconocidos, el número de falsos reconocimientos y el número de errores cometidos al diferenciar entre el acrosoma y la pieza intermedia. La Tabla 8 muestra los resultados obtenidos. Tabla 8: Resultados del protocolo de prueba Parámetro Valor Estructuras identificadas 1209 Espermatozoides presentes 1196 Espermatozoides reconocidos 1116 Espermatozoides no reconocidos 80 Falsos reconocimientos 93 Diferenciación errónea entre acrosoma y pieza intermedia 84 El error de segmentación establece una relación entre los falsos reconocimientos y las detecciones totales con el objetivo de estimar la capacidad de discriminación del algoritmo de segmentación. Se trata de una estimación del grado de confiabilidad de las detecciones realizadas por el algoritmo. La fórmula para el cálculo de este error es la siguiente: 42 Para la muestra seleccionada, en total se reconocieron 1209 estructuras, de las cuales 93 no eran espermatozoides. Es decir, se comete un error de segmentación de 7,69% confundiendo algunas regiones de las imágenes con espermatozoides. Sin embargo, y a pesar de que el error de segmentación sea relativamente bajo, en algunas imágenes se incrementaba considerablemente la tasa de falsos reconocimientos, sobre todo en las láminas (como se observa en la Figura 28) que presentaron problemas para lograr la coloración adecuada de la muestra. En tales imágenes surgían manchas considerablemente similares tanto en color como en proporciones a los espermatozoides. La Figura 29 muestra un gráfico que refleja en el eje de las ordenadas la tasa de falsos reconocimientos para cada una de las imágenes de la muestra agrupadas según las láminas a las que pertenecían. Como puede verse, en la lámina C la tasa incrementa significativamente hasta casi duplicar el valor máximo de las restantes láminas. Figura 28: Algunos problemas en la coloración de las muestras Figura 29: Tasa de falsos reconocimientos agrupados por láminas Otra medida de la capacidad de discriminación del algoritmo de segmentación consiste en determinar la proporción de omisiones en la detección de espermatozoides. El error de omisión relaciona el número de espermatozoides no reconocidos con el número de espermatozoides presentes. La fórmula para el cálculo de esta medida es la siguiente: Para la muestra seleccionada, el algoritmo de segmentación no detectó 80 espermatozoides de los 1196 presentes, lo que equivale a una tasa aproximada de error de omisión de 6,69%. 43 Finalmente, la estimación de la calidad y precisión de las características extraídas en los espermatozoides reconocidos, se logra relacionando las equivocaciones cometidas al aplicar las reglas heurísticas para diferenciar entre el acrosoma y la pieza intermedia con el número de reconocimientos exitosos. En este sentido, si antes de la extracción de las características se diferenció erróneamente estas estructuras, los resultados del procesamiento para tal espermatozoide serán incorrectos. La fórmula para el cálculo de este error es la siguiente: Para la muestra seleccionada se cometieron 84 errores diferenciando entre el acrosoma y la PI en las 1116 detecciones exitosas de células espermáticas, lo que equivale a un error de extracción de características de 7,53%. En la Figura 30, se muestra una representación gráfica de la proporción de los errores cometidos para la muestra seleccionada siguiendo el protocolo de prueba. Figura 30: Errores cometidos durante el procesamiento de las imágenes El protocolo de prueba también contempló el estudio de los aspectos relacionados a la eficiencia en la ejecución del módulo de procesamiento, medida en términos del tiempo requerido para realizar los cómputos de segmentación y extracción de características. En la Tabla 9 se muestran los intervalos de tiempo obtenidos para el procesamiento de las imágenes de la muestra, así como el tiempo de operación promedio. Tabla 9: Tiempo requerido por el módulo de procesamiento Operación Tiempo mínimo Tiempo máximo Tiempo promedio Segmentación 2,223 segundos 2,880 segundos 2,507 segundos Extracción de caratcterísticas 0,355 segundos 0,978 segundos 0,657 segundos Ambas 2,578 segundos 3,858 segundos 3,164 segundos A pesar de que la concentración espermática de cada lámina resultó variable y condicionó el tiempo de procesamiento de la imagen (a mayor número de espermatozoides por imagen 44 mayor tiempo requerido), se obtuvieron rangos de valores relativamente ajustados (aproximadamente de 500 milisegundos) lo que es indicio de que el orden de complejidad de los algoritmos resulta adecuado. En la Figura 31 se muestra una comparación entre el tiempo promedio necesario para ejecutar cada una de las operaciones con respecto al tiempo total de procesamiento si se ejecutaran ambas. Puede observarse que la segmentación requiere de aproximadamente cuatro veces el tiempo que se invierte en la operación de extracción de características, lo que refleja su mayor complejidad algorítmica dado el elevado volumen de cálculos matriciales que realiza. Figura 31: Comparación entre los tiempos promedios de ejecución de las operaciones 45 2.4 DESARROLLO DE LA APLICACIÓN La siguiente sección describe los requerimientos de la aplicación y los Casos de Uso diseñados para satisfacerlos. Posteriormente, se muestra el ambiente de ventanas que caracteriza la aplicación, definido a partir del análisis de los requerimientos. 2.4.1 ANÁLISIS DE REQUERIMIENTOS Y MODELOS DE CASO DE USO Durante la fase de levantamiento de la información fueron identificados los siguientes requerimientos: A) El usuario debe poder cargar una imagen o directorio de imágenes en cualquiera de los formatos gráficos comúnmente utilizados (JPG, PNG, BMP y GIF). B) En caso de abrir un directorio de imágenes, se debe ofrecer la posibilidad de procesar todas las imágenes contenidas en éste. C) El usuario debe poder verificar individualmente el procesamiento de los espermatozoides reconocidos, así como ser capaz de introducir etiquetas de clasificación a cada uno de estos, en caso que lo desee. D) El usuario debe poder consultar en cualquier instante los estadísticos de procesamiento realizado a los espermatozoides presentes. E) La aplicación debe guardar en cualquier instante el trabajo de clasificación que está realizando el usuario y garantizar la persistencia de estos datos. F) El usuario debe poder generar un archivo de texto plano que contenga todas las características extraídas de los espermatozoides, así como las etiquetas asignadas a estos por el usuario. La Figura 32 detalla los Casos de Uso básicos definidos para satisfacer los requerimientos de la aplicación. En la Tabla 10 se describe cada caso. Figura 32: Casos de Uso básicos (nivel 0) del Clasificador de Morfología Espermática 46 Tabla 10: Descripción nivel 0 de Casos de Uso básicos Nombre Abrir imagen Identificador CU 1 Descripción El usuario puede abrir la imagen que desee en cualquiera de los formatos JPG, PNG, BMP o GIF Pre-Condición Ninguna Post-Condición Se muestra la imagen en la interfaz manteniendo el radio-aspecto original Nombre Abrir directorio de imágenes Identificador CU 2 Descripción El usuario puede abrir un directorio de imágenes en formato JPG, PNG, BMP o GIF Pre-Condición Ninguna Post-Condición Se muestra la primera imagen del directorio en la interfaz manteniendo el radio-aspecto original Nombre Procesar imagen Identificador CU 3 Descripción El usuario puede iniciar la secuencia de procesamiento que se ocupa de la segmentación y extracción de características de los espermatozoides Pre-Condición Se ha cargado una imagen en la aplicación Post-Condición Se identifican los espermatozoides reconocidos con un id numérico ascendente que inicia en 0. En el panel lateral se carga la imagen y clasificación del primer espermatozoide reconocido, así como las etiquetas que le hayan sido asignadas en procesamientos previos Nombre Generar archivo de clasificación Identificador CU 4 Descripción El usuario puede especificar al sistema el momento en el que desee generar el archivo de clasificación Pre-Condición Todas las imágenes abiertas deben haber sido procesadas Post-Condición El sistema genera o sobrescribe (en caso de existir) el archivo de clasificación ‘espermatozoides.txt’ Nombre Consultar estadísticas Identificador CU 5 Descripción El usuario puede consultar las estadísticas de procesamiento de las imágenes analizadas Pre-Condición Ninguna Post-Condición Se informa al usuario acerca de los estadísticos de procesamiento de los espermatozoides analizados Nombre Visualizar Ayuda Identificador CU 6 Descripción Se muestra una breve descripción del funcionamiento de la aplicación, así como de la forma de operar sus funcionalidades Pre-Condición Ninguna Post-Condición Se muestra la ventana con la ayuda del sistema 47 Las Figuras 33 y 34 muestran la especificación de nivel 1 para los Casos de Uso CU2 y CU3, mientras que en las Tablas 11 y 12 se describen, respectivamente, estos casos. Figura 33: Especificación de Casos de Uso nivel 1 para CU2 Tabla 11: Descripción nivel 1 para CU2 Nombre Seleccionar imagen Identificador CU 2.1 Descripción El usuario puede seleccionar cualquier imagen contenida en el directorio Pre-Condición CU 2 Post-Condición Se muestra en la interfaz la imagen seleccionada por el usuario manteniendo el radio-aspecto original Figura 34: Especificación de Casos de Uso nivel 1 para CU3 48 Tabla 12: Descripción nivel 1 para CU3 Nombre Cargar imagen Identificador CU 3.1 Descripción El sistema busca el archivo de clasificación de la imagen actual, y, en caso de existir, carga todas las clasificaciones disponibles Pre-Condición CU 1 ó CU 2 Post-Condición El sistema se actualiza con la información relacionada al procesamiento previamente almacenado para la imagen actual o crea los archivos de persistencia necesarios Nombre Clasificar espermatozoide Identificador CU 3.2 Descripción El usuario puede clasificar cualquiera de los espermatozoides reconocidos por el módulo de procesamiento Pre-Condición CU 3.1 Post-Condición Se registra permanentemente la clasificación del usuario al espermatozoide seleccionado Nombre Ver Cajas Contenedoras Orientadas Identificador CU 3.3 Descripción El usuario puede visualizar las Cajas Contenedoras Orientadas de los espermatozoides reconocidos por el módulo de procesamiento Pre-Condición La imagen se ha procesado con éxito Post-Condición La interfaz muestra las Cajas Contenedoras Orientadas de los espermatozoides reconocidos Nombre Ver diagonales mayores Identificador CU 3.4 Descripción El usuario puede visualizar las diagonales mayores de los espermatozoides reconocidos por el módulo de procesamiento Pre-Condición La imagen se ha procesado con éxito Post-Condición La interfaz muestra las diagonales mayores de los espermatozoides reconocidos Nombre Ver diagonales menores Identificador CU 3.5 Descripción El usuario puede visualizar las diagonales menores de los espermatozoides reconocidos por el módulo de procesamiento Pre-Condición La imagen se ha procesado con éxito Post-Condición La interfaz muestra las diagonales menores de los espermatozoides reconocidos Nombre Amplificar imagen Identificador CU 3.6 Descripción El usuario puede amplificar la imagen procesada Pre-Condición La imagen se ha procesado con éxito Post-Condición La interfaz muestra la imagen procesada amplificada 49 (Continuación de Tabla 12) Nombre Ver identificadores Identificador CU 3.7 Descripción El usuario puede visualizar los identificadores de los espermatozoides reconocidos por el módulo de procesamiento Pre-Condición La imagen se ha procesado con éxito Post-Condición La interfaz muestra los identificadores de los espermatozoides reconocidos Nombre Exportar espermatozoides segmentados Identificador CU 3.8 Descripción El usuario puede exportar como imágenes individuales los espermatozoides reconocidos por el módulo de procesamiento Pre-Condición La imagen se ha procesado con éxito Post-Condición Se guardan las imágenes de los espermatozoides reconocidos en el directorio seleccionado por el usuario Nombre Ver contornos de espermatozoides Identificador CU 3.9 Descripción El usuario puede visualizar los contornos detectados en la imagen por el módulo de procesamiento Pre-Condición La imagen se ha procesado con éxito Post-Condición La interfaz muestra los contornos detectados en la imagen 2.4.2 PLATAFORMA TECNOLÓGICA Para el desarrollo de la aplicación se utilizó la siguiente configuración de desarrollo: A) Especificaciones de Hardware Procesador Intel® Coretm2 Duo CPU 1,80 GHz 1,5 GB de Memoria RAM. Disco Duro de 120GB. B) Sistema Operativo La aplicación se desarrollo bajo ambiente Microsoft® Windows XP Profesional, versión 2002, Service Pack 3. C) Herramientas de Software Luego de evaluar diversas herramientas de desarrollo se seleccionaron las siguientes: Kit de Desarrollo Java (JDK): incluye la Máquina Virtual de Java (Java SE Runtime Environment) versión jre1.6.0_07 y la versión 1.6.0_03 de JDK. Entorno de desarrollo integrado: NetBeans 6.1. Editor de archivos de texto: Notepad++. Microsoft® Paint versión 5.1. Adobe® Photoshop® CS2 versión 9.0.2. 50 2.4.3 DISEÑO DE LA INTERFAZ A la herramienta resultante se le denominó CME en alusión a Clasificador de Morfología Espermática. La aplicación consiste en una única ventana que incluye los controles necesarios para ejecutar todas las funcionalidades. Se cree que este mecanismo simplifica la interacción con el sistema ya que el usuario no debe operar varias ventanas. Para el diseño de la interfaz, se decidió mantener condiciones similares a las que caracterizan el entorno de trabajo del experto. En la Figura 35 se muestra la interfaz de la aplicación. Figura 35: Interfaz del Clasificador de Morfología Espermática Las funcionalidades de la aplicación se encuentran agrupadas convenientemente en 5 menús. El primer menú se denomina “Archivo” y ofrece la posibilidad de abrir ya sea una imagen o directorio de imágenes, exportar las imágenes de los espermatozoides reconocidos, exportar la vista principal como imagen y salir de la aplicación. En la Figura 36 se muestran estas funcionalidades. 51 Figura 36: Menú Archivo Con el objetivo de facilitar la visualización de los resultados del procesamiento, se ofrece al usuario la opción de activar o desactivar el dibujado de diversas estructuras, así como la posibilidad de controlar el tamaño de la vista principal. En el menú “Ver” se permite seleccionar entre la vista ajustada a los controles y la vista aumentada de la imagen procesada además de mostrar u ocultar Cajas Contenedoras Orientadas, diagonales mayores, diagonales menores e identificadores de los espermatozoides reconocidos por el módulo de procesamiento. La Figura 36 muestra el menú “Ver” así como ejemplos de sus funcionalidades. Figura 37: Funcionalidades del menú Ver Durante el procesamiento, el usuario puede determinar la secuencia a seguir utilizando las funcionalidades del menú “Ir a” o los botones de la barra de herramientas. En la Figura 38 se detallan estas operaciones. Como puede verse, el usuario puede seguir una secuencia ordenada de procesamiento o definir su propia secuencia utilizando el Combo Box, que indica además las imágenes que faltan por procesar anteponiendo la letra “x” al nombre de éstas. Figura 38: Secuencia de procesamiento de las imágenes 52 En caso de que el usuario desee utilizar la aplicación como visor de imágenes de láminas de espermatozoides, puede seleccionar entre activar o desactivar el módulo de procesamiento para reducir el tiempo de espera. En la Figura 39 se muestran las funcionalidades del menú “Procesamiento”. Si el usuario decide desactivar el procesamiento automático de las imágenes debe iniciar la secuencia de procesamiento manualmente para cada imagen que desee procesar. Figura 39: Menú Procesamiento Al procesar una imagen, el usuario dispone de varias formas de visualizar los resultados. La Figura 40 muestra la funcionalidad de selección de vistas. Es posible optar por la vista de la imagen original RGB, las imágenes de cada uno de los canales RGB por separado, los contornos identificados dibujados sobre la imagen original RGB y una máscara binaria con los contornos identificados. Figura 40: Selector de vistas En cualquier instante que lo desee, el usuario puede consultar los estadísticos referentes a las imágenes procesadas por el módulo, seleccionando la pestaña “Estadísticos”. Como puede observarse en la Figura 41, esta sección muestra información general de procesamiento como número de espermatozoides no clasificados, anormales, normales y falsos reconocimientos así como registros detallados por tipos de defectos. El usuario puede exportar estas estadísticas a un archivo de texto plano si lo desea presionando el botón “Exportar”. 53 Figura 41: Estadísticos de procesamiento Finalmente, el menú “Ayuda” facilita el acceso a la ventana de ayuda del sistema, donde se explican las funcionalidades de la interfaz, así como a la ventana de créditos que muestra los datos asociados a la construcción de la aplicación. En la Figura 42 se muestra el menú “Ayuda” y en las Figuras 43 y 44 se muestran las ventanas de ayuda y créditos, respectivamente. Figura 42: Menú Ayuda 54 Figura 43: Ventana de ayuda Figura 44: Ventana de Créditos 55 CONCLUSIONES, RECOMENDACIONES Y LIMITACIONES La búsqueda de información, definición, estructuración, diseño y desarrollo del proyecto conforman un conjunto de actividades complejas que requirieron ser llevadas a cabo con precaución para garantizar el éxito de los resultados. En este sentido, se trató de un trabajo que premia el cuidado en los detalles ya que los productos de una fase se convierten en los insumos de la fase siguiente, resultando relativamente sencillo propagar errores a lo largo del proceso. Partiendo de esta premisa, se adoptó como criterio de desarrollo la exhaustividad parcial, agotando las alternativas disponibles para la culminación de una fase antes de dar paso al abordaje de la etapa siguiente. Por lo tanto, se comenzó con una amplia revisión de investigaciones en el área, donde se pudo constatar diversas posibilidades tecnológicas disponibles para abordar el problema de la automatización. Sin embargo, pronto se hizo evidente que el reconocimiento de células microscópicas en general resulta un procedimiento específico que debe ser abordado en base a heurísticas de procesamiento, factor que complica considerablemente la investigación. En efecto, varias de las pruebas realizadas con las técnicas de consulta a menudo requerían de desarrollos parciales. A pesar de existir numerosos paquetes de procesamiento digital de imágenes en el mercado, frecuentemente se requirió poner a prueba aproximaciones muy específicas definidas en base a una combinación de técnicas, que no siempre resulta equivalente a la aplicación secuencial e independiente de éstas. Por esta razón es conveniente disponer, además de paquetes de procesamiento de imágenes, de un entorno de trabajo que permita hacer rápidamente estas pruebas ofreciendo la posibilidad de depuración de algoritmos. Especialmente porque no siempre resulta sencillo encontrar errores de implementación cuando se combinan varios algoritmos. La segmentación de las estructuras consistió, por lo tanto, en el problema más complejo al que se enfrentó la investigación dado que es el punto de partida para lograr la solución y de ella dependían las siguientes fases del desarrollo. Se trató de una actividad en la que se invirtió la mitad del tiempo total del trabajo tratando de cumplir con los estándares de calidad propuestos. El desarrollo de esta fase pone en evidencia la indeterminación de este tipo de investigaciones donde no existe una solución a priori: se debe participar crítica, activa y creativamente en la construcción del camino a seguir. En efecto, como producto y aporte de la fase de segmentación, surge el desarrollo del operador de textura NCA (Núcleo de Círculo y Anillo), que permitió avanzar a la siguiente fase de identificación de las estructuras del espermatozoide. Se trató de una alternativa útil para la definición de contornos de células espermáticas, aunque es probable que su extrapolación al contexto de otras células microscópicas deba hacerse siguiendo las consideraciones heurísticas relativas al problema que se desee abordar. Otro aspecto que resultó importante se evidenció una vez abordada la fase de identificación de las estructuras del espermatozoide. Se observó que a pesar de tomar precauciones para 56 controlar el error de procesamiento definiendo un conjunto de reglas heurísticas para tal fin, éstas no lograban reducirlo más allá de ciertos límites sin afectar el desempeño general del sistema. Debido a este factor, se cree que en este tipo de investigaciones pudiera ser inevitable el hecho de tener que tolerar cierto margen de error producto de variaciones en la captura de las imágenes. Por lo tanto, resulta conveniente buscar una solución que aporte globalmente la menor cantidad de error posible, en detrimento de mejorar unilateralmente algún aspecto del procesamiento. Sin embargo, las operaciones de segmentación y extracción de características arrojan márgenes de error que comparados con la variabilidad y dificultad de replicación de los resultados de la evaluación morfológica realizada por los expertos pudieran ser tolerables. En efecto, el protocolo diseñado para estimar la calidad y confiabilidad del procesamiento estima una tasa de error de segmentación de 7,69%, error por omisión en la detección de espermatozoides de 6,69% y error en la extracción de características de 7,53%. Otro factor que debe ser analizado, tiene que ver con las características de la implementación de la solución. Luego de realizar pruebas de rendimiento, pudo constatarse que este tipo de problemas demandan al desarrollador recurrir constantemente a optimizaciones de los algoritmos con el objetivo de reducir el tiempo de ejecución. La eficiencia se encuentra en parte subordinada al uso de implementaciones convenientes de algoritmos ya conocidos (como el DFS) incorporados a la solución. En el caso de los algoritmos diseñados específicamente para la solución, se debe tomar la precaución de analizar el coste en complejidad debido a la gran cantidad de iteraciones requeridas para depurar y construir las estructuras de datos matriciales que utiliza la aplicación. En general, y a pesar de las dificultades encontradas durante el desarrollo del proyecto, se trató de una experiencia satisfactoria que permitió integrar diversas áreas del conocimiento relacionado a la ciencia de la computación. El desarrollo de CME evidencia la factibilidad de recurrir a este tipo de tecnologías en el país, mostrando los aportes de esta ciencia en la Universidad Central de Venezuela. El proyecto se constituyó en un mecanismo de difusión del uso de estas herramientas y busca informar a diversos sectores de la sociedad acerca de sus beneficios. RECOMENDACIONES Luego de concluir esta investigación se recomienda: 1. Realizar pruebas utilizando otros reactivos químicos para lograr la coloración de las muestras. El acrosoma y la pieza intermedia presentaron intensidades RGB similares con el procedimiento utilizado, lo que introduce error en el sistema. 2. Realizar pruebas utilizando mayores resoluciones para las imágenes y factores de aumento superiores a 100x para la escena. Es posible que a mayor acercamiento se logren mejores resultados. Aunque muy probablemente cambien las heurísticas relacionadas con el tamaño de las estructuras. 3. Controlar las condiciones de iluminación durante la captura de las escenas para evitar introducir ruidos periódicos en las imágenes, lo que dificulta la aplicación de 57 algunas técnicas (como la umbralización) y complican considerablemente la solución. 4. Analizar las heurísticas diseñadas para el reconocimiento de las estructuras del espermatozoide con distintos expertos. 5. Validar mediante análisis estadísticos la capacidad discriminativa de las características extraídas con el objetivo de lograr modelos de clasificación morfológica más precisos. LIMITACIONES Desde el inicio de la investigación se dispuso del banco de imágenes de las escenas capturadas con la ayuda del experto. Se cree que este factor facilitó en parte el desarrollo del trabajo dado que permite economizar el tiempo necesario para la captura de las imágenes. Sin embargo, condiciona los resultados de la investigación especialmente porque en varias imágenes se presentaron problemas en la tinción de las estructuras, lo que se constituyó en una fuente de error que no pudo ser controlada. 58 REFERENCIAS [ALE04] E. Alegre, L. Sánchez, R. Alaiz, J. Domínguez. Utilización de momentos estadísticos y redes neurales en la clasificación de cabezas de espermatozoides de verraco. XXV Jornadas de Automática, Ciudad Real, España, 2004. [BAK04] E. Bak, K. Najarian, J. Brockway. Efficient segmentation framework of cell images in noise environments. IEMBS apos, 26th Annual International Conference of the IEEE, vol. 1, issue 1-5. pp. 1802 – 1805, sept. 2004. [BOV00] Bovik A. Handbook of Image and Video Processing. Academic Press. Primera Edición, may. 31, 2000. [BUE02] P. Buendía, C. Soler. F. Paolicchi, G. Gago, B. Urquieta, F. Pérez, E. Bustos. Morphometric characterization and classification of alpaca sperm heads using the Sperm- Class Analyzer® computer-assisted system. Theriogenology, vol. 57, pp. 1207 – 1218, 2002. [CAL07] E. Calderon. Aplicación de las redes neuronales en la estimación de modelos de clasificación de la morfología de la cabeza de espermatozoide humano a partir de imágenes. Trabajo especial de grado para optar al título de Licenciado en Computación. Universidad Central de Venezuela, 2007. [CAR07] H. Carrillo, J. Villareal, M. Sotaquirá, A. Goelkel, R. Gutiérrez. A Computer Aided Tool for the Assessment of Human Sperm Morphology. Departamento de Ingeniería Eléctrica y Electrónica y Departamento de Química y Biología. Universidad del Norte, Barranquilla, Colombia. IEEE Student member, 2007. [CER06] G. Cerezo. El Análisis de Semen Humano: La Estandarización de su Evaluación. Contacto Químico 1, vol. 3, oct.-dic. 6-8, 2006. [CRA97] R. Crane. A simplified Approach to Imagen Processing Clasical and Modern Techniques in C, Prentice Hall, 1997. [FRE93] J. Freeman y D. Skapura. Redes Neuronales: Algoritmos, aplicaciones y técnicas de programación. Delaware E.U.A. Addison Wesley Iberoamericana S.A. 1993. [FOL93] J. Foley, A. van Dam, S. Feiner, J. Hughes, R. Phillips. Introduction to Computer Graphics. Addison-Wesley, Reading, may.1993. [GAR91] P. Garcia, R. Gross. Pequeño Larousse Ilustrado.Ediciones Laousse, Paris, Francia, 1991. [GON02] R. Gonzalez, R. Woods. Digital Image Processing. Prentice Hall. Segunda Edición, 2002. 59 [HAG02] M. Hagan, H. Demuth, M. Beale. Neural Network Design. PWS Publishing Company, 2002. [KAT86] D. Katz, J. Overstreet, S. Samuels, P. Nis Wander, T. Bloom, E. Lewis. Morphometric Analysis of Spermatozoa in the Assessment of Human Male Fertility. Journal of Andrology, vol. 7, pp. 203-210. jul./ago. 1986. [KRU99] T. Kruger, K. Coetzee. The role of sperm morphology in assisted reproduction. Human reproduction update, vol. 5, num. 2, pp. 172-178, 1999. [LAR04] L. Larcher, R. Costaguta. Una Red Neuronal Backpropagation Aplicada a la Microhistología. Inteligencia Artificial, Revista Iberoamericana de Inteligencia Artificial. Nro.23, pp. 105-109. ISSN: 1137-3601, 2004. [LIN94] C. Linneberg, P. Salamon, C. Svarer and L. Hanses (1994). Towards Semen Quality Assessment Using Neural Networks. Neural Networks for Signal Processing IV. Proceedings of the 1994 IEEE Workshop, pp. 509-517 (ISBN: 0-7803-2026-3). [LON05] X. Long, W. Cleveland and Y. Lawrence. A New Preprocessing Approach for Cell Recognition. IEEE Transactions on Information Technology in Biomedicine, vol. 9, nro. 3, sept. 2005. [MAR06] T. Markiewicz, S. Osowski. Data mining techniques for feature selection in blood cell recognition. ESANN'2006 proceedings - European Symposium on Artificial Neural Networks. D-side publi., ISBN 2-930307-06-4. Bruges (Bélgica), 26-28 abr., 2006. [OMS01] OMS – Organización Mundial de la Salud. Manual de Laboratorio para el examen del semen humano y de la interacción entre el semen y el moco cervical. Editorial Médica Panamericana S.A. Cuarta Edición, Madrid, España, 2001. [OTS79] N. Otsu. A. threshold selection method from gray-level histograms. Publicado en IEEE Transactions on Systems, Man, and Cybernetics, vol. 9, pp. 62-66. (ISSN 0018- 9472), 1979. [PAD88] R. Padrón, G. Fernández, M. Gallardo. Interpretación del Análisis Seminal. Revista cubana Endocrinología, ISSN 0188-9796, Instituto Nacional de Endocrinología, Departamento de Reproducción Humana, 9(1), 81-90, referenciado en 47,50, 1988. [PRA07] W. Pratt. Digital Image Processing. Fourth Edition. Wiley Interscience Publications, 2007. [RAM07A] E. Ramos, Y. Pereira, H. Núñez, M. Castro, R. Casañas. Aplicación de visualización de una ontología parra el dominio del análisis del semen humano. Ingeniería y Ciencia, ISSN 1794-9165, vol. 3, num. 5, pp. 43-66, 2007. [RAM07B] E. Ramos, H. Núñez, M. Castro, G. Rosellino, A. Urriola, R. Casañas. ANALISE: Un Sistema Multiagente para el Dominio del Análisis del Líquido Seminal 60 Humano. IWPAAMS 2007, 6th Internacional Workshop on practical applications on agents and multi-agent systems. Salamanca España, nov. 2007. [RUS07] J. Russ. The Image Processing Handbook. CRC PRESS. Quinta Edición, 2007. [RUS02] S. Russell, J. Norvig. Artificial Intelligence a morden approach. Prentice Hall. Segunda edición, 2002. [SAN05] L. Sánchez, E. Alegre. Evaluación de descriptores de textura en la clasificación de células espermáticas. XXVI Jornadas de Automática Alicante-Elche. Universidad de Alicante y Universidad Miguel Hernández de Elche, sept. 2005. [SPE04] L. Speroff, M. Fitz. Clinical Gynecologic Endocrinology and Infertility. Lippincott Williams & Wilkins. Séptima Edición, 2004. [THE03] N. Theera-Umpon. Automatic White Blood Cell Classification using Biased- Output Neural Networks with Morphological Feature. Thammasat International Journal of Science and Technology (TIJSAT), vol. 87, pp. 64-71, 2003. [TIN05] A. Tinku and K. Ajoy. Image Processing: Principles and Applications. Wiley Interscience Publications, 2005. [UMB05] S. Umbaugh. Computer Imaging: Digital Analysis and Processing. CRC PRESS BOOK, 2005. 61CLASIFICACIN DE LA MORFOLOGA DE ESPERMATOZOIDES HUMANOS Universidad Central de Venezuela Facultad de Ciencias Escuela de Computación Centro de Ingeniería de Software y Sistemas Laboratorio de Inteligencia Artificial Opción Profesional: Inteligencia Artificial Herramienta para la extracción automática de características morfológicas de espermatozoides humanos a partir de imágenes Trabajo Especial de Grado Presentado ante la ilustre Universidad Central de Venezuela, por el Magíster Scientiarum Hendry Ferreira Chame, para optar al Título de Licenciado en Computación Tutores: Haydemar Núñez y Roberto Casañas Caracas, octubre de 2008 ACTA Quienes suscriben, miembros del jurado designado por el Consejo de la Escuela de Computación, para dictaminar sobre el Trabajo Especial de Grado titulado: “Herramienta para la extracción automática de características morfológicas de espermatozoides humanos a partir de imágenes” y presentado por el Magíster Scientiarum Hendry Ferreira Chame, de cédula de identidad E – 82.063.290, para optar al título de Licenciado en Computación, dejan constancia de lo estipulado a continuación: Leído como fue dicho trabajo por cada uno de los miembros del jurado, se fijó el día 30 de Octubre de 2008 a las 10:00 a.m., para que su autor lo defendiera en forma pública, lo que hizo en la Sala 1 de la Escuela de Computación, mediante una presentación oral del contenido del Trabajo Especial de Grado, luego de lo cual respondió a las preguntas formuladas. Finalizada la defensa pública del Trabajo Especial de Grado, el jurado decidió APROBARLO. En fé de lo cual se levanta la presente Acta, en la Ciudad Universitaria de Caracas a los treinta días del mes de octubre del año dos mil ocho dejándose también constancia de que actúo como Coordinadora del Jurado la Profesora Esmeralda Ramos. Jurado Principal _______________________ _______________________ Profesor Ernesto Coto Profesora Esmeralda Ramos _______________________ _______________________ Profesor Roberto Casañas Profesora Haydemar Nuñez (Tutor) (Tutora) 2 . DEDICATORIA Dedico este trabajo a la humanidad, que a pesar de haberse empeñado algunas veces en crear y ejecutar algoritmos de destrucción, en otras, ha intentado reducir la entropía de la vida. 3 AGRADECIMIENTOS Agradezco a: Laboratorio de Inteligencia Artificial de la Universidad Central de Venezuela, especialmente a la profesora Esmeralda Ramos por la franca y sincera disposición para ayudar. Los tutores Haydemar Núñez y Roberto Casaña por la amabilidad, sinceridad, dedicación, disposición de trabajo y calidad docente. Los profesores Robinson Rivas, Rhadamés Carmona, Esmitt Ramírez y Ernesto Coto por las precisas y oportunas observaciones hechas al trabajo. Karina Gómez por la dulce compañía a lo largo de la investigación. Especialmente por tolerar que llevara el computador a la playa e invitarme a trabajar con amor. Mi familia. A Fuad Aziz Chame, Glória de Fátima Chame, Fuad Aziz Chame Filho, Danya Ferreira Chame y Daniela Ferreira Chame, por haberme brindado a través de la convivencia las contingencias necesarias para llegar a este punto. La vida, por permitirme realizar mis sueños. 4 RESUMEN El Análisis de Líquido Seminal (ALS) o Espermograma es un procedimiento diagnóstico importante para la salud ya que se constituye en un medio de evaluación de la fertilidad masculina. Por otra parte, permite estimar el funcionamiento de diferentes estructuras del aparato reproductivo, lo que resulta conveniente para dar seguimiento a intervenciones médicas como la vasectomía, así como otros chequeos pre y post operatorios. En el ALS se realizan dos grupos de pruebas (macroscópicas y microscópicas). La evaluación morfológica es una subprueba microscópica que demanda altos costes en términos de pericia, tiempo y esfuerzo, además de ser un procedimiento vulnerable a varias fuentes de error. A partir de la vigencia, utilidad e importancia de la evaluación morfológica así como de las dificultades asociadas a este examen, el propósito de esta investigación fue construir una herramienta que apoye al experto en la prueba. Para tal fin, se definió un modelo de procesamiento de imágenes digitales microscópicas del líquido seminal, que identifica y extrae las características a los espermatozoides presentes en la escena. Luego del desarrollo y definición del modelo, se realizaron pruebas con una muestra de 89 imágenes tomadas en condiciones similares al ambiente de trabajo del experto. Los resultados indican una tasa de error de segmentación de 7,69% confundiendo elementos de las imágenes con espermatozoides, 6,69% de omisiones de espermatozoides presentes y 7,53% de error en la extracción de características producto de la identificación errónea de las estructuras del espermatozoide. El desarrollo del proyecto constituye un aporte que demuestra la factibilidad de desarrollar este tipo de tecnologías en el país. Sin embargo, mostró ser una actividad compleja, que debe ser llevada a cabo con precaución, controlando las fuentes de error. Requiere de creatividad e innovación así como del dominio de los aspectos técnicos relacionados a la eficiencia en la ejecución de programas en el computador. Palabras claves: Morfología Espermática, Inteligencia Artificial, Procesamiento Digital de Imágenes. 5 TABLA DE CONTENIDOS INTRODUCCIÓN 8 CAPITULO I: MARCO TEÓRICO 10 1.1 ANÁLISIS DE LÍQUIDO SEMINAL 10 1.1.1 MORFOLOGÍA ESPERMÁTICA 10 1.2 INTELIGENCIA ARTIFICIAL 12 1.2.1 ÁREAS DE LA INTELIGENCIA ARTIFICIAL 13 1.2.1.1 APRENDIZAJE AUTOMÁTICO 14 1.2.1.1.1 REDES NEURONALES 14 1.2.3. SISTEMAS MULTIAGENTES 16 1.3 IMÁGEN DIGITAL 16 1.3.1 ESPACIOS DE COLOR EN IMÁGENES DIGITALES 16 1.4 PROCESAMIENTO DIGITAL DE IMÁGENES 18 1.4.1 CONVOLUCIÓN 18 1.4.2 ANÁLISIS DE HISTOGRAMA 19 1.4.3 OPERACIONES ARITMÉTICAS 20 1.4.4 SEGMENTACIÓN 20 1.4.4.1 UMBRALIZACIÓN 21 1.4.4.2 OPERADORES DE TEXTURA 21 1.4.5. OPERADORES LÓGICOS 22 1.4.6. OPERADORES MORFOLÓGICOS 23 CAPITULO II: MARCO APLICATIVO 25 2.1 PLANTEAMIENTO DEL PROBLEMA 25 2.1.1 ANTECEDENTES 26 2.1.2 PROPUESTA DE SOLUCIÓN 28 2.2. OBJETIVOS 29 2.3.1 GENERAL 29 2.3.2 ESPECÍFICOS 29 2.3 PROCESAMIENTO DE IMÁGENES DE ESPERMATOZOIDES HUMANOS 30 2.3.1 ADQUISICIÓN DE IMÁGENES 30 2.3.2 PRE-PROCESAMIENTO DE IMÁGENES 30 2.3.3 SEGMENTACIÓN DE IMÁGENES 31 2.3.3.1 CONSTRUCCIÓN DE LA MÁSCARA DE CABEZAS DE ESPERMATOZOIDES (MCE) 32 2.3.3.2 PROPUESTA DE OPERADOR DE TEXTURA NÚCLEO DE CÍRCULO Y ANILLO (NCA) 33 2.3.3.3 CONSTRUCCIÓN DE LA MÁSCARA DE NÚCLEO DE CÍRCULO Y ANILLO (MNCA) 23 2.3.3.4 CONSTRUCCIÓN DE LA MÁSCARA DE CONTORNOS DE ESPERMATOZOIDES (MCOE) 34 2.3.3.5 EXTRACCIÓN DE CAJAS CONTENEDORAS ORIENTADAS 35 6 2.3.3.6 SEPARACIÓN DE ESTRUCTURAS DEL ESPERMATOZOIDE 36 2.3.4 EXTRACCIÓN DE CARACTERÍSTICAS 39 2.3.5 ANÁLISIS DE RESULTADOS 42 2.4 DESARROLLO DE LA APLICACIÓN 46 2.4.1 ANÁLISIS DE REQUERIMIENTOS Y MODELOS DE CASO DE USO 46 2.4.2 PLATAFORMA TECNOLÓGICA 50 2.4.3 DISEÑO DE LA INTERFAZ 51 CONCLUSIONES Y RECOMENDACIONES 56 REFERENCIAS 59 7 INTRODUCCIÓN El Análisis de Líquido Seminal (ALS) o Espermograma es un procedimiento diagnóstico que por varias razones resulta importante en el ámbito de las ciencias de la salud. Se constituye en un medio de evaluación de la fertilidad masculina así como un medio para estimar el funcionamiento de diferentes estructuras del aparato reproductivo. En efecto, a través del ALS se evalúa la función secretora de las glándulas anexas, procesos infecciosos- inflamatorios del tracto urogenital, procesos obstructivos, mal funcionamiento de las vesículas seminales o próstata y anormalidades motrices y morfológicas de los espermatozoides [RAM07A]. Este examen se constituye además en un medio para dar seguimiento a intervenciones médico-quirúrgicas como la vasectomía, en el chequeo pre y post operatorio. En el ALS se realizan dos grupos de pruebas [OMS01]. La evaluación macroscópica analiza características físico-químicas del semen como aspecto, licuefacción, volumen, color, viscosidad y pH. Las pruebas microscópicas evalúan concentración, aglutinación, motilidad, viabilidad y morfología espermática, así como otros elementos celulares presentes (células epiteliales e inmaduras, leucocitos, eritrocitos, bacterias y otros residuos) [PAD88] [CER06]. La evaluación morfológica resulta ser, en la práctica, una actividad con altos costes en términos de pericia, tiempo y esfuerzo. Se trata de una tarea repetitiva donde el experto debe contar manualmente 200 espermatozoides y clasificarlos según sus características morfológicas, diferenciándolos apropiadamente de otras estructuras presentes en el semen. Se trata de un método vulnerable a la subjetividad y experticia de los profesionales resultando ser un procedimiento difícil de enseñar, con gran variabilidad, inexactitud y dificultad de replicación de sus resultados [KAT86]. Conciente de la vigencia, utilidad e importancia del ALS, así como de las dificultades asociadas a este examen, el proyecto ANALISE busca construir un sistema multi-agente cuya finalidad sea apoyar a los profesionales de las ciencias de la salud en el análisis de la calidad del semen humano [RAM07B]. En este marco de desarrollo, uno de los módulos o agentes se encargará de la clasificación morfológica de espermatozoides presentes en una muestra a través de imágenes digitalizadas de las escenas que analiza el experto. Específicamente, y de acuerdo a los objetivos propuestos por el proyecto ANALISE, el diseño del módulo de clasificación morfológica contempla el funcionamiento automático (o desasistido) definido en un algoritmo que opera en tres pasos lógicamente diferenciables: a) identificar espermatozoides, b) extraer las características presentes y c) a través de un paradigma o modelo de clasificación, asignar un rótulo o categoría morfológica a cada uno de estos espermatozoides. El propósito de esta investigación fue construir una herramienta, que partiendo de la definición de un modelo de procesamiento de imágenes digitales microscópicas del líquido seminal, identifique y extraiga desasistidamente características a los espermatozoides presentes en la escena. Los productos de esta investigación operan, en consecuencia, en dos vertientes: Por una parte, integran el módulo de clasificación morfológica del proyecto 8 ANALISE llevando a cabo los pasos a y b. Por otra parte, se constituye en una herramienta de soporte que, a través de una interfaz gráfica, permite la construcción de vectores que incorporan tanto las características automáticamente extraídas como las categorías morfológicas asignadas a tales espermatozoides por los expertos, lo que permitirá la estimación del modelo que finalmente clasificará desasistidamente los espermatozoides presentes. Este documento se encuentra estructurado en dos capítulos. En el Capítulo I se presenta la teoría relacionada al proceso de análisis de semen humano, una revisión de algunos conceptos básicos en el área de Inteligencia Artificial, así como una revisión de las técnicas de procesamiento digital de imágenes (PDI) comúnmente utilizadas para la segmentación y extracción de características. En el Capítulo II se analizan los antecedentes al problema y se propone una solución utilizando PDI describiendo detalladamente la combinación de técnicas utilizadas, además se presentan y analizan los resultados obtenidos. Por último, se presentan las conclusiones alcanzadas, se realizan recomendaciones para trabajos futuros y se señalan las limitaciones de la investigación. 9 CAPITULO I: MARCO TEÓRICO 1.1 ANÁLISIS DE LÍQUIDO SEMINAL Actualmente, el examen más utilizado para evaluar la infertilidad en el hombre, entendida como la incapacidad de procrear luego de un año de intentos sin usar métodos anticonceptivos, es el Espermograma [SPE04]. La Organización mundial de la Salud (OMS) define un protocolo de prueba que consta de dos partes: la evaluación macroscópica y la evaluación microscópica [OMS01]. En la Tabla 1 se muestran los aspectos evaluados en el ALS. Tabla 1: Características evaluadas en el ALS Prueba Característica Descripción Macroscópica Aspecto Homogeneidad o heterogeneidad de la muestra, color, presencia de cuerpos mucosos y fibrinas, opacidad/transparencia. Macroscópica Licuefacción Análisis de consistencia (líquida o con coágulos). Macroscópica pH Medido con papel especial de rango de 2 a 9, al cabo de 30 segundos se observa el color de la zona impregnada y se compara con la cartilla de calibración. Valor de referencia: mayor de 7.2. Macroscópica Viscosidad Propiedad de resistencia al movimiento uniforme de su masa. Normal en caso de observar un pequeño filamento, aumentada con filamento mayor a los 2 cm. de longitud. Macroscópica Volumen Medido con pipeta volumétrica tiene valor normal entre 2 y 6 ml. Microscópica Aglutinación Unión entre espermatozoides móviles por cualquiera de sus partes. Microscópica Concentración Cantidad de espermatozoides presentes en la muestra por unidad de volumen. Microscópica Otros elementos Presencia de células epiteliales e inmaduras, leucocitos, eritrocitos, bacterias y otros residuos. Microscópica Motilidad Espermatozoides móviles e inmóviles en la muestra, se clasifican en: Móviles progresivos rápidos, Móviles progresivos moderados, Móviles no progresivos e Inmóviles. Microscópica Morfología Evaluación de morfología de partes del espermatozoide: Cabeza, Cuello o Pieza Intermedia y Cola. Microscópica Viabilidad Proporción entre los espermatozoides inmóviles vivos y los espermatozoides inmóviles muertos. 1.1.1 MORFOLOGÍA ESPERMÁTICA Las subpruebas morfológicas llevadas a cabo en el ALS son de gran utilidad para la identificación de la infertilidad masculina, proveen una valiosa información que contribuye 10 al éxito de procedimientos de reproducción asistida como la fertilización in vitro y la inyección intransitoplasmática [KRU99]. Para llevar a cabo el análisis morfológico se recomienda usar el reactivo químico hematoxilina-eosina con el objetivo de diferenciar los espermatozoides a través de la coloración [OMS01]. Como resultado de este procedimiento, los espermatozoides y demás células adquieren tonos oscuros (cercanos al negro) sobre un fondo rojizo-naranja. La Figura 1 ilustra las partes que constituyen al espermatozoide humano: Cabeza (compuesta por Acrosoma y Post-Acrosoma), Pieza Intermedia (PI) y Cola. Los criterios de normalidad para un espermatozoide [OMS01] se enumeran en la Tabla 2. Si cualquiera de los valores obtenidos para estos parámetros está fuera del intervalo definido como aceptable, el espermatozoide es clasificado como anormal. Las malformaciones son clasificadas por regiones, en la Figura 2 se observan algunas de éstas. Tabla 2: Aspectos morfológicos evaluados Estructura Características Cabeza Ovalada, única, lisa, Acrosoma ocupa entre 40% y 70% del área. Longitud de 4-5 µm. Ancho 2.5-3.5 µm. Si existen vacuolas, no deberán ocupar más de la mitad del área. Pieza Intermedia Estrecha, unida axialmente, alineada con la Cabeza, sin restos citoplasmáticos, no debe exceder 1/3 del área de la Cabeza. Longitud 6-10 µm. Cola Uniforme, única, desenrollada, 45 µm de longitud, ligeramente más estrecha que la Pieza Intermedia, sin residuos citoplasmáticos. Figura 1: Partes del espermatozoide humano 11 Figura 2: Algunas anormalidades morfológicas del espermatozoide humano 1.2 INTELIGENCIA ARTIFICIAL La Inteligencia Artificial (IA) es un área de investigación compleja que ha sido definida en base a dos dimensiones [RUS02]. La primera hace referencia a la diferenciación entre el pensamiento y la acción, mientras que la segunda establece diferencias entre las capacidades inteligentes humanas y el concepto de inteligencia desincorporado de lo humano. En conjunto se generan 4 categorías de definiciones, en la Tabla 3 se muestran ejemplos de cada una de éstas. Las definiciones de las celdas superiores consideran los procesos de pensamiento y razonamiento, mientras que las definiciones de las celdas inferiores incluyen, además de estos, el comportamiento. En la columna izquierda se define a la IA mediante comparaciones entre el desempeño de los seres humanos y el sistema automático, mientras que las definiciones de la columna derecha realizan comparaciones con respecto al concepto ideal de inteligencia. 12 Tabla 3: Cuatro categorías de definiciones de IA [RUS02] "El excitante nuevo esfuerzo de hacer que las computadoras piensen… máquinas con mentes, en el completo y literal sentido " (Haugeland, 1985) "[La automatización de] actividades que asociamos con el pensamiento humano, actividades como la toma de decisiones, la resolución de problemas, el aprendizaje…" (Bellman, 1978) "El estudio de las facultades mentales a través del uso de modelos computacionales" (Charniak and McDermott, 1985) "El estudio de los cómputos que hacen posible percibir, razonar y actuar " (Winston, 1992) "El arte de crear máquinas que lleven a cabo funciones que requieren inteligencia cuando son ejecutadas por las personas " (Kurzweil, 1990) "El estudio del cómo hacer que las computadoras realicen cosas, que para el momento, las personas son mejores" (Rich and Knight, 1991) "Un campo de estudio que busca explicar y emular el comportamiento inteligente en términos de procesos computacionales" (Schalkoff, 1990) "La rama de la ciencia de la computación dedicada a la automatización del comportamiento inteligente" (Luger and Stubblefield, 1993) Dependiendo de la definición de IA adoptada, se plantean distintos tipos de investigaciones para resolver problemas en áreas igualmente diversas. Por ejemplo, la consideración al componente conductual caracteriza trabajos en el área de la robótica, a diferencia de investigaciones, como la presente, que buscan la automatización de actividades asociadas al pensamiento como la toma de decisiones. En cuanto a la segunda dimensión, las investigaciones que consideran el concepto ideal de inteligencia se orientan, por ejemplo, hacia la estimación de modelos cognitivos, a diferencia de trabajos (como el presente) que buscan emular pericias humanas específicas (por ejemplo, la detección de células microscópicas). Por consiguiente, de los conceptos expuestos el que mejor se ajusta a las características de esta investigación es el propuesto por Bellman (1978). 1.2.1 ÁREAS DE LA INTELIGENCIA ARTIFICIAL Con el objetivo de proporcionar una definición operacional satisfactoria del concepto de inteligencia, Alan Turing (1950) diseñó una prueba para medir el comportamiento inteligente de una máquina. Específicamente, lo define como la habilidad de lograr el desempeño humano en todas las actividades cognitivas, de manera suficiente como para lograr que el evaluador se confunda y no pueda diferenciar entre las respuestas humanas y las respuestas automáticas [RUS02]. Las capacidades requeridas a un sistema automático para realizar la prueba de Turing son: 1) Procesamiento de lenguaje natural para establecer la comunicación con el evaluador, 2) Representación del conocimiento para almacenar la información provista antes o durante la evaluación, 3) Razonamiento automático para utilizar la información almacenada y responder las preguntas elaborando conclusiones, 4) Aprendizaje automático para adaptar 13 el sistema a nuevas circunstancias, detectar y explorar patrones, 5) Visión automática para percibir objetos y 6) Robótica para mover objetos. A pesar de que la prueba no haya sido hasta el momento completada con éxito1, ha servido como punto de partida para un gran número de investigaciones en cada una de las áreas que define. La presente investigación, dadas sus características, se encuentra enmarcada en el área de aprendizaje automático. 1.2.1.1 APRENDIZAJE AUTOMÁTICO El área de aprendizaje automático se dedica a la adquisición automática del conocimiento. Es un campo relativamente amplio y ha dado lugar a distintas estrategias de abordaje como, por ejemplo, el aprendizaje inductivo, deductivo, genético y conexionista [HAG02]. El aprendizaje inductivo pretende definir modelos de conceptos a partir de la generalización de conjuntos de ejemplos, se buscan descripciones simples que expliquen las características comunes a estos. El aprendizaje analítico o deductivo obtiene descripciones generales a partir de un ejemplo de concepto y su explicación, esta generalización puede ser memorizada para ser utilizada en situaciones similares al ejemplo. El aprendizaje genético utiliza algoritmos inspirados en la teoría de la evolución para encontrar descripciones generales a conjuntos de ejemplos, la exploración que realizan estos algoritmos permiten encontrar la descripción más ajustada a dicho conjunto. Finalmente, el aprendizaje conexionista busca descripciones generales mediante el uso de la capacidad de adaptación de redes de neuronas artificiales, que tras un proceso de entrenamiento, registran el estado correspondiente al concepto aprendido [HAG02]. 1.2.1.1.1 REDES NEURONALES Las redes neuronales artificiales son un paradigma de aprendizaje y procesamiento automático inspirado en estudios realizados sobre el funcionamiento del sistema nervioso. Se trata de un sistema de interconexión de neuronas en una red que recibe un patrón de estímulo como entrada y produce una salida [RUS02]. Siguiendo la analogía entre el funcionamiento de las neuronas como unidades básicas del tejido nervioso, incluyendo el cerebro; una red neuronal se define como un conjunto de nodos conectados entre si a través de enlaces. Cada enlace contiene un peso numérico que se constituye en el medio de almacenamiento a largo plazo de la red neuronal. El modo de funcionamiento de cada neurona es el siguiente: la neurona recibe un patrón de señal como entrada, se realiza una suma ponderada aplicando los pesos a dicho patrón, y en función del resultado evaluado a partir de la función de activación, se emite una salida. [HAG02]. 1 El Premio Loebner es una competición que concede premios a un sistema automático de acuerdo a su rendimiento en la prueba de Turing. Hasta el año 2008, la mayor distinción se otorgó al programa alemán Elbot que recibió 3.000,00$ y una medalla de bronce, tras haber sido capaz de engañar al 25% de los jueces, que creían estar conversando con un humano. [dirección Web: http://www.loebner.net/Prizef/loebner- prize.html] 14 Las redes neuronales, por lo general, están compuestas por capas de neuronas (redes multi- capas) de modo que las salidas de una capa están completamente conectadas a las entradas de la capa siguiente, aunque es posible definir redes que no cumplan con esta condición como las que se encuentren parcialmente conectadas y las que presentan realimentación de neuronas hacia sí misma (redes recurrentes). Las redes mono-capa, por el contrario, son aquellas compuestas por una única capa de neuronas [HAG02]. El Perceptron en una red neuronal compuesta por una capa de entrada y otra de salida, lo que equivale en la práctica a una capacidad de representación limitada ya que sólo permite la discriminación de patrones linealmente separables. El Perceptron Multicapa, en cambio, es un tipo de red neuronal utilizada para clasificar conjuntos no separables linealmente pudiendo ser total o localmente conexa [FRE93]. En la Figura 3 se muestra un ejemplo de arquitectura Perceptron Multicapa. Figura 3: Ejemplo de arquitectura Perceptron Multicapa El proceso de entrenamiento de una red neuronal consiste en la adaptación progresiva de los valores de las conexiones sinápticas (pesos) con el propósito de lograr el aprendizaje deseado. Dependiendo del tipo de red, este procedimiento puede clasificarse en supervisado y no supervisado [FRE93]. El entrenamiento supervisado requiere conocer los valores de salida esperados para todas las entradas, a diferencia del entrenamiento no-supervisado. Para llevar a cabo el algoritmo se debe proporcionar a la red entradas con los datos de entrenamiento, las salidas obtenidas se comparan con las salidas esperadas y se calcula la diferencia estimando el error de la respuesta de la red [RUS]. Existen algoritmos de aprendizaje supervisado como el de retro-propagación del error (backpropagation) que actualizan los pesos de la red utilizando el método de descenso por el gradiente [FRE93]. Específicamente, se divide el cálculo entre las distintas unidades de manera que el cambio en cada peso pueda calcularse utilizando información local. El peso de cada conexión a una unidad de salida se ajusta en la dirección adecuada (excitadora o inhibidora) y en la proporción adecuada para reducir el error. Se sigue este procedimiento para ajustar los errores de cada una de las capas. Los pasos anteriores se repiten a través de un número de ciclos para diferentes patrones de entrada-salida hasta que el sistema converja y se obtengan los pesos adecuados 15 1.2.3. SISTEMAS MULTIAGENTES Un agente es cualquier entidad que percibe su entorno a través de sensores y actúa sobre este mediante efectores. El agente es considerado racional cuando realiza la mejor acción posible a partir de los datos percibidos [RUS02]. Los Sistemas Multi-agentes colaboran para resolver problemas, donde cada agente cumple una función específica y coopera con los otros a los fines de alcanzar los objetivos planteados. Los SMA son especialmente adecuados, en lugar de soluciones de software tradicionales, en aquellas situaciones en las que el grado de complejidad del problema es tal que la solución difícilmente puede ser alcanzada por un solo agente, el conocimiento se encuentra distribuido o el problema puede ser descompuesto en sub-problemas [RAM07B]. 1.3 IMAGEN DIGITAL Una imagen (del latín imago) es una representación visual de un objeto mediante distintas técnicas como pintura, fotografía, tomografía, video y otras [GAR91]. Las imágenes digitales son aquellas que se almacenan y representan en el computador a través de secuencias de valores binarios. En general, pueden identificarse dos tipos o categorías de imágenes digitales: mapas de bits e imágenes vectoriales [UMB05]. El mapa de bits es el mecanismo comúnmente utilizado por los dispositivos de registro de imágenes. Consiste en un conjunto de puntos o píxeles con valores de color y luminancia propios; almacena por lo tanto todos los puntos visibles de la imagen. La imagen vectorial, en cambio, consiste en un formato que recurre al uso de métodos para representar líneas, curvas y formas almacenando únicamente puntos claves. 1.3.1 ESPACIOS DE COLOR EN IMÁGENES DIGITALES En la naturaleza, los colores obtenidos por descomposición de la luz a partir de tres longitudes de onda se denominan colores aditivos [PRA07]. Reciben este nombre ya que la mezcla de intensidades de sólo tres de ellos: rojo, verde y azul (Red, Green, Blue, RGB) permite obtener todos los colores del espectro visible. Matemáticamente, el espacio de color es un modelo que se define a partir de una base de N vectores, cuya combinación lineal genera todo el espacio de color. El propósito de estos modelos de composición es facilitar una conveniente especificación de un color dentro del espectro de colores [FOL93]. Existen espacios que intentan englobar la mayor cantidad posible de los colores visibles por el ojo humano, aunque otros aíslan tan solo un subconjunto de ellos. Los espacios de color se definen en base a una o más dimensiones. Por ejemplo, como puede verse en la Figura 4, un espacio bastante útil definido en una dimensión es la Escala de Grises. En ésta, las imágenes están conformadas por variaciones de intensidades de gris siendo la menor intensidad el color negro y la mayor intensidad el color blanco [RUS07]. 16 Figura 4: Imagen en Escala de Grises Los espacios de color bidimensionales generalmente se construyen a partir de subespacios de dimensiones superiores. Por ejemplo, el subespacio RG se construye en base al espacio RGB. También pueden definirse subespacios de color basados en otros espacios tridimensionales (como el modelo Hue Saturation Value, HSV) y tetradimensionales (como el modelo Cyan Magenta Yellow and Key, CMYK). Los espacios de color de tres dimensiones son ampliamente utilizados. En ellos, los colores se representan mediante tres coordenadas o atributos. Existen varios tipos y la utilidad de cada uno se determina según las características de la aplicación que lo requiera [TIN05]. Para la presente investigación, un espacio de color tridimensional que resultó de gran utilidad fue el modelo RGB. En el modelo de color RGB se le asigna un valor entre 0 y 255 a cada uno de los componentes (rojo, verde y azul) que forman el color [RUS07]. Los valores más altos de RGB corresponden a una cantidad mayor de luz blanca, mientras que los más bajos definen los colores más oscuros. En la Figura 5 se muestra una forma de visualizar este modelo normalizando las coordenadas de color. Figura 5: Modelo de color RGB 17 1.4 PROCESAMIENTO DIGITAL DE IMÁGENES El procesamiento digital de imágenes es el conjunto de técnicas que se aplican a las imágenes digitales con el objetivo de mejorar su calidad o facilitar la búsqueda de información resaltando ciertas características de interés. El análisis y procesamiento de imágenes digitales sigue uno de dos enfoques existentes: considerar la imagen en el dominio espacial o considerarla en el dominio frecuencial [RUS07]. En el dominio espacial, la imagen puede verse como una señal con saltos discretos que se representa mediante la variación de intensidades de color por unidad de tiempo. En el dominio frecuencial, la imagen se representa por los componentes de la señal según la frecuencia y el desplazamiento de fase. Existen numerosas técnicas de procesamiento de imágenes que pueden aplicarse desde el dominio espacial o desde el dominio frecuencial, en última instancia, su valor dependerá en gran medida de las características del problema que se desee abordar. Considerando heurísticamente el problema (localizar espermatozoides en la escena), algunas técnicas que mostraron gran valor fueron: Convolución (filtros y detección de bordes), Análisis de Histograma, Operaciones Aritméticas, Segmentación (Umbralización, Operadores de Textura), Operaciones Lógicas y Operaciones Morfológicas (Erosión y Dilatación), 1.4.1 CONVOLUCIÓN La Convolución es una operación llevada a cabo en el dominio espacial. Consiste en la suma de los productos entre los valores de un núcleo (de tamaño NxM, con N y M impar) y los valores de los píxeles de una región equivalente en la imagen. El resultado se le asigna al píxel de la imagen que equivalga a la posición central del núcleo para un instante dado. En la Convolución, el núcleo se desplaza sobre los píxeles de la imagen modificando sus valores a través de un mecanismo de ventana deslizante [CRA97]. La operación puede representarse de la siguiente forma: g(x,y) = f(x,y) a(x,y) Donde a(x,y) es la función respuesta al impulso del filtro a aplicar (también denominado núcleo o máscara de Convolución), f(x,y) es la imagen de entrada y g(x,y) es la imagen filtrada. La expresión matemática para el caso bidimensional es la siguiente: Existen muchas aplicaciones de núcleos de Convolución. En general se utilizan para suavizado y reducción de ruidos (ej. filtro Gaussiano), al tomar la primera derivada se detectan bordes en la imagen (filtros de Prewitt, Sobel y Roberts, etc.), la segunda derivada permite lograr el efecto de operadores no direccionales que actúan como filtros pasa-alto para aumentar el contraste [CRA97], además de una serie de efectos visuales con fines 18 artísticos. En la Tabla 4 se muestran los principales filtros de detección de bordes bajo una acción de Convolución. Tabla 4: Algunos filtros usados para la detección de bordes [PRA07] Operador de gradiente Dirección Horizontal Dirección Vertical Roberts 0 0 -1 0 1 0 0 0 0 -1 0 0 0 1 0 0 0 0 Prewitt -1 0 1 -1 0 1 -1 0 1 -1 -1 -1 0 0 0 1 1 1 Sobel -1 0 1 -2 0 2 -1 0 1 -1 -2 -1 0 0 0 1 2 1 Isotrópico -1 0 1 -√2 0 √2 -1 0 1 -1 -√2 -1 0 0 0 1 √2 1 1.4.2 ANÁLISIS DE HISTOGRAMA El Histograma de una imagen digital cuyos valores de píxel estén en el rango (0, L-1) es una función discreta f(rk) = nk, donde rk es el k-ésimo nivel de intensidad del canal y nk es el número de píxeles en la imagen que tienen el nivel rk. Es una práctica común normalizar el Histograma dividiendo cada uno de sus valores entre el número total de píxeles en la imagen denotado por n. Así la versión normalizada del Histograma permite estimar la distribución de probabilidad de ocurrencia del nivel rk [GON02]. Los Histogramas proveen estadísticas útiles que resultan de gran importancia para operaciones de segmentación y compresión de imágenes [GON02]. Son además la base de numerosas técnicas de procesamiento en el dominio espacial. En la Figura 6, se muestra una representación gráfica del Histograma de una imagen en escala de grises. Figura 6: Representación gráfica del Histograma de una imagen 19 1.4.3 OPERACIONES ARITMÉTICAS Las Operaciones Aritméticas entre imágenes digitales son herramientas de gran utilidad para mejorar la calidad de la imagen, así como para facilitar la extracción de características. Existen muchos ejemplos de su aplicabilidad, siendo uno de ellos el campo de la Visión Artificial, donde la identificación de diferencias entre cuadros temporales de una escena hace posible la identificación de cambios en el estado de los objetos presentes [RUS07]. En general, las operaciones aritméticas básicas con imágenes digitales son: suma, resta, multiplicación y división entre píxeles homólogos. Dado que los mapas de bits se definen mediante arreglos de números, estas operaciones deben efectuarse con precaución para evitar desbordamientos en el rango de los valores permitidos [BOV00]. Por lo tanto, no resulta, en este contexto, una función lineal. Supóngase n imágenes de dimensión NxM (todas deben tener el mismo tamaño) la suma entre ellas se define como: La resta de dos imágenes f1, f2 se define como: fr = f2 - f1 El producto de n imágenes se define como: La división de dos imágenes f1, f2 se define como: fr = f2 / f1 Donde f1 debe ser distinto de cero. 1.4.4 SEGMENTACIÓN La Segmentación de una imagen consiste en la aplicación de una serie de pasos (o algoritmo) que la particionan en un conjunto de regiones homogéneas y significativas, de modo que los píxeles en cada región posean una cantidad idéntica de propiedades o atributos (como por ejemplo, niveles de gris, contraste, valores espectrales o propiedades de textura). El resultado de la Segmentación es la identificación de regiones conectadas entre sí y no superpuestas [TIN05]. Matemáticamente la operación de Segmentación de una imagen R se define como: R = R1 U R2 U R3 U …Rn Donde Ri son las regiones resultantes para 0< i < n. 20 Dos técnicas ampliamente utilizadas en la Segmentación de imágenes son la Umbralización y los Operadores de Textura. 1.4.4.1 UMBRALIZACIÓN La técnica de Umbralización es un procedimiento que requiere de pocos recursos computacionales. Permite separar una imagen digital en regiones de interés mutuamente excluyentes a partir de un valor umbral definido por algún método [TIN05]. Para aplicarla, basta asignar a los píxeles de la imagen resultante una intensidad de color en función al conjunto de pertenencia definido para la imagen de entrada. Por ejemplo, supóngase que para una imagen en escala de grises se ha definido el umbral u=100 (0<= u<=255), los píxeles cuya intensidad i sea menor a u tendrán el valor v1, caso contrario tendrán el valor v2. Este algoritmo puede extenderse a múltiples umbrales diferenciando varias regiones, la función para n umbrales se define de la siguiente forma: Los umbrales pueden determinarse manual o automáticamente [RUS07]. El algoritmo de cálculo de umbral automático de Otsu se basa en el supuesto de que en la distribución de probabilidades del Histograma existen dos clases. En este sentido, el umbral óptimo debe maximizar la varianza de separación entre las clases y minimizar la varianza interna a cada clase [OTS79]. 1.4.4.2 OPERADORES DE TEXTURA Existen ocasiones en las que las regiones características no se definen a partir de intensidades de color, se constituyen por el contrario en base a patrones en la variación entre intensidades, lo que a menudo se conoce como texturas [RUS07]. En estos casos, no resulta conveniente considerar aisladamente la intensidad de color de un píxel para decidir la región a la que pertenece. Una estrategia que comúnmente se utiliza consiste en clasificar el píxel en función de la variación de la intensidad de color de la vecindad que lo incluye. Los operadores de textura se aplican siguiendo el mecanismo de ventana deslizante descrito para la convolución. Utilizan criterios estadísticos de dispersión como la varianza o el rango de variación en la vecindad para asignar al píxel central un valor. Se pueden aplicar varios criterios estadísticos para construir operadores de textura, utilizando igualmente diversos tamaños y formas de núcleos (cuadriláteros y circulares). Por ejemplo, en el operador Varianza se asigna al píxel central el valor de la varianza calculada para todos los píxeles que pertenecen en un instante dado al núcleo. El operador Rango, por su parte, asigna al píxel central la diferencia entre la intensidad máxima y la 21 intensidad mínima. En la Figura 7 se muestra el resultado de estos operadores al ser aplicados sobre la imagen del cuadro izquierdo. Figura 7: Operadores de Textura (tomado de [RUS07]) 1.4.5 OPERADORES LÓGICOS Las imágenes binarias separan los píxeles asignándolos a uno de dos conjuntos en base a alguna propiedad. La selección puede realizarse mediante umbralización de intensidades de brillo en escalas de grises o color RGB, también puede resultar del procesamiento de la textura u otra información. La meta de la binarización es separar las características del fondo, de modo que se pueda aplicar operaciones de conteo, medición y ajuste [RUS07]. Por lo general, a los píxeles de las regiones características se les asigna el valor 1 y al fondo el valor 0. En ocasiones, el resultado de la operación de segmentación no resulta correcto, sobre todo para imágenes realistas y complejas donde se clasifica erróneamente algunos píxeles de fondo como región de interés. Estos errores suelen ocurrir en los bordes de las regiones o dentro de éstas debido a la presencia de ruido en la captura de la imagen [RUS07]. Un grupo de herramientas bastante útil para solucionar este problema son los operadores lógicos o booleanos. Los operadores lógicos son cuatro: AND, OR, XOR y NOT. Los tres primeros combinan dos imágenes de entrada para producir una imagen de salida, mientras que el último solo requiere de una imagen de entrada. La Figura 8 ilustra cada una de estas operaciones. En la operación AND un píxel tendrá valor 1 en la imagen de salida si su valor para las dos imágenes de entrada es 1. En la operación OR un píxel tendrá valor 1 en la imagen de salida si su valor para al menos una imagen de entrada es 1. En la operación XOR un píxel tendrá valor 1 en la imagen de salida si tiene valor 1 para una sola imagen de entrada. Finalmente, el operador NOT invierte el valor del píxel para la imagen de entrada en la imagen de salida. 22 Figura 8: Operadores Lógicos (modificado de [RUS07]) 1.4.6 OPERADORES MORFOLÓGICOS Otra alternativa para corregir los errores resultantes del procedimiento de segmentación son los Operadores Morfológicos. El procesamiento morfológico de una imagen binaria es una operación que se realiza en el dominio espacial con el objetivo de modificar la estructura de las regiones características [PRA07]. Las propiedades geométricas más importantes de las imágenes binarias son: conectividad, área y perímetro [TIN05]. El análisis de cada una de ellas arroja información de gran utilidad para el procesamiento de la imagen. Por ejemplo, una región característica podría definirse en base a la conectividad entre los píxeles de una parte de la imagen; el área, puede servir como indicador de la proporción de una región con respecto al tamaño de la imagen mientras que el perímetro puede informar acerca de la forma de una región. Formalmente, la conectividad entre píxeles de una imagen binaria se define como: Un píxel P0 en la posición (i0,j0) está conectado a otro píxel Pn en la posición (in,jn) si y solo si existe un camino desde P0 a Pn entendido como una secuencia de puntos (i0, j0), (i1, j1) , … , (in, jn), tal que el píxel en la posición (ik,jk) es un vecino del píxel en la posición (ik+l, jk+l) y Pk=Pk+1 para todo k, 0<k<n-1 [TIN05]. Como puede verse en la Figura 9, en función a las características del problema es posible definir varios tipos de conectividad, lo que permite identificar regiones en la imagen (cuadro de la derecha). 23 Figura 9: Propiedad de conectividad en imágenes binarias La Dilatación y Erosión son operaciones morfológicas fundamentales que se basan en la propiedad de conectividad entre un píxel y sus vecinos. A grandes rasgos podría decirse que la Dilatación es una operación que permite que una región crezca uniformemente, mientras que con la Erosión, la región se reduce uniformemente [PRA07]. Para llevar a cabo estas operaciones se define un patrón de comparación (o elemento estructurante), que al igual que en la operación de convolución, consiste en un núcleo situado sobre la región que rodea al píxel de interés. Si los píxeles cumplen lógicamente con la conectividad del elemento estructurante, al píxel central se le asignará el valor 1 para la Dilatación y el valor 0 para la Erosión. Si no se cumple con la conectividad del elemento estructurante, el píxel central conservará su valor tanto para la Erosión como para la Dilatación. En la Figura 10 puede verse el efecto de estas operaciones sobre una imagen binaria. Figura 10: Operaciones morfológicas de Dilatación y Erosión. 24 CAPITULO II: MARCO APLICATIVO 2.1 PLANTEAMIENTO DEL PROBLEMA Las dificultades inherentes a las subpruebas morfológicas, llevadas a cabo como parte del Espermograma, hacen que en la práctica sea deseable lograr una automatización de este proceso. En efecto, se trata de una actividad que por sus características resulta vulnerable a la subjetividad y fatiga del examinador, lo que cuestiona la confiabilidad de los resultados que arroja (en ocasiones muestra baja correlación entre juicios de expertos) [KAT86]. La clasificación morfología y el conteo espermático son actividades de naturaleza iterativa. Inicialmente, el experto prepara las muestras y las sitúa en el microscopio. Luego, para realizar la prueba, utiliza una técnica de desplazamiento en la escena en forma de “S” que busca evitar considerar varias veces al mismo elemento. A medida que se posiciona en la escena, registra en uno de cuatro contadores asignados a los dedos de la mano (índice, medio, anular y meñique) el resultado de la clasificación del elemento. Las cuatro categorías que registra incluyen: espermatozoide normal, defecto de cabeza, defecto de pieza intermedia y defecto de cola. Este procedimiento se repite hasta completar un total de 200 espermatozoides [OMS01] El procedimiento descrito puede ser objeto de varias fuentes de error. En este sentido, podría ocurrir que el examinador se equivoque estimando la morfología del espermatozoide, o que clasifique correctamente al espermatozoide, pero, debido al cansancio, lo registre erróneamente en otro contador. Finalmente, por distracción o fatiga, podría perderse la secuencia de desplazamiento en la escena y considerarse por duplicado algún elemento. Además de las fuentes de error presentes, otro aspecto que merece ser señalado se relaciona con la precisión del reporte morfológico que genera el experto. Específicamente, y como sólo dispone de cuatro categorías de clasificación mutuamente excluyentes, se pierde información cuando ocurren defectos en más de una categoría. Por otra parte, dentro de un mismo grupo existen varios tipos de defectos que el experto no registra para agilizar el procedimiento. Si fuera posible mantener el registro específico de los defectos encontrados, probablemente se logre un análisis cualitativo más preciso y detallado. Por los factores antes señalados, resulta útil proveer a estos profesionales de mecanismos auxiliares que les permitan realizar el trabajo con mayor eficiencia, mayor precisión y menor esfuerzo. En consecuencia, el proyecto ANALISE desarrollado en el Laboratorio de Inteligencia Artificial conjuntamente con la Escuela de Bioanálisis de la Universidad Central de Venezuela, se plantea como objetivo construir un sistema multi-agente cuya finalidad sea apoyar a los profesionales de las ciencias de la salud en el análisis de la calidad del semen humano [RAM07B]. Este proyecto incorpora como uno de sus módulos o agente constituyente uno de clasificación morfológica automática de espermatozoides presentes en imágenes digitalizadas de las escenas que analiza el experto. 25 2.1.1 ANTECEDENTES La automatización de procedimientos que tengan que ver con la salud (diagnóstico y clasificación) ha tenido, afortunadamente, un interés generalizado en la computación emergente. En particular el estudio y clasificación morfológica automática de estructuras microscópicas ha sido un campo de intensa investigación. Los trabajos en el área reflejan diversas estrategias de abordaje. En este sentido, una primera corriente de investigación ha consistido en aplicar técnicas de procesamiento digital de imágenes para segmentar regiones de interés. El objetivo de este procedimiento es eliminar ruido así como objetos no deseados. Las estructuras resultantes se codifican posteriormente en vectores de características y se propagan a través de una red neuronal, que en última instancia los clasificará morfológicamente. Siguiendo esta estrategia, se ha abordado, por ejemplo, la clasificación de glóbulos blancos basada en operaciones morfológicas (básicamente erosión y dilatación) [THE03]. También se ha automatizado la identificación de la composición botánica de la dieta del ganado caprino recurriendo a técnicas de procesamiento de imágenes como conversión de color RGB a escala de grises, ecualización de histograma y umbralización a tres niveles, utilizando para la clasificación una red neuronal con retropropagación del error [LAR04]. En ocasiones, la calidad de la imagen a procesar es baja debido a la presencia de ruido. Para estos casos el conocimiento heurístico de la morfología en análisis resulta muy importante, ya que permite economizar el procesamiento destinado a mejorar la calidad y centrarse en las regiones de interés. De hecho, algunas estrategias incorporan la probabilidad de pertenencia de los píxeles a una región característica en función de su localidad espacial, por ejemplo, para la detección de células [BAK04]. La simple identificación inicial de las características en la imagen que se desea procesar, sin embargo, se convierte en un problema objeto de estudio. En efecto, existen investigaciones que se dedican principalmente a estimar los atributos que mejor representan al objeto que se desea segmentar. Por ejemplo, en un estudio destinado al reconocimiento de células en la sangre de pacientes leucémicos [MAR06], se identifican cuatro fuentes de atributos para los objetos: geométricos (radio, perímetro, área, simetría, etc.), de textura (interrelaciones entre arreglos espaciales de los píxeles de la imagen), de distribución de intensidades de color (análisis de histograma) y morfológicos (operaciones morfológicas). En vista de esta complejidad han surgido otras estrategias. Se ha intentado integrar técnicas de inteligencia artificial al proceso de segmentación entrenando una red neuronal para reconocer los objetos de interés. El procedimiento consiste en: 1) extraer de la imagen todos los posibles rectángulos de píxeles (cuyo tamaño se determina mediante el conocimiento heurístico de las dimensiones de los objetos buscados) siguiendo un mecanismo de ventana deslizante, y, 2) las sub-imágenes resultantes se codifican en vectores y se pasan a la red que identificará las regiones características presentes [LON05]. Este procedimiento tiene la ventaja de simplificar el diseño de la investigación ya que prescinde del uso de técnicas de procesamiento de imágenes, pero requiere que los objetos a segmentar tengan dimensiones y aspecto uniforme. 26 Sin embargo, existen casos como el de los espermatozoides, en los que las características a clasificar presentan forma, dimensiones y estructura variante lo que dificulta la aplicación de conocimiento heurístico para diferenciarlas desasistidamente. De hecho, algunos trabajos proponen soluciones semi-automatizadas donde se pide al usuario, o bien definir los contornos de las estructuras [KAT86], o marcar los que detecte la aplicación erróneamente [BUE02]. Esta estrategia tiene como ventaja la minimización de los errores cometidos por falsos reconocimientos, pero resulta muy incómoda y poco eficiente cuando la tarea debe repetirse un gran número de veces. Las dificultades asociadas al problema de la automatización, han dirigido el foco de interés de algunas investigaciones hacia el análisis de un subconjunto de la morfología espermática. En efecto, en un estudio que se propuso estimar la calidad del semen de verraco a partir de la caracterización de las cabezas de espermatozoides, se utilizó dos tipos de descriptores de imagen basados en momentos estadísticos (momentos de Hu y Zernike), y una red neuronal Perceptron multicapa con función de activación sigmoidal [ALE04]. Los resultados indican que los momentos Hu constituyen características más relevantes para clasificar estas estructuras, pero no se reporta el error cometido durante el proceso de clasificación automática. En otro estudio, cuyo propósito fue la clasificación de cabezas de espermatozoides humanos, se procesaron imágenes en el dominio frecuencial construyendo un vector característico a partir de los coeficientes de Fourier [LIN94]. Esta información se ingresaba a una red neuronal con retropropagación del error, que en última instancia los clasificaba en normales y anormales. La investigación reporta resultados con un margen de error del 25%, afirmando que se trata de una proporción equivalente a los errores cometidos por humanos. Una investigación destinada a comparar el uso de descriptores de textura (estadísticos de segundo orden sobre matriz de coocurrencia), con descriptores geométricos de cabezas de espermatozoides de verracos a través de un clasificador k-vecinos, reporta una tasa de aciertos “no muy alta” a pesar de no especificarla [SAN05]. No obstante, los resultados indican que los descriptores de textura resultaron más efectivos que los descriptores geométricos. En la Universidad Central de Venezuela, se llevo a cabo un estudio donde se propuso desarrollar un modelo de clasificación automático de la morfología de cabezas de espermatozoides, basado en una red neuronal Perceptron multicapa y el procesamiento digital de imágenes [CAL07]. La investigación reporta la tasa de 28% de identificación errónea de células espermáticas, resultando considerablemente mayor el error que se comete al distinguir entre cabezas normales y anormales (entre 40% y 57%). Dado que la complejidad de estas operaciones no es equivalente (se presentan mayores discrepancias entre los juicios de expertos al momento de clasificar el espermatozoide como normal o anormal, en comparación a la identificación de este), es posible que los resultados se vean afectados, aparte de los errores cometidos durante el procesamiento de las imágenes, por errores introducidos por el experto durante la fase de entrenamiento del modelo de clasificación, ya que recurre a un paradigma de aprendizaje de tipo supervisado. 27 Tal vez la investigación que mejores resultados reporta considera el estudio morfológico de la cabeza y pieza intermedia del espermatozoide [CAR07]. Para lograr la automatización, se recurrió al uso de procesamiento digital de imágenes prescindiendo de técnicas de inteligencia artificial. La clasificación de las estructuras resultantes se realizó mediante la conversión entre distancias de píxeles y micrómetros comparando los valores con los rangos descritos como normales por la OMS. Los resultados indican una tasa de acierto de 95,78% para los espermatozoides presentes, 89,5% para cabezas; 88,9% para acrosoma; 88,9% para post-acrosoma y 85% para pieza intermedia. Sin embargo, el procedimiento requiere de ciertas condiciones como alta resolución de las imágenes (3072x2304) y factor de magnificación microscópica (Zoom) de 600X (por lo general los expertos utilizan 100X). Por otra parte, las imágenes utilizadas en las pruebas correspondieron a escenas que en promedio contenían 1,34 espermatozoides (216 imágenes con 285 espermatozoides), lo que en la práctica convierte a este procedimiento en semi-automático ya que la captura de las imágenes funciona como una segmentación inicial. Como puede verse, el debate en torno a la automatización de la clasificación morfológica de espermatozoides y células en general no resulta concluyente. Evidencia un área de investigación activa y compleja cuyos productos se sitúan en varios niveles de análisis. En este sentido, una primera vertiente analítica tiene que ver con la estimación del mejor método para identificar las células presentes, lo que resulta determinado en gran medida por consideraciones heurísticas. En general se observan tres tipos de aproximaciones: a) usar técnicas de Inteligencia Artificial, b) usar técnicas de procesamiento digital de imágenes y c) recurrir a un enfoque intermedio entre las dos anteriores. La segunda categoría de análisis tiene que ver con la determinación del tipo de características que mejor representan las células espermáticas y microscópicas en general. Algunos trabajos sugieren descriptores de tipo estadísticos, otros sugieren criterios morfológicos y así sucesivamente hasta incluir por extensión a los criterios de textura, intensidad de color y geométricos. Finalmente, la determinación del modelo de clasificación se constituye en la tercera categoría de análisis. Las investigaciones revisadas reportan una gran variedad de enfoques y paradigmas de clasificación para la simulación del conocimiento humano. 2.1.2 PROPUESTA DE SOLUCIÓN Los trabajos revisados en el campo de la automatización de procesos diagnósticos de estructuras microscópicas, sugieren un área compleja, que para su abordaje requiere ser prudentemente dividida en al menos tres sub-problemas o pasos lógicos, a saber: a) Identificación de espermatozoides presentes, b) Extracción de características y c) Clasificación morfológica. Como aporte a la solución del problema, la presente investigación aborda los dos primeros estadios del procesamiento. El tercer estadio, dada la gran cantidad de modelos de clasificación y representación artificial de pericias humanas existentes, además de las 28 características específicas al conocimiento que se desea simular se constituye por su complejidad en un tópico que merece ser abordado independientemente. Para lograr la identificación y extracción de características automáticas de las células espermáticas, el presente trabajo se propone emprender la construcción de una aplicación o programa, que basado en una combinación de técnicas de procesamiento digital de imágenes, reciba como entrada imágenes microscópicas del líquido seminal humano, produciendo como salida un vector de características morfológicas automático de los espermatozoides presentes en la escena. Específicamente, y de acuerdo a los objetivos propuestos por el proyecto ANALISE, los productos de esta investigación operan en dos vertientes: Por una parte, integran el módulo de clasificación morfológica del proyecto llevando a cabo los pasos a y b (ver introducción). Por otra parte, se consiste en una herramienta de soporte que, a través de una interfaz gráfica, permite la construcción de vectores que incorporan tanto las características automáticamente extraídas como las categorías morfológicas asignadas a tales espermatozoides por los expertos, lo que permitirá la estimación del modelo que finalmente clasificará desasistidamente los espermatozoides presentes. 2.2 OBJETIVOS El objetivo de la presente investigación consiste en: 2.2.1 GENERAL Desarrollar una herramienta para la identificación y extracción automática de características de células espermáticas humanas, que funcione a partir de la definición de un modelo basado en técnicas de procesamiento digital de imágenes. 2.2.2 ESPECÍFICOS - Diseñar un algoritmo de segmentación que aplicado a imágenes de escenas microscópicas del líquido seminal humano, permita identificar, con el menor margen de error posible, los espermatozoides presentes. - Diseñar un algoritmo de extracción de características que permita medir y codificar las distintas estructuras presentes en las regiones resultantes del procedimiento de segmentación, que opere con el menor margen de error posible. - Desarrollar una librería de procesamiento que codifique los algoritmos de segmentación y extracción de características, que pueda ser fácilmente incorporada a la plataforma multi- agente ANALISE. - Desarrollar una aplicación interactiva que facilite a los expertos procesar las imágenes de las escenas de espermatozoides, así como introducir etiquetas de clasificación con el objetivo de construir vectores de características para estimar modelos de clasificación. 29 2.3 PROCESAMIENTO DE IMÁGENES DE ESPERMATOZOIDES HUMANOS A continuación se describen las fases de adquisición, pre-procesamiento, segmentación y extracción de características de las imágenes analizadas. 2.3.1 ADQUISICIÓN DE IMÁGENES Siguiendo las características del entorno de trabajo del experto, se utilizó un banco de 294 imágenes capturadas desde un microscopio Leica modelo DM LS2. El procedimiento consistió en explorar cada lámina con el objetivo de aumento 10x posicionando la muestra en las regiones con menor densidad de espermatozoides para evitar agrupamientos. Una vez ubicadas las regiones poco congestionadas, se utiliza el objetivo de aumento 100x. Siguiendo la técnica de recorrido de escena en forma de “S”, se capturan las imágenes con la ayuda de una cámara Cannon modelo PowerShot S50 de 5.0 mega píxeles. Este procedimiento se repite hasta lograr al menos 200 espermatozoides, por lo tanto, el número de escenas para cada lámina dependerá de la concentración espermática de la muestra. En esta investigación se disponía de láminas en las que esta condición se obtenía con un grupo de 6 a 44 imágenes por lámina. Finalmente, la resolución de las imágenes fue 1600x1200 píxeles, tomadas en las mismas condiciones de iluminación que utiliza el experto al momento de analizar las muestras. 2.3.2 PRE-PROCESAMIENTO DE IMÁGENES En general, los trabajos de investigación en el área sugieren que para facilitar y optimizar la aplicación de técnicas de segmentación, así como con la mayoría de las técnicas de procesamiento disponibles, resulta conveniente operar sobre la imagen en un espacio de color unidimensional, y las imágenes de los espermatozoides se registraron en el espacio de color RGB. La primera decisión que se debía tomar era determinar la mejor estrategia a seguir para convertir de color RGB a escala de grises con la menor pérdida de información posible. En las referencias revisadas se señalan varias estrategias para realizar la conversión, siendo las más comunes las dos siguientes: a) tomar el promedio de los tres componentes RGB, o b) tomar proporciones distintas de cada componente basado en estudios médicos sobre los receptores de color en la visión humana. Estas estrategias se probaron y arrojaron resultados similares. No obstante, un abordaje menos común, que dio mejores resultados, consistió en analizar el histograma de cada canal y determinar los canales que aportaban mayor información de contraste a la escena. De acuerdo a este análisis, los canales rojo y verde aportaban de manera natural gran cantidad de información de contraste, a diferencia del canal azul. La Figura 11 muestra una imagen de la escena microscópica vista desde cada canal RGB. Los algoritmos de segmentación, por consiguiente, operan utilizando como entrada la imagen en escala de grises replicando el canal rojo o el canal verde; se decidió prescindir del canal azul. 30 Figura 11: Comparación entre canales RGB Una vez convertida la imagen original a dos imágenes en escala de grises, se aplicó la técnica de umbralización a dos niveles (binarización) sobre la imagen del canal rojo (por ser este el que presentaba la mayor dispersión en la distribución de frecuencias del histograma) utilizando un umbral global calculado a partir del método de Otsu [OTS79]. La imagen binarizada resultante permitió construir dos estructuras matriciales: la Máscara del Área de Procesamiento (MAP) y la Máscara de cabezas de Espermatozoides (MCE). La MAP cumple la función de delimitar la región a procesar, excluyendo los bordes negros que caracterizan las imágenes microscópicas. Se trata de una matriz de valores binarios que indica si el píxel i,j debe o no ser procesado por los algoritmos de segmentación. Adicionalmente, al calcular esta matriz se tuvo especial cuidado en guardar las posiciones limítrofes horizontales que restringen el área de procesamiento. La idea es evitar que los algoritmos de segmentación desperdicien iteraciones en los píxeles muy cercanos a los bordes horizontales. En la Figura 12 se muestra un ejemplo de esta estructura. Figura 12: Máscara del Área de Procesamiento 2.3.3 SEGMENTACIÓN DE IMÁGENES El algoritmo de segmentación resultó complejo y requirió de la combinación de varias técnicas de procesamiento digital de imágenes, así como de la definición de algunas estructuras de datos matriciales que se enumeran en la Tabla 5. A continuación se describe la secuencia de pasos necesaria para llevar a cabo este procedimiento. 31 Tabla 5: Estructuras matriciales para realizar la segmentación Identificador Descripción MAP Máscara del Área de Procesamiento. Define la región a procesar MCE Máscara de Cabezas de Espermatozoides. Almacena las posibles regiones que corresponden a cabezas de espermatozoides MNCA Máscara de Núcleo de Círculo y Anillo. Almacena las regiones que corresponden a posibles espermatozoides incluyendo cabeza, PI y cola MCOE Máscara de Contornos de Espermatozoides. Guarda los contornos de las regiones presentes en la MNCA 2.3.3.1 CONSTRUCCIÓN DE LA MÁSCARA DE CABEZAS DE ESPERMATOZOIDES (MCE) La Máscara de Cabezas de Espermatozoides (MCE) almacena las regiones de la imagen que corresponden a posibles cabezas de espermatozoides. Para construir esta estructura, se aplicó el algoritmo de Búsqueda en Profundidad o DFS (por sus siglas en inglés Depth- First Search) sobre la imagen binarizada del canal rojo. Este algoritmo permite recorrer todos los nodos de un grafo de forma ordenada mas no uniforme. La adaptación del DFS al problema se logra considerando la imagen como un grafo g(v,e) donde |v| es el conjunto de píxeles que la conforman y |e| se define en base a la conectividad de los 8 píxeles vecinos a cada píxel (exceptuando el caso de los píxeles ubicados hacia los bordes de la imagen). A medida que se recorren los nodos del grafo que comparten el valor 1, se guardan tanto los límites (izquierdo, derecho, inferior y superior) de cada región, como el área en términos de número de píxeles recorridos. Para construir la MCE, se descartan las regiones con dimensiones inferiores a 18x18 píxeles o superiores a 55x55 píxeles (heurísticamente calculado), al ser recorridas nuevamente por DFS cambiando en tales posiciones el valor a 0. En la Figura 13 se muestra un ejemplo de MCE, puede observarse que la pequeña mancha presente en el cuadro intermedio se remueve a través de este mecanismo en el cuadro derecho. Figura 13: Máscara de Cabezas de Espermatozoides (MCE) 32 http://www.cs.mcgill.ca/%7Ecs251/OldCourses/1997/topic26/ http://www.cs.mcgill.ca/%7Ecs251/OldCourses/1997/topic26/ 2.3.3.2 PROPUESTA DE OPERADOR DE TEXTURA NÚCLEO DE CIRCULO Y ANILLO (NCA) En ocasiones, como se observa en la Figura 13, la construcción de la MCE presenta algunos problemas dado que las cabezas de los espermatozoides próximos entre sí suelen fusionarse en una misma región. Este artefacto resulta inconveniente ya que dificulta la segmentación correcta de las estructuras; por esta razón, se hizo necesario diseñar un mecanismo para separarlos que además de clasificar las regiones mediante la intensidad del píxel actual, considerase la vecindad en la que éste se inserta. Las técnicas de segmentación por operadores de textura asignan un valor al píxel central en función del análisis de la vecindad que lo incorpora. Sin embargo, los operadores del tipo rango, varianza y media, entre otros, no arrojaban los resultados esperados, por lo que se propuso un nuevo operador de textura que permitiera separar los espermatozoides en su totalidad del fondo. La estructura del operador diseñado se define a partir de dos regiones. La región A está conformada por un círculo centrado en el píxel de interés y radio R. La región B consiste en un anillo con radio interno R y radio externo S. Dada la forma del operador resultante, se le denominó Operador de Círculo y Anillo. La idea consistió en comparar el promedio de intensidades de gris de la región A, con el promedio de intensidades de gris de la región B. La segmentación se logra mediante el conocimiento heurístico de que los espermatozoides son más oscuros que el fondo, de modo que si el promedio de A es menor al promedio de B, al píxel central se le asigna el valor 1, caso contrario se le asigna el valor 0. La Figura 14 muestra una representación del NCA. Figura 14: Núcleo de Círculo y Anillo 2.3.3.3 CONSTRUCCIÓN DE LA MÁSCARA DE NÚCLEO DE CÍRCULO Y ANILLO (MNCA) La aplicación de la técnica de segmentación por NCA hizo posible separar con mayor precisión los espermatozoides cercanos entre si, al procesar la imagen en escala de grises correspondiente al canal verde (la imagen del canal rojo presentaba transiciones suaves y 33 menor contraste). Como resultado, se construyó una nueva estructura matricial a la que se denominó Máscara de Núcleo de Círculo y Anillo (MNCA). Para construir la MNCA se deben realizar dos operaciones. El primer paso consiste en binarizar utilizando NCA con radio R y S de 3 y 5 píxeles respectivamente. Se decidió utilizar estos valores ya que se observó que a mayor tamaño de R y S menor precisión en la segmentación, dado que los espermatozoides cercanos se unían producto del desbordamiento de sus contornos. En el caso de valores R y S muy pequeños, por el contrario, los contornos de los espermatozoides no cerraban adecuadamente. El segundo paso consiste en remover mediante DFS las regiones cuya dimensión sea inferior a 25x25 píxeles (calculado heurísticamente). El propósito de la MNCA es almacenar las estructuras de los espermatozoides como un conjunto, es decir, incluyendo cabeza, pieza intermedia y cola (en el caso de estar presentes). La Figura 15 muestra un ejemplo de MNCA. Puede observarse en el cuadro intermedio que la segmentación por NCA resalta algunas regiones del fondo producto de pequeñas variaciones uniformes en la intensidad de gris. Estas regiones no corresponden a espermatozoides. Como puede verse en el cuadro de la derecha, se intenta corregir este error aplicando el algoritmo DFS. Figura 15: Máscara de Núcleo de Círculo y Anillo (MNCA) 2.3.3.4 CONSTRUCCIÓN DE LA MÁSCARA DE CONTORNOS DE ESPERMATOZOIDES (MCOE) Las estructuras MCE y MNCA, almacenan información complementaria acerca de la ubicación y forma de los espermatozoides respectivamente. No obstante, como ya se ha mencionado, la MCE presenta errores típicos del algoritmo de umbralización a dos niveles que pueden ser corregidos con la información que guarda la MNCA. Para ello, se debe construir una cuarta estructura matricial a la que se denominó Máscara de Contornos de Espermatozoides (MCOE). El procedimiento se lleva a cabo en tres pasos. Primero, se debe aplicar la operación de convolución sobre la MNCA utilizando el núcleo horizontal, vertical y diagonal de Prewitt de 3x3 (en ambos sentidos) para detectar contornos. A la imagen resultante, se le aplica dos veces la operación morfológica de erosión. En la primera aplicación se erosiona el píxel central si el píxel a la izquierda tiene valor 1, mientras que para la segunda aplicación se erosiona el píxel central si el píxel superior tiene valor 1. Finalmente, se aplica DFS para 34 eliminar las regiones de la imagen cuyas dimensiones sean inferiores a 25x25 píxeles (heurísticamente determinado) ya que corresponden a algunos contornos internos de la cabeza del espermatozoide. En la Figura 16 se muestra de izquierda a derecha los pasos descritos para construir la estructura MCOE. Figura 16: Máscara de Contornos de Espermatozoides (MCOE) 2.3.3.5 EXTRACCIÓN DE CAJAS CONTENEDORAS ORIENTADAS Una vez que se dispone de las estructuras MCE y MCOE se aplica el operador morfológico XOR entre ambas. A la imagen resultante, se remueven tanto las regiones cuya área sea inferior a 200 píxeles (heurísticamente calculado) utilizando DFS, como aquellas que no sean intersecadas por la MNCA (ya que posiblemente corresponden a manchas u otro tipo de células). Como puede verse en la Figura 17, este procedimiento facilita la depuración y separación de las cabezas de los espermatozoides que se hallan en contacto. A pesar de que las cabezas resultantes pierdan algunos píxeles de contorno (que serán repuestos en estadios posteriores del procesamiento), se facilita la estimación de las Cajas Contenedoras Orientadas (CCO), así como una primera aproximación al cálculo de los ejes de orientación del espermatozoide. . Figura 17: Separación de cabezas fusionadas Durante la aplicación de DFS para la remoción de las regiones pequeñas, se debe tomar la precaución de guardar los límites (izquierdo, derecho, superior e inferior) de cada región. Estas coordenadas definen un rectángulo de procesamiento que restringe el área de cálculo para la recta de mayor longitud que pase por la cabeza e incluya el centro del rectángulo. Las CCOs se construyen a partir del ángulo formado entre esta diagonal mayor provisional y el eje de las abscisas. Una vez calculado el ángulo de inclinación, al rotar las regiones en 35 sentido de las agujas del reloj, se facilita el cálculo de las dimensiones ajustadas del objeto incluyendo la diagonal menor parcial. La estructura resultante se define, por consiguiente, mediante las coordenadas del menor rectángulo que contenga al objeto. Sin embargo, debido al hecho de que se calcula a partir de la MCE, y ésta solo almacena las posibles cabezas de los espermatozoides; se amplían las coordenadas 10 píxeles hacia ambos límites de la diagonal mayor parcial para intentar incorporar heurísticamente la pieza intermedia del espermatozoide. Finalmente, se deben rotar las coordenadas limítrofes del objeto en el sentido contrario a las agujas del reloj. En la Figura 18 se ilustra este procedimiento. Figura 18: Cálculo de Cajas Contenedoras Orientadas Una vez calculadas las diagonales parciales, se pueden realizar nuevos descartes o filtrado de las estructuras. En efecto, se eliminan las CCOs que cumplan con alguno de los siguientes criterios: 1) Las diagonales no se cruzan en un punto común, 2) La diagonal parcial menor, luego del procesamiento, presenta mayor longitud que la diagonal parcial mayor en una proporción de 1.1, y 3) Dos o más vértices de los cuatro que definen las diagonales resultan contenidos en otra CCO de mayores dimensiones. En el cuadro de la derecha de la Figura 19 se observan ejemplos de estos 3 casos. Figura 19: Criterios de descarte de regiones de acuerdo a las diagonales parciales 2.3.3.6 SEPARACIÓN DE ESTRUCTURAS DEL ESPERMATOZOIDE Luego de la construcción de las CCOs, el siguiente paso consiste en identificar las estructuras de los espermatozoides contenidos en las regiones delimitadas. Este procedimiento se logra aplicando nuevamente la técnica de umbralización, pero esta vez utilizando dos umbrales locales calculados para cada CCO. Para el cálculo de estos 36 umbrales se toma la intensidad de gris promedio en la región delimitada por la CCO y se multiplica, siguiendo un criterio heurístico, por 0,6 para obtener el umbral 1 y 1,15 para obtener el umbral 2. Estas proporciones se obtuvieron luego de realizar varias pruebas y en general ofrecieron mejores resultados para diferenciar las estructuras presentes. Como resultado del procedimiento descrito, se obtienen regiones definidas a tres niveles de intensidad de gris donde el color negro corresponde a la Región post-acrosómica, el color gris identifica tanto al acrosoma como a la pieza intermedia y el color blanco representa el fondo. Como puede observarse en la Figura 20, se requiere corregir el efecto de desbordamiento de las regiones, lo que se logra en tres pasos lógicos: 1) Aplicar el operador lógico XOR entre la MCOE y la imagen trinarizada, 2) Remover las regiones pequeñas hacia los bordes de las estructuras y 3) Aplicar el operador lógico OR entre la imagen resultante y la MNCA para volver a agregar los píxeles del borde. Figura 20: Umbralización de CCO a tres niveles No obstante, y a pesar de haber corregido el problema de desbordamiento de la umbralización a tres niveles, los resultados de la operación no resultan satisfactorios ya que la pieza intermedia y la región acrosómica de la cabeza comparten la misma categoría, como consecuencia de presentar intensidades de gris semejantes en la imagen original. Para solucionar este problema, se hizo necesario definir un conjunto de reglas heurísticas (descritas en la Tabla 6) que al ser aplicadas pudieran diferenciar entre estas estructuras. En la Figura 21 se muestra de izquierda a derecha ejemplos de la aplicación de cada una de las cuadro reglas. Tabla 6: Heurísticas de decisión para diferenciar entre PI y acrosoma Nro. Regla Decisión 1 El contorno definido en la MCOE corta alguno de los bordes de la CCO en dirección a la diagonal mayor. El lado de corte corresponde a la PI. 2 El contorno definido en la MCOE no corta los bordes de la CCO en dirección a la diagonal mayor y sobra considerable espacio hacia alguno de los lados. El lado sobrante corresponde al acrosoma. 3 El contorno definido en la MCOE corta ambos o ningún borde en dirección a la diagonal mayor de la CCO. El lado más ancho corresponde al acrosoma. 37 (Continuación de Tabla 6) 4 Hay una única región gris. Si es más ancha que la región post-acrosómica se trata del acrosoma, caso contrario de la PI Figura 21: Ejemplos de heurísticas para diferenciar entre PI y acrosoma Como puede verse en los cuadros 1 y 2 de la Figura 21, para la aplicación de las dos primeras reglas, dado que la imagen segmentada se procesa rotada hasta alinear con el eje de las abscisas, se recorre la matriz de píxeles en sentido horizontal ubicando las posiciones de los límites laterales del contorno. En el caso de las dos últimas reglas (cuadros 3 y 4), se recorre la matriz en sentido vertical, ubicando el ancho máximo de la mitad izquierda y derecha. Las posiciones y medidas obtenidas permiten, en última instancia, la aplicación de las reglas heurísticas. Las estructuras de datos descritas anteriormente permiten, en conjunto, lograr la segmentación de los espermatozoides presentes en las imágenes. En general, y a modo de síntesis, los pasos necesarios para realizar este procedimiento son los siguientes: 1) Calcular un umbral global según el método de Otsu. 2) Binarizar la imagen del canal rojo. 3) Construir la MAP. 4) Construir la MCE. 5) Construir la MNCA. 6) Construir la MCOE. 7) Remover las regiones de la MCE que no intersequen la MNCA. 8) Separar las cabezas muy cercanas aplicando XOR entre la MCE y la MCOE removiendo las regiones pequeñas. 9) Calcular las diagonales mayores y menores parciales. 10) Calcular las Cajas Contenedoras Orientadas. 11) Filtrar las CCO analizando el cruce de las diagonales. 12) Umbralizar a tres niveles las áreas definidas por las CCOs. 13) Corregir el efecto de desbordamiento aplicando XOR entre la imagen umbralizada y la MCOE removiendo las regiones pequeñas. 14) Aplicar las cuatro reglas heurísticas para identificar el acrosoma y la PI. 38 2.3.4 EXTRACCIÓN DE CARACTERÍSTICAS Como resultado del procedimiento de segmentación, se guardan por separado las imágenes rotadas (alineadas con el eje de las abscisas) de las posibles estructuras a ser consideradas como espermatozoides. El siguiente paso consiste, por lo tanto, en extraer las características de cada una de estas regiones. Siguiendo los criterios de la OMS para clasificar morfológicamente cabezas de espermatozoides humanos, se decidió tomar como variables el área de la región acrosómica, post-acrosómica, así como el área total de la cabeza, calculadas utilizando DFS. Se cree que estos criterios permiten determinar la presencia de defectos de tamaño (macrocéfalo o microcéfalo). Adicionalmente, facilitan la detección de defectos relacionados a la proporción entre el área de las regiones (se considera una cabeza normal si la región acrosómica ocupa entre el 40% y el 70% del tamaño total [OMS01]). Otro grupo de defectos relacionado a la cabeza tiene que ver con la forma. Para estimar qué tan ovalada resulta la cabeza, se registra el tamaño de sus ejes de orientación (horizontal y vertical), donde la relación entre éstos ofrece una idea acerca de la elipticidad de la estructura. Para el cálculo de los ejes, se recorre la imagen horizontal y verticalmente guardando la máxima cantidad de píxeles contiguos en cada sentido que pertenezcan a la región de la cabeza. En la Figura 22 se ilustra la forma de calcular estos ejes, se observa que para el cálculo del eje horizontal se trazan rectas paralelas a las abscisas por cada fila de la matriz, mientras que para el cálculo del eje vertical se trazan rectas paralelas a las ordenadas por cada columna de la matriz. Figura 22: Cálculo de eje horizontal y vertical de la cabeza Sin embargo, esta relación no registra la presencia de deformaciones o anormalidades. Para estimar este tipo de defectos, se calcula el perímetro de la cabeza contando los píxeles del borde y se compara esta medida con el perímetro de la elipse definida a partir de los ejes. La Figura 23 ilustra este procedimiento. Se cree que mientras mayor sea la diferencia entre ambas medidas, mayor será la deformación de la cabeza ya que el contorno será más irregular. 39 Figura 23: Cálculo de perímetro de la cabeza y perímetro de elipse ideal Otra medida del grado de deformación se logra a través del cálculo de la diferencia en píxeles entre la elipse ideal y el contorno real. Esta diferencia se calcula dibujando la elipse en una matriz auxiliar y contando en valor absoluto la distancia de un píxel de la elipse con respeto a su homólogo en el contorno de la cabeza. Se cree que a menor ajuste del contorno a la elipse ideal, más irregular resulta la forma de la cabeza. En la Figura 24 se ilustra este procedimiento, se observa en el cuadro de la derecha que la diferencia calculada corresponde al área localizada entre la cabeza y la elipse ideal. Figura 24: Diferencia entre contorno real y elipse ideal Para analizar el defecto de inserción asimétrica de la pieza intermedia, se decidió calcular el ángulo de inserción (en grados) entre el eje horizontal de la cabeza y la PI. Una vez obtenido el eje horizontal, el procedimiento consiste en trazar una recta que pase por el punto de inicio de esta diagonal y la ordenada media de la abscisa limítrofe de la pieza intermedia. En la Figura 25 se ilustra el algoritmo, el ángulo calculado puede observarse en la ampliación del cuadro de la derecha. Figura 25: Cálculo de ángulo de inserción de PI 40 El ancho máximo de la PI, permite, por su parte, estimar defectos como la presencia de gota citoplasmática y Cuello engrosado. Esta medida se calcula recorriendo la imagen verticalmente guardando la máxima cantidad de píxeles contiguos que pertenezcan a la PI. Como puede verse en el ejemplo del cuadro de la derecha de la Figura 26, la recta más cercana a la región post-acrosómica corresponde a la máxima anchura de la PI. Figura 26: Cálculo de ancho máximo PI Finalmente, para el caso de cabezas sueltas en la escena, se creyó conveniente representar en una variable la presencia o ausencia de la PI cuando la región correspondiente resultaba despreciable en término de área (menor a 5 píxeles). En total se definió un conjunto de 13 variables para construir el vector de características. En la Tabla 7 se enumeran y definen estos parámetros morfológicos. Tal como se ha señalado, algunas de estas características no guardan relación directa con los criterios formales de clasificación de la OMS, no obstante, operan como variables auxiliares, que combinadas de la manera apropiada, hacen factible su clasificación. La Figura 27 ilustra los parámetros considerados. Tabla 7: Aspectos morfológicos evaluados Parámetro Descripción Área cabeza Número de píxeles contenidos en la región de la cabeza. Área acrosoma Número de píxeles contenidos en la región acrosómica. Área post-acrosoma Número de píxeles contenidos en la región post-acrosómica. Eje horizontal cabeza Longitud en píxeles del eje horizontal de la cabeza. Eje vertical cabeza Longitud en píxeles del eje vertical de la cabeza. Diferencia Ei-Cr Diferencia en píxeles entre contorno real y contorno de elipse ideal calculada a partir de los ejes de la cabeza. Elipticidad División entre eje horizontal y eje vertical de la cabeza. Perímetro real Número de píxeles que conforman el borde de la cabeza. Perímetro ideal Perímetro elíptico definido por: p = 2π√((a²+b²)/ 2). Diferencia Pi - Pr Diferencia entre perímetro elíptico ideal y perímetro real. Presencia PI Indica si la pieza intermedia está o no presente. Ángulo inserción PI Ángulo en grados entre eje Horizontal de la cabeza y eje PI– cabeza. Ancho máximo PI Ancho máximo en píxeles de PI. 41 Figura 27: Extracción de Características 2.3.5 ANÁLISIS DE RESULTADOS Con el objetivo de estimar la confiabilidad y calidad de los resultados arrojados por el módulo de procesamiento, se diseñó un protocolo de prueba que consistía en seleccionar aleatoriamente 89 imágenes de las 294 disponibles, lo que equivale aproximadamente al 30,27% de la población. Para cada una de las imágenes se contó la cantidad de espermatozoides presentes, la cantidad de reconocimientos exitosos, el número de espermatozoides no reconocidos, el número de falsos reconocimientos y el número de errores cometidos al diferenciar entre el acrosoma y la pieza intermedia. La Tabla 8 muestra los resultados obtenidos. Tabla 8: Resultados del protocolo de prueba Parámetro Valor Estructuras identificadas 1209 Espermatozoides presentes 1196 Espermatozoides reconocidos 1116 Espermatozoides no reconocidos 80 Falsos reconocimientos 93 Diferenciación errónea entre acrosoma y pieza intermedia 84 El error de segmentación establece una relación entre los falsos reconocimientos y las detecciones totales con el objetivo de estimar la capacidad de discriminación del algoritmo de segmentación. Se trata de una estimación del grado de confiabilidad de las detecciones realizadas por el algoritmo. La fórmula para el cálculo de este error es la siguiente: 42 Para la muestra seleccionada, en total se reconocieron 1209 estructuras, de las cuales 93 no eran espermatozoides. Es decir, se comete un error de segmentación de 7,69% confundiendo algunas regiones de las imágenes con espermatozoides. Sin embargo, y a pesar de que el error de segmentación sea relativamente bajo, en algunas imágenes se incrementaba considerablemente la tasa de falsos reconocimientos, sobre todo en las láminas (como se observa en la Figura 28) que presentaron problemas para lograr la coloración adecuada de la muestra. En tales imágenes surgían manchas considerablemente similares tanto en color como en proporciones a los espermatozoides. La Figura 29 muestra un gráfico que refleja en el eje de las ordenadas la tasa de falsos reconocimientos para cada una de las imágenes de la muestra agrupadas según las láminas a las que pertenecían. Como puede verse, en la lámina C la tasa incrementa significativamente hasta casi duplicar el valor máximo de las restantes láminas. Figura 28: Algunos problemas en la coloración de las muestras Figura 29: Tasa de falsos reconocimientos agrupados por láminas Otra medida de la capacidad de discriminación del algoritmo de segmentación consiste en determinar la proporción de omisiones en la detección de espermatozoides. El error de omisión relaciona el número de espermatozoides no reconocidos con el número de espermatozoides presentes. La fórmula para el cálculo de esta medida es la siguiente: Para la muestra seleccionada, el algoritmo de segmentación no detectó 80 espermatozoides de los 1196 presentes, lo que equivale a una tasa aproximada de error de omisión de 6,69%. 43 Finalmente, la estimación de la calidad y precisión de las características extraídas en los espermatozoides reconocidos, se logra relacionando las equivocaciones cometidas al aplicar las reglas heurísticas para diferenciar entre el acrosoma y la pieza intermedia con el número de reconocimientos exitosos. En este sentido, si antes de la extracción de las características se diferenció erróneamente estas estructuras, los resultados del procesamiento para tal espermatozoide serán incorrectos. La fórmula para el cálculo de este error es la siguiente: Para la muestra seleccionada se cometieron 84 errores diferenciando entre el acrosoma y la PI en las 1116 detecciones exitosas de células espermáticas, lo que equivale a un error de extracción de características de 7,53%. En la Figura 30, se muestra una representación gráfica de la proporción de los errores cometidos para la muestra seleccionada siguiendo el protocolo de prueba. Figura 30: Errores cometidos durante el procesamiento de las imágenes El protocolo de prueba también contempló el estudio de los aspectos relacionados a la eficiencia en la ejecución del módulo de procesamiento, medida en términos del tiempo requerido para realizar los cómputos de segmentación y extracción de características. En la Tabla 9 se muestran los intervalos de tiempo obtenidos para el procesamiento de las imágenes de la muestra, así como el tiempo de operación promedio. Tabla 9: Tiempo requerido por el módulo de procesamiento Operación Tiempo mínimo Tiempo máximo Tiempo promedio Segmentación 2,223 segundos 2,880 segundos 2,507 segundos Extracción de caratcterísticas 0,355 segundos 0,978 segundos 0,657 segundos Ambas 2,578 segundos 3,858 segundos 3,164 segundos A pesar de que la concentración espermática de cada lámina resultó variable y condicionó el tiempo de procesamiento de la imagen (a mayor número de espermatozoides por imagen 44 mayor tiempo requerido), se obtuvieron rangos de valores relativamente ajustados (aproximadamente de 500 milisegundos) lo que es indicio de que el orden de complejidad de los algoritmos resulta adecuado. En la Figura 31 se muestra una comparación entre el tiempo promedio necesario para ejecutar cada una de las operaciones con respecto al tiempo total de procesamiento si se ejecutaran ambas. Puede observarse que la segmentación requiere de aproximadamente cuatro veces el tiempo que se invierte en la operación de extracción de características, lo que refleja su mayor complejidad algorítmica dado el elevado volumen de cálculos matriciales que realiza. Figura 31: Comparación entre los tiempos promedios de ejecución de las operaciones 45 2.4 DESARROLLO DE LA APLICACIÓN La siguiente sección describe los requerimientos de la aplicación y los Casos de Uso diseñados para satisfacerlos. Posteriormente, se muestra el ambiente de ventanas que caracteriza la aplicación, definido a partir del análisis de los requerimientos. 2.4.1 ANÁLISIS DE REQUERIMIENTOS Y MODELOS DE CASO DE USO Durante la fase de levantamiento de la información fueron identificados los siguientes requerimientos: A) El usuario debe poder cargar una imagen o directorio de imágenes en cualquiera de los formatos gráficos comúnmente utilizados (JPG, PNG, BMP y GIF). B) En caso de abrir un directorio de imágenes, se debe ofrecer la posibilidad de procesar todas las imágenes contenidas en éste. C) El usuario debe poder verificar individualmente el procesamiento de los espermatozoides reconocidos, así como ser capaz de introducir etiquetas de clasificación a cada uno de estos, en caso que lo desee. D) El usuario debe poder consultar en cualquier instante los estadísticos de procesamiento realizado a los espermatozoides presentes. E) La aplicación debe guardar en cualquier instante el trabajo de clasificación que está realizando el usuario y garantizar la persistencia de estos datos. F) El usuario debe poder generar un archivo de texto plano que contenga todas las características extraídas de los espermatozoides, así como las etiquetas asignadas a estos por el usuario. La Figura 32 detalla los Casos de Uso básicos definidos para satisfacer los requerimientos de la aplicación. En la Tabla 10 se describe cada caso. Figura 32: Casos de Uso básicos (nivel 0) del Clasificador de Morfología Espermática 46 Tabla 10: Descripción nivel 0 de Casos de Uso básicos Nombre Abrir imagen Identificador CU 1 Descripción El usuario puede abrir la imagen que desee en cualquiera de los formatos JPG, PNG, BMP o GIF Pre-Condición Ninguna Post-Condición Se muestra la imagen en la interfaz manteniendo el radio-aspecto original Nombre Abrir directorio de imágenes Identificador CU 2 Descripción El usuario puede abrir un directorio de imágenes en formato JPG, PNG, BMP o GIF Pre-Condición Ninguna Post-Condición Se muestra la primera imagen del directorio en la interfaz manteniendo el radio-aspecto original Nombre Procesar imagen Identificador CU 3 Descripción El usuario puede iniciar la secuencia de procesamiento que se ocupa de la segmentación y extracción de características de los espermatozoides Pre-Condición Se ha cargado una imagen en la aplicación Post-Condición Se identifican los espermatozoides reconocidos con un id numérico ascendente que inicia en 0. En el panel lateral se carga la imagen y clasificación del primer espermatozoide reconocido, así como las etiquetas que le hayan sido asignadas en procesamientos previos Nombre Generar archivo de clasificación Identificador CU 4 Descripción El usuario puede especificar al sistema el momento en el que desee generar el archivo de clasificación Pre-Condición Todas las imágenes abiertas deben haber sido procesadas Post-Condición El sistema genera o sobrescribe (en caso de existir) el archivo de clasificación ‘espermatozoides.txt’ Nombre Consultar estadísticas Identificador CU 5 Descripción El usuario puede consultar las estadísticas de procesamiento de las imágenes analizadas Pre-Condición Ninguna Post-Condición Se informa al usuario acerca de los estadísticos de procesamiento de los espermatozoides analizados Nombre Visualizar Ayuda Identificador CU 6 Descripción Se muestra una breve descripción del funcionamiento de la aplicación, así como de la forma de operar sus funcionalidades Pre-Condición Ninguna Post-Condición Se muestra la ventana con la ayuda del sistema 47 Las Figuras 33 y 34 muestran la especificación de nivel 1 para los Casos de Uso CU2 y CU3, mientras que en las Tablas 11 y 12 se describen, respectivamente, estos casos. Figura 33: Especificación de Casos de Uso nivel 1 para CU2 Tabla 11: Descripción nivel 1 para CU2 Nombre Seleccionar imagen Identificador CU 2.1 Descripción El usuario puede seleccionar cualquier imagen contenida en el directorio Pre-Condición CU 2 Post-Condición Se muestra en la interfaz la imagen seleccionada por el usuario manteniendo el radio-aspecto original Figura 34: Especificación de Casos de Uso nivel 1 para CU3 48 Tabla 12: Descripción nivel 1 para CU3 Nombre Cargar imagen Identificador CU 3.1 Descripción El sistema busca el archivo de clasificación de la imagen actual, y, en caso de existir, carga todas las clasificaciones disponibles Pre-Condición CU 1 ó CU 2 Post-Condición El sistema se actualiza con la información relacionada al procesamiento previamente almacenado para la imagen actual o crea los archivos de persistencia necesarios Nombre Clasificar espermatozoide Identificador CU 3.2 Descripción El usuario puede clasificar cualquiera de los espermatozoides reconocidos por el módulo de procesamiento Pre-Condición CU 3.1 Post-Condición Se registra permanentemente la clasificación del usuario al espermatozoide seleccionado Nombre Ver Cajas Contenedoras Orientadas Identificador CU 3.3 Descripción El usuario puede visualizar las Cajas Contenedoras Orientadas de los espermatozoides reconocidos por el módulo de procesamiento Pre-Condición La imagen se ha procesado con éxito Post-Condición La interfaz muestra las Cajas Contenedoras Orientadas de los espermatozoides reconocidos Nombre Ver diagonales mayores Identificador CU 3.4 Descripción El usuario puede visualizar las diagonales mayores de los espermatozoides reconocidos por el módulo de procesamiento Pre-Condición La imagen se ha procesado con éxito Post-Condición La interfaz muestra las diagonales mayores de los espermatozoides reconocidos Nombre Ver diagonales menores Identificador CU 3.5 Descripción El usuario puede visualizar las diagonales menores de los espermatozoides reconocidos por el módulo de procesamiento Pre-Condición La imagen se ha procesado con éxito Post-Condición La interfaz muestra las diagonales menores de los espermatozoides reconocidos Nombre Amplificar imagen Identificador CU 3.6 Descripción El usuario puede amplificar la imagen procesada Pre-Condición La imagen se ha procesado con éxito Post-Condición La interfaz muestra la imagen procesada amplificada 49 (Continuación de Tabla 12) Nombre Ver identificadores Identificador CU 3.7 Descripción El usuario puede visualizar los identificadores de los espermatozoides reconocidos por el módulo de procesamiento Pre-Condición La imagen se ha procesado con éxito Post-Condición La interfaz muestra los identificadores de los espermatozoides reconocidos Nombre Exportar espermatozoides segmentados Identificador CU 3.8 Descripción El usuario puede exportar como imágenes individuales los espermatozoides reconocidos por el módulo de procesamiento Pre-Condición La imagen se ha procesado con éxito Post-Condición Se guardan las imágenes de los espermatozoides reconocidos en el directorio seleccionado por el usuario Nombre Ver contornos de espermatozoides Identificador CU 3.9 Descripción El usuario puede visualizar los contornos detectados en la imagen por el módulo de procesamiento Pre-Condición La imagen se ha procesado con éxito Post-Condición La interfaz muestra los contornos detectados en la imagen 2.4.2 PLATAFORMA TECNOLÓGICA Para el desarrollo de la aplicación se utilizó la siguiente configuración de desarrollo: A) Especificaciones de Hardware Procesador Intel® Coretm2 Duo CPU 1,80 GHz 1,5 GB de Memoria RAM. Disco Duro de 120GB. B) Sistema Operativo La aplicación se desarrollo bajo ambiente Microsoft® Windows XP Profesional, versión 2002, Service Pack 3. C) Herramientas de Software Luego de evaluar diversas herramientas de desarrollo se seleccionaron las siguientes: Kit de Desarrollo Java (JDK): incluye la Máquina Virtual de Java (Java SE Runtime Environment) versión jre1.6.0_07 y la versión 1.6.0_03 de JDK. Entorno de desarrollo integrado: NetBeans 6.1. Editor de archivos de texto: Notepad++. Microsoft® Paint versión 5.1. Adobe® Photoshop® CS2 versión 9.0.2. 50 2.4.3 DISEÑO DE LA INTERFAZ A la herramienta resultante se le denominó CME en alusión a Clasificador de Morfología Espermática. La aplicación consiste en una única ventana que incluye los controles necesarios para ejecutar todas las funcionalidades. Se cree que este mecanismo simplifica la interacción con el sistema ya que el usuario no debe operar varias ventanas. Para el diseño de la interfaz, se decidió mantener condiciones similares a las que caracterizan el entorno de trabajo del experto. En la Figura 35 se muestra la interfaz de la aplicación. Figura 35: Interfaz del Clasificador de Morfología Espermática Las funcionalidades de la aplicación se encuentran agrupadas convenientemente en 5 menús. El primer menú se denomina “Archivo” y ofrece la posibilidad de abrir ya sea una imagen o directorio de imágenes, exportar las imágenes de los espermatozoides reconocidos, exportar la vista principal como imagen y salir de la aplicación. En la Figura 36 se muestran estas funcionalidades. 51 Figura 36: Menú Archivo Con el objetivo de facilitar la visualización de los resultados del procesamiento, se ofrece al usuario la opción de activar o desactivar el dibujado de diversas estructuras, así como la posibilidad de controlar el tamaño de la vista principal. En el menú “Ver” se permite seleccionar entre la vista ajustada a los controles y la vista aumentada de la imagen procesada además de mostrar u ocultar Cajas Contenedoras Orientadas, diagonales mayores, diagonales menores e identificadores de los espermatozoides reconocidos por el módulo de procesamiento. La Figura 36 muestra el menú “Ver” así como ejemplos de sus funcionalidades. Figura 37: Funcionalidades del menú Ver Durante el procesamiento, el usuario puede determinar la secuencia a seguir utilizando las funcionalidades del menú “Ir a” o los botones de la barra de herramientas. En la Figura 38 se detallan estas operaciones. Como puede verse, el usuario puede seguir una secuencia ordenada de procesamiento o definir su propia secuencia utilizando el Combo Box, que indica además las imágenes que faltan por procesar anteponiendo la letra “x” al nombre de éstas. Figura 38: Secuencia de procesamiento de las imágenes 52 En caso de que el usuario desee utilizar la aplicación como visor de imágenes de láminas de espermatozoides, puede seleccionar entre activar o desactivar el módulo de procesamiento para reducir el tiempo de espera. En la Figura 39 se muestran las funcionalidades del menú “Procesamiento”. Si el usuario decide desactivar el procesamiento automático de las imágenes debe iniciar la secuencia de procesamiento manualmente para cada imagen que desee procesar. Figura 39: Menú Procesamiento Al procesar una imagen, el usuario dispone de varias formas de visualizar los resultados. La Figura 40 muestra la funcionalidad de selección de vistas. Es posible optar por la vista de la imagen original RGB, las imágenes de cada uno de los canales RGB por separado, los contornos identificados dibujados sobre la imagen original RGB y una máscara binaria con los contornos identificados. Figura 40: Selector de vistas En cualquier instante que lo desee, el usuario puede consultar los estadísticos referentes a las imágenes procesadas por el módulo, seleccionando la pestaña “Estadísticos”. Como puede observarse en la Figura 41, esta sección muestra información general de procesamiento como número de espermatozoides no clasificados, anormales, normales y falsos reconocimientos así como registros detallados por tipos de defectos. El usuario puede exportar estas estadísticas a un archivo de texto plano si lo desea presionando el botón “Exportar”. 53 Figura 41: Estadísticos de procesamiento Finalmente, el menú “Ayuda” facilita el acceso a la ventana de ayuda del sistema, donde se explican las funcionalidades de la interfaz, así como a la ventana de créditos que muestra los datos asociados a la construcción de la aplicación. En la Figura 42 se muestra el menú “Ayuda” y en las Figuras 43 y 44 se muestran las ventanas de ayuda y créditos, respectivamente. Figura 42: Menú Ayuda 54 Figura 43: Ventana de ayuda Figura 44: Ventana de Créditos 55 CONCLUSIONES, RECOMENDACIONES Y LIMITACIONES La búsqueda de información, definición, estructuración, diseño y desarrollo del proyecto conforman un conjunto de actividades complejas que requirieron ser llevadas a cabo con precaución para garantizar el éxito de los resultados. En este sentido, se trató de un trabajo que premia el cuidado en los detalles ya que los productos de una fase se convierten en los insumos de la fase siguiente, resultando relativamente sencillo propagar errores a lo largo del proceso. Partiendo de esta premisa, se adoptó como criterio de desarrollo la exhaustividad parcial, agotando las alternativas disponibles para la culminación de una fase antes de dar paso al abordaje de la etapa siguiente. Por lo tanto, se comenzó con una amplia revisión de investigaciones en el área, donde se pudo constatar diversas posibilidades tecnológicas disponibles para abordar el problema de la automatización. Sin embargo, pronto se hizo evidente que el reconocimiento de células microscópicas en general resulta un procedimiento específico que debe ser abordado en base a heurísticas de procesamiento, factor que complica considerablemente la investigación. En efecto, varias de las pruebas realizadas con las técnicas de consulta a menudo requerían de desarrollos parciales. A pesar de existir numerosos paquetes de procesamiento digital de imágenes en el mercado, frecuentemente se requirió poner a prueba aproximaciones muy específicas definidas en base a una combinación de técnicas, que no siempre resulta equivalente a la aplicación secuencial e independiente de éstas. Por esta razón es conveniente disponer, además de paquetes de procesamiento de imágenes, de un entorno de trabajo que permita hacer rápidamente estas pruebas ofreciendo la posibilidad de depuración de algoritmos. Especialmente porque no siempre resulta sencillo encontrar errores de implementación cuando se combinan varios algoritmos. La segmentación de las estructuras consistió, por lo tanto, en el problema más complejo al que se enfrentó la investigación dado que es el punto de partida para lograr la solución y de ella dependían las siguientes fases del desarrollo. Se trató de una actividad en la que se invirtió la mitad del tiempo total del trabajo tratando de cumplir con los estándares de calidad propuestos. El desarrollo de esta fase pone en evidencia la indeterminación de este tipo de investigaciones donde no existe una solución a priori: se debe participar crítica, activa y creativamente en la construcción del camino a seguir. En efecto, como producto y aporte de la fase de segmentación, surge el desarrollo del operador de textura NCA (Núcleo de Círculo y Anillo), que permitió avanzar a la siguiente fase de identificación de las estructuras del espermatozoide. Se trató de una alternativa útil para la definición de contornos de células espermáticas, aunque es probable que su extrapolación al contexto de otras células microscópicas deba hacerse siguiendo las consideraciones heurísticas relativas al problema que se desee abordar. Otro aspecto que resultó importante se evidenció una vez abordada la fase de identificación de las estructuras del espermatozoide. Se observó que a pesar de tomar precauciones para 56 controlar el error de procesamiento definiendo un conjunto de reglas heurísticas para tal fin, éstas no lograban reducirlo más allá de ciertos límites sin afectar el desempeño general del sistema. Debido a este factor, se cree que en este tipo de investigaciones pudiera ser inevitable el hecho de tener que tolerar cierto margen de error producto de variaciones en la captura de las imágenes. Por lo tanto, resulta conveniente buscar una solución que aporte globalmente la menor cantidad de error posible, en detrimento de mejorar unilateralmente algún aspecto del procesamiento. Sin embargo, las operaciones de segmentación y extracción de características arrojan márgenes de error que comparados con la variabilidad y dificultad de replicación de los resultados de la evaluación morfológica realizada por los expertos pudieran ser tolerables. En efecto, el protocolo diseñado para estimar la calidad y confiabilidad del procesamiento estima una tasa de error de segmentación de 7,69%, error por omisión en la detección de espermatozoides de 6,69% y error en la extracción de características de 7,53%. Otro factor que debe ser analizado, tiene que ver con las características de la implementación de la solución. Luego de realizar pruebas de rendimiento, pudo constatarse que este tipo de problemas demandan al desarrollador recurrir constantemente a optimizaciones de los algoritmos con el objetivo de reducir el tiempo de ejecución. La eficiencia se encuentra en parte subordinada al uso de implementaciones convenientes de algoritmos ya conocidos (como el DFS) incorporados a la solución. En el caso de los algoritmos diseñados específicamente para la solución, se debe tomar la precaución de analizar el coste en complejidad debido a la gran cantidad de iteraciones requeridas para depurar y construir las estructuras de datos matriciales que utiliza la aplicación. En general, y a pesar de las dificultades encontradas durante el desarrollo del proyecto, se trató de una experiencia satisfactoria que permitió integrar diversas áreas del conocimiento relacionado a la ciencia de la computación. El desarrollo de CME evidencia la factibilidad de recurrir a este tipo de tecnologías en el país, mostrando los aportes de esta ciencia en la Universidad Central de Venezuela. El proyecto se constituyó en un mecanismo de difusión del uso de estas herramientas y busca informar a diversos sectores de la sociedad acerca de sus beneficios. RECOMENDACIONES Luego de concluir esta investigación se recomienda: 1. Realizar pruebas utilizando otros reactivos químicos para lograr la coloración de las muestras. El acrosoma y la pieza intermedia presentaron intensidades RGB similares con el procedimiento utilizado, lo que introduce error en el sistema. 2. Realizar pruebas utilizando mayores resoluciones para las imágenes y factores de aumento superiores a 100x para la escena. Es posible que a mayor acercamiento se logren mejores resultados. Aunque muy probablemente cambien las heurísticas relacionadas con el tamaño de las estructuras. 3. Controlar las condiciones de iluminación durante la captura de las escenas para evitar introducir ruidos periódicos en las imágenes, lo que dificulta la aplicación de 57 algunas técnicas (como la umbralización) y complican considerablemente la solución. 4. Analizar las heurísticas diseñadas para el reconocimiento de las estructuras del espermatozoide con distintos expertos. 5. Validar mediante análisis estadísticos la capacidad discriminativa de las características extraídas con el objetivo de lograr modelos de clasificación morfológica más precisos. LIMITACIONES Desde el inicio de la investigación se dispuso del banco de imágenes de las escenas capturadas con la ayuda del experto. Se cree que este factor facilitó en parte el desarrollo del trabajo dado que permite economizar el tiempo necesario para la captura de las imágenes. Sin embargo, condiciona los resultados de la investigación especialmente porque en varias imágenes se presentaron problemas en la tinción de las estructuras, lo que se constituyó en una fuente de error que no pudo ser controlada. 58 REFERENCIAS [ALE04] E. Alegre, L. Sánchez, R. Alaiz, J. Domínguez. Utilización de momentos estadísticos y redes neurales en la clasificación de cabezas de espermatozoides de verraco. XXV Jornadas de Automática, Ciudad Real, España, 2004. [BAK04] E. Bak, K. Najarian, J. Brockway. Efficient segmentation framework of cell images in noise environments. IEMBS apos, 26th Annual International Conference of the IEEE, vol. 1, issue 1-5. pp. 1802 – 1805, sept. 2004. [BOV00] Bovik A. Handbook of Image and Video Processing. Academic Press. Primera Edición, may. 31, 2000. [BUE02] P. Buendía, C. Soler. F. Paolicchi, G. Gago, B. Urquieta, F. Pérez, E. Bustos. Morphometric characterization and classification of alpaca sperm heads using the Sperm- Class Analyzer® computer-assisted system. Theriogenology, vol. 57, pp. 1207 – 1218, 2002. [CAL07] E. Calderon. Aplicación de las redes neuronales en la estimación de modelos de clasificación de la morfología de la cabeza de espermatozoide humano a partir de imágenes. Trabajo especial de grado para optar al título de Licenciado en Computación. Universidad Central de Venezuela, 2007. [CAR07] H. Carrillo, J. Villareal, M. Sotaquirá, A. Goelkel, R. Gutiérrez. A Computer Aided Tool for the Assessment of Human Sperm Morphology. Departamento de Ingeniería Eléctrica y Electrónica y Departamento de Química y Biología. Universidad del Norte, Barranquilla, Colombia. IEEE Student member, 2007. [CER06] G. Cerezo. El Análisis de Semen Humano: La Estandarización de su Evaluación. Contacto Químico 1, vol. 3, oct.-dic. 6-8, 2006. [CRA97] R. Crane. A simplified Approach to Imagen Processing Clasical and Modern Techniques in C, Prentice Hall, 1997. [FRE93] J. Freeman y D. Skapura. Redes Neuronales: Algoritmos, aplicaciones y técnicas de programación. Delaware E.U.A. Addison Wesley Iberoamericana S.A. 1993. [FOL93] J. Foley, A. van Dam, S. Feiner, J. Hughes, R. Phillips. Introduction to Computer Graphics. Addison-Wesley, Reading, may.1993. [GAR91] P. Garcia, R. Gross. Pequeño Larousse Ilustrado.Ediciones Laousse, Paris, Francia, 1991. [GON02] R. Gonzalez, R. Woods. Digital Image Processing. Prentice Hall. Segunda Edición, 2002. 59 [HAG02] M. Hagan, H. Demuth, M. Beale. Neural Network Design. PWS Publishing Company, 2002. [KAT86] D. Katz, J. Overstreet, S. Samuels, P. Nis Wander, T. Bloom, E. Lewis. Morphometric Analysis of Spermatozoa in the Assessment of Human Male Fertility. Journal of Andrology, vol. 7, pp. 203-210. jul./ago. 1986. [KRU99] T. Kruger, K. Coetzee. The role of sperm morphology in assisted reproduction. Human reproduction update, vol. 5, num. 2, pp. 172-178, 1999. [LAR04] L. Larcher, R. Costaguta. Una Red Neuronal Backpropagation Aplicada a la Microhistología. Inteligencia Artificial, Revista Iberoamericana de Inteligencia Artificial. Nro.23, pp. 105-109. ISSN: 1137-3601, 2004. [LIN94] C. Linneberg, P. Salamon, C. Svarer and L. Hanses (1994). Towards Semen Quality Assessment Using Neural Networks. Neural Networks for Signal Processing IV. Proceedings of the 1994 IEEE Workshop, pp. 509-517 (ISBN: 0-7803-2026-3). [LON05] X. Long, W. Cleveland and Y. Lawrence. A New Preprocessing Approach for Cell Recognition. IEEE Transactions on Information Technology in Biomedicine, vol. 9, nro. 3, sept. 2005. [MAR06] T. Markiewicz, S. Osowski. Data mining techniques for feature selection in blood cell recognition. ESANN'2006 proceedings - European Symposium on Artificial Neural Networks. D-side publi., ISBN 2-930307-06-4. Bruges (Bélgica), 26-28 abr., 2006. [OMS01] OMS – Organización Mundial de la Salud. Manual de Laboratorio para el examen del semen humano y de la interacción entre el semen y el moco cervical. Editorial Médica Panamericana S.A. Cuarta Edición, Madrid, España, 2001. [OTS79] N. Otsu. A. threshold selection method from gray-level histograms. Publicado en IEEE Transactions on Systems, Man, and Cybernetics, vol. 9, pp. 62-66. (ISSN 0018- 9472), 1979. [PAD88] R. Padrón, G. Fernández, M. Gallardo. Interpretación del Análisis Seminal. Revista cubana Endocrinología, ISSN 0188-9796, Instituto Nacional de Endocrinología, Departamento de Reproducción Humana, 9(1), 81-90, referenciado en 47,50, 1988. [PRA07] W. Pratt. Digital Image Processing. Fourth Edition. Wiley Interscience Publications, 2007. [RAM07A] E. Ramos, Y. Pereira, H. Núñez, M. Castro, R. Casañas. Aplicación de visualización de una ontología parra el dominio del análisis del semen humano. Ingeniería y Ciencia, ISSN 1794-9165, vol. 3, num. 5, pp. 43-66, 2007. [RAM07B] E. Ramos, H. Núñez, M. Castro, G. Rosellino, A. Urriola, R. Casañas. ANALISE: Un Sistema Multiagente para el Dominio del Análisis del Líquido Seminal 60 Humano. IWPAAMS 2007, 6th Internacional Workshop on practical applications on agents and multi-agent systems. Salamanca España, nov. 2007. [RUS07] J. Russ. The Image Processing Handbook. CRC PRESS. Quinta Edición, 2007. [RUS02] S. Russell, J. Norvig. Artificial Intelligence a morden approach. Prentice Hall. Segunda edición, 2002. [SAN05] L. Sánchez, E. Alegre. Evaluación de descriptores de textura en la clasificación de células espermáticas. XXVI Jornadas de Automática Alicante-Elche. Universidad de Alicante y Universidad Miguel Hernández de Elche, sept. 2005. [SPE04] L. Speroff, M. Fitz. Clinical Gynecologic Endocrinology and Infertility. Lippincott Williams & Wilkins. Séptima Edición, 2004. [THE03] N. Theera-Umpon. Automatic White Blood Cell Classification using Biased- Output Neural Networks with Morphological Feature. Thammasat International Journal of Science and Technology (TIJSAT), vol. 87, pp. 64-71, 2003. [TIN05] A. Tinku and K. Ajoy. Image Processing: Principles and Applications. Wiley Interscience Publications, 2005. [UMB05] S. Umbaugh. Computer Imaging: Digital Analysis and Processing. CRC PRESS BOOK, 2005. 61